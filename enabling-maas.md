
<!-- snap-ui-2-7
<table width="100%"><tr>
<tr><td>Snap >>> </td>
<td><strong>UI/2.7</strong></td>
<td><a href="https://discourse.maas.io/t/installing-maas-2-8-via-snap-and-ui/2172">UI/2.8</a></td>
<td><a href="https://discourse.maas.io/t/installing-maas-2-7-via-snap-and-cli/2173">CLI/2.7</a></td>
<td><a href="https://discourse.maas.io/t/installing-maas-2-8-via-snap-and-cli/2174">CLI/2.8</a></td><tr>
<tr><td>Packages >>> </td>
<td><a href="https://discourse.maas.io/t/installing-maas-2-7-with-packages-ui/2175">UI/2.7</a></td>
<td><a href="https://discourse.maas.io/t/installing-maas-2-8-with-packages-ui/2176">UI/2.8</a></td>
<td><a href="https://discourse.maas.io/t/installing-maas-2-7-with-packages-using-the-cli/2177">CLI/2.7</a></td>
<td><a href="https://discourse.maas.io/t/installing-maas-2-8-with-packages-using-the-cli/2178">CLI/2.8</a></td><tr>
</table>
 snap-ui-2-7 -->

<!-- snap-ui-2-8
<table width="100%"><tr>
<tr><td>Snap >>> </td>
<td><a href="https://discourse.maas.io/t/installing-maas-2-7-via-snap-and-ui/2171">UI/2.7</a></td>
<td><strong>UI/2.8</strong></td>
<td><a href="https://discourse.maas.io/t/installing-maas-2-7-via-snap-and-cli/2173">CLI/2.7</a></td>
<td><a href="https://discourse.maas.io/t/installing-maas-2-8-via-snap-and-cli/2174">CLI/2.8</a></td><tr>
<tr><td>Packages >>> </td>
<td><a href="https://discourse.maas.io/t/installing-maas-2-7-with-packages-ui/2175">UI/2.7</a></td>
<td><a href="https://discourse.maas.io/t/installing-maas-2-8-with-packages-ui/2176">UI/2.8</a></td>
<td><a href="https://discourse.maas.io/t/installing-maas-2-7-with-packages-using-the-cli/2177">CLI/2.7</a></td>
<td><a href="https://discourse.maas.io/t/installing-maas-2-8-with-packages-using-the-cli/2178">CLI/2.8</a></td><tr>
</table>
 snap-ui-2-8 -->

<!-- snap-cli-2-7
<table width="100%"><tr>
<tr><td>Snap >>> </td>
<td><a href="https://discourse.maas.io/t/installing-maas-2-7-via-snap-and-ui/2171">UI/2.7</a></td>
<td><a href="https://discourse.maas.io/t/installing-maas-2-8-via-snap-and-ui/2172">UI/2.8</a></td>
<td><strong>CLI/2.7</strong></td>
<td><a href="https://discourse.maas.io/t/installing-maas-2-8-via-snap-and-cli/2174">CLI/2.8</a></td><tr>
<tr><td>Packages >>> </td>
<td><a href="https://discourse.maas.io/t/installing-maas-2-7-with-packages-ui/2175">UI/2.7</a></td>
<td><a href="https://discourse.maas.io/t/installing-maas-2-8-with-packages-ui/2176">UI/2.8</a></td>
<td><a href="https://discourse.maas.io/t/installing-maas-2-7-with-packages-using-the-cli/2177">CLI/2.7</a></td>
<td><a href="https://discourse.maas.io/t/installing-maas-2-8-with-packages-using-the-cli/2178">CLI/2.8</a></td><tr>
</table>
 snap-cli-2-7 -->

<!-- snap-cli-2-8
<table width="100%"><tr>
<tr><td>Snap >>> </td>
<td><a href="https://discourse.maas.io/t/installing-maas-2-7-via-snap-and-ui/2171">UI/2.7</a></td>
<td><a href="https://discourse.maas.io/t/installing-maas-2-8-via-snap-and-ui/2172">UI/2.8</a></td>
<td><a href="https://discourse.maas.io/t/installing-maas-2-7-via-snap-and-cli/2173">CLI/2.7</a></td>
<td><strong>CLI/2.8</strong></td><tr>
<tr><td>Packages >>> </td>
<td><a href="https://discourse.maas.io/t/installing-maas-2-7-with-packages-ui/2175">UI/2.7</a></td>
<td><a href="https://discourse.maas.io/t/installing-maas-2-8-with-packages-ui/2176">UI/2.8</a></td>
<td><a href="https://discourse.maas.io/t/installing-maas-2-7-with-packages-using-the-cli/2177">CLI/2.7</a></td>
<td><a href="https://discourse.maas.io/t/installing-maas-2-8-with-packages-using-the-cli/2178">CLI/2.8</a></td><tr>
</table>
 snap-cli-2-8 -->

<!-- deb-ui-2-7
<table width="100%"><tr>
<tr><td>Snap >>> </td>
<td><a href="https://discourse.maas.io/t/installing-maas-2-7-via-snap-and-ui/2171">UI/2.7</a></td>
<td><a href="https://discourse.maas.io/t/installing-maas-2-8-via-snap-and-ui/2172">UI/2.8</a></td>
<td><a href="https://discourse.maas.io/t/installing-maas-2-7-via-snap-and-cli/2173">CLI/2.7</a></td>
<td><a href="https://discourse.maas.io/t/installing-maas-2-8-via-snap-and-cli/2174">CLI/2.8</a></td><tr>
<tr><td>Packages >>> </td>
<td><strong>UI/2.7</strong></td>
<td><a href="https://discourse.maas.io/t/installing-maas-2-8-with-packages-ui/2176">UI/2.8</a></td>
<td><a href="https://discourse.maas.io/t/installing-maas-2-7-with-packages-using-the-cli/2177">CLI/2.7</a></td>
<td><a href="https://discourse.maas.io/t/installing-maas-2-8-with-packages-using-the-cli/2178">CLI/2.8</a></td><tr>
</table>
 deb-ui-2-7 -->

<!-- deb-ui-2-8
<table width="100%"><tr>
<tr><td>Snap >>> </td>
<td><a href="https://discourse.maas.io/t/installing-maas-2-7-via-snap-and-ui/2171">UI/2.7</a></td>
<td><a href="https://discourse.maas.io/t/installing-maas-2-8-via-snap-and-ui/2172">UI/2.8</a></td>
<td><a href="https://discourse.maas.io/t/installing-maas-2-7-via-snap-and-cli/2173">CLI/2.7</a></td>
<td><a href="https://discourse.maas.io/t/installing-maas-2-8-via-snap-and-cli/2174">CLI/2.8</a></td><tr>
<tr><td>Packages >>> </td>
<td><a href="https://discourse.maas.io/t/installing-maas-2-7-with-packages-ui/2175">UI/2.7</a></td>
<td><strong>UI/2.8</strong></td>
<td><a href="https://discourse.maas.io/t/installing-maas-2-7-with-packages-using-the-cli/2177">CLI/2.7</a></td>
<td><a href="https://discourse.maas.io/t/installing-maas-2-8-with-packages-using-the-cli/2178">CLI/2.8</a></td><tr>
</table>
 deb-ui-2-8 -->

<!-- deb-cli-2-7
<table width="100%"><tr>
<tr><td>Snap >>> </td>
<td><a href="https://discourse.maas.io/t/installing-maas-2-7-via-snap-and-ui/2171">UI/2.7</a></td>
<td><a href="https://discourse.maas.io/t/installing-maas-2-8-via-snap-and-ui/2172">UI/2.8</a></td>
<td><a href="https://discourse.maas.io/t/installing-maas-2-7-via-snap-and-cli/2173">CLI/2.7</a></td>
<td><a href="https://discourse.maas.io/t/installing-maas-2-8-via-snap-and-cli/2174">CLI/2.8</a></td><tr>
<tr><td>Packages >>> </td>
<td><a href="https://discourse.maas.io/t/installing-maas-2-7-with-packages-ui/2175">UI/2.7</a></td>
<td><a href="https://discourse.maas.io/t/installing-maas-2-8-with-packages-ui/2176">UI/2.8</a></td>
<td><strong>CLI/2.7</strong></td>
<td><a href="https://discourse.maas.io/t/installing-maas-2-8-with-packages-using-the-cli/2178">CLI/2.8</a></td><tr>
</table>
 deb-cli-2-7 -->

<!-- deb-cli-2-8
<table width="100%"><tr>
<tr><td>Snap >>> </td>
<td><a href="https://discourse.maas.io/t/installing-maas-2-7-via-snap-and-ui/2171">UI/2.7</a></td>
<td><a href="https://discourse.maas.io/t/installing-maas-2-8-via-snap-and-ui/2172">UI/2.8</a></td>
<td><a href="https://discourse.maas.io/t/installing-maas-2-7-via-snap-and-cli/2173">CLI/2.7</a></td>
<td><a href="https://discourse.maas.io/t/installing-maas-2-8-via-snap-and-cli/2174">CLI/2.8</a></td><tr>
<tr><td>Packages >>> </td>
<td><a href="https://discourse.maas.io/t/installing-maas-2-7-with-packages-ui/2175">UI/2.7</a></td>
<td><a href="https://discourse.maas.io/t/installing-maas-2-8-with-packages-ui/2176">UI/2.8</a></td>
<td><a href="https://discourse.maas.io/t/installing-maas-2-7-with-packages-using-the-cli/2177">CLI/2.7</a></td>
<td><strong>CLI/2.8</strong></td><tr>
</table>
 deb-cli-2-8 -->

<!-- tags for this page
     snap-ui-2-7 snap-ui-2-8 snap-cli-2-7 snap-cli-2-8
     deb-ui-2-7 deb-ui-2-8 deb-cli-2-7 deb-cli-2-8
--> 

Welcome to the installation guide and compact tutorial for MAAS.  This pre-flight checklist will help you get MAAS running quickly.  Collapsible sections unclutter the page, and detailed doc references help you dig deeper. Quick questions kick off each section, help you skip to your desired topic. 

Start with the links above: Choose your preferred install method (snap vs. debian packages), interface (web UI vs. command line interface/CLI), and version (2.7 vs. 2.8) -- then select the matching link to instantly customize this material.  

#### Quick questions you may have:

* [How do I upgrade my existing MAAS?](#heading--upgrade-maas)
* [How do I install and configure MAAS?](#heading--install-config)
* [How do I add machines to MAAS?](#heading--add-machines)
* [How do I deploy and manage machines with MAAS?](#heading--deploy-machines)

<h2 id="heading--upgrade-maas">Upgrade an existing MAAS</h2>

<!-- snap-ui-2-8 snap-cli-2-8
It's easy to upgrade your 2.7 snap to 2.8 -- but you'll want to confirm whether you're running MAAS in a single node (region+rack) or on multiple nodes (separate region and rack controllers).

<h3>For a region+rack configuration</h3>

Upgrade your 2.7 snap to 2.8 with this command:

    $ sudo snap refresh --channel=2.8 maas

After entering your password, the snap will refresh from the 2.8 channel.  You will **not** need to re-initialize MAAS.

<h3>For a multi-node MAAS deployment</h3>

If you are using a multi-node maas deployment with separate regions and racks, you should first run this command on each of your rack nodes:

    $ sudo snap refresh --channel=2.8 maas

Finally, run the same command on your region node(s).
 snap-ui-2-8 snap-cli-2-8 -->

<h2 id="heading--install-config">Installing and configuring MAAS</h2>

Installing and configuring the MAAS 2.8 snap is relatively straightforward, but there are choices to make.  For example, you'll want to decide whether to install a test/proof-of-concept configuration, or just go ahead and set up a production configuration. Use this section to help you get MAAS up and running, so that you can start adding and deploying machines.

#### Quick questions you may have:

* [How do I prepare to install MAAS?](#heading--prepare-for-maas)
* [How do I install MAAS?](#heading--maas-installation)
* [How do I initialize MAAS?](#heading--init-maas)
* [How do I configure MAAS and get it running?](#heading--config-maas)

<h2 id="heading--prepare-for-maas">Preparing to install MAAS</h2>

Preparing for MAAS requires a little up-front work.  First, you need to confirm that your intended host meets the hardware requirements for MAAS; then there are a few setup steps you'll want to complete to prevent delays later on.

#### Quick questions you might have:

* [What are the requirements for a test environment?](#heading--test-environment)
* [What are the requirements for a production environment?](#heading--production-environment)
* [What setup steps should I complete before installation?](#heading--setup-steps)

<h3 id="heading--maas-requirements">MAAS host requirements</a>

The minimum requirements for your MAAS host(s) vary widely, depending on local implementation and usage.  Below, you will find resource estimates based on both the MAAS components and the Ubuntu Server operating system. We consider both a test configuration (for proof of concept) and a production environment.

<h4 id="heading--test-environment">Requirements for a test environment</h4>

Here is a proof-of-concept scenario, with all MAAS components installed on a single host. This scenario assumes two complete sets of images (latest two Ubuntu LTS releases) for a single architecture (amd64).

| | Memory (MB) | CPU (GHz) | Disk (GB) |
|:-----|-----:|-----:|-----:|
| [Region controller](/t/concepts-and-terms/785#heading--controllers) (minus PostgreSQL) | 512 | 0.5 | 5 |
| PostgreSQL | 512 | 0.5 | 5 |
| [Rack controller](/t/concepts-and-terms/785#heading--controllers") | 512 | 0.5 | 5 |
| Ubuntu Server (including logs)| 512 | 0.5 | 5 |

Based on this table, the approximate requirements for this scenario are 2 GB memory, 2 GHz CPU, and 20 GB of disk space.

<h4 id="heading--production-environment">Requirements for a production environment</h4>

Here is a production scenario designed to handle a high number of sustained client connections. This scenario implements both high availability (region and rack) and load balancing (region). MAAS reserves extra space for images (database and rack controller), while some images, such as those for Microsoft Windows, may require a lot more -- so plan accordingly.

| | Memory (MB) | CPU (GHz) | Disk (GB) |
|:-----|-----:|-----:|-----:|
| [Region controller](/t/concepts-and-terms/785#heading--controllers) (minus PostgreSQL) | 2048 | 2.0 | 5 |
| PostgreSQL | 2048 | 2.0 | 20 |
| [Rack controller](/t/concepts-and-terms/785#heading--controllers") | 2048 | 2.0 | 20 |
| Ubuntu Server (including logs)| 512 | 0.5 | 5 |

So, based on the above, the approximate requirements for this scenario are:

* A region controller (including PostgreSQL) installed on one host, with 4.5 GB memory, 4.5 GHz CPU, and 45 GB of disk space.
* A duplicate region controller (including PostgreSQL) on a second host, also with 4.5 GB memory, 4.5 GHz CPU, and 45 GB of disk space.
* A rack controller installed on a third host, with 2.5 GB memory, 2.5 GHz CPU, and 40 GB of disk space.
* A duplicate rack controller on a fourth host, also with 2.5 GB memory, 2.5 GHz CPU, and 40 GB of disk space.

[note]
The tables above refer to MAAS infrastructure only. They do not cover the resources needed by subsequently-added nodes. Note that machines should have IPMI-based BMC controllers for power cycling, see [Power management](/t/power-management/830) for more details.
[/note]

Some examples of factors that influence hardware specifications include:

* the number of connecting clients (client activity)
* how you decide to distribute services
* whether or not you use [high availability/load balancing](/t/high-availability/804).
* the number of images that you choose to store (disk space affecting PostgreSQL and the rack controller)

Also, this discussion does not take into account a possible local image mirror, which would be a large consumer of disk space.

One rack controller should only service 1000 machines or less, regardless of how you distribute them across subnets. There is no load balancing at the rack level, so you will need additional, independent rack controllers. Each controller must service its own subnet(s).

<h3 id="heading--setup-steps">Setting up for MAAS</h3>

There are a few preliminary steps that will smooth out your MAAS usage:

* **Disable bind9** - If `bind9` is running on the system where you're going to host MAAS, you need to disable it.  The bind9 daemon interferes with MAAS, producing some unusual and hard-to-debug errors.  You can see if it's running with the command `ps aux | grep named`.
* **Set your machines to netboot** - MAAS uses PXE to remotely boot your machines via their NICs, so you'll need to have your machines set to netboot, or MAAS can't access and use them.
* **Turn on machines that should auto-enlist** - If you want MAAS to find and enlist your machines automatically, you need to turn them on.
* **OR gather the UUIDs and MAC addresses for your machines** - If you're going to manually enroll machines, you'll need this information.
* **AND determine the [power type](/t/power-management/830)** - If you're manually enrolling machines, you'll also want to be able to tell MAAS how power them up.  Follow the link to learn more about power types.

[note]
If you have installed `bind9` or have it running, you will need to uninstall it before installing MAAS.  You can check with `ps aux | grep named` to see if it's running. The `bind9` daemon interferes with MAAS operation and creates a number of unusual, hard-to-debug errors -- but don't worry, MAAS provides DNS and can work with existing DNS servers.
[/note]

<h2 id="heading--maas-installation">Installing MAAS</h2>

<!-- snap-ui-2-8 snap-cli-2-8
[Snaps](https://snapcraft.io/docs) are containerised software packages. To install MAAS from a snap simply enter the following:

    $ sudo snap install maas --channel=2.8

After entering your password, the snap will download and install from the 2.8 channel -- though MAAS needs initialising before it's ready to go.
snap-ui-2-8 snap-cli-2-8 -->

<h2 id="heading--init-maas">Initialising MAAS</h2>

<!-- snap-ui-2-8 snap-cli-2-8
MAAS 2.8 supports essentially three initialisation modes and two configurations: a test or proof-of-concept configuration, and a production configuration.  MAAS 2.8 separates the PostgreSQL database from the MAAS snap for scalability reasons, so the steps are a bit different than previous versions.  In the case of the production configuration, native PostgreSQL on the localhost is used for the MAAS database.  For the test configuration, a PostgreSQL snap is provided to encapsulate the test database.  Read on to determine your desired modes before initialising.

### Quick questions you may have:

* [What are the initialisation modes for MAAS 2.8?](#heading--maas-init-modes)
* [How do I initialise MAAS in a test configuration?](#heading--init-poc)
* [How do I initialise MAAS for production?](#heading--init-prod)

<h3 id="heading--maas-init-modes">MAAS initialisation modes</h3>

MAAS supports the following modes, which dictate what services will run on the local system:

| Mode          | Region | Rack | Database | Description                           |
|---------------|--------|------|----------|---------------------------------------|
| `all`*        | X      | X    | X        | Deprecated (see warning below)        |
| `region`      | X      |      |          | Region API server only                |
| `rack`        |        | X    |          | Rack controller only                  |
| `region+rack` | X      | X    |          | Region API server and rack controller |
| `none`        |        |      |          | Deinitializes MAAS and stops services |

[note type="Warning" status="all mode being deprecated"]
The MAAS initialisation mode "all" is [deprecated in MAAS version 2.8.0 and will be removed in MAAS version 2.9.0](https://maas.io/deprecations/MD1).
[/note]

<h2 id="heading--init-poc">Initialising MAAS as a test configuration</h2>

We want to provide a more compact version for those who may be testing MAAS.  To achieve this, we're providing a separate snap, called `maas-test-db`, which provides a PostgreSQL database for use in testing and evaluating MAAS.   The following instructions will help you take advantage of this test configuration.

Once MAAS is installed, you can use the `--help` flag with `maas init` to get relevant instructions:
 
    $ sudo maas init --help
    usage: maas init [-h] {region+rack,region,rack} . . .

    Initialise MAAS in the specified run mode.

    optional arguments:
      -h, --help            show this help message and exit

    run modes:
      {region+rack,region,rack}
        region+rack         Both region and rack controllers
        region              Region controller only
        rack                Rack controller only

    When installing region or rack+region modes, MAAS needs a
    PostgreSQL database to connect to.

    If you want to set up PostgreSQL for a non-production deployment on
    this machine, and configure it for use with MAAS, you can install
    the maas-test-db snap before running 'maas init':
        sudo snap install maas-test-db
        sudo maas init region+rack --database-uri maas-test-db:///

We'll quickly walk through these instructions to confirm your understanding.  First, install the `maas-test-db` snap:
 
    sudo snap install maas-test-db

Note that this step installs a a running PostgreSQL and a MAAS-ready database instantiation.  When it's done, you can double check with a built-in PostgreSQL shell:

    $ maas-test-db.psql
    psql (10.6)
    Type "help" for help.

    postgres=# \l

This will produce a list of databases, one of which will be `maasdb`, owned by `maas`.  Note that this database is still empty because MAAS is not yet initialized and, hence, is not yet using the database.  Once this is done, you can run the `maas init` command:

    sudo maas init region+rack --database-uri maas-test-db:///

After running for a moment, the command will prompt you for a MAAS URL; typically, you can use the default:
 
    MAAS URL [default=http://10.45.222.159:5240/MAAS]:

When you've entered a suitable URL, or accepted the default, the following prompt will appear:
 
    MAAS has been set up.

    If you want to configure external authentication or use
    MAAS with Canonical RBAC, please run

      sudo maas configauth

    To create admins when not using external authentication, run

      sudo maas createadmin

Let's assume you just want a local testing user named `admin`:

    $ sudo maas createadmin
    Username: admin
    Password: ******
    Again: ******
    Email: admin@example.com
    Import SSH keys [] (lp:user-id or gh:user-id): gh:yourusername

At this point, MAAS is basically set up and running.  You can confirm this with `sudo maas status`.  If you need an API key, you can obtain this with `sudo maas apikey --username yourusername`.  Now you will be able to test and evaluate MAAS by going to the URL you entered or accepted above and entering your `admin` username and password.

<h2 id="heading--init-prod">Initialise MAAS for a production configuration</h2>

To install MAAS in a production configuration, you need to setup PostgreSQL, as described below.

<h3 id="heading--pg-setup">Setting up PostgreSQL from scratch</h3>

To set up PostgreSQL, even if it's running on a different machine, you can use the following procedure:

1. You will need to install PostgreSQL on the machine where you want to keep the database.  This can be the same machine as the MAAS region/rack controllers or a totally separate machine.  If PostgreSQL (version 10 or better) is already running on your target machine, you can skip this step. To install PostgreSQL, run these commands:

        sudo apt update -y
        sudo apt install -y postgresql

2. You want to make sure you have a suitable PostgreSQL user, which can be accomplished with the following command, where `$MAAS_DBUSER` is your desired database username, and `$MAAS_DBPASS` is the intended password for that username.  Note that if you're executing this step in a LXD container (as root, which is the default), you may get a minor error, but the operation will still complete correctly.

        sudo -u postgres psql -c "CREATE USER \"$MAAS_DBUSER\" WITH ENCRYPTED PASSWORD '$MAAS_DBPASS'"

3. Create the MAAS database with the following command, where `$MAAS_DBNAME` is your desired name for the MAAS database (typically known as `maas`). Again, if you're executing this step in a LXD container as root, you can ignore the minor error that results.

        sudo -u postgres createdb -O "$MAAS_DBUSER" "$MAAS_DBNAME"

4. Edit `/etc/postgresql/10/main/pg_hba.conf` and add a line for the newly created database, replacing the variables with actual  names. You can limit access to a specific network by using a different CIDR than `0/0`.

        host    $MAAS_DBNAME    $MAAS_DBUSER    0/0     md5

5. You can then initialise MAAS via the following command:

        sudo maas init region+rack --database-uri "postgres://$MAAS_DBUSER:$MAAS_DBPASS@$HOSTNAME/$MAAS_DBNAME"

[note] You should use `localhost` for `$HOSTNAME` if you're running PostgreSQL on the same box as MAAS.[/note]

Don't worry; if you leave out any of the database parameters, you'll be prompted for those details.

<h2 id="heading--service-status">Checking MAAS service status</h2>

You can check the status of running services with:

    sudo maas status

Typically, the output looks something like this:

    bind9                            RUNNING   pid 7999, uptime 0:09:17
    dhcpd                            STOPPED   Not started
    dhcpd6                           STOPPED   Not started
    ntp                              RUNNING   pid 8598, uptime 0:05:42
    postgresql                       RUNNING   pid 8001, uptime 0:09:17
    proxy                            STOPPED   Not started
    rackd                            RUNNING   pid 8000, uptime 0:09:17
    regiond:regiond-0                RUNNING   pid 8003, uptime 0:09:17
    regiond:regiond-1                RUNNING   pid 8008, uptime 0:09:17
    regiond:regiond-2                RUNNING   pid 8005, uptime 0:09:17
    regiond:regiond-3                RUNNING   pid 8015, uptime 0:09:17
    tgt                              RUNNING   pid 8040, uptime 0:09:15

With MAAS installed and initialised, you can now open the web UI in your browser and begin your [Configuration journey](/t/configuration-journey/781).
snap-ui-2-8 snap-cli-2-8 -->

<h2 id="heading--example">Example of MAAS initialisation</h2>

The following demonstrates the `region+rack` mode, a popular initialisation choice for MAAS:

    sudo maas init region+rack

`maas` will ask for the MAAS URL:

    MAAS URL [default=http://10.55.60.1:5240/MAAS]: http://192.168.122.1:5240/MAAS

If you also need to create an admin user, you can use:

    sudo maas createadmin

which takes you through the following exchange:

    Create first admin account:       
    Username: admin
    Password: ******
    Again: ******
    Email: admin@example.com
    Import SSH keys [] (lp:user-id or gh:user-id): lp:petermatulis

[note]
You will use the username and password created above to access the web UI.  If you enter a [Launchpad](https://launchpad.net/) or [GitHub](https://github.com) account name with associated SSH key, MAAS will import them automatically.
[/note]

<h2 id="heading--maas-url">MAAS URL</h2>

All run modes (except `none`) prompt for a MAAS URL, interpreted differently depending on the mode:

-   `region`: Used to create a new region controller.
-   `rack`: Used to locate the region controller.

<h2 id="heading--shared-secret">Shared secret</h2>

The 'rack' and 'region+rack' modes will additionally ask for a shared secret that will allow the new rack controller to register with the region controller.

<h2 id="heading--reinitialising-maas">Reinitialising MAAS</h2>

It is also possible to re-initialise MAAS to switch modes.  For example, to switch from `rack` to `region`:
 
    sudo maas init region

<h2 id="heading--additional-init-options">Additional `init` options</h2>

The `init` command can takes optional arguments. To list them, as well as read a brief description of each, you can enter:

    sudo maas init --help
snap-ui-2-8 snap-cli-2-8 -->

<!-- deb-ui-2-8 deb-cli-2-8
[Snap](https://discourse.maas.io/t/maas-installation-from-a-snap/773) is the preferred method of installing MAAS.  Fully-confined snap installs begin with version 2.7.0.  For completeness, this page offers package installation instructions.  There is also a more detailed page about [installing from packages](/t/maas-installation-from-packages/769) that may be useful for installing packages for versions 2.7 and below.

<h2 id="heading--install-from-packages">Install MAAS from packages</h2>

This section covers the obsoleted use of deb/APT packages to install MAAS.  With the advent of MAAS 2.7.0, installation via [snap](/t/install-from-a-snap/773) is the recommended method to acquire MAAS.  You may want to consider an installation within [LXD containers](/t/install-with-lxd/757). These containers allow MAAS nodes to also run as local containers and are ideal for testing and experimenting with MAAS.

You can install a newer stable version via PPAs listed on the [MAAS launchpad](https://launchpad.net/~maas), including:

-   [ppa:maas/2.6](https://launchpad.net/~maas/+archive/ubuntu/2.6)
-   [ppa:maas/2.7](https://launchpad.net/~maas/+archive/ubuntu/2.7)
-   [ppa:maas/2.8](https://launchpad.net/~maas/+archive/ubuntu/2.8)

For example, to add the 2.8 PPA, type:

``` bash
sudo apt-add-repository -yu ppa:maas/2.8
```

There is also a "transitional" PPA:

-   [ppa:maas/snap-transition](https://launchpad.net/~maas/+archive/ubuntu/snap-transition)

This PPA contains the same transitional deb packages that are available in 20.04.  It's designed to help people running deb-based MAAS on 18.04 to migrate to the snap even before upgrading to 20.04.

<h3 id="heading--installation-scenarios">Installation scenarios</h3>

The recommended way to set up an initial MAAS environment is to put everything on one machine:

``` bash
sudo apt install maas
```

Executing this command leads you to a list of dependent packages to be installed, and a summary prompt that lets you choose whether to continue with the install:

![apt-install-maas-y-n|522x499](upload://26gNdi5vdnCMEDqgO9bp2xXz68R.jpeg) 

Choosing "Y" proceeds with a standard <code>apt</code> package install.

<h4>Distributed environment</h4> 

<p>For a more distributed environment, you can place the region controller on one machine:</p>

``` bash
sudo apt install maas-region-controller
```

and the rack controller (see [Rack controller](/t/rack-controller/771) for details) on another:

``` bash
sudo apt install maas-rack-controller
sudo maas-rack register
```

These two steps will lead you through two similar <code>apt</code> install sequences.

<h3 id="heading--creating-a-maas-user">Creating a MAAS user</h3>

<p>Finally, you will need to create a MAAS administrator user to access the web UI:</p>

``` bash
sudo maas createadmin --username=$PROFILE --email=$EMAIL_ADDRESS
```

<p>For example, the process might go like this:</p>

![apt-create-admin-sequence|690x67](upload://72BsWNvix7Wfm45vFLbMIjV6WBX.jpeg) 
<p>The username can be anything. You will also be prompted to supply a password for the user. The command option <code>--password=$PASSWORD</code> can be used to specify one but, depending on your environment, this may pose a security risk.</p>
<div class="p-notification">
<p class="p-notification__response">At this time, MAAS does not make use of the email address. However, it may do so in the future.</p>
</div>

Finally, the <code>createadmin</code> option asks for an SSH key:

![create-admin-ssh-key-prompt|475x26](upload://a9E7n9qKDwZCeuDvLKwyv3imTXE.jpeg) 

<p>If you have an SSH key associated with your launchpad or github accounts, you can enter the username here to include the key.  For launchpad, just enter <code>lp:username</code>, and for github, enter <code>gp:username</code> at the prompt.  In both cases, the actual username has to be supplied after the <code>lp:</code> or <code>gh:</code> prefix. </p>

<p>If you don't have a key associated with either of these services, you will have an opportunity to paste your public key into the MAAS SSH key list, after you've started MAAS for the first time as part of the welcome screens.</p>

Once all this is done, you're ready to access MAAS from the web UI and begin your [Configuration journey](https://maas.io/docs/configuration-journey).

<h3 id="heading--next-steps">Next steps</h3>

Once you have installed your MAAS environment (region + rack controller) and any possible extra rack controllers(s), you are ready to begin your [Configuration journey](https://maas.io/docs/configuration-journey).
deb-ui-2-8 deb-cli-2-8 -->

<!-- snap-ui-2-7 snap-cli-2-7
[Snaps](https://snapcraft.io/docs) are containerised software packages. To install MAAS from a snap simply enter the following:

``` bash
sudo snap install maas --channel=2.7
```

After entering your password, the snap will download and install from the *2.7.0* channel. However, MAAS needs initialising before it's ready to go.

<h2 id="heading--initialisation">Initialisation</h2>

The next step involves initialising MAAS with a *run mode*. Selecting one of the following modes dictates what services will run on the local system:

| Mode          | Region | Rack | Database | Description                           |
|---------------|--------|------|----------|---------------------------------------|
| `all`*        | X      | X    | X        | All services (see warning below)      |
| `region`      | X      |      |          | Region API server only                |
| `rack`        |        | X    |          | Rack controller only                  |
| `region+rack` | X      | X    |          | Region API server and rack controller |
| `none`        |        |      |          | Deinitializes MAAS and stops services |

[note type="Warning" status="all mode being deprecated"]
Configuring the MAAS snap in "all" mode will be [deprecated in MAAS version 2.8.0 and removed in MAAS version 2.9.0](https://maas.io/deprecations/MD1).
[/note]

To initialise MAAS and select a run mode, use the `maas init` command with the *--mode* argument.

<h3 id="heading--example">Example</h3>

The following demonstrates the `all` mode, a popular initialisation choice for MAAS:

``` bash
sudo maas init --mode all
```

A dialog will appear that will gather some basic information:

``` no-highlight
MAAS URL [default=http://10.55.60.1:5240/MAAS]: http://192.168.122.1:5240/MAAS
Create first admin account:       
Username: admin
Password: ******
Again: ******
Email: admin@example.com
Import SSH keys [] (lp:user-id or gh:user-id): lp:petermatulis
```

[note]
You will use the username and password to access the web UI.  If you enter a [Launchpad](https://launchpad.net/) or [GitHub](https://github.com) account name with associated SSH key, MAAS will import them automatically.
[/note]

<h3 id="heading--maas-url">MAAS URL</h3>

All run modes (except `none`) prompt for a MAAS URL, interpreted differently depending on the mode:

-   `all`, `region+rack`: Used to create a new region controller as well as to tell the rack controller how to find the region connntroller.
-   `region`: Used to create a new region controller.
-   `rack`: Used to locate the region controller.

<h3 id="heading--shared-secret">Shared secret</h3>

The 'rack' and 'region+rack' modes will additionally ask for a shared secret that will allow the new rack controller to register with the region controller.

<h3 id="heading--reinitialising-maas">Reinitialising MAAS</h3>

To re-initialise MAAS, for example, to switch from `rack` to `region`:

``` bash
sudo maas init --mode region
```

<h3 id="heading--additional-init-options">Additional `init` options</h3>

The `init` command can take a number of optional arguments. To list them all as well as read a brief description of each:

``` bash
sudo maas init --help
```

<h2 id="heading--configuration-verification">Configuration verification</h2>

After a *snap* installation of MAAS, you can verifiy the currently-running configuration with:

``` bash
sudo maas config
```

Sample output (for mode 'all'):

``` no-highlight
Mode: all
Settings:
maas_url=http://192.168.122.1:5240/MAAS
```

<h2 id="heading--service-statuses">Service statuses</h2>

You can check the status of running services with:

``` bash
sudo maas status
```

Sample output (for mode 'all'):

``` no-highlight
bind9                            RUNNING   pid 7999, uptime 0:09:17
dhcpd                            STOPPED   Not started
dhcpd6                           STOPPED   Not started
ntp                              RUNNING   pid 8598, uptime 0:05:42
postgresql                       RUNNING   pid 8001, uptime 0:09:17
proxy                            STOPPED   Not started
rackd                            RUNNING   pid 8000, uptime 0:09:17
regiond:regiond-0                RUNNING   pid 8003, uptime 0:09:17
regiond:regiond-1                RUNNING   pid 8008, uptime 0:09:17
regiond:regiond-2                RUNNING   pid 8005, uptime 0:09:17
regiond:regiond-3                RUNNING   pid 8015, uptime 0:09:17
tgt                              RUNNING   pid 8040, uptime 0:09:15
```

With MAAS installed and initialised, you can now open the web UI in your browser and begin your [Configuration journey](https://maas.io/docs/configuration-journey).
 snap-ui-2-7 snap-cli-2-7 -->

<!-- deb-ui-2-7 deb-cli-2-7
[note type="warning" status="Procedure for versions 2.7 and below only"]
This page covers the obsoleted use of deb/APT packages to install MAAS.  With the advent of MAAS 2.7.0, installation via [snap](/t/maas-installation-from-a-snap/773) is the recommended method to acquire MAAS.  Please note that using this method with versions 2.8 and above is not recommended.
[/note]  

You may want to consider an installation within [LXD containers](/t/install-with-lxd/757). These containers allow MAAS nodes to also run as local containers and are ideal for testing and experimenting with MAAS.

<h2 id="heading--packages">Packages</h2>

There are three packages to consider when installing MAAS:

- `maas-region-controller` - region API server, database, DNS, [HTTP proxy](/t/proxy/763), and web UI
- `maas-rack-controller` - [rack controller](/t/rack-controllers/771) and [DHCP](/t/managing-dhcp/759)
- `maas` - a metapackage that installs both the above packages to provide a complete MAAS environment

Each of the above packages has its dependencies. That is, each will bring in other MAAS packages not listed above. You can see the full list of MAAS packages with the command:

``` bash
apt-cache search maas
```

As an example, running this command might produce output that looks like this:

![apt-cache-maas-output|690x339](upload://giaZfenWDEkils5KCgA6BlgC6L.jpeg) 

The 'maas' metapackage is the recommended way to install MAAS. See the [Introduction](/t/what-is-maas/840#heading--key-components-and-colocation-of-all-services) for more detail on colocating all services on a single host.  Note that high availability with MAAS involves installing multiple region/rack controllers. See [MAAS HA](/t/high-availability/804) for more information on this topic.

<h2 id="heading--package-repositories">Package repositories</h2>

While MAAS is available in the normal Ubuntu archives, the available packages may be lagging non-archive, but still stable, versions.  For example, you can check the available versions of MAAS by typing: 

``` bash
apt-cache madison maas
```

which produces output similar to this:

![apt-cache-madison-output|690x100](upload://vbYbb4hTxUaiufHj4aErENwkVAh.jpeg) 

You can install a newer stable version via PPAs listed on the [MAAS launchpad](https://launchpad.net/~maas), including:

-   [ppa:maas/2.6](https://launchpad.net/~maas/+archive/ubuntu/2.6)
-   [ppa:maas/2.7](https://launchpad.net/~maas/+archive/ubuntu/2.7)

For example, to add the 2.7 PPA, type:

``` bash
sudo apt-add-repository -yu ppa:maas/2.7
```

which produces output similar to:

![add-maas-2-7-ppa|690x494](upload://p65sJ6uRq2w22SFfxvLze2dEjsP.jpeg) 

If you check available versions again, you will see that the new repository is now available:

![apt-cache-madison-2-7|690x126](upload://1ukIlIJPuPTYDZa2STEcNGJF1hv.jpeg) 

<h2 id="heading--installation-scenarios">Installation scenarios</h2>

The recommended way to set up an initial MAAS environment is to put everything on one machine:

``` bash
sudo apt install maas
```

Executing this command leads you to a list of dependent packages to be installed, and a summary prompt that lets you choose whether to continue with the install:

![apt-install-maas-y-n|522x499](upload://26gNdi5vdnCMEDqgO9bp2xXz68R.jpeg) 

Choosing "Y" proceeds with a standard <code>apt</code> package install.

<h3>Distributed environment</h3> 

<p>For a more distributed environment, you can place the region controller on one machine:</p>

``` bash
sudo apt install maas-region-controller
```

and the rack controller (see [Rack controller](/t/rack-controllers/771) for details) on another:

``` bash
sudo apt install maas-rack-controller
sudo maas-rack register
```

These two steps will lead you through two similar <code>apt</code> install sequences.

<h2 id="heading--creating-a-maas-user">Creating a MAAS user</h2>

<p>Finally, you will need to create a MAAS administrator user to access the web UI:</p>

``` bash
sudo maas createadmin --username=$PROFILE --email=$EMAIL_ADDRESS
```

<p>For example, the process might go like this:</p>

![apt-create-admin-sequence|690x67](upload://72BsWNvix7Wfm45vFLbMIjV6WBX.jpeg) 
<p>The username can be anything. You will also be prompted to supply a password for the user. The command option <code>--password=$PASSWORD</code> can be used to specify one but, depending on your environment, this may pose a security risk.</p>
<div class="p-notification">
<p class="p-notification__response">At this time, MAAS does not make use of the email address. However, it may do so in the future.</p>
</div>

Finally, the <code>createadmin</code> option asks for an SSH key:

![create-admin-ssh-key-prompt|475x26](upload://a9E7n9qKDwZCeuDvLKwyv3imTXE.jpeg) 

<p>If you have an SSH key associated with your launchpad or github accounts, you can enter the username here to include the key.  For launchpad, just enter <code>lp:username</code>, and for github, enter <code>gp:username</code> at the prompt.  In both cases, the actual username has to be supplied after the <code>lp:</code> or <code>gh:</code> prefix. </p>

<p>If you don't have a key associated with either of these services, you will have an opportunity to paste your public key into the MAAS SSH key list, after you've started MAAS for the first time as part of the welcome screens.</p>

Once all this is done, you're ready to access MAAS from the web UI and begin your [Configuration journey](https://maas.io/docs/configuration-journey).
 deb-ui-2-7 deb-cli-2-7 -->

<h2 id="heading--maas-login">Logging in to MAAS</h2>

<h2 id="heading--maas-config">MAAS post-install configuration</h2>

<h2 id="heading--download-images">Downloading OS images for MAAS</h2>

<h2 id="heading--admin-ssh-keys">Adding admin SSH keys to MAAS</h2>

<h2 id="heading--maas-networking">Setting up MAAS networking</h2>

<h2 id="heading--import-ssh-keys">Importing SSH keys to machines</h2>

<h2 id="heading--physical-machines">Adding physical machines</h2>

<h2 id="heading--virtual-machines">Adding virtual machines</h2>

<h2 id="heading--commissioning">Commissioning machines</h2>

<h2 id="heading--acquisition">Acquiring machines</h2>

<h2 id="heading--deployment">Deploying machines</h2>

<h2 id="heading--deployed-ssh-access">SSH access to deployed machines</h2>

<h2 id="heading--release-machines">Releasing deployed machines</h2>

<h2 id="heading--broken-machines">Marking machines as broken</h2>


As explained in the [Introduction](/t/maas-documentation/25#heading--key-components-and-colocation-of-all-services), the installation of MAAS consists of the installation of a rack controller and a region controller which, in turn, provide a multitude of services. Go ahead and [install MAAS](/t/maas-installation-from-a-snap/773)!

<h2 id="heading--access-the-web-ui">Access the web UI</h2>

You *will* be using the web UI so now is the time to log in and take a look around! Proceed to the web UI now. This will involve the creation of an administrator user. Notice how the web UI (API server) is accessed via port 5240 and not port 80.

[note]
Although the web UI may be accessed via port 80, this is not guaranteed to work in future versions of MAAS.
[/note]

The initial access of the web UI will kick off an optional [configuration journey](/t/configuration-journey/781) whose purpose is to get the essential aspects of MAAS configured right away.

Completing the journey will remove the need to perform equivalent deeds below so you'll need to adjust accordingly.

<h2 id="heading--zones">Zones</h2>

For [zones](/t/availability-zones/820), many people won't need to change anything as a default zone is provided out of the box. However, they are still worth reading about, especially if the default one does not suffice.

<h2 id="heading--networking">Networking</h2>

Firstly, in terms of IP addresses, understand what a *reserved range* is by reading [Concepts and terms](/t/concepts-and-terms/785#heading--ip-ranges). Create one (not *reserved dynamic range*) if you need one.

Secondly, configure a default gateway and a nameserver that your machines will use. See [Networking](/t/networking/768) for how to do this.

<h2 id="heading--import-boot-images">Import boot images</h2>

[Read up on images](/t/images/754) as they're quite important. Continue reading until you have discovered how to import them. You will see that you have the choice to use the CLI to do this. Either way: achievement unlocked!

The import process can take a while. Consider moving on and coming back. Just ensure that the import has completed prior to adding a machine.

[note]
Once installed, by default, MAAS will begin downloading images for the latest Ubuntu LTS.
[/note]

<h2 id="heading--access-the-maas-cli">Access the MAAS CLI</h2>

Even if you've imported images with the web UI, it would be wise (and cool?) to give the [CLI](/t/maas-cli/802) a spin in case you ever need to use it later. Although we strive to make the web UI feature-equivalent to the CLI, some things can still only be done with the CLI.

<h2 id="heading--enable-dhcp">Enable DHCP</h2>

You won't get far without DHCP since it is required in order to make PXE work, which, in turn, is necessary to introduce your systems to MAAS. But you knew that. Anyway, DHCP is installed - it just needs enabling. [Read about DHCP](/t/managing-dhcp/759) and continue until you have enabled it.

<h2 id="heading--users-and-ssh-keys">Users and SSH keys</h2>

You already have an administrative user but MAAS can also have regular users (who log in to the interface or use the CLI). What users you create depends on how you intend to use MAAS.

Additionally, in order for a user to log into a MAAS-deployed machine that user *must* have their public SSH key installed on it.

Study [User accounts](/t/user-accounts/790) to learn about how to create more users and how to add their public SSH keys to MAAS. Once that's done, every deployed machine will automatically have that key installed.

<h2 id="heading--add-a-node">Add a machine</h2>

It's time to actually do something! MAAS manages machines, but at this time it doesn't have any. Go forth and [add a machine](/t/add-machines/821) now. Obviously, you need a spare physical system (but KVM works too). In the web UI, confirm that the import of images has finished!

Go to the 'Machines' page in the web UI. A successfully added machine will soon appear there with a status of *New*. It will also have a funny name. Whatever, you're still a rock star!

<h2 id="heading--edit-power-type">Edit power type</h2>

A machine needs to power cycle while being managed by MAAS. The next step is therefore to tell MAAS how to do this. That is, you need to [edit the power type](/t/power-management/830) of the machine's BMC.

<h2 id="heading--commission-a-node">Commission a machine</h2>

Commissioning a machine involves MAAS testing it to ensure that it is able to communicate properly with the region API server. [Commission](/t/commission-machines/822) your machine now.

<h2 id="heading--deploy-a-node">Deploy a machine</h2>

Lots of folks would have [Juju](https://jujucharms.com/docs/stable/about-juju) take over at this point. Juju acts as a sort of command & control centre for adding services/applications on top of MAAS machines (among other "clouds"). If you're just not there and/or you want to quickly test things out you can use the web UI to [deploy a machine](/t/deploy-machines/825) directly.

<h2 id="heading--ssh-to-the-node">SSH to the machine</h2>

If you [imported your SSH key](/t/user-accounts/790#heading--ssh-keys) then you should now be able to ssh to the deployed machine by connecting to the 'ubuntu' account. The machine's page in the web UI will inform you of its IP address. Mission accomplished!

<!-- LINKS -->