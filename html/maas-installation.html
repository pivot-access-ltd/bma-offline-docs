<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" type="text/css" href="css/stylesheet.css" />
    <style>
      #selector a:link{color:black;}
      #selector a:visited{color:black;}
      #selector a:active{color:black;}
      #selector a:hover{color:blue;}
      #sidebar a:link{color:black;}
      #sidebar a:visited{color:black;}
      #sidebar a:active{color:black;}
      #sidebar a:hover{color:blue;}
      ul {margin-left:0;list-style-type:none;}
      li {margin: 4px 0;}
    </style>
  </head>
  <body>
    <div id="selector" style="top:0; position:fixed; float:right; background-color:#d9d9d9; width:100%;border-bottom:1px solid black;">
      &nbsp;&nbsp;<strong>Offline docs</strong>
      <a href="https://maas.io/docs">(switch to live docs)</a>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      <span style="background-color:white;border-top:1px solid black; border-left:1px solid black; border-right:1px solid black; border-bottom:5px solid white;">
	  UI-only
      </span>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
	<a href="cli/maas-installation.html">
	  CLI-only
	</a>
    </div>
    <div id="sidebar" style="float:left; width:25%;margin-top:40px; margin-left:20px">
      <strong>
	<a href="../maas-documentation.html">
	  Introduction
	</a>
      </strong>
      <ul>
	<li>
	  <a href="about-maas.html">
	    About MAAS
	  </a>
	</li>
	<li>
	  <a href="give-me-an-example-of-maas.html">
	    &ldquo;Give me an example&rdquo;
	  </a>
	</li>
	<li>
	  <a href="whats-new-in-maas.html">
	    What&rsquo;s new in 3.0
	  </a>
	</li>
	<li>
	  <a href="maas-requirements.html">
	    Requirements
	  </a>
	</li>
	<li>
	  <a href="maas-installation.html">
	    Installation
	  </a>
	</li>
	<li>
	  <a href="configuration-journey.html">
	    Configuration journey
	  </a>
	</li>
      <strong>
	<a href="controllers.html">
	  Controllers
	</a>
      </strong>
      <ul>
	<li>
	  <a href="maas-communication.html">
	    Communication
	  </a>
	</li>
	<li>
	  <a href="rack-controllers.html">
	    Rack controllers
	  </a>
	</li>
	<li>
	  <a href="region-controllers.html">
	    Region controllers
	  </a>
	</li>
	<li>
	  <a href="high-availability.html">
	    High availability
	  </a>
	</li>
      </ul>
      <strong>
	<a href="machines.html">
	  Machines
	</a>
      </strong>
      <ul>
	<li>
	  <a href="add-machines.html">
	    Add machines
	  </a>
	</li>
	<li>
	  <a href="power-management.html">
	    Power management
	  </a>
	</li>
	<li>
	  <a href="commission-machines.html">
	    Commission machines
	  </a>
	</li>
	<li>Testing
	</li>
	<li>
	  <a href="hardware-testing.html">
	    Hardware testing
	  </a>
	</li>
	<li>
	  <a href="network-testing.html">
	    Network testing
	  </a>
	</li>
	<li>
	  <a href="commissioning-and-hardware-testing-scripts.html">
	    Commissioning and hardware testing scripts
	  </a>
	</li>
	<li>
	  <a href="deploy-machines.html">
	    Deploy machines
	  </a>
	</li>
	<li>
	  <a href="maas-tags.html">
	    Tags
	  </a>
	</li>
	<li>
	  <a href="custom-machine-setup.html">
	    Custom machine setup
	  </a>
	</li>
	<li>
	  <a href="kernel-boot-options.html">
	    Kernel boot options
	  </a>
	</li>
	<li>
	  <a href="resource-pools.html">
	    Resource pools
	  </a>
	</li>
	<li>
	  <a href="storage.html">
	    Storage
	  </a>
	</li>
	<li>
	  <a href="vmware-vmfs-datastores.html">
	    VMware VMFS datastores
	  </a>
	</li>
	<li>
	  <a href="ubuntu-kernels.html">
	    Ubuntu kernels
	  </a>
	</li>
      </ul>
      <strong>
	<a href="images.html">
	  Images
	</a>
      </strong>
      <ul>
	<li>
	  <a href="select-and-import-images.html">
	    Select and import images
	  </a>
	</li>
	<li>
	  <a href="local-image-mirror.html">
	    Local image mirror
	  </a>
	</li>
	<li>
	  <a href="vmware-images.html">
	    VMWare images
	  </a>
	</li>
      </ul>
      <strong>
	<a href="networking.html">
	  Networking
	</a>
      </strong>
      <ul>
	<li>
	  <a href="subnet-management.html">
	    Subnet management
	  </a>
	</li>
	<li>
	  <a href="managing-dhcp.html">
	    DHCP
	  </a>
	</li>
	<li>
	  <a href="ip-ranges.html">
	    IP ranges
	  </a>
	</li>
	<li>
	  <a href="proxy.html">
	    Proxy
	  </a>
	</li>
	<li>
	  <a href="ntp-services.html">
	    NTP
	  </a>
	</li>
	<li>
	  <a href="network-discovery.html">
	    Network discovery
	  </a>
	</li>
	<li>
	  <a href="ipv6-addressing.html">
	    IPv6
	  </a>
	</li>
	<li>
	  <a href="configuring-tls-encryption.html">
	    SSL
	  </a>
	</li>
	<li>
	  <a href="managing-stp.html">
	    STP
	  </a>
	</li>
	<li>
	  <a href="availability-zones.html">
	    Availability zones (AZs)
	  </a>
	</li>
      </ul>
      <strong>
	<a href="vm-hosting.html">
	  VM hosting
	</a>
      </strong>
      <ul>
	<li>
	  <a href="vm-host-networking.html">
	    VM host networking
	  </a>
	</li>
	<li>
	  <a href="adding-a-vm-host.html">
	    Add a VM host
	  </a>
	</li>
	<li>
	  <a href="vm-host-storage-pools.html">
	    VM host storage pools
	  </a>
	</li>
	<li>
	  <a href="creating-and-deleting-vms.html">
	    Creating and deleting VMs
	  </a>
	</li>
      </ul>
      <strong>Operations
      </strong>
      <ul>
	<li>
	  <a href="prometheus-metrics.html">
	    Prometheus metrics
	  </a>
	</li>
	<li>
	  <a href="backup.html">
	    Backup
	  </a>
	</li>
	<li>
	  <a href="hardening-your-maas-installation.html">
	    MAAS security
	  </a>
	</li>
	<li>
	  <a href="maas-logging.html">
	    Logging
	  </a>
	</li>
	<li>
	  <a href="commissioning-logs.html">
	    Commissioning logs
	  </a>
	</li>
	<li>
	  <a href="user-accounts.html">
	    User accounts
	  </a>
	</li>
	<li>
	  <a href="interactive-search.html">
	    Interactive search
	  </a>
	</li>
      </ul>
      <strong>
	<a href="concepts-and-terms.html">
	  Concepts &amp; terms
	</a>
      </strong>
      <ul>
	<li>
	  <a href="concepts-and-terms.html#heading--network-tutorial">
	    Brief network tutorial
	  </a>
	</li>
      </ul>
      <strong>
	<a href="maas-cli.html">
	  CLI
	</a>
      </strong>
      <ul>
	<li>
	  <a href="common-cli-tasks.html">
	    The CLI cookbook
	  </a>
	</li>
	<li>
	  <a href="common-cli-tasks.html">
	    Common tasks
	  </a>
	</li>
	<li>
	  <a href="audit-event-logs.html">
	    Audit event logs
	  </a>
	</li>
	<li>
	  <a href="cli-kernel-management.html">
	    Kernel management
	  </a>
	</li>
	<li>
	  <a href="cli-image-management.html">
	    Image management
	  </a>
	</li>
	<li>
	  <a href="cli-interface-management.html">
	    Interface management
	  </a>
	</li>
	<li>
	  <a href="cli-advanced-tasks.html">
	    Advanced tasks
	  </a>
	</li>
	<li>
	  <a href="cli-composable-hardware.html">
	    Composable hardware
	  </a>
	</li>
	<li>
	  <a href="python-api-client.html">
	    API client
	  </a>
	</li>
      </ul>
      <strong>
	<a href="api.html">
	  API documentation
	</a>
      </strong>
      <ul>
	<li>
	  <a href="api-authentication.html">
	    API authentication
	  </a>
	</li>
      </ul>
      <strong>
	<a href="troubleshooting.html">
	  Troubleshoot
	</a>
      </strong>
      <ul>
	<li>
	  <a href="getting-help.html">
	    Getting help
	  </a>
	</li>
	<li>
	  <a href="tips-tricks-and-traps.html">
	    Tips, tricks, and traps
	  </a>
	</li>
	<li>
	  <a href="https://old-docs.maas.io/2.5/en/">
	    MAAS 2.5 (+ earlier) doc
	  </a>
	</li>
      </ul>
      <strong>
	<a href="whats-new-in-maas.html">
	  Release notes
	</a>
      </strong>
      <p/>
      <strong>
	<a href="writing-guide.html">
	  Help improve these docs
	</a>
      </strong>
    </div>
    <div class="container" style="float:right; width:65%; margin-top:40px; margin-right:30px">
      <h1>MAAS installation</h1><p>||2.7|2.8|2.9|3.0|</p>
<!-- snap-2-7-ui snap-2-7-cli 
[Snaps](https://snapcraft.io/docs) are containerised software packages. To install MAAS from a snap simply enter the following:

<pre><code class="bash">sudo snap install maas --channel=2.7
</code></pre>


After entering your password, the snap will download and install from the 2.7 channel. However, MAAS needs initialising before it's ready to go.

<a href="#heading--initialisation"><h2 id="heading--initialisation">Initialisation</h2></a>

The next step involves initialising MAAS with a *run mode*. Selecting one of the following modes dictates what services will run on the local system:

| Mode          | Region | Rack | Database | Description                           |
|---------------|--------|------|----------|---------------------------------------|
| `all`*        | X      | X    | X        | All services (see warning below)      |
| `region`      | X      |      |          | Region API server only                |
| `rack`        |        | X    |          | Rack controller only                  |
| `region+rack` | X      | X    |          | Region API server and rack controller |
| `none`        |        |      |          | Reinitialises MAAS and stops services |

<strong>NOTE:</strong> 
Configuring the MAAS snap in "all" mode will be [deprecated in MAAS version 2.8.0 and removed in MAAS version 2.9.0](https://maas.io/deprecations/MD1).


To initialise MAAS and select a run mode, use the `maas init` command with the *--mode* argument.

<a href="#heading--example"><h3 id="heading--example">Example</h3></a>

The following demonstrates the `all` mode, a popular initialisation choice for MAAS:


<pre><code class="bash">sudo maas init --mode all
</code></pre>


A dialog will appear that will gather some basic information:


<pre><code class="no-highlight">MAAS URL [default=http://10.55.60.1:5240/MAAS]: http://192.168.122.1:5240/MAAS
Create first admin account:       
Username: admin
Password: ******
Again: ******
Email: admin@example.com
Import SSH keys [] (lp:user-id or gh:user-id): lp:petermatulis
</code></pre>


<strong>NOTE:</strong> 
You will use the username and password to access the web UI.  If you enter a [Launchpad](https://launchpad.net/) or [GitHub](https://github.com) account name with associated SSH key, MAAS will import them automatically.


<a href="#heading--maas-url"><h3 id="heading--maas-url">MAAS URL</h3></a>

All run modes (except `none`) prompt for a MAAS URL, interpreted differently depending on the mode:

-   `all`, `region+rack`: Used to create a new region controller as well as to tell the rack controller how to find the region controller.
-   `region`: Used to create a new region controller.
-   `rack`: Used to locate the region controller.

<a href="#heading--shared-secret"><h3 id="heading--shared-secret">Shared secret</h3></a>

The 'rack' and 'region+rack' modes will additionally ask for a shared secret that will allow the new rack controller to register with the region controller.

<a href="#heading--reinitialising-maas"><h3 id="heading--reinitialising-maas">Reinitialising MAAS</h3></a>

To re-initialise MAAS, for example, to switch from `rack` to `region`:


<pre><code class="bash">sudo maas init --mode region
</code></pre>


<a href="#heading--additional-init-options"><h3 id="heading--additional-init-options">Additional `init` options</h3></a>

The `init` command can take a number of optional arguments. To list them all as well as read a brief description of each:


<pre><code class="bash">sudo maas init --help
</code></pre>


<a href="#heading--configuration-verification"><h2 id="heading--configuration-verification">Configuration verification</h2></a>

After a *snap* installation of MAAS, you can verify the currently-running configuration with:


<pre><code class="bash">sudo maas config
</code></pre>


Sample output (for mode 'all'):


<pre><code class="no-highlight">Mode: all
Settings:
maas_url=http://192.168.122.1:5240/MAAS
</code></pre>


<a href="#heading--service-statuses"><h2 id="heading--service-statuses">Service statuses</h2></a>

You can check the status of running services with:


<pre><code class="bash">sudo maas status
</code></pre>


Sample output (for mode 'all'):


<pre><code class="no-highlight">bind9                            RUNNING   pid 7999, uptime 0:09:17
dhcpd                            STOPPED   Not started
dhcpd6                           STOPPED   Not started
ntp                              RUNNING   pid 8598, uptime 0:05:42
postgresql                       RUNNING   pid 8001, uptime 0:09:17
proxy                            STOPPED   Not started
rackd                            RUNNING   pid 8000, uptime 0:09:17
regiond:regiond-0                RUNNING   pid 8003, uptime 0:09:17
regiond:regiond-1                RUNNING   pid 8008, uptime 0:09:17
regiond:regiond-2                RUNNING   pid 8005, uptime 0:09:17
regiond:regiond-3                RUNNING   pid 8015, uptime 0:09:17
tgt                              RUNNING   pid 8040, uptime 0:09:15
</code></pre>

snap-2-7-ui snap-2-7-cli -->

<!-- snap-2-7-ui
With MAAS installed and initialised, you can now open the web UI in your browser and begin your [Configuration journey](configuration-journey.html).
snap-2-7-ui -->

<!-- snap-2-7-cli
With MAAS installed and initialised, you can now open the web UI in your browser and begin your [Configuration journey](configuration-journey.html).
snap-2-7-cli -->

<!-- snap-2-8-ui snap-2-8-cli
MAAS can be installed in either of two configurations:  test or production.  The test configuration uses a small PostgreSQL database (in a separate snap), designed for use with MAAS. The full-up production configuration uses a separate PostgreSQL database for performance and scalability.  This article will walk you through both install methods.

#### Thirteen questions you may have:

1. [How do I install (but not initialise) the MAAS snap?](#heading--install-maas-snap)
2. [How do I upgrade my 2.7 snap to version 2.8?](#heading--upgrade-maas-snap)
3. [What are MAAS initialisation modes?](#heading--maas-init-modes)
4. [How do I initialise MAAS for a test or proof-of-concept configuration?](#heading--init-poc)
5. [How do I initialise MAAS for a production configuration?](#heading--init-prod)
6. [How do I migrate an existing snap install?](tips-tricks-and-traps.html#heading--migrate-maas)
7. [What if I want to manually export the MAAS database to an existing PostgreSQL server?](tips-tricks-and-traps.html#heading--manual-export)
8. [How can I check the service status of my MAAS configuration?](#heading--service-status)
9. [How do I re-initialise MAAS, if I want to?](#heading--reinitialising-maas)
10. [How can I discover additional init options?](#heading--additional-init-options)
11. [Give me an example of initialising MAAS](#heading--example)
12. [Tell me about the MAAS URL](#heading--maas-url)
13. [Tell me about the shared secret](#heading--shared-secret)

<strong>NOTE:</strong> 
If you have installed `bind9` or have it running, you will need to uninstall it before installing MAAS.  You can check with `ps aux | grep named` to see if it's running. The `bind9` daemon interferes with MAAS operation and creates a number of unusual, hard-to-debug errors -- but don't worry, MAAS provides DNS and can work with existing DNS servers.


<a href="#heading--install-maas-snap"><h2 id="heading--install-maas-snap">Installing MAAS from the snap</h2></a>

[Snaps](https://snapcraft.io/docs) are containerised software packages. To install MAAS from a snap simply enter the following:

    $ sudo snap install maas --channel=2.8

After entering your password, the snap will download and install from the 2.8 channel -- though MAAS needs initialising before it's ready to go.

<a href="#heading--upgrade-maas-snap"><h2 id="heading--upgrade-maas-snap">Upgrading MAAS from 2.7</h2></a>

If you want to upgrade from a 2.7 snap to 2.8, and you are using a `region+rack` configuration, use this command:

    $ sudo snap refresh --channel=2.8 maas

After entering your password, the snap will refresh from the 2.8 channel.  You will **not** need to re-initialise MAAS.

If you are using a multi-node maas deployment with separate regions and racks, you should first run the upgrade command above for rack nodes, then for region nodes.

<a href="#heading--maas-init-modes"><h2 id="heading--maas-init-modes">MAAS initialisation modes</h2></a>

MAAS supports the following modes, which dictate what services will run on the local system:

| Mode          | Region | Rack | Database | Description                           |
|---------------|--------|------|----------|---------------------------------------|
| `all`*        | X      | X    | X        | Deprecated (see warning below)        |
| `region`      | X      |      |          | Region API server only                |
| `rack`        |        | X    |          | Rack controller only                  |
| `region+rack` | X      | X    |          | Region API server and rack controller |
| `none`        |        |      |          | Reinitialises MAAS and stops services |

<strong>NOTE:</strong> 
The MAAS initialisation mode "all" is [deprecated in MAAS version 2.8.0 and will be removed in MAAS version 2.9.0](https://maas.io/deprecations/MD1).


<a href="#heading--init-poc"><h2 id="heading--init-poc">Initialising MAAS as a test configuration</h2></a>

We want to provide a more compact version for those who may be testing MAAS.  To achieve this, we're providing a separate snap, called `maas-test-db`, which provides a PostgreSQL database for use in testing and evaluating MAAS.   The following instructions will help you take advantage of this test configuration.

Once MAAS is installed, you can use the `--help` flag with `maas init` to get relevant instructions:

    $ sudo maas init --help
    usage: maas init [-h] {region+rack,region,rack} . . .

    Initialise MAAS in the specified run mode.

    optional arguments:
      -h, --help            show this help message and exit

    run modes:
      {region+rack,region,rack}
        region+rack         Both region and rack controllers
        region              Region controller only
        rack                Rack controller only

    When installing region or rack+region modes, MAAS needs a
    PostgreSQL database to connect to.

    If you want to set up PostgreSQL for a non-production deployment on
    this machine, and configure it for use with MAAS, you can install
    the maas-test-db snap before running 'maas init':
        sudo snap install maas-test-db
        sudo maas init region+rack --database-uri maas-test-db:///

We'll quickly walk through these instructions to confirm your understanding.  First, install the `maas-test-db` snap:

    sudo snap install maas-test-db

Note that this step installs a a running PostgreSQL and a MAAS-ready database instantiation.  When it's done, you can double check with a built-in PostgreSQL shell:

    $ maas-test-db.psql
    psql (10.6)
    Type "help" for help.

    postgres=# \l

This will produce a list of databases, one of which will be `maasdb`, owned by `maas`.  Note that this database is still empty because MAAS is not yet initialised and, hence, is not yet using the database.  Once this is done, you can run the `maas init` command:

    sudo maas init region+rack --database-uri maas-test-db:///

After running for a moment, the command will prompt you for a MAAS URL; typically, you can use the default:

    MAAS URL [default=http://10.45.222.159:5240/MAAS]:

When you've entered a suitable URL, or accepted the default, the following prompt will appear:

    MAAS has been set up.

    If you want to configure external authentication or use
    MAAS with Canonical RBAC, please run

      sudo maas configauth

    To create admins when not using external authentication, run

      sudo maas createadmin

Let's assume you just want a local testing user named `admin`:

    $ sudo maas createadmin
    Username: admin
    Password: ******
    Again: ******
    Email: admin@example.com
    Import SSH keys [] (lp:user-id or gh:user-id): gh:yourusername

At this point, MAAS is basically set up and running.  You can confirm this with `sudo maas status`.  If you need an API key, you can obtain this with `sudo maas apikey --username yourusername`.  Now you will be able to test and evaluate MAAS by going to the URL you entered or accepted above and entering your `admin` username and password.

<a href="#heading--configuration-verification"><h2 id="heading--configuration-verification">Configuration verification</h2></a>

After a snap installation of MAAS, you can verify the currently-running configuration with:

    sudo maas config

<a href="#heading--init-prod"><h2 id="heading--init-prod">Initialise MAAS for a production configuration</h2></a>

To install MAAS in a production configuration, you need to setup PostgreSQL, as described below.

<a href="#heading--pg-setup"><h3 id="heading--pg-setup">Setting up PostgreSQL from scratch</h3></a>

To set up PostgreSQL, even if it's running on a different machine, you can use the following procedure:

1. You will need to install PostgreSQL on the machine where you want to keep the database.  This can be the same machine as the MAAS region/rack controllers or a totally separate machine.  If PostgreSQL (version 10 or better) is already running on your target machine, you can skip this step. To install PostgreSQL, run these commands:

        sudo apt update -y
        sudo apt install -y postgresql

2. You want to make sure you have a suitable PostgreSQL user, which can be accomplished with the following command, where `$MAAS_DBUSER` is your desired database username, and `$MAAS_DBPASS` is the intended password for that username.  Note that if you're executing this step in a LXD container (as root, which is the default), you may get a minor error, but the operation will still complete correctly.

        sudo -u postgres psql -c "CREATE USER \"$MAAS_DBUSER\" WITH ENCRYPTED PASSWORD '$MAAS_DBPASS'"

3. Create the MAAS database with the following command, where `$MAAS_DBNAME` is your desired name for the MAAS database (typically known as `maas`). Again, if you're executing this step in a LXD container as root, you can ignore the minor error that results.

        sudo -u postgres createdb -O "$MAAS_DBUSER" "$MAAS_DBNAME"

4. Edit `/etc/postgresql/10/main/pg_hba.conf` and add a line for the newly created database, replacing the variables with actual  names. You can limit access to a specific network by using a different CIDR than `0/0`.

        host    $MAAS_DBNAME    $MAAS_DBUSER    0/0     md5

5. You can then initialise MAAS via the following command:

        sudo maas init region+rack --database-uri "postgres://$MAAS_DBUSER:$MAAS_DBPASS@$HOSTNAME/$MAAS_DBNAME"

<strong>NOTE:</strong> 

Don't worry; if you leave out any of the database parameters, you'll be prompted for those details.

<a href="#heading--service-status"><h2 id="heading--service-status">Checking MAAS service status</h2></a>

You can check the status of running services with:

    sudo maas status

Typically, the output looks something like this:

    bind9                            RUNNING   pid 7999, uptime 0:09:17
    dhcpd                            STOPPED   Not started
    dhcpd6                           STOPPED   Not started
    ntp                              RUNNING   pid 8598, uptime 0:05:42
    postgresql                       RUNNING   pid 8001, uptime 0:09:17
    proxy                            STOPPED   Not started
    rackd                            RUNNING   pid 8000, uptime 0:09:17
    regiond:regiond-0                RUNNING   pid 8003, uptime 0:09:17
    regiond:regiond-1                RUNNING   pid 8008, uptime 0:09:17
    regiond:regiond-2                RUNNING   pid 8005, uptime 0:09:17
    regiond:regiond-3                RUNNING   pid 8015, uptime 0:09:17
    tgt                              RUNNING   pid 8040, uptime 0:09:15

snap-2-8-cli snap-2-8-ui -->

<!-- snap-2-8-cli
With MAAS installed and initialised, you can now open the web UI in your browser and begin your [Configuration journey](configuration-journey.html).
 snap-2-8-cli -->

<!-- snap-2-8-ui
With MAAS installed and initialised, you can now open the web UI in your browser and begin your [Configuration journey](configuration-journey.html).
 snap-2-8-ui -->

<!-- snap-2-8-cli snap-2-8-ui
<a href="#heading--example"><h2 id="heading--example">Example of MAAS initialisation</h2></a>

The following demonstrates the `region+rack` mode, a popular initialisation choice for MAAS:

    sudo maas init region+rack

`maas` will ask for the MAAS URL:

    MAAS URL [default=http://10.55.60.1:5240/MAAS]: http://192.168.122.1:5240/MAAS

If you also need to create an admin user, you can use:

    sudo maas createadmin

which takes you through the following exchange:

    Create first admin account:       
    Username: admin
    Password: ******
    Again: ******
    Email: admin@example.com
    Import SSH keys [] (lp:user-id or gh:user-id): lp:petermatulis

<strong>NOTE:</strong> 
You will use the username and password created above to access the web UI.  If you enter a [Launchpad](https://launchpad.net/) or [GitHub](https://github.com) account name with associated SSH key, MAAS will import them automatically.


<a href="#heading--maas-url"><h2 id="heading--maas-url">MAAS URL</h2></a>

All run modes (except `none`) prompt for a MAAS URL, interpreted differently depending on the mode:

-   `region`: Used to create a new region controller.
-   `rack`: Used to locate the region controller.

<a href="#heading--shared-secret"><h2 id="heading--shared-secret">Shared secret</h2></a>

The 'rack' and 'region+rack' modes will additionally ask for a shared secret that will allow the new rack controller to register with the region controller.

<a href="#heading--reinitialising-maas"><h2 id="heading--reinitialising-maas">Reinitialising MAAS</h2></a>

It is also possible to re-initialise MAAS to switch modes.  For example, to switch from `rack` to `region`:

    sudo maas init region

<a href="#heading--additional-init-options"><h2 id="heading--additional-init-options">Additional `init` options</h2></a>

The `init` command can takes optional arguments. To list them, as well as read a brief description of each, you can enter:

    sudo maas init --help

snap-2-8-ui snap-2-8-cli -->

<!-- snap-2-9-ui snap-2-9-cli
MAAS can be installed in either of two configurations:  test or production.  The test configuration uses a small PostgreSQL database (in a separate snap), designed for use with MAAS. The full-up production configuration uses a separate PostgreSQL database for performance and scalability.  This article will walk you through both install methods.

#### Thirteen questions you may have:

1. [How do I install (but not initialise) the MAAS 2.9 snap?](#heading--install-maas-snap)
2. [How do I upgrade my 2.8 snap to version 2.9?](#heading--upgrade-maas-snap)
3. [What are MAAS initialisation modes?](#heading--maas-init-modes)
4. [How do I initialise MAAS for a test or proof-of-concept configuration?](#heading--init-poc)
5. [How do I initialise MAAS for a production configuration?](#heading--init-prod)
6. [How do I migrate an existing snap install?](tips-tricks-and-traps.html#heading--migrate-maas)
7. [What if I want to manually export the MAAS database to an existing PostgreSQL server?](tips-tricks-and-traps.html#heading--manual-export)
8. [How can I check the service status of my MAAS configuration?](#heading--service-status)
9. [How do I re-initialise MAAS, if I want to?](#heading--reinitialising-maas)
10. [How can I discover additional init options?](#heading--additional-init-options)
11. [Give me an example of initialising MAAS](#heading--example)
12. [Tell me about the MAAS URL](#heading--maas-url)
13. [Tell me about the shared secret](#heading--shared-secret)

<strong>NOTE:</strong> 
If you have installed `bind9` or have it running, you will need to uninstall it before installing MAAS.  You can check with `ps aux | grep named` to see if it's running. The `bind9` daemon interferes with MAAS operation and creates a number of unusual, hard-to-debug errors -- but don't worry, MAAS provides DNS and can work with existing DNS servers.


<a href="#heading--install-maas-snap"><h2 id="heading--install-maas-snap">Installing MAAS from the snap</h2></a>

[Snaps](https://snapcraft.io/docs) are containerised software packages. To install MAAS from a snap simply enter the following:

    $ sudo snap install --channel=2.9/stable maas

After entering your password, the snap will download and install from the 2.9 stable channel -- though MAAS needs initialising before it's ready to go.

<a href="#heading--upgrade-maas-snap"><h2 id="heading--upgrade-maas-snap">Upgrading MAAS from 2.8</h2></a>

If you want to upgrade from a 2.8 snap to 2.9, and you are using a `region+rack` configuration, use this command:

    $ sudo snap refresh --channel=2.9/stable maas

After entering your password, the snap will refresh from the 2.9 stable channel.  You will **not** need to re-initialise MAAS.

If you are using a multi-node maas deployment with separate regions and racks, you should first run the upgrade command above for rack nodes, then for region nodes.

<a href="#heading--maas-init-modes"><h2 id="heading--maas-init-modes">MAAS initialisation modes</h2></a>

MAAS supports the following modes, which dictate what services will run on the local system:

| Mode          | Region | Rack | Database | Description                           |
|---------------|--------|------|----------|---------------------------------------|
| `region`      | X      |      |          | Region API server only                |
| `rack`        |        | X    |          | Rack controller only                  |
| `region+rack` | X      | X    |          | Region API server and rack controller |
| `none`        |        |      |          | Reinitialises MAAS and stops services |

<a href="#heading--init-poc"><h2 id="heading--init-poc">Initialising MAAS as a test configuration</h2></a>

We want to provide a more compact version for those who may be testing MAAS.  To achieve this, we're providing a separate snap, called `maas-test-db`, which provides a PostgreSQL database for use in testing and evaluating MAAS.   The following instructions will help you take advantage of this test configuration.

Once MAAS is installed, you can use the `--help` flag with `maas init` to get relevant instructions:

    $ sudo maas init --help
    usage: maas init [-h] {region+rack,region,rack} . . .

    Initialise MAAS in the specified run mode.

    optional arguments:
      -h, --help            show this help message and exit

    run modes:
      {region+rack,region,rack}
        region+rack         Both region and rack controllers
        region              Region controller only
        rack                Rack controller only

    When installing region or rack+region modes, MAAS needs a
    PostgreSQL database to connect to.

    If you want to set up PostgreSQL for a non-production deployment on
    this machine, and configure it for use with MAAS, you can install
    the maas-test-db snap before running 'maas init':
        sudo snap install maas-test-db
        sudo maas init region+rack --database-uri maas-test-db:///

We'll quickly walk through these instructions to confirm your understanding.  First, install the `maas-test-db` snap:

    sudo snap install maas-test-db

Note that this step installs a a running PostgreSQL and a MAAS-ready database instantiation.  When it's done, you can double check with a built-in PostgreSQL shell:

    $ maas-test-db.psql
    psql (10.6)
    Type "help" for help.

    postgres=# \l

This will produce a list of databases, one of which will be `maasdb`, owned by `maas`.  Note that this database is still empty because MAAS is not yet initialised and, hence, is not yet using the database.  Once this is done, you can run the `maas init` command:

    sudo maas init region+rack --database-uri maas-test-db:///

After running for a moment, the command will prompt you for a MAAS URL; typically, you can use the default:

    MAAS URL [default=http://10.45.222.159:5240/MAAS]:

When you've entered a suitable URL, or accepted the default, the following prompt will appear:

    MAAS has been set up.

    If you want to configure external authentication or use
    MAAS with Canonical RBAC, please run

      sudo maas configauth

    To create admins when not using external authentication, run

      sudo maas createadmin

Let's assume you just want a local testing user named `admin`:

    $ sudo maas createadmin
    Username: admin
    Password: ******
    Again: ******
    Email: admin@example.com
    Import SSH keys [] (lp:user-id or gh:user-id): gh:yourusername

At this point, MAAS is basically set up and running.  You can confirm this with `sudo maas status`.  If you need an API key, you can obtain this with `sudo maas apikey --username yourusername`.  Now you will be able to test and evaluate MAAS by going to the URL you entered or accepted above and entering your `admin` username and password.

<a href="#heading--configuration-verification"><h2 id="heading--configuration-verification">Configuration verification</h2></a>

After a snap installation of MAAS, you can verify the currently-running configuration with:

    sudo maas config

<a href="#heading--init-prod"><h2 id="heading--init-prod">Initialise MAAS for a production configuration</h2></a>

To install MAAS in a production configuration, you need to setup PostgreSQL, as described below.

<a href="#heading--pg-setup"><h3 id="heading--pg-setup">Setting up PostgreSQL from scratch</h3></a>

To set up PostgreSQL, even if it's running on a different machine, you can use the following procedure:

1. You will need to install PostgreSQL on the machine where you want to keep the database.  This can be the same machine as the MAAS region/rack controllers or a totally separate machine.  If PostgreSQL (version 10 or better) is already running on your target machine, you can skip this step. To install PostgreSQL, run these commands:

        sudo apt update -y
        sudo apt install -y postgresql

2. You want to make sure you have a suitable PostgreSQL user, which can be accomplished with the following command, where `$MAAS_DBUSER` is your desired database username, and `$MAAS_DBPASS` is the intended password for that username.  Note that if you're executing this step in a LXD container (as root, which is the default), you may get a minor error, but the operation will still complete correctly.

        sudo -u postgres psql -c "CREATE USER \"$MAAS_DBUSER\" WITH ENCRYPTED PASSWORD '$MAAS_DBPASS'"

3. Create the MAAS database with the following command, where `$MAAS_DBNAME` is your desired name for the MAAS database (typically known as `maas`). Again, if you're executing this step in a LXD container as root, you can ignore the minor error that results.

        sudo -u postgres createdb -O "$MAAS_DBUSER" "$MAAS_DBNAME"

4. Edit `/etc/postgresql/10/main/pg_hba.conf` and add a line for the newly created database, replacing the variables with actual  names. You can limit access to a specific network by using a different CIDR than `0/0`.

        host    $MAAS_DBNAME    $MAAS_DBUSER    0/0     md5

5. You can then initialise MAAS via the following command:

        sudo maas init region+rack --database-uri "postgres://$MAAS_DBUSER:$MAAS_DBPASS@$HOSTNAME/$MAAS_DBNAME"

<strong>NOTE:</strong> 

Don't worry; if you leave out any of the database parameters, you'll be prompted for those details.

<a href="#heading--service-status"><h2 id="heading--service-status">Checking MAAS service status</h2></a>

You can check the status of running services with:

    sudo maas status

Typically, the output looks something like this:

    bind9                            RUNNING   pid 7999, uptime 0:09:17
    dhcpd                            STOPPED   Not started
    dhcpd6                           STOPPED   Not started
    ntp                              RUNNING   pid 8598, uptime 0:05:42
    postgresql                       RUNNING   pid 8001, uptime 0:09:17
    proxy                            STOPPED   Not started
    rackd                            RUNNING   pid 8000, uptime 0:09:17
    regiond:regiond-0                RUNNING   pid 8003, uptime 0:09:17
    regiond:regiond-1                RUNNING   pid 8008, uptime 0:09:17
    regiond:regiond-2                RUNNING   pid 8005, uptime 0:09:17
    regiond:regiond-3                RUNNING   pid 8015, uptime 0:09:17
    tgt                              RUNNING   pid 8040, uptime 0:09:15

snap-2-9-cli snap-2-9-ui -->

<!-- snap-2-9-cli
With MAAS installed and initialised, you can now open the web UI in your browser and begin your [Configuration journey](configuration-journey.html).
 snap-2-9-cli -->

<!-- snap-2-9-ui
With MAAS installed and initialised, you can now open the web UI in your browser and begin your [Configuration journey](configuration-journey.html).
 snap-2-9-ui -->

<!-- snap-2-9-cli snap-2-9-ui
<a href="#heading--example"><h2 id="heading--example">Example of MAAS initialisation</h2></a>

The following demonstrates the `region+rack` mode, a popular initialisation choice for MAAS:

    sudo maas init region+rack

`maas` will ask for the MAAS URL:

    MAAS URL [default=http://10.55.60.1:5240/MAAS]: http://192.168.122.1:5240/MAAS

If you also need to create an admin user, you can use:

    sudo maas createadmin

which takes you through the following exchange:

    Create first admin account:       
    Username: admin
    Password: ******
    Again: ******
    Email: admin@example.com
    Import SSH keys [] (lp:user-id or gh:user-id): lp:petermatulis

<strong>NOTE:</strong> 
You will use the username and password created above to access the web UI.  If you enter a [Launchpad](https://launchpad.net/) or [GitHub](https://github.com) account name with associated SSH key, MAAS will import them automatically.


<a href="#heading--maas-url"><h2 id="heading--maas-url">MAAS URL</h2></a>

All run modes (except `none`) prompt for a MAAS URL, interpreted differently depending on the mode:

-   `region`: Used to create a new region controller.
-   `rack`: Used to locate the region controller.

<a href="#heading--shared-secret"><h2 id="heading--shared-secret">Shared secret</h2></a>

The 'rack' and 'region+rack' modes will additionally ask for a shared secret that will allow the new rack controller to register with the region controller.

<a href="#heading--reinitialising-maas"><h2 id="heading--reinitialising-maas">Reinitialising MAAS</h2></a>

It is also possible to re-initialise MAAS to switch modes.  For example, to switch from `rack` to `region`:

    sudo maas init region

<a href="#heading--additional-init-options"><h2 id="heading--additional-init-options">Additional `init` options</h2></a>

The `init` command can takes optional arguments. To list them, as well as read a brief description of each, you can enter:

    sudo maas init --help

snap-2-9-ui snap-2-9-cli -->

<!-- deb-2-8-cli deb-2-8-ui

<a href="#heading--upgrade-2-7-to-2-8"><h2 id="heading--upgrade-2-7-to-2-8">Upgrading from MAAS 2.7</h2></a>

Upgrading from MAAS 2.7 to MAAS 2.8 is accomplished via the following command sequence:


<pre><code>sudo add-apt-repository ppa:maas/2.8
sudo apt update
sudo apt upgrade maas
</code></pre>


<a href="#heading--install-from-packages"><h2 id="heading--install-from-packages">Install MAAS from packages</h2></a>

You can install a 2.8 stable version of MAAS via the PPA listed on the [MAAS launchpad](https://launchpad.net/~maas), specifically:

-   [ppa:maas/2.8](https://launchpad.net/~maas/+archive/ubuntu/2.8)

To add the 2.8 PPA, type:


<pre><code class="bash">sudo add-apt-repository -yu ppa:maas/2.8
</code></pre>


<a href="#heading--installation-scenarios"><h3 id="heading--installation-scenarios">Installation scenarios</h3></a>

The recommended way to set up an initial MAAS environment is to put everything on one machine:


<pre><code class="bash">sudo apt install maas
</code></pre>


Executing this command leads you to a list of dependent packages to be installed, and a summary prompt that lets you choose whether to continue with the install:

<a href="images/0eb9d0ed0711d3a6c548d44cf2ed48f49000a4b5.jpeg" target = "_blank"><img src="images/0eb9d0ed0711d3a6c548d44cf2ed48f49000a4b5.jpeg"></a></a>

Choosing "Y" proceeds with a standard <code>apt</code> package install.

<h4>Distributed environment</h4> 

<p>For a more distributed environment, you can place the region controller on one machine:</p>


<pre><code class="bash">sudo apt install maas-region-controller
</code></pre>


and the rack controller (see [Rack controller](rack-controller.html) for details) on another:


<pre><code class="bash">sudo apt install maas-rack-controller
sudo maas-rack register
</code></pre>


These two steps will lead you through two similar <code>apt</code> install sequences.

<a href="#heading--creating-a-maas-user"><h3 id="heading--creating-a-maas-user">Creating a MAAS user</h3></a>

<p>Finally, you will need to create a MAAS administrator user to access the web UI:</p>


<pre><code class="bash">sudo maas createadmin --username=$PROFILE --email=$EMAIL_ADDRESS
</code></pre>


<p>For example, the process might go like this:</p>

<a href="images/315a94f85b928644037839677fd51871df0c1319.jpeg" target = "_blank"><img src="images/315a94f85b928644037839677fd51871df0c1319.jpeg"></a></a>

<p>The username can be anything. You will also be prompted to supply a password for the user. The command option <code>--password=$PASSWORD</code> can be used to specify one but, depending on your environment, this may pose a security risk.</p>

<div class="p-notification">
<p class="p-notification__response">At this time, MAAS does not make use of the email address. However, it may do so in the future.</p>
</div>

Finally, the <code>createadmin</code> option asks for an SSH key:

<a
<a href="images/472ce8e02273187370565e3d40175fe0ea8e351e.jpeg" target = "_blank"><img src="images/472ce8e02273187370565e3d40175fe0ea8e351e.jpeg"></a></a>

<p>If you have an SSH key associated with your launchpad or github accounts, you can enter the username here to use the associated key.  For launchpad, just enter <code>lp:username</code>, and for github, enter <code>gh:username</code> at the prompt.  In both cases, the actual username has to be supplied after the <code>lp:</code> or <code>gh:</code> prefix. </p>

<p>If you don't have a key associated with either of these services, you will have an opportunity to paste your public key into the MAAS SSH key list, after you've started MAAS for the first time as part of the welcome screens.</p>

<a href="#heading--next-steps"><h3 id="heading--next-steps">Next steps</h3></a>

deb-2-8-cli deb-2-8-ui -->

<!-- deb-2-8-cli
Once you have installed your MAAS environment (region + rack controller) and any possible extra rack controllers(s), you are ready to begin your [Configuration journey](configuration-journey.html).
deb-2-8-cli -->

<!-- deb-2-8-ui
Once you have installed your MAAS environment (region + rack controller) and any possible extra rack controllers(s), you are ready to begin your [Configuration journey](configuration-journey.html).
deb-2-8-ui -->

<!-- deb-2-7-cli deb-2-7-ui

<a href="#heading--upgrade-2-6-to-2-7"><h2 id="heading--upgrade-2-6-to-2-7">Upgrading from MAAS 2.6</h2></a>

Upgrading from MAAS 2.6 to MAAS 2.7 is accomplished via the following command sequence:


<pre><code>sudo add-apt-repository ppa:maas/2.7
sudo apt update
sudo apt upgrade maas
</code></pre>


<a href="#heading--install-from-packages"><h2 id="heading--install-from-packages">Install MAAS from packages</h2></a>

You can install a 2.7 stable version of MAAS via the PPA listed on the [MAAS launchpad](https://launchpad.net/~maas), specifically:

-   [ppa:maas/2.7](https://launchpad.net/~maas/+archive/ubuntu/2.7)

To add the 2.7 PPA, type:


<pre><code class="bash">sudo add-apt-repository -yu ppa:maas/2.7
</code></pre>


<a href="#heading--installation-scenarios"><h3 id="heading--installation-scenarios">Installation scenarios</h3></a>

The recommended way to set up an initial MAAS environment is to put everything on one machine:


<pre><code class="bash">sudo apt install maas
</code></pre>


Executing this command leads you to a list of dependent packages to be installed, and a summary prompt that lets you choose whether to continue with the install:

<a href="images/0eb9d0ed0711d3a6c548d44cf2ed48f49000a4b5.jpeg" target = "_blank"><img src="images/0eb9d0ed0711d3a6c548d44cf2ed48f49000a4b5.jpeg"></a></a>

Choosing "Y" proceeds with a standard <code>apt</code> package install.

<h4>Distributed environment</h4> 

<p>For a more distributed environment, you can place the region controller on one machine:</p>


<pre><code class="bash">sudo apt install maas-region-controller
</code></pre>


and the rack controller (see [Rack controller](rack-controller.html) for details) on another:


<pre><code class="bash">sudo apt install maas-rack-controller
sudo maas-rack register
</code></pre>


These two steps will lead you through two similar <code>apt</code> install sequences.

<a href="#heading--creating-a-maas-user"><h3 id="heading--creating-a-maas-user">Creating a MAAS user</h3></a>

<p>Finally, you will need to create a MAAS administrator user to access the web UI:</p>


<pre><code class="bash">sudo maas createadmin --username=$PROFILE --email=$EMAIL_ADDRESS
</code></pre>


<p>For example, the process might go like this:</p>

<a href="images/315a94f85b928644037839677fd51871df0c1319.jpeg" target = "_blank"><img src="images/315a94f85b928644037839677fd51871df0c1319.jpeg"></a></a>

<p>The username can be anything. You will also be prompted to supply a password for the user. The command option <code>--password=$PASSWORD</code> can be used to specify one but, depending on your environment, this may pose a security risk.</p>

<div class="p-notification">
<p class="p-notification__response">At this time, MAAS does not make use of the email address. However, it may do so in the future.</p>
</div>

Finally, the <code>createadmin</code> option asks for an SSH key:

<a
<a href="images/472ce8e02273187370565e3d40175fe0ea8e351e.jpeg" target = "_blank"><img src="images/472ce8e02273187370565e3d40175fe0ea8e351e.jpeg"></a></a>

<p>If you have an SSH key associated with your launchpad or github accounts, you can enter the username here to include the key.  For launchpad, just enter <code>lp:username</code>, and for github, enter <code>gh:username</code> at the prompt.  In both cases, the actual username has to be supplied after the <code>lp:</code> or <code>gh:</code> prefix. </p>

<p>If you don't have a key associated with either of these services, you will have an opportunity to paste your public key into the MAAS SSH key list, after you've started MAAS for the first time as part of the welcome screens.</p>

<a href="#heading--next-steps"><h3 id="heading--next-steps">Next steps</h3></a>

deb-2-7-cli deb-2-7-ui -->

<!-- deb-2-7-cli
Once you have installed your MAAS environment (region + rack controller) and any possible extra rack controllers(s), you are ready to begin your [Configuration journey](configuration-journey.html).
deb-2-7-cli -->

<!-- deb-2-7-ui
Once you have installed your MAAS environment (region + rack controller) and any possible extra rack controllers(s), you are ready to begin your [Configuration journey](configuration-journey.html).
deb-2-7-ui -->

<!-- deb-2-9-cli deb-2-9-ui
<a href="#heading--upgrade-via-packages"><h2 id="heading--upgrade-via-packages">Upgrade MAAS 2.8 to MAAS 2.9</h2></a>

MAAS 2.8 is the last supported version for Ubuntu 18.04 LTS.  Newer versions of MAAS will not be back-portable, and consequently, to upgrade to MAAS 2.9 and all future versions, you will also need to upgrade the base operating system to Ubuntu 20.04.  You do these two operations all at once, with the following procedure:


<pre><code>sudo add-apt-repository ppa:maas/2.9
</code></pre>


You will get a message similar to this:


<pre><code> For stable releases of 2.9.x
 More info: https://launchpad.net/~maas/+archive/ubuntu/2.9
Press [ENTER] to continue or Ctrl-c to cancel adding it.

Hit:1 http://security.ubuntu.com/ubuntu bionic-security InRelease
Hit:2 http://ppa.launchpad.net/maas/2.8/ubuntu bionic InRelease          
Hit:3 http://archive.ubuntu.com/ubuntu bionic InRelease                  
Hit:4 http://archive.ubuntu.com/ubuntu bionic-updates InRelease                                     
Ign:5 http://ppa.launchpad.net/maas/2.9/ubuntu bionic InRelease          
Hit:6 http://archive.ubuntu.com/ubuntu bionic-backports InRelease        
Err:7 http://ppa.launchpad.net/maas/2.9/ubuntu bionic Release                 
  404  Not Found [IP: 91.189.95.85 80]
Reading package lists... Done
E: The repository 'http://ppa.launchpad.net/maas/2.9/ubuntu bionic Release' does not have a Release file.
N: Updating from such a repository can't be done securely, and is therefore disabled by default.
N: See apt-secure(8) manpage for repository creation and user configuration details.
</code></pre>


This message seems to indicate that nothing happened, but, in fact, this command still creates the file:


<pre><code>/etc/apt/sources.list.d/maas-ubuntu-2_9-bionic.list
</code></pre>


This file identifies the path to the 2.9 PPA, even though it incorrectly implies there's a Bionic release there:


<pre><code>deb http://ppa.launchpad.net/maas/2.9/ubuntu bionic main
</code></pre>


Still, that's enough for `do-release-upgrade` to figure out that there is a 2.9 PPA, and when it checks, it will find a Focal version of MAAS, which it will bring over and install in place of 2.8.  It isn't necessary to stop MAAS or do anything else, except go ahead and run the upgrade:


<pre><code>sudo do-release-upgrade --allow-third-parties
</code></pre>


This command will produce a lot of output, ask you a few questions (for which the defaults are usually fine), and eventually ask you to reboot.  Once your machine has come back up, you can check whether your upgrade has been successful by entering:


<pre><code>lsb_release -a
</code></pre>


If the ugprade was successful, this command should yield output similar to the following:


<pre><code>No LSB modules are available.
Distributor ID: Ubuntu
Description:    Ubuntu 20.04.1 LTS
Release:    20.04
Codename:   focal
</code></pre>


You have now upgraded to the Ubuntu 20.04 LTS base, and if you check your running MAAS install, you should see that the version has been updated to the latest stable 2.9 release.

<a href="#heading--installation-scenarios"><h2 id="heading--installation-scenarios">Installing MAAS 2.9 fresh</h2></a>

The recommended way to set up an initial MAAS environment is to put everything on one machine:


<pre><code class="bash">sudo apt-get -y install maas
</code></pre>


Executing this command leads you to a list of dependent packages to be installed, and a summary prompt that lets you choose whether to continue with the install:

<a href="images/0eb9d0ed0711d3a6c548d44cf2ed48f49000a4b5.jpeg" target = "_blank"><img src="images/0eb9d0ed0711d3a6c548d44cf2ed48f49000a4b5.jpeg"></a></a>

Choosing "Y" proceeds with a standard <code>apt</code> package install.

<h4>Distributed environment</h4> 

<p>For a more distributed environment, you can place the region controller on one machine:</p>


<pre><code class="bash">sudo apt install maas-region-controller
</code></pre>


and the rack controller (see [Rack controller](rack-controller.html) for details) on another:


<pre><code class="bash">sudo apt install maas-rack-controller
sudo maas-rack register
</code></pre>


These two steps will lead you through two similar <code>apt</code> install sequences.

<a href="#heading--creating-a-maas-user"><h3 id="heading--creating-a-maas-user">Creating a MAAS user</h3></a>

<p>Finally, you will need to create a MAAS administrator user to access the web UI:</p>


<pre><code class="bash">sudo maas createadmin --username=$PROFILE --email=$EMAIL_ADDRESS
</code></pre>


<p>For example, the process might go like this:</p>

<a href="images/315a94f85b928644037839677fd51871df0c1319.jpeg" target = "_blank"><img src="images/315a94f85b928644037839677fd51871df0c1319.jpeg"></a></a>

<p>The username can be anything. You will also be prompted to supply a password for the user. The command option <code>--password=$PASSWORD</code> can be used to specify one but, depending on your environment, this may pose a security risk.</p>

<div class="p-notification">
<p class="p-notification__response">At this time, MAAS does not make use of the email address. However, it may do so in the future.</p>
</div>

Finally, the <code>createadmin</code> option asks for an SSH key:

<a
<a href="images/472ce8e02273187370565e3d40175fe0ea8e351e.jpeg" target = "_blank"><img src="images/472ce8e02273187370565e3d40175fe0ea8e351e.jpeg"></a></a>

<p>If you have an SSH key associated with your launchpad or github accounts, you can enter the username here to include the key.  For launchpad, just enter <code>lp:username</code>, and for github, enter <code>gh:username</code> at the prompt.  In both cases, the actual username has to be supplied after the <code>lp:</code> or <code>gh:</code> prefix. </p>

<p>If you don't have a key associated with either of these services, you will have an opportunity to paste your public key into the MAAS SSH key list, after you've started MAAS for the first time as part of the welcome screens.</p>

<a href="#heading--next-steps"><h3 id="heading--next-steps">Next steps</h3></a>

deb-2-9-cli deb-2-9-ui -->

<!-- deb-2-9-cli
Once you have installed your MAAS environment (region + rack controller) and any possible extra rack controllers(s), you are ready to begin your [Configuration journey](configuration-journey.html).
deb-2-9-cli -->

<!-- deb-2-9-ui
Once you have installed your MAAS environment (region + rack controller) and any possible extra rack controllers(s), you are ready to begin your [Configuration journey](configuration-journey.html).
deb-2-9-ui -->

<p>MAAS can be installed in either of two configurations:  test or production.  The test configuration uses a small PostgreSQL database (in a separate snap), designed for use with MAAS. The full-up production configuration uses a separate PostgreSQL database for performance and scalability.  This article will walk you through both install methods.</p>
<h4>Thirteen questions you may have:</h4>
<ol>
<li><a href="#heading--install-maas-snap">How do I install (but not initialise) the MAAS 3.0 Beta snap?</a></li>
<li><a href="#heading--upgrade-maas-snap">How do I upgrade my 2.9 snap to the MAAS 3.0 Beta?</a></li>
<li><a href="#heading--maas-init-modes">What are MAAS initialisation modes?</a></li>
<li><a href="#heading--init-poc">How do I initialise MAAS for a test or proof-of-concept configuration?</a></li>
<li><a href="#heading--init-prod">How do I initialise MAAS for a production configuration?</a></li>
<li><a href="tips-tricks-and-traps.html#heading--migrate-maas">How do I migrate an existing snap install?</a></li>
<li><a href="tips-tricks-and-traps.html#heading--manual-export">What if I want to manually export the MAAS database to an existing PostgreSQL server?</a></li>
<li><a href="#heading--service-status">How can I check the service status of my MAAS configuration?</a></li>
<li><a href="#heading--reinitialising-maas">How do I re-initialise MAAS, if I want to?</a></li>
<li><a href="#heading--additional-init-options">How can I discover additional init options?</a></li>
<li><a href="#heading--example">Give me an example of initialising MAAS</a></li>
<li><a href="#heading--maas-url">Tell me about the MAAS URL</a></li>
<li><a href="#heading--shared-secret">Tell me about the shared secret</a></li>
</ol>
<p><strong>NOTE:</strong> 
If you have installed <code>bind9</code> or have it running, you will need to uninstall it before installing MAAS.  You can check with <code>ps aux | grep named</code> to see if it&rsquo;s running. The <code>bind9</code> daemon interferes with MAAS operation and creates a number of unusual, hard-to-debug errors &ndash; but don&rsquo;t worry, MAAS provides DNS and can work with existing DNS servers.</p>
<p><a href="#heading--install-maas-snap"><h2 id="heading--install-maas-snap">Installing MAAS from the snap</h2></a></p>
<p><a href="https://snapcraft.io/docs">Snaps</a> are containerised software packages. To install MAAS from a snap simply enter the following:</p>
<pre><code>$ sudo snap install --channel=3.0/beta maas
</code></pre>
<p>After entering your password, the snap will download and install from the 3.0 beta channel &ndash; though MAAS needs initialising before it&rsquo;s ready to go.</p>
<p><a href="#heading--upgrade-maas-snap"><h2 id="heading--upgrade-maas-snap">Upgrading MAAS from 2.9</h2></a></p>
<p>If you want to upgrade from a 2.9 snap to 3.0 Beta 1 snap, and you are using a <code>region+rack</code> configuration, use this command:</p>
<pre><code>$ sudo snap refresh --channel=3.0/beta maas
</code></pre>
<p>After entering your password, the snap will refresh from the 3.0 beta channel.  You will <strong>not</strong> need to re-initialise MAAS.</p>
<p>If you are using a multi-node maas deployment with separate regions and racks, you should first run the upgrade command above for rack nodes, then for region nodes.</p>
<p><a href="#heading--maas-init-modes"><h2 id="heading--maas-init-modes">MAAS initialisation modes</h2></a></p>
<p>MAAS supports the following modes, which dictate what services will run on the local system:</p>
<table>
<thead>
<tr>
<th>Mode</th>
<th>Region</th>
<th>Rack</th>
<th>Database</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>region</code></td>
<td>X</td>
<td></td>
<td></td>
<td>Region API server only</td>
</tr>
<tr>
<td><code>rack</code></td>
<td></td>
<td>X</td>
<td></td>
<td>Rack controller only</td>
</tr>
<tr>
<td><code>region+rack</code></td>
<td>X</td>
<td>X</td>
<td></td>
<td>Region API server and rack controller</td>
</tr>
<tr>
<td><code>none</code></td>
<td></td>
<td></td>
<td></td>
<td>Reinitialises MAAS and stops services</td>
</tr>
</tbody>
</table>
<p><a href="#heading--init-poc"><h2 id="heading--init-poc">Initialising MAAS as a test configuration</h2></a></p>
<p>We want to provide a more compact version for those who may be testing MAAS.  To achieve this, we&rsquo;re providing a separate snap, called <code>maas-test-db</code>, which provides a PostgreSQL database for use in testing and evaluating MAAS.   The following instructions will help you take advantage of this test configuration.</p>
<p>Once MAAS is installed, you can use the <code>--help</code> flag with <code>maas init</code> to get relevant instructions:</p>
<pre><code>$ sudo maas init --help
usage: maas init [-h] {region+rack,region,rack} . . .

Initialise MAAS in the specified run mode.

optional arguments:
  -h, --help            show this help message and exit

run modes:
  {region+rack,region,rack}
    region+rack         Both region and rack controllers
    region              Region controller only
    rack                Rack controller only

When installing region or rack+region modes, MAAS needs a
PostgreSQL database to connect to.

If you want to set up PostgreSQL for a non-production deployment on
this machine, and configure it for use with MAAS, you can install
the maas-test-db snap before running 'maas init':
    sudo snap install maas-test-db
    sudo maas init region+rack --database-uri maas-test-db:///
</code></pre>
<p>We&rsquo;ll quickly walk through these instructions to confirm your understanding.  First, install the <code>maas-test-db</code> snap:</p>
<pre><code>sudo snap install maas-test-db
</code></pre>
<p>Note that this step installs a a running PostgreSQL and a MAAS-ready database instantiation.  When it&rsquo;s done, you can double check with a built-in PostgreSQL shell:</p>
<pre><code>$ maas-test-db.psql
psql (10.6)
Type "help" for help.

postgres=# \l
</code></pre>
<p>This will produce a list of databases, one of which will be <code>maasdb</code>, owned by <code>maas</code>.  Note that this database is still empty because MAAS is not yet initialised and, hence, is not yet using the database.  Once this is done, you can run the <code>maas init</code> command:</p>
<pre><code>sudo maas init region+rack --database-uri maas-test-db:///
</code></pre>
<p>After running for a moment, the command will prompt you for a MAAS URL; typically, you can use the default:</p>
<pre><code>MAAS URL [default=http://10.45.222.159:5240/MAAS]:
</code></pre>
<p>When you&rsquo;ve entered a suitable URL, or accepted the default, the following prompt will appear:</p>
<pre><code>MAAS has been set up.

If you want to configure external authentication or use
MAAS with Canonical RBAC, please run

  sudo maas configauth

To create admins when not using external authentication, run

  sudo maas createadmin
</code></pre>
<p>Let&rsquo;s assume you just want a local testing user named <code>admin</code>:</p>
<pre><code>$ sudo maas createadmin
Username: admin
Password: ******
Again: ******
Email: admin@example.com
Import SSH keys [] (lp:user-id or gh:user-id): gh:yourusername
</code></pre>
<p>At this point, MAAS is basically set up and running.  You can confirm this with <code>sudo maas status</code>.  If you need an API key, you can obtain this with <code>sudo maas apikey --username yourusername</code>.  Now you will be able to test and evaluate MAAS by going to the URL you entered or accepted above and entering your <code>admin</code> username and password.</p>
<p><a href="#heading--configuration-verification"><h2 id="heading--configuration-verification">Configuration verification</h2></a></p>
<p>After a snap installation of MAAS, you can verify the currently-running configuration with:</p>
<pre><code>sudo maas config
</code></pre>
<p><a href="#heading--init-prod"><h2 id="heading--init-prod">Initialise MAAS for a production configuration</h2></a></p>
<p>To install MAAS in a production configuration, you need to setup PostgreSQL, as described below.</p>
<p><a href="#heading--pg-setup"><h3 id="heading--pg-setup">Setting up PostgreSQL from scratch</h3></a></p>
<p>To set up PostgreSQL, even if it&rsquo;s running on a different machine, you can use the following procedure:</p>
<ol>
<li>
<p>You will need to install PostgreSQL on the machine where you want to keep the database.  This can be the same machine as the MAAS region/rack controllers or a totally separate machine.  If PostgreSQL (version 10 or better) is already running on your target machine, you can skip this step. To install PostgreSQL, run these commands:</p>
<pre><code>sudo apt update -y
sudo apt install -y postgresql
</code></pre>
</li>
<li>
<p>You want to make sure you have a suitable PostgreSQL user, which can be accomplished with the following command, where <code>$MAAS_DBUSER</code> is your desired database username, and <code>$MAAS_DBPASS</code> is the intended password for that username.  Note that if you&rsquo;re executing this step in a LXD container (as root, which is the default), you may get a minor error, but the operation will still complete correctly.</p>
<pre><code>sudo -u postgres psql -c "CREATE USER \"$MAAS_DBUSER\" WITH ENCRYPTED PASSWORD '$MAAS_DBPASS'"
</code></pre>
</li>
<li>
<p>Create the MAAS database with the following command, where <code>$MAAS_DBNAME</code> is your desired name for the MAAS database (typically known as <code>maas</code>). Again, if you&rsquo;re executing this step in a LXD container as root, you can ignore the minor error that results.</p>
<pre><code>sudo -u postgres createdb -O "$MAAS_DBUSER" "$MAAS_DBNAME"
</code></pre>
</li>
<li>
<p>Edit <code>/etc/postgresql/10/main/pg_hba.conf</code> and add a line for the newly created database, replacing the variables with actual  names. You can limit access to a specific network by using a different CIDR than <code>0/0</code>.</p>
<pre><code>host    $MAAS_DBNAME    $MAAS_DBUSER    0/0     md5
</code></pre>
</li>
<li>
<p>You can then initialise MAAS via the following command:</p>
<pre><code>sudo maas init region+rack --database-uri "postgres://$MAAS_DBUSER:$MAAS_DBPASS@$HOSTNAME/$MAAS_DBNAME"
</code></pre>
</li>
</ol>
<p><strong>NOTE:</strong> </p>
<p>Don&rsquo;t worry; if you leave out any of the database parameters, you&rsquo;ll be prompted for those details.</p>
<p><a href="#heading--service-status"><h2 id="heading--service-status">Checking MAAS service status</h2></a></p>
<p>You can check the status of running services with:</p>
<pre><code>sudo maas status
</code></pre>
<p>Typically, the output looks something like this:</p>
<pre><code>bind9                            RUNNING   pid 7999, uptime 0:09:17
dhcpd                            STOPPED   Not started
dhcpd6                           STOPPED   Not started
ntp                              RUNNING   pid 8598, uptime 0:05:42
postgresql                       RUNNING   pid 8001, uptime 0:09:17
proxy                            STOPPED   Not started
rackd                            RUNNING   pid 8000, uptime 0:09:17
regiond:regiond-0                RUNNING   pid 8003, uptime 0:09:17
regiond:regiond-1                RUNNING   pid 8008, uptime 0:09:17
regiond:regiond-2                RUNNING   pid 8005, uptime 0:09:17
regiond:regiond-3                RUNNING   pid 8015, uptime 0:09:17
tgt                              RUNNING   pid 8040, uptime 0:09:15
</code></pre>
<!-- snap-3-0-cli
With MAAS installed and initialised, you can now open the web UI in your browser and begin your [Configuration journey](configuration-journey.html).
 snap-3-0-cli -->

<p>With MAAS installed and initialised, you can now open the web UI in your browser and begin your <a href="configuration-journey.html">Configuration journey</a>.</p>
<p><a href="#heading--example"><h2 id="heading--example">Example of MAAS initialisation</h2></a></p>
<p>The following demonstrates the <code>region+rack</code> mode, a popular initialisation choice for MAAS:</p>
<pre><code>sudo maas init region+rack
</code></pre>
<p><code>maas</code> will ask for the MAAS URL:</p>
<pre><code>MAAS URL [default=http://10.55.60.1:5240/MAAS]: http://192.168.122.1:5240/MAAS
</code></pre>
<p>If you also need to create an admin user, you can use:</p>
<pre><code>sudo maas createadmin
</code></pre>
<p>which takes you through the following exchange:</p>
<pre><code>Create first admin account:       
Username: admin
Password: ******
Again: ******
Email: admin@example.com
Import SSH keys [] (lp:user-id or gh:user-id): lp:petermatulis
</code></pre>
<p><strong>NOTE:</strong> 
You will use the username and password created above to access the web UI.  If you enter a <a href="https://launchpad.net/">Launchpad</a> or <a href="https://github.com">GitHub</a> account name with associated SSH key, MAAS will import them automatically.</p>
<p><a href="#heading--maas-url"><h2 id="heading--maas-url">MAAS URL</h2></a></p>
<p>All run modes (except <code>none</code>) prompt for a MAAS URL, interpreted differently depending on the mode:</p>
<ul>
<li><code>region</code>: Used to create a new region controller.</li>
<li><code>rack</code>: Used to locate the region controller.</li>
</ul>
<p><a href="#heading--shared-secret"><h2 id="heading--shared-secret">Shared secret</h2></a></p>
<p>The &lsquo;rack&rsquo; and &lsquo;region+rack&rsquo; modes will additionally ask for a shared secret that will allow the new rack controller to register with the region controller.</p>
<p><a href="#heading--reinitialising-maas"><h2 id="heading--reinitialising-maas">Reinitialising MAAS</h2></a></p>
<p>It is also possible to re-initialise MAAS to switch modes.  For example, to switch from <code>rack</code> to <code>region</code>:</p>
<pre><code>sudo maas init region
</code></pre>
<p><a href="#heading--additional-init-options"><h2 id="heading--additional-init-options">Additional <code>init</code> options</h2></a></p>
<p>The <code>init</code> command can takes optional arguments. To list them, as well as read a brief description of each, you can enter:</p>
<pre><code>sudo maas init --help
</code></pre>
<!-- deb-3-0-cli deb-3-0-ui
<a href="#heading--installation-scenarios"><h2 id="heading--installation-scenarios">Installing MAAS 3.0 Beta 1</h2></a>

The recommended way to set up an initial MAAS environment is to put everything on one machine:


<pre><code class="bash">sudo apt-add-repository paa:maas/3.0-next
sudo apt update
sudo apt-get -y install maas
</code></pre>


Executing this command leads you to a list of dependent packages to be installed, and a summary prompt that lets you choose whether to continue with the install:

<a href="images/0eb9d0ed0711d3a6c548d44cf2ed48f49000a4b5.jpeg" target = "_blank"><img src="images/0eb9d0ed0711d3a6c548d44cf2ed48f49000a4b5.jpeg"></a></a>

Choosing "Y" proceeds with a standard <code>apt</code> package install.

<h4>Distributed environment</h4> 

<p>For a more distributed environment, you can place the region controller on one machine:</p>


<pre><code class="bash">sudo apt install maas-region-controller
</code></pre>


and the rack controller (see [Rack controller](rack-controller.html) for details) on another:


<pre><code class="bash">sudo apt install maas-rack-controller
sudo maas-rack register
</code></pre>


These two steps will lead you through two similar <code>apt</code> install sequences.

<a href="#heading--creating-a-maas-user"><h3 id="heading--creating-a-maas-user">Creating a MAAS user</h3></a>

<p>Finally, you will need to create a MAAS administrator user to access the web UI:</p>


<pre><code class="bash">sudo maas createadmin --username=$PROFILE --email=$EMAIL_ADDRESS
</code></pre>


<p>For example, the process might go like this:</p>

<a href="images/315a94f85b928644037839677fd51871df0c1319.jpeg" target = "_blank"><img src="images/315a94f85b928644037839677fd51871df0c1319.jpeg"></a></a>

<p>The username can be anything. You will also be prompted to supply a password for the user. The command option <code>--password=$PASSWORD</code> can be used to specify one but, depending on your environment, this may pose a security risk.</p>

<div class="p-notification">
<p class="p-notification__response">At this time, MAAS does not make use of the email address. However, it may do so in the future.</p>
</div>

Finally, the <code>createadmin</code> option asks for an SSH key:

<a
<a href="images/472ce8e02273187370565e3d40175fe0ea8e351e.jpeg" target = "_blank"><img src="images/472ce8e02273187370565e3d40175fe0ea8e351e.jpeg"></a></a>

<p>If you have an SSH key associated with your launchpad or github accounts, you can enter the username here to include the key.  For launchpad, just enter <code>lp:username</code>, and for github, enter <code>gh:username</code> at the prompt.  In both cases, the actual username has to be supplied after the <code>lp:</code> or <code>gh:</code> prefix. </p>

<p>If you don't have a key associated with either of these services, you will have an opportunity to paste your public key into the MAAS SSH key list, after you've started MAAS for the first time as part of the welcome screens.</p>

<a href="#heading--next-steps"><h3 id="heading--next-steps">Next steps</h3></a>

deb-3-0-cli deb-3-0-ui -->

<!-- deb-3-0-cli
Once you have installed your MAAS environment (region + rack controller) and any possible extra rack controllers(s), you are ready to begin your [Configuration journey](configuration-journey.html).
deb-3-0-cli -->

<!-- deb-3-0-ui
Once you have installed your MAAS environment (region + rack controller) and any possible extra rack controllers(s), you are ready to begin your [Configuration journey](configuration-journey.html).
deb-3-0-ui -->
    </div>
  </body>
</html>