<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" type="text/css" href="css/stylesheet.css" />
    <style>
      #selector a:link{color:black;}
      #selector a:visited{color:black;}
      #selector a:active{color:black;}
      #selector a:hover{color:blue;}
      #sidebar a:link{color:black;}
      #sidebar a:visited{color:black;}
      #sidebar a:active{color:black;}
      #sidebar a:hover{color:blue;}
      ul {margin-deb-2-8-clileft:0;list-deb-2-8-clistyle-deb-2-8-clitype:none;}
      li {margin: 4px 0;}
    </style>
  </head>
  <body>
    <div id="selector" style="top:0; position:fixed; float:right; background-deb-2-8-clicolor:#d9d9d9; width:100%;border-deb-2-8-clibottom:1px solid black;">
      &nbsp;&nbsp;<strong>Offline docs</strong>
      <a href="https://maas.io/docs">(switch to live docs)</a>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
	<a href="../ui/high-deb-2-8-cliavailability.html">
	  &nbsp;UI-deb-2-8-clionly&nbsp;
	</a>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      <span style="background-deb-2-8-clicolor:white;border-deb-2-8-clitop:1px solid black; border-deb-2-8-clileft:1px solid black; border-deb-2-8-cliright:1px solid black; border-deb-2-8-clibottom:5px solid white;">
	  CLI-deb-2-8-clionly
      </span>
    </div>
    <div id="sidebar" style="float:left; width:25%;margin-deb-2-8-clitop:40px; margin-deb-2-8-clileft:20px">
      <strong>
	<a href="maas-deb-2-8-clidocumentation.html">
	  Introduction
	</a>
      </strong>
      <ul>
	<li>
	  <a href="about-deb-2-8-climaas.html">
	    About MAAS
	  </a>
	</li>
	<li>
	  <a href="give-deb-2-8-clime-deb-2-8-clian-deb-2-8-cliexample-deb-2-8-cliof-deb-2-8-climaas.html">
	    &ldquo;Give me an example&rdquo;
	  </a>
	</li>
	<li>
	  <a href="whats-deb-2-8-clinew-deb-2-8-cliin-deb-2-8-climaas.html">
	    What&rsquo;s new in 2.8
	  </a>
	</li>
	<li>
	  <a href="maas-deb-2-8-clirequirements.html">
	    Requirements
	  </a>
	</li>
	<li>
	  <a href="maas-deb-2-8-cliinstallation.html">
	    Installation
	  </a>
	</li>
	<li>
	  <a href="configuration-deb-2-8-clijourney.html">
	    Configuration journey
	  </a>
	</li>
      <strong>
	<a href="controllers.html">
	  Controllers
	</a>
      </strong>
      <ul>
	<li>
	  <a href="maas-deb-2-8-clicommunication.html">
	    Communication
	  </a>
	</li>
	<li>
	  <a href="rack-deb-2-8-clicontrollers.html">
	    Rack controllers
	  </a>
	</li>
	<li>
	  <a href="region-deb-2-8-clicontrollers.html">
	    Region controllers
	  </a>
	</li>
	<li>
	  <a href="high-deb-2-8-cliavailability.html">
	    High availability
	  </a>
	</li>
      </ul>
      <strong>
	<a href="machines.html">
	  Machines
	</a>
      </strong>
      <ul>
	<li>
	  <a href="add-deb-2-8-climachines.html">
	    Add machines
	  </a>
	</li>
	<li>
	  <a href="power-deb-2-8-climanagement.html">
	    Power management
	  </a>
	</li>
	<li>
	  <a href="commission-deb-2-8-climachines.html">
	    Commission machines
	  </a>
	</li>
	<li>Testing
	</li>
	<li>
	  <a href="hardware-deb-2-8-clitesting.html">
	    Hardware testing
	  </a>
	</li>
	<li>
	  <a href="network-deb-2-8-clitesting.html">
	    Network testing
	  </a>
	</li>
	<li>
	  <a href="commissioning-deb-2-8-cliand-deb-2-8-clihardware-deb-2-8-clitesting-deb-2-8-cliscripts.html">
	    Commissioning and hardware testing scripts
	  </a>
	</li>
	<li>
	  <a href="deploy-deb-2-8-climachines.html">
	    Deploy machines
	  </a>
	</li>
	<li>
	  <a href="maas-deb-2-8-clitags.html">
	    Tags
	  </a>
	</li>
	<li>
	  <a href="custom-deb-2-8-climachine-deb-2-8-clisetup.html">
	    Custom machine setup
	  </a>
	</li>
	<li>
	  <a href="kernel-deb-2-8-cliboot-deb-2-8-clioptions.html">
	    Kernel boot options
	  </a>
	</li>
	<li>
	  <a href="resource-deb-2-8-clipools.html">
	    Resource pools
	  </a>
	</li>
	<li>
	  <a href="storage.html">
	    Storage
	  </a>
	</li>
	<li>
	  <a href="vmware-deb-2-8-clivmfs-deb-2-8-clidatastores.html">
	    VMware VMFS datastores
	  </a>
	</li>
	<li>
	  <a href="ubuntu-deb-2-8-clikernels.html">
	    Ubuntu kernels
	  </a>
	</li>
      </ul>
      <strong>
	<a href="images.html">
	  Images
	</a>
      </strong>
      <ul>
	<li>
	  <a href="select-deb-2-8-cliand-deb-2-8-cliimport-deb-2-8-cliimages.html">
	    Select and import images
	  </a>
	</li>
	<li>
	  <a href="local-deb-2-8-cliimage-deb-2-8-climirror.html">
	    Local image mirror
	  </a>
	</li>
	<li>
	  <a href="vmware-deb-2-8-cliimages.html">
	    VMWare images
	  </a>
	</li>
      </ul>
      <strong>
	<a href="networking.html">
	  Networking
	</a>
      </strong>
      <ul>
	<li>
	  <a href="subnet-deb-2-8-climanagement.html">
	    Subnet management
	  </a>
	</li>
	<li>
	  <a href="managing-deb-2-8-clidhcp.html">
	    DHCP
	  </a>
	</li>
	<li>
	  <a href="ip-deb-2-8-cliranges.html">
	    IP ranges
	  </a>
	</li>
	<li>
	  <a href="proxy.html">
	    Proxy
	  </a>
	</li>
	<li>
	  <a href="ntp-deb-2-8-cliservices.html">
	    NTP
	  </a>
	</li>
	<li>
	  <a href="network-deb-2-8-clidiscovery.html">
	    Network discovery
	  </a>
	</li>
	<li>
	  <a href="ipv6-deb-2-8-cliaddressing.html">
	    IPv6
	  </a>
	</li>
	<li>
	  <a href="configuring-deb-2-8-clitls-deb-2-8-cliencryption.html">
	    SSL
	  </a>
	</li>
	<li>
	  <a href="managing-deb-2-8-clistp.html">
	    STP
	  </a>
	</li>
	<li>
	  <a href="availability-deb-2-8-clizones.html">
	    Availability zones (AZs)
	  </a>
	</li>
      </ul>
      <strong>
	<a href="vm-deb-2-8-clihosting.html">
	  VM hosting
	</a>
      </strong>
      <ul>
	<li>
	  <a href="vm-deb-2-8-clihost-deb-2-8-clinetworking.html">
	    VM host networking
	  </a>
	</li>
	<li>
	  <a href="adding-deb-2-8-clia-deb-2-8-clivm-deb-2-8-clihost.html">
	    Add a VM host
	  </a>
	</li>
	<li>
	  <a href="vm-deb-2-8-clihost-deb-2-8-clistorage-deb-2-8-clipools.html">
	    VM host storage pools
	  </a>
	</li>
	<li>
	  <a href="creating-deb-2-8-cliand-deb-2-8-clideleting-deb-2-8-clivms.html">
	    Creating and deleting VMs
	  </a>
	</li>
      </ul>
      <strong>Operations
      </strong>
      <ul>
	<li>
	  <a href="prometheus-deb-2-8-climetrics.html">
	    Prometheus metrics
	  </a>
	</li>
	<li>
	  <a href="backup.html">
	    Backup
	  </a>
	</li>
	<li>
	  <a href="hardening-deb-2-8-cliyour-deb-2-8-climaas-deb-2-8-cliinstallation.html">
	    MAAS security
	  </a>
	</li>
	<li>
	  <a href="maas-deb-2-8-clilogging.html">
	    Logging
	  </a>
	</li>
	<li>
	  <a href="commissioning-deb-2-8-clilogs.html">
	    Commissioning logs
	  </a>
	</li>
	<li>
	  <a href="user-deb-2-8-cliaccounts.html">
	    User accounts
	  </a>
	</li>
	<li>
	  <a href="interactive-deb-2-8-clisearch.html">
	    Interactive search
	  </a>
	</li>
      </ul>
      <strong>
	<a href="concepts-deb-2-8-cliand-deb-2-8-cliterms.html">
	  Concepts &amp; terms
	</a>
      </strong>
      <ul>
	<li>
	  <a href="concepts-deb-2-8-cliand-deb-2-8-cliterms.html#heading-deb-2-8-cli-deb-2-8-clinetwork-deb-2-8-clitutorial">
	    Brief network tutorial
	  </a>
	</li>
      </ul>
      <strong>
	<a href="maas-deb-2-8-clicli.html">
	  CLI
	</a>
      </strong>
      <ul>
	<li>
	  <a href="common-deb-2-8-clicli-deb-2-8-clitasks.html">
	    The CLI cookbook
	  </a>
	</li>
	<li>
	  <a href="common-deb-2-8-clicli-deb-2-8-clitasks.html">
	    Common tasks
	  </a>
	</li>
	<li>
	  <a href="audit-deb-2-8-clievent-deb-2-8-clilogs.html">
	    Audit event logs
	  </a>
	</li>
	<li>
	  <a href="cli-deb-2-8-clikernel-deb-2-8-climanagement.html">
	    Kernel management
	  </a>
	</li>
	<li>
	  <a href="cli-deb-2-8-cliimage-deb-2-8-climanagement.html">
	    Image management
	  </a>
	</li>
	<li>
	  <a href="cli-deb-2-8-cliinterface-deb-2-8-climanagement.html">
	    Interface management
	  </a>
	</li>
	<li>
	  <a href="cli-deb-2-8-cliadvanced-deb-2-8-clitasks.html">
	    Advanced tasks
	  </a>
	</li>
	<li>
	  <a href="cli-deb-2-8-clicomposable-deb-2-8-clihardware.html">
	    Composable hardware
	  </a>
	</li>
	<li>
	  <a href="python-deb-2-8-cliapi-deb-2-8-cliclient.html">
	    API client
	  </a>
	</li>
      </ul>
      <strong>
	<a href="api.html">
	  API documentation
	</a>
      </strong>
      <ul>
	<li>
	  <a href="api-deb-2-8-cliauthentication.html">
	    API authentication
	  </a>
	</li>
      </ul>
      <strong>
	<a href="troubleshooting.html">
	  Troubleshoot
	</a>
      </strong>
      <ul>
	<li>
	  <a href="getting-deb-2-8-clihelp.html">
	    Getting help
	  </a>
	</li>
	<li>
	  <a href="tips-deb-2-8-clitricks-deb-2-8-cliand-deb-2-8-clitraps.html">
	    Tips, tricks, and traps
	  </a>
	</li>
	<li>
	  <a href="https://old-deb-2-8-clidocs.maas.io/2.5/en/">
	    MAAS 2.5 (+ earlier) doc
	  </a>
	</li>
      </ul>
      <strong>
	<a href="whats-deb-2-8-clinew-deb-2-8-cliin-deb-2-8-climaas.html">
	  Release notes
	</a>
      </strong>
      <p/>
      <strong>
	<a href="writing-deb-2-8-cliguide.html">
	  Help improve these docs
	</a>
      </strong>
    </div>
    <div class="container" style="float:right; width:65%; margin-deb-2-8-clitop:40px; margin-deb-2-8-cliright:30px">
      <h1>High availability</h1><!-deb-2-8-cli-deb-2-8-cli deb-deb-2-8-cli2-deb-2-8-cli7-deb-2-8-clicli
 deb-deb-2-8-cli2-deb-2-8-cli7-deb-2-8-clicli -deb-2-8-cli-deb-2-8-cli>

<!-deb-2-8-cli-deb-2-8-cli deb-deb-2-8-cli2-deb-2-8-cli7-deb-2-8-cliui
 deb-deb-2-8-cli2-deb-2-8-cli7-deb-2-8-cliui -deb-2-8-cli-deb-2-8-cli>

<!-deb-2-8-cli-deb-2-8-cli deb-deb-2-8-cli2-deb-2-8-cli8-deb-2-8-cliui
 deb-deb-2-8-cli2-deb-2-8-cli8-deb-2-8-cliui -deb-2-8-cli-deb-2-8-cli>

<!-deb-2-8-cli-deb-2-8-cli deb-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-clicli
 deb-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-clicli -deb-2-8-cli-deb-2-8-cli>

<!-deb-2-8-cli-deb-2-8-cli deb-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-cliui
 deb-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-cliui -deb-2-8-cli-deb-2-8-cli>

<!-deb-2-8-cli-deb-2-8-cli snap-deb-2-8-cli2-deb-2-8-cli7-deb-2-8-clicli
 snap-deb-2-8-cli2-deb-2-8-cli7-deb-2-8-clicli -deb-2-8-cli-deb-2-8-cli>

<!-deb-2-8-cli-deb-2-8-cli snap-deb-2-8-cli2-deb-2-8-cli7-deb-2-8-cliui
 snap-deb-2-8-cli2-deb-2-8-cli7-deb-2-8-cliui -deb-2-8-cli-deb-2-8-cli>

<!-deb-2-8-cli-deb-2-8-cli snap-deb-2-8-cli2-deb-2-8-cli8-deb-2-8-clicli
 snap-deb-2-8-cli2-deb-2-8-cli8-deb-2-8-clicli -deb-2-8-cli-deb-2-8-cli>

<!-deb-2-8-cli-deb-2-8-cli snap-deb-2-8-cli2-deb-2-8-cli8-deb-2-8-cliui
 snap-deb-2-8-cli2-deb-2-8-cli8-deb-2-8-cliui -deb-2-8-cli-deb-2-8-cli>

<!-deb-2-8-cli-deb-2-8-cli snap-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-clicli
 snap-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-clicli -deb-2-8-cli-deb-2-8-cli>

<!-deb-2-8-cli-deb-2-8-cli snap-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-cliui
 snap-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-cliui -deb-2-8-cli-deb-2-8-cli>

<p>This page describes how to provide high availability (HA) for MAAS at both region and rack levels.  In the context of MAAS, there are four types of HA:</p>
<ol>
<li>BMC (node power cycling)</li>
<li>DHCP</li>
<li>PostgreSQL</li>
<li>API services</li>
</ol>
<h4>Four questions you might have:</h4>
<ol>
<li><a href="#heading-deb-2-8-cli-deb-2-8-clirack-deb-2-8-clicontroller-deb-2-8-cliha">How do I make rack controllers highly available?</a></li>
<li><a href="#heading-deb-2-8-cli-deb-2-8-clibmc-deb-2-8-cliha">How do I enable highly-deb-2-8-cliavailable BMC?</a></li>
<li><a href="#heading-deb-2-8-cli-deb-2-8-clidhcp-deb-2-8-cliha">How do I enable highly-deb-2-8-cliavailable DHCP services?</a></li>
<li><a href="#heading-deb-2-8-cli-deb-2-8-cliregion-deb-2-8-clicontroller-deb-2-8-cliha">How do I make region controllers highly available?</a></li>
<li><a href="#heading-deb-2-8-cli-deb-2-8-clipostgresql-deb-2-8-cliha">How do I enable highly-deb-2-8-cliavailable PostgreSQL?</a></li>
<li><a href="#heading-deb-2-8-cli-deb-2-8-clisecondary-deb-2-8-cliapi-deb-2-8-cliservers">How do I enable highly-deb-2-8-cliavailable API services?</a></li>
<li><a href="#heading-deb-2-8-cli-deb-2-8-cliload-deb-2-8-clibalancing-deb-2-8-cliwith-deb-2-8-clihaproxy-deb-2-8-clioptional">How do I enable load balancing for API services?</a></li>
</ol>
<p><a href="#heading-deb-2-8-cli-deb-2-8-clirack-deb-2-8-clicontroller-deb-2-8-cliha"><h2 id="heading-deb-2-8-cli-deb-2-8-clirack-deb-2-8-clicontroller-deb-2-8-cliha">Make rack controllers highly available</h2></a></p>
<!-deb-2-8-cli-deb-2-8-cli deb-deb-2-8-cli2-deb-2-8-cli7-deb-2-8-clicli
You need to [install multiple rack controllers](rack-deb-2-8-clicontrollers.html#heading-deb-2-8-cli-deb-2-8-cliinstall-deb-2-8-clia-deb-2-8-clirack-deb-2-8-clicontroller) to achieve real high availability.  Once that's done, you automatically gain highly-deb-2-8-cliavailable BMC control, and you can also enable highly-deb-2-8-cliavailable DHCP.
 deb-deb-2-8-cli2-deb-2-8-cli7-deb-2-8-clicli -deb-2-8-cli-deb-2-8-cli>

<!-deb-2-8-cli-deb-2-8-cli deb-deb-2-8-cli2-deb-2-8-cli7-deb-2-8-cliui
You need to [install multiple rack controllers](rack-deb-2-8-clicontrollers.html#heading-deb-2-8-cli-deb-2-8-cliinstall-deb-2-8-clia-deb-2-8-clirack-deb-2-8-clicontroller) to achieve real high availability.  Once that's done, you automatically gain highly-deb-2-8-cliavailable BMC control, and you can also enable highly-deb-2-8-cliavailable DHCP.
 deb-deb-2-8-cli2-deb-2-8-cli7-deb-2-8-cliui -deb-2-8-cli-deb-2-8-cli>

<p>You need to <a href="rack-deb-2-8-clicontrollers.html#heading-deb-2-8-cli-deb-2-8-cliinstall-deb-2-8-clia-deb-2-8-clirack-deb-2-8-clicontroller">install multiple rack controllers</a> to achieve real high availability.  Once that&rsquo;s done, you automatically gain highly-deb-2-8-cliavailable BMC control, and you can also enable highly-deb-2-8-cliavailable DHCP.</p>
<!-deb-2-8-cli-deb-2-8-cli deb-deb-2-8-cli2-deb-2-8-cli8-deb-2-8-cliui
You need to [install multiple rack controllers](rack-deb-2-8-clicontrollers.html#heading-deb-2-8-cli-deb-2-8-cliinstall-deb-2-8-clia-deb-2-8-clirack-deb-2-8-clicontroller) to achieve real high availability.  Once that's done, you automatically gain highly-deb-2-8-cliavailable BMC control, and you can also enable highly-deb-2-8-cliavailable DHCP.
 deb-deb-2-8-cli2-deb-2-8-cli8-deb-2-8-cliui -deb-2-8-cli-deb-2-8-cli>

<!-deb-2-8-cli-deb-2-8-cli deb-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-clicli
You need to [install multiple rack controllers](rack-deb-2-8-clicontrollers.html#heading-deb-2-8-cli-deb-2-8-cliinstall-deb-2-8-clia-deb-2-8-clirack-deb-2-8-clicontroller) to achieve real high availability.  Once that's done, you automatically gain highly-deb-2-8-cliavailable BMC control, and you can also enable highly-deb-2-8-cliavailable DHCP.
 deb-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-clicli -deb-2-8-cli-deb-2-8-cli>

<!-deb-2-8-cli-deb-2-8-cli deb-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-cliui
You need to [install multiple rack controllers](rack-deb-2-8-clicontrollers.html#heading-deb-2-8-cli-deb-2-8-cliinstall-deb-2-8-clia-deb-2-8-clirack-deb-2-8-clicontroller) to achieve real high availability.  Once that's done, you automatically gain highly-deb-2-8-cliavailable BMC control, and you can also enable highly-deb-2-8-cliavailable DHCP.
 deb-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-cliui -deb-2-8-cli-deb-2-8-cli>

<!-deb-2-8-cli-deb-2-8-cli snap-deb-2-8-cli2-deb-2-8-cli7-deb-2-8-clicli
You need to [install multiple rack controllers](rack-deb-2-8-clicontrollers.html#heading-deb-2-8-cli-deb-2-8-cliinstall-deb-2-8-clia-deb-2-8-clirack-deb-2-8-clicontroller) to achieve real high availability.  Once that's done, you automatically gain highly-deb-2-8-cliavailable BMC control, and you can also enable highly-deb-2-8-cliavailable DHCP.
 snap-deb-2-8-cli2-deb-2-8-cli7-deb-2-8-clicli -deb-2-8-cli-deb-2-8-cli>

<!-deb-2-8-cli-deb-2-8-cli snap-deb-2-8-cli2-deb-2-8-cli7-deb-2-8-cliui
You need to [install multiple rack controllers](rack-deb-2-8-clicontrollers.html#heading-deb-2-8-cli-deb-2-8-cliinstall-deb-2-8-clia-deb-2-8-clirack-deb-2-8-clicontroller) to achieve real high availability.  Once that's done, you automatically gain highly-deb-2-8-cliavailable BMC control, and you can also enable highly-deb-2-8-cliavailable DHCP.
 snap-deb-2-8-cli2-deb-2-8-cli7-deb-2-8-cliui -deb-2-8-cli-deb-2-8-cli>

<!-deb-2-8-cli-deb-2-8-cli snap-deb-2-8-cli2-deb-2-8-cli8-deb-2-8-clicli
You need to [install multiple rack controllers](rack-deb-2-8-clicontrollers.html#heading-deb-2-8-cli-deb-2-8-cliinstall-deb-2-8-clia-deb-2-8-clirack-deb-2-8-clicontroller) to achieve real high availability.  Once that's done, you automatically gain highly-deb-2-8-cliavailable BMC control, and you can also enable highly-deb-2-8-cliavailable DHCP.
 snap-deb-2-8-cli2-deb-2-8-cli8-deb-2-8-clicli -deb-2-8-cli-deb-2-8-cli>

<!-deb-2-8-cli-deb-2-8-cli snap-deb-2-8-cli2-deb-2-8-cli8-deb-2-8-cliui
You need to [install multiple rack controllers](rack-deb-2-8-clicontrollers.html#heading-deb-2-8-cli-deb-2-8-cliinstall-deb-2-8-clia-deb-2-8-clirack-deb-2-8-clicontroller) to achieve real high availability.  Once that's done, you automatically gain highly-deb-2-8-cliavailable BMC control, and you can also enable highly-deb-2-8-cliavailable DHCP.
 snap-deb-2-8-cli2-deb-2-8-cli8-deb-2-8-cliui -deb-2-8-cli-deb-2-8-cli>

<!-deb-2-8-cli-deb-2-8-cli snap-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-clicli
You need to [install multiple rack controllers](rack-deb-2-8-clicontrollers.html#heading-deb-2-8-cli-deb-2-8-cliinstall-deb-2-8-clia-deb-2-8-clirack-deb-2-8-clicontroller) to achieve real high availability.  Once that's done, you automatically gain highly-deb-2-8-cliavailable BMC control, and you can also enable highly-deb-2-8-cliavailable DHCP.
 snap-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-clicli -deb-2-8-cli-deb-2-8-cli>

<!-deb-2-8-cli-deb-2-8-cli snap-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-cliui
You need to [install multiple rack controllers](rack-deb-2-8-clicontrollers.html#heading-deb-2-8-cli-deb-2-8-cliinstall-deb-2-8-clia-deb-2-8-clirack-deb-2-8-clicontroller) to achieve real high availability.  Once that's done, you automatically gain highly-deb-2-8-cliavailable BMC control, and you can also enable highly-deb-2-8-cliavailable DHCP.
 snap-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-cliui -deb-2-8-cli-deb-2-8-cli>

<p><a href="#heading-deb-2-8-cli-deb-2-8-clibmc-deb-2-8-cliha"><h3 id="heading-deb-2-8-cli-deb-2-8-clibmc-deb-2-8-cliha">Enable highly-deb-2-8-cliavailable BMC</h3></a></p>
<p>HA for BMC control (node power cycling) is provided out-deb-2-8-cliof-deb-2-8-clithe-deb-2-8-clibox, once a second rack controller is present. MAAS will automatically identify which rack controller is responsible for a BMC and set up communication accordingly.</p>
<p><a href="#heading-deb-2-8-cli-deb-2-8-clidhcp-deb-2-8-cliha"><h3 id="heading-deb-2-8-cli-deb-2-8-clidhcp-deb-2-8-cliha">Enable highly-deb-2-8-cliavailable DHCP services</h3></a></p>
<p>DHCP HA affects the way MAAS manages node, including enlistment, commissioning and deployment. It enables primary and secondary DHCP instances to serve the same VLAN. This VLAN replicates all lease information is between rack controllers. MAAS-deb-2-8-climanaged DHCP is a requirement for DHCP HA.</p>
<!-deb-2-8-cli-deb-2-8-cli deb-deb-2-8-cli2-deb-2-8-cli7-deb-2-8-clicli
If you are enabling DHCP for the first time after adding a second rack controller, please read [Enabling DHCP](managing-deb-2-8-clidhcp.html#heading-deb-2-8-cli-deb-2-8-clienabling-deb-2-8-clidhcp).  On the other hand, if you have already enabled DHCP on your initial rack controller, you'll need to reconfigure DHCP.
 deb-deb-2-8-cli2-deb-2-8-cli7-deb-2-8-clicli -deb-2-8-cli-deb-2-8-cli>

<!-deb-2-8-cli-deb-2-8-cli deb-deb-2-8-cli2-deb-2-8-cli7-deb-2-8-cliui
If you are enabling DHCP for the first time after adding a second rack controller, please read [Enabling DHCP](managing-deb-2-8-clidhcp.html#heading-deb-2-8-cli-deb-2-8-clienabling-deb-2-8-clidhcp).  On the other hand, if you have already enabled DHCP on your initial rack controller, you'll need to reconfigure DHCP.
 deb-deb-2-8-cli2-deb-2-8-cli7-deb-2-8-cliui -deb-2-8-cli-deb-2-8-cli>

<p>If you are enabling DHCP for the first time after adding a second rack controller, please read <a href="managing-deb-2-8-clidhcp.html#heading-deb-2-8-cli-deb-2-8-clienabling-deb-2-8-clidhcp">Enabling DHCP</a>.  On the other hand, if you have already enabled DHCP on your initial rack controller, you&rsquo;ll need to reconfigure DHCP.</p>
<!-deb-2-8-cli-deb-2-8-cli deb-deb-2-8-cli2-deb-2-8-cli8-deb-2-8-cliui
If you are enabling DHCP for the first time after adding a second rack controller, please read [Enabling DHCP](managing-deb-2-8-clidhcp.html#heading-deb-2-8-cli-deb-2-8-clienabling-deb-2-8-clidhcp).  On the other hand, if you have already enabled DHCP on your initial rack controller, you'll need to reconfigure DHCP.
 deb-deb-2-8-cli2-deb-2-8-cli8-deb-2-8-cliui -deb-2-8-cli-deb-2-8-cli>

<!-deb-2-8-cli-deb-2-8-cli deb-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-clicli
If you are enabling DHCP for the first time after adding a second rack controller, please read [Enabling DHCP](managing-deb-2-8-clidhcp.html#heading-deb-2-8-cli-deb-2-8-clienabling-deb-2-8-clidhcp).  On the other hand, if you have already enabled DHCP on your initial rack controller, you'll need to reconfigure DHCP.
 deb-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-clicli -deb-2-8-cli-deb-2-8-cli>

<!-deb-2-8-cli-deb-2-8-cli deb-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-cliui
If you are enabling DHCP for the first time after adding a second rack controller, please read [Enabling DHCP](managing-deb-2-8-clidhcp.html#heading-deb-2-8-cli-deb-2-8-clienabling-deb-2-8-clidhcp).  On the other hand, if you have already enabled DHCP on your initial rack controller, you'll need to reconfigure DHCP.
 deb-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-cliui -deb-2-8-cli-deb-2-8-cli>

<!-deb-2-8-cli-deb-2-8-cli snap-deb-2-8-cli2-deb-2-8-cli7-deb-2-8-clicli
If you are enabling DHCP for the first time after adding a second rack controller, please read [Enabling DHCP](managing-deb-2-8-clidhcp.html#heading-deb-2-8-cli-deb-2-8-clienabling-deb-2-8-clidhcp).  On the other hand, if you have already enabled DHCP on your initial rack controller, you'll need to reconfigure DHCP.
 snap-deb-2-8-cli2-deb-2-8-cli7-deb-2-8-clicli -deb-2-8-cli-deb-2-8-cli>

<!-deb-2-8-cli-deb-2-8-cli snap-deb-2-8-cli2-deb-2-8-cli7-deb-2-8-cliui
If you are enabling DHCP for the first time after adding a second rack controller, please read [Enabling DHCP](managing-deb-2-8-clidhcp.html#heading-deb-2-8-cli-deb-2-8-clienabling-deb-2-8-clidhcp).  On the other hand, if you have already enabled DHCP on your initial rack controller, you'll need to reconfigure DHCP.
 snap-deb-2-8-cli2-deb-2-8-cli7-deb-2-8-cliui -deb-2-8-cli-deb-2-8-cli>

<!-deb-2-8-cli-deb-2-8-cli snap-deb-2-8-cli2-deb-2-8-cli8-deb-2-8-clicli
If you are enabling DHCP for the first time after adding a second rack controller, please read [Enabling DHCP](managing-deb-2-8-clidhcp.html#heading-deb-2-8-cli-deb-2-8-clienabling-deb-2-8-clidhcp).  On the other hand, if you have already enabled DHCP on your initial rack controller, you'll need to reconfigure DHCP.
 snap-deb-2-8-cli2-deb-2-8-cli8-deb-2-8-clicli -deb-2-8-cli-deb-2-8-cli>

<!-deb-2-8-cli-deb-2-8-cli snap-deb-2-8-cli2-deb-2-8-cli8-deb-2-8-cliui
If you are enabling DHCP for the first time after adding a second rack controller, please read [Enabling DHCP](managing-deb-2-8-clidhcp.html#heading-deb-2-8-cli-deb-2-8-clienabling-deb-2-8-clidhcp).  On the other hand, if you have already enabled DHCP on your initial rack controller, you'll need to reconfigure DHCP.
 snap-deb-2-8-cli2-deb-2-8-cli8-deb-2-8-cliui -deb-2-8-cli-deb-2-8-cli>

<!-deb-2-8-cli-deb-2-8-cli snap-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-clicli
If you are enabling DHCP for the first time after adding a second rack controller, please read [Enabling DHCP](managing-deb-2-8-clidhcp.html#heading-deb-2-8-cli-deb-2-8-clienabling-deb-2-8-clidhcp).  On the other hand, if you have already enabled DHCP on your initial rack controller, you'll need to reconfigure DHCP.
 snap-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-clicli -deb-2-8-cli-deb-2-8-cli>

<!-deb-2-8-cli-deb-2-8-cli snap-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-cliui
If you are enabling DHCP for the first time after adding a second rack controller, please read [Enabling DHCP](managing-deb-2-8-clidhcp.html#heading-deb-2-8-cli-deb-2-8-clienabling-deb-2-8-clidhcp).  On the other hand, if you have already enabled DHCP on your initial rack controller, you'll need to reconfigure DHCP.
 snap-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-cliui -deb-2-8-cli-deb-2-8-cli>

<!-deb-2-8-cli-deb-2-8-cli snap-deb-2-8-cli2-deb-2-8-cli7-deb-2-8-cliui snap-deb-2-8-cli2-deb-2-8-cli8-deb-2-8-cliui snap-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-cliui deb-deb-2-8-cli2-deb-2-8-cli7-deb-2-8-cliui deb-deb-2-8-cli2-deb-2-8-cli8-deb-2-8-cliui deb-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-cliui
Access the appropriate VLAN (via the 'Subnets' page) and choose action 'Reconfigure DHCP'. There, you will see the second rack controller in the 'Secondary controller' field. All you should have to do is press the 'Reconfigure DHCP' button:

<a href="images/c2fe0e3d5a663ac7dda0ed33b7591c4a6dfaff20.jpeg" target = "_blank"><img src="images/c2fe0e3d5a663ac7dda0ed33b7591c4a6dfaff20.jpeg"></a></a>
snap-deb-2-8-cli2-deb-2-8-cli7-deb-2-8-cliui snap-deb-2-8-cli2-deb-2-8-cli8-deb-2-8-cliui snap-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-cliui deb-deb-2-8-cli2-deb-2-8-cli7-deb-2-8-cliui deb-deb-2-8-cli2-deb-2-8-cli8-deb-2-8-cliui deb-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-cliui -deb-2-8-cli-deb-2-8-cli>

<p>To reconfigure DHCP after adding a new rack controller, use the following sequence of commands:</p>
<pre><code>vid=$(maas maas subnets read | jq -deb-2-8-clir '.[] | select(.cidr == &quot;10.0.0.0/24&quot;) | .vlan.vid')
fabric_name=$(maas maas subnets read | jq -deb-2-8-clir '.[] | select(.cidr == &quot;10.0.0.0/24&quot;) | .vlan.fabric')
query=&quot;.[] | select(.name == \&quot;$fabric_name\&quot;) | .id&quot;
fabric_id=$(maas maas fabrics read | jq &quot;$query&quot;)
maas maas ipranges create type=reserved start_ip=10.0.0.3 end_ip=10.0.0.49
maas maas ipranges create type=dynamic start_ip=10.0.0.50 end_ip=10.0.0.99
maas maas vlan update ${fabric_id} ${vid} primary_rack=$(hostname) dhcp_on=true
</code></pre>

<p>Be sure to substitute the sample values for those of your own environment.</p>
<p><a href="#heading-deb-2-8-cli-deb-2-8-climultiple-deb-2-8-cliregion-deb-2-8-cliendpoints"><h3 id="heading-deb-2-8-cli-deb-2-8-climultiple-deb-2-8-cliregion-deb-2-8-cliendpoints">Configure multiple region endpoints</h3></a></p>
<p>MAAS will automatically discover and track all reachable region controllers in a single cluster of rack controllers  It will also attempt to automatically connect to them if the one in use becomes inaccessible.  Administrators can alternatively specify multiple region-deb-2-8-clicontroller endpoints for a single rack controller by adding entries to <code>/etc/maas/rackd.conf</code>.  For example:</p>
<!-deb-2-8-cli-deb-2-8-cli snap-deb-2-8-cli2-deb-2-8-cli7-deb-2-8-cliui snap-deb-2-8-cli2-deb-2-8-cli7-deb-2-8-clicli snap-deb-2-8-cli2-deb-2-8-cli8-deb-2-8-cliui snap-deb-2-8-cli2-deb-2-8-cli8-deb-2-8-clicli snap-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-cliui snap-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-clicli
MAAS will automatically discover and track all reachable region controllers in a single cluster of rack controllers  It will also attempt to automatically connect to them if the one in use becomes inaccessible.  Administrators can alternatively specify multiple region-deb-2-8-clicontroller endpoints for a single rack controller by adding entries to `/var/snap/maas/current/rackd.conf`.  For example:
snap-deb-2-8-cli2-deb-2-8-cli7-deb-2-8-cliui snap-deb-2-8-cli2-deb-2-8-cli7-deb-2-8-clicli snap-deb-2-8-cli2-deb-2-8-cli8-deb-2-8-cliui snap-deb-2-8-cli2-deb-2-8-cli8-deb-2-8-clicli snap-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-cliui snap-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-clicli -deb-2-8-cli-deb-2-8-cli>

<pre><code>.
.
.
maas_url:
  -deb-2-8-cli http://&lt;ip 1&gt;:&lt;port&gt;/MAAS/
  -deb-2-8-cli http://&lt;ip 2&gt;:&lt;port&gt;/MAAS/
.
.
.
</code></pre>
<p>The setup of highly-deb-2-8-cliavailable DHCP is now complete.  Note that, for HA purposes, DHCP provisioning will take into account multiple DNS services when there is more than one region controller on a single region.</p>
<p><a href="#heading-deb-2-8-cli-deb-2-8-cliregion-deb-2-8-clicontroller-deb-2-8-cliha"><h2 id="heading-deb-2-8-cli-deb-2-8-cliregion-deb-2-8-clicontroller-deb-2-8-cliha">Make region controllers highly available</h2></a></p>
<p>Implementing highly-deb-2-8-cliavailable region control involves setting up two highly-deb-2-8-cliavailable services:</p>
<ol>
<li>PostgreSQL HA</li>
<li>Secondary API server(s)</li>
</ol>
<p>Load balancing is optional, but is highly recommended.</p>
<p><a href="#heading-deb-2-8-cli-deb-2-8-clipostgresql-deb-2-8-cliha"><h3 id="heading-deb-2-8-cli-deb-2-8-clipostgresql-deb-2-8-cliha">Enable highly-deb-2-8-cliavailable PostgreSQL</h3></a></p>
<p>MAAS stores all state information in the PostgreSQL database. It is therefore recommended to run it in HA mode. Configuring HA for PostgreSQL is external to MAAS. You will, therefore, need to study the <a href="https://www.postgresql.org/docs/9.5/static/high-deb-2-8-cliavailability.html">PostgreSQL documentation</a> and implement the variant of HA that makes you feel most comfortable.</p>
<!-deb-2-8-cli-deb-2-8-cli deb-deb-2-8-cli2-deb-2-8-cli7-deb-2-8-clicli
A quick treatment of [PostgreSQL HA: hot standby](postgresql-deb-2-8-cliha-deb-2-8-clihot-deb-2-8-clistandby.html) is provided here for convenience only. This summary will give you an idea of the command line implementation of HA with PostgreSQL.
 deb-deb-2-8-cli2-deb-2-8-cli7-deb-2-8-clicli -deb-2-8-cli-deb-2-8-cli>

<!-deb-2-8-cli-deb-2-8-cli deb-deb-2-8-cli2-deb-2-8-cli7-deb-2-8-cliui
A quick treatment of [PostgreSQL HA: hot standby](postgresql-deb-2-8-cliha-deb-2-8-clihot-deb-2-8-clistandby.html) is provided here for convenience only. This summary will give you an idea of the command line implementation of HA with PostgreSQL.
 deb-deb-2-8-cli2-deb-2-8-cli7-deb-2-8-cliui -deb-2-8-cli-deb-2-8-cli>

<p>A quick treatment of <a href="postgresql-deb-2-8-cliha-deb-2-8-clihot-deb-2-8-clistandby.html">PostgreSQL HA: hot standby</a> is provided here for convenience only. This summary will give you an idea of the command line implementation of HA with PostgreSQL.</p>
<!-deb-2-8-cli-deb-2-8-cli deb-deb-2-8-cli2-deb-2-8-cli8-deb-2-8-cliui
A quick treatment of [PostgreSQL HA: hot standby](postgresql-deb-2-8-cliha-deb-2-8-clihot-deb-2-8-clistandby.html) is provided here for convenience only. This summary will give you an idea of the command line implementation of HA with PostgreSQL.
 deb-deb-2-8-cli2-deb-2-8-cli8-deb-2-8-cliui -deb-2-8-cli-deb-2-8-cli>

<!-deb-2-8-cli-deb-2-8-cli deb-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-clicli
A quick treatment of [PostgreSQL HA: hot standby](postgresql-deb-2-8-cliha-deb-2-8-clihot-deb-2-8-clistandby.html) is provided here for convenience only. This summary will give you an idea of the command line implementation of HA with PostgreSQL.
 deb-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-clicli -deb-2-8-cli-deb-2-8-cli>

<!-deb-2-8-cli-deb-2-8-cli deb-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-cliui
A quick treatment of [PostgreSQL HA: hot standby](postgresql-deb-2-8-cliha-deb-2-8-clihot-deb-2-8-clistandby.html) is provided here for convenience only. This summary will give you an idea of the command line implementation of HA with PostgreSQL.
 deb-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-cliui -deb-2-8-cli-deb-2-8-cli>

<!-deb-2-8-cli-deb-2-8-cli snap-deb-2-8-cli2-deb-2-8-cli7-deb-2-8-clicli
A quick treatment of [PostgreSQL HA: hot standby](postgresql-deb-2-8-cliha-deb-2-8-clihot-deb-2-8-clistandby.html) is provided here for convenience only. This summary will give you an idea of the command line implementation of HA with PostgreSQL.
 snap-deb-2-8-cli2-deb-2-8-cli7-deb-2-8-clicli -deb-2-8-cli-deb-2-8-cli>

<!-deb-2-8-cli-deb-2-8-cli snap-deb-2-8-cli2-deb-2-8-cli7-deb-2-8-cliui
A quick treatment of [PostgreSQL HA: hot standby](postgresql-deb-2-8-cliha-deb-2-8-clihot-deb-2-8-clistandby.html) is provided here for convenience only. This summary will give you an idea of the command line implementation of HA with PostgreSQL.
 snap-deb-2-8-cli2-deb-2-8-cli7-deb-2-8-cliui -deb-2-8-cli-deb-2-8-cli>

<!-deb-2-8-cli-deb-2-8-cli snap-deb-2-8-cli2-deb-2-8-cli8-deb-2-8-clicli
A quick treatment of [PostgreSQL HA: hot standby](postgresql-deb-2-8-cliha-deb-2-8-clihot-deb-2-8-clistandby.html) is provided here for convenience only. This summary will give you an idea of the command line implementation of HA with PostgreSQL.
 snap-deb-2-8-cli2-deb-2-8-cli8-deb-2-8-clicli -deb-2-8-cli-deb-2-8-cli>

<!-deb-2-8-cli-deb-2-8-cli snap-deb-2-8-cli2-deb-2-8-cli8-deb-2-8-cliui
A quick treatment of [PostgreSQL HA: hot standby](postgresql-deb-2-8-cliha-deb-2-8-clihot-deb-2-8-clistandby.html) is provided here for convenience only. This summary will give you an idea of the command line implementation of HA with PostgreSQL.
 snap-deb-2-8-cli2-deb-2-8-cli8-deb-2-8-cliui -deb-2-8-cli-deb-2-8-cli>

<!-deb-2-8-cli-deb-2-8-cli snap-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-clicli
A quick treatment of [PostgreSQL HA: hot standby](postgresql-deb-2-8-cliha-deb-2-8-clihot-deb-2-8-clistandby.html) is provided here for convenience only. This summary will give you an idea of the command line implementation of HA with PostgreSQL.
 snap-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-clicli -deb-2-8-cli-deb-2-8-cli>

<!-deb-2-8-cli-deb-2-8-cli snap-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-cliui
A quick treatment of [PostgreSQL HA: hot standby](postgresql-deb-2-8-cliha-deb-2-8-clihot-deb-2-8-clistandby.html) is provided here for convenience only. This summary will give you an idea of the command line implementation of HA with PostgreSQL.
 snap-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-cliui -deb-2-8-cli-deb-2-8-cli>

<p>Each region controller uses up to 40 connections to PostgreSQL in high load situations. Running two region controllers requires no modifications to the <code>max_connections</code> in <code>postgresql.conf</code>. More than two region controllers require that <code>max_connections</code> be adjusted to add 40 more connections per added region controller.</p>
<p><a href="#heading-deb-2-8-cli-deb-2-8-clisecondary-deb-2-8-cliapi-deb-2-8-cliservers"><h3 id="heading-deb-2-8-cli-deb-2-8-clisecondary-deb-2-8-cliapi-deb-2-8-cliservers">Enable highly-deb-2-8-cliavailable API services</h3></a></p>
<!-deb-2-8-cli-deb-2-8-cli snap-deb-2-8-cli2-deb-2-8-cli7-deb-2-8-clicli
Setting up high-deb-2-8-cliavailability using snaps is relatively easy:

1.  Set up PostgreSQL for high-deb-2-8-cliavailability as [explained above](high-deb-2-8-cliavailability.html#heading-deb-2-8-cli-deb-2-8-clipostgresql-deb-2-8-cliha). PostgreSQL should run outside of the snap.
2.  [Install](maas-deb-2-8-cliinstallation.html#heading-deb-2-8-cli-deb-2-8-cliinstall-deb-2-8-clifrom-deb-2-8-clisnap) the MAAS snap on each machine you intend to use as a rack or region controller. You'll need the MAAS shared secret, located here, `/var/snap/maas/common/maas/secret`, on the first region controller you set up.
3.  [Initialise the snap](maas-deb-2-8-cliinstallation.html#heading-deb-2-8-cli-deb-2-8-cliinitialisation) as a `rack` or `region` controller. Note that if you intend to use a machine as a region controller, you'll need to tell MAAS how to access your PostgreSQL database host with the following arguments:
    -deb-2-8-cli   `-deb-2-8-cli-deb-2-8-clidatabase-deb-2-8-clihost DATABASE_HOST`
    -deb-2-8-cli   `-deb-2-8-cli-deb-2-8-clidatabase-deb-2-8-cliname DATABASE_NAME`
    -deb-2-8-cli   `-deb-2-8-cli-deb-2-8-clidatabase-deb-2-8-cliuser DATABASE_USER`
    -deb-2-8-cli   `-deb-2-8-cli-deb-2-8-clidatabase-deb-2-8-clipass DATABASE_PASS`
 snap-deb-2-8-cli2-deb-2-8-cli7-deb-2-8-clicli -deb-2-8-cli-deb-2-8-cli>

<!-deb-2-8-cli-deb-2-8-cli snap-deb-2-8-cli2-deb-2-8-cli7-deb-2-8-cliui
Setting up high-deb-2-8-cliavailability using snaps is relatively easy:

1.  Set up PostgreSQL for high-deb-2-8-cliavailability as [explained above](high-deb-2-8-cliavailability.html#heading-deb-2-8-cli-deb-2-8-clipostgresql-deb-2-8-cliha). PostgreSQL should run outside of the snap.
2.  [Install](maas-deb-2-8-cliinstallation.html#heading-deb-2-8-cli-deb-2-8-cliinstall-deb-2-8-clifrom-deb-2-8-clisnap) the MAAS snap on each machine you intend to use as a rack or region controller. You'll need the MAAS shared secret, located here, `/var/snap/maas/common/maas/secret`, on the first region controller you set up.
3.  [Initialise the snap](maas-deb-2-8-cliinstallation.html#heading-deb-2-8-cli-deb-2-8-cliinitialisation) as a `rack` or `region` controller. Note that if you intend to use a machine as a region controller, you'll need to tell MAAS how to access your PostgreSQL database host with the following arguments:
    -deb-2-8-cli   `-deb-2-8-cli-deb-2-8-clidatabase-deb-2-8-clihost DATABASE_HOST`
    -deb-2-8-cli   `-deb-2-8-cli-deb-2-8-clidatabase-deb-2-8-cliname DATABASE_NAME`
    -deb-2-8-cli   `-deb-2-8-cli-deb-2-8-clidatabase-deb-2-8-cliuser DATABASE_USER`
    -deb-2-8-cli   `-deb-2-8-cli-deb-2-8-clidatabase-deb-2-8-clipass DATABASE_PASS`
 snap-deb-2-8-cli2-deb-2-8-cli7-deb-2-8-cliui -deb-2-8-cli-deb-2-8-cli>

<!-deb-2-8-cli-deb-2-8-cli snap-deb-2-8-cli2-deb-2-8-cli8-deb-2-8-clicli
Setting up high-deb-2-8-cliavailability using snaps is relatively easy:

1.  Set up PostgreSQL for high-deb-2-8-cliavailability as [explained above](high-deb-2-8-cliavailability.html#heading-deb-2-8-cli-deb-2-8-clipostgresql-deb-2-8-cliha). PostgreSQL should run outside of the snap.
2.  [Install](maas-deb-2-8-cliinstallation.html#heading-deb-2-8-cli-deb-2-8-cliinstall-deb-2-8-clifrom-deb-2-8-clisnap) the MAAS snap on each machine you intend to use as a rack or region controller. You'll need the MAAS shared secret, located here, `/var/snap/maas/common/maas/secret`, on the first region controller you set up.
3.  [Initialise the snap](maas-deb-2-8-cliinstallation.html#heading-deb-2-8-cli-deb-2-8-cliinitialisation) as a `rack` or `region` controller. Note that if you intend to use a machine as a region controller, you'll need to tell MAAS how to access your PostgreSQL database host with the following four arguments:

1.   `-deb-2-8-cli-deb-2-8-clidatabase-deb-2-8-clihost DATABASE_HOST`
2.   `-deb-2-8-cli-deb-2-8-clidatabase-deb-2-8-cliname DATABASE_NAME`
3.   `-deb-2-8-cli-deb-2-8-clidatabase-deb-2-8-cliuser DATABASE_USER`
4.   `-deb-2-8-cli-deb-2-8-clidatabase-deb-2-8-clipass DATABASE_PASS`
 snap-deb-2-8-cli2-deb-2-8-cli8-deb-2-8-clicli -deb-2-8-cli-deb-2-8-cli>

<!-deb-2-8-cli-deb-2-8-cli snap-deb-2-8-cli2-deb-2-8-cli8-deb-2-8-cliui
Setting up high-deb-2-8-cliavailability using snaps is relatively easy:

1.  Set up PostgreSQL for high-deb-2-8-cliavailability as [explained above](high-deb-2-8-cliavailability.html#heading-deb-2-8-cli-deb-2-8-clipostgresql-deb-2-8-cliha). PostgreSQL should run outside of the snap.
2.  [Install](maas-deb-2-8-cliinstallation.html#heading-deb-2-8-cli-deb-2-8-cliinstall-deb-2-8-clifrom-deb-2-8-clisnap) the MAAS snap on each machine you intend to use as a rack or region controller. You'll need the MAAS shared secret, located here, `/var/snap/maas/common/maas/secret`, on the first region controller you set up.
3.  [Initialise the snap](maas-deb-2-8-cliinstallation.html#heading-deb-2-8-cli-deb-2-8-cliinitialisation) as a `rack` or `region` controller. Note that if you intend to use a machine as a region controller, you'll need to tell MAAS how to access your PostgreSQL database host with the following four arguments:

1.   `-deb-2-8-cli-deb-2-8-clidatabase-deb-2-8-clihost DATABASE_HOST`
2.   `-deb-2-8-cli-deb-2-8-clidatabase-deb-2-8-cliname DATABASE_NAME`
3.   `-deb-2-8-cli-deb-2-8-clidatabase-deb-2-8-cliuser DATABASE_USER`
4.   `-deb-2-8-cli-deb-2-8-clidatabase-deb-2-8-clipass DATABASE_PASS`
 snap-deb-2-8-cli2-deb-2-8-cli8-deb-2-8-cliui -deb-2-8-cli-deb-2-8-cli>

<!-deb-2-8-cli-deb-2-8-cli snap-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-clicli
Setting up high-deb-2-8-cliavailability using snaps is relatively easy:

1.  Set up PostgreSQL for high-deb-2-8-cliavailability as [explained above](high-deb-2-8-cliavailability.html#heading-deb-2-8-cli-deb-2-8-clipostgresql-deb-2-8-cliha). PostgreSQL should run outside of the snap.
2.  [Install](maas-deb-2-8-cliinstallation.html#heading-deb-2-8-cli-deb-2-8-cliinstall-deb-2-8-clifrom-deb-2-8-clisnap) the MAAS snap on each machine you intend to use as a rack or region controller. You'll need the MAAS shared secret, located here, `/var/snap/maas/common/maas/secret`, on the first region controller you set up.
3.  [Initialise the snap](maas-deb-2-8-cliinstallation.html#heading-deb-2-8-cli-deb-2-8-cliinitialisation) as a `rack` or `region` controller. Note that if you intend to use a machine as a region controller, you'll need to tell MAAS how to access your PostgreSQL database host with the following four arguments:

1.   `-deb-2-8-cli-deb-2-8-clidatabase-deb-2-8-clihost DATABASE_HOST`
2.   `-deb-2-8-cli-deb-2-8-clidatabase-deb-2-8-cliname DATABASE_NAME`
3.   `-deb-2-8-cli-deb-2-8-clidatabase-deb-2-8-cliuser DATABASE_USER`
4.   `-deb-2-8-cli-deb-2-8-clidatabase-deb-2-8-clipass DATABASE_PASS`
 snap-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-clicli -deb-2-8-cli-deb-2-8-cli>

<!-deb-2-8-cli-deb-2-8-cli snap-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-cliui
Setting up high-deb-2-8-cliavailability using snaps is relatively easy:

1.  Set up PostgreSQL for high-deb-2-8-cliavailability as [explained above](high-deb-2-8-cliavailability.html#heading-deb-2-8-cli-deb-2-8-clipostgresql-deb-2-8-cliha). PostgreSQL should run outside of the snap.
2.  [Install](maas-deb-2-8-cliinstallation.html#heading-deb-2-8-cli-deb-2-8-cliinstall-deb-2-8-clifrom-deb-2-8-clisnap) the MAAS snap on each machine you intend to use as a rack or region controller. You'll need the MAAS shared secret, located here, `/var/snap/maas/common/maas/secret`, on the first region controller you set up.
3.  [Initialise the snap](maas-deb-2-8-cliinstallation.html#heading-deb-2-8-cli-deb-2-8-cliinitialisation) as a `rack` or `region` controller. Note that if you intend to use a machine as a region controller, you'll need to tell MAAS how to access your PostgreSQL database host with the following four arguments:

1.   `-deb-2-8-cli-deb-2-8-clidatabase-deb-2-8-clihost DATABASE_HOST`
2.   `-deb-2-8-cli-deb-2-8-clidatabase-deb-2-8-cliname DATABASE_NAME`
3.   `-deb-2-8-cli-deb-2-8-clidatabase-deb-2-8-cliuser DATABASE_USER`
4.   `-deb-2-8-cli-deb-2-8-clidatabase-deb-2-8-clipass DATABASE_PASS`
 snap-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-cliui -deb-2-8-cli-deb-2-8-cli>

<!-deb-2-8-cli-deb-2-8-cli deb-deb-2-8-cli2-deb-2-8-cli7-deb-2-8-clicli
Please see [Region controllers](region-deb-2-8-clicontrollers.html) and [Multiple region endpoints](#heading-deb-2-8-cli-deb-2-8-climultiple-deb-2-8-cliregion-deb-2-8-cliendpoints) for more information about how to install and configure rack controllers for multiple region controllers.
 deb-deb-2-8-cli2-deb-2-8-cli7-deb-2-8-clicli -deb-2-8-cli-deb-2-8-cli>

<!-deb-2-8-cli-deb-2-8-cli deb-deb-2-8-cli2-deb-2-8-cli7-deb-2-8-cliui
Please see [Region controllers](region-deb-2-8-clicontrollers.html) and [Multiple region endpoints](#heading-deb-2-8-cli-deb-2-8-climultiple-deb-2-8-cliregion-deb-2-8-cliendpoints) for more information about how to install and configure rack controllers for multiple region controllers.
 deb-deb-2-8-cli2-deb-2-8-cli7-deb-2-8-cliui -deb-2-8-cli-deb-2-8-cli>

<p>Please see <a href="region-deb-2-8-clicontrollers.html">Region controllers</a> and <a href="#heading-deb-2-8-cli-deb-2-8-climultiple-deb-2-8-cliregion-deb-2-8-cliendpoints">Multiple region endpoints</a> for more information about how to install and configure rack controllers for multiple region controllers.</p>
<!-deb-2-8-cli-deb-2-8-cli deb-deb-2-8-cli2-deb-2-8-cli8-deb-2-8-cliui
Please see [Region controllers](region-deb-2-8-clicontrollers.html) and [Multiple region endpoints](#heading-deb-2-8-cli-deb-2-8-climultiple-deb-2-8-cliregion-deb-2-8-cliendpoints) for more information about how to install and configure rack controllers for multiple region controllers.
 deb-deb-2-8-cli2-deb-2-8-cli8-deb-2-8-cliui -deb-2-8-cli-deb-2-8-cli>

<!-deb-2-8-cli-deb-2-8-cli deb-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-clicli
Please see [Region controllers](region-deb-2-8-clicontrollers.html) and [Multiple region endpoints](#heading-deb-2-8-cli-deb-2-8-climultiple-deb-2-8-cliregion-deb-2-8-cliendpoints) for more information about how to install and configure rack controllers for multiple region controllers.
 deb-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-clicli -deb-2-8-cli-deb-2-8-cli>

<!-deb-2-8-cli-deb-2-8-cli deb-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-cliui
Please see [Region controllers](region-deb-2-8-clicontrollers.html) and [Multiple region endpoints](#heading-deb-2-8-cli-deb-2-8-climultiple-deb-2-8-cliregion-deb-2-8-cliendpoints) for more information about how to install and configure rack controllers for multiple region controllers.
 deb-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-cliui -deb-2-8-cli-deb-2-8-cli>

<p><a href="#heading-deb-2-8-cli-deb-2-8-cliload-deb-2-8-clibalancing-deb-2-8-cliwith-deb-2-8-clihaproxy-deb-2-8-clioptional"><h3 id="heading-deb-2-8-cli-deb-2-8-cliload-deb-2-8-clibalancing-deb-2-8-cliwith-deb-2-8-clihaproxy-deb-2-8-clioptional">Load balancing with HAProxy (optional)</h3></a></p>
<p>You can add load balancing with <a href="http://www.haproxy.org/">HAProxy</a> load-deb-2-8-clibalancing software to support multiple API servers. In this setup, HAProxy provides access to the MAAS web UI and API.</p>
<p><strong>NOTE:</strong> 
If you happen to have Apache running on the same server where you intend to install HAProxy, you will need to stop and disable <code>apache2</code>, because HAProxy binds to port 80.</p>
<p><a href="#heading-deb-2-8-cli-deb-2-8-cliinstall"><h4 id="heading-deb-2-8-cli-deb-2-8-cliinstall">Install</h4></a></p>
<pre><code class="bash">sudo apt install haproxy
</code></pre>

<p><a href="#heading-deb-2-8-cli-deb-2-8-cliconfigure"><h4 id="heading-deb-2-8-cli-deb-2-8-cliconfigure">Configure</h4></a></p>
<p>Configure each API server&rsquo;s load balancer by copying the following into <code>/etc/haproxy/haproxy.cfg</code> (see the <a href="http://cbonte.github.io/haproxy-deb-2-8-clidconv/1.6/configuration.html">upstream configuration manual (external link)</a> as a reference). Replace $PRIMARY_API_SERVER_IP and $SECONDARY_API_SERVER_IP with their respective IP addresses:</p>
<pre><code class="yaml">frontend maas
    bind    *:80
    retries 3
    option  redispatch
    option  http-deb-2-8-cliserver-deb-2-8-cliclose
    default_backend maas

backend maas
    timeout server 90s
    balance source
    hash-deb-2-8-clitype consistent
    server localhost localhost:5240 check
    server maas-deb-2-8-cliapi-deb-2-8-cli1 $PRIMARY_API_SERVER_IP:5240 check
    server maas-deb-2-8-cliapi-deb-2-8-cli2 $SECONDARY_API_SERVER_IP:5240 check
</code></pre>

<p>where <code>maas-deb-2-8-cliapi-deb-2-8-cli1</code> and <code>maas-deb-2-8-cliapi-deb-2-8-cli2</code> are arbitrary server labels.</p>
<p>Now restart the load balancer to have these changes take effect:</p>
<pre><code class="bash">sudo systemctl restart haproxy
</code></pre>

<p>The configuration of region controller HA is now complete.</p>
<p><strong>The API server(s) must be now be referenced (e.g. web UI, MAAS CLI) using port 80 (as opposed to port 5240).</strong></p>
    </div>
  </body>
</html>