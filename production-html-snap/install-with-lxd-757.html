<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" type="text/css" href="css/stylesheet.css" />
    <style>
      #selector a:link{color:black;}
      #selector a:visited{color:black;}
      #selector a:active{color:black;}
      #selector a:hover{color:blue;}
      #sidebar a:link{color:black;}
      #sidebar a:visited{color:black;}
      #sidebar a:active{color:black;}
      #sidebar a:hover{color:blue;}
      ul {margin-left:0;list-style-type:none;}
      li {margin: 4px 0;}
    </style>
  </head>
  <body>
    <div id="selector" style="top:0; position:fixed; float:right; background-color:#d9d9d9; width:100%;border-bottom:1px solid black;">
      &nbsp;&nbsp;<strong>Offline docs</strong>
      <a href="https://maas.io/docs">(switch to live docs)</a>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      <a href="../maas-vanilla/install-with-lxd-757.html" style="border-top:1px solid black; border-left:1px solid black; border-right:1px solid black;">
	Full
      </a>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      <a href="../maas-ui-only/install-with-lxd-757.html" style="border-top:1px solid black; border-left:1px solid black; border-right:1px solid black;">
	UI-only
      </a>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      <strong>
	<a href="../maas-cli-only/install-with-lxd-757.html" style="background-color:white;border-top:1px solid black; border-left:1px solid black; border-right:1px solid black; border-bottom:5px solid white;align:center;">
	  &nbsp;CLI-only&nbsp;
	</a>
      </strong>
    </div>
    <div id="sidebar" style="float:left; width:25%;margin-top:40px; margin-left:20px">
      <strong>
	<a href="maas-documentation-25.html">
	  Introduction
	</a>
      </strong>
      <ul>
	<li>
	  <a href="about-maas-840.html">
	    About MAAS
	  </a>
	</li>
	<li>
	  <a href="give-me-an-example-of-maas-1314.html">
	    &ldquo;Give me an example&rdquo;
	  </a>
	</li>
	<li>
	  <a href="explore-maas-787.html">
	    Explore MAAS
	  </a>
	</li>
	<li>
	  <a href="whats-new-in-maas-2-8-1655.html">
	    What&rsquo;s new in 2.8
	  </a>
	</li>
	<li>
	  <a href="https://maas.io/install">
	    Quick start
	  </a>
	</li>
      </ul>
      <strong>Installing MAAS
      </strong>
      <ul>
	<li>
	  <a href="maas-requirements-789.html">
	    Requirements
	  </a>
	</li>
	<li>
	  <a href="maas-installation-from-a-snap-773.html">
	    Installation
	  </a>
	</li>
	<li>
	  <a href="configuration-journey-781.html">
	    Configuration journey
	  </a>
	</li>
	<li>
	  <a href="installation-and-configuration-checklist-750.html">
	    Setup checklist
	  </a>
	</li>
      </ul>
      <strong>
	<a href="introduction-to-controllers-786.html">
	  Controllers
	</a>
      </strong>
      <ul>
	<li>
	  <a href="maas-communication-783.html">
	    Communication
	  </a>
	</li>
	<li>
	  <a href="rack-controllers-771.html">
	    Rack controllers
	  </a>
	</li>
	<li>
	  <a href="region-controllers-772.html">
	    Region controllers
	  </a>
	</li>
	<li>
	  <a href="high-availability-804.html">
	    High availability
	  </a>
	</li>
      </ul>
      <strong>
	<a href="introduction-to-machines-829.html">
	  Machines
	</a>
      </strong>
      <ul>
	<li>
	  <a href="add-machines-821.html">
	    Add machines
	  </a>
	</li>
	<li>
	  <a href="power-management-830.html">
	    Power management
	  </a>
	</li>
	<li>
	  <a href="commission-machines-822.html">
	    Commission machines
	  </a>
	</li>
	<li>Testing
	</li>
	<li>
	  <a href="hardware-testing-826.html">
	    Hardware testing
	  </a>
	</li>
	<li>
	  <a href="network-testing-1267.html">
	    Network testing
	  </a>
	</li>
	<li>
	  <a href="commissioning-and-hardware-testing-scripts-833.html">
	    Commissioning and hardware testing scripts
	  </a>
	</li>
	<li>
	  <a href="deploy-machines-825.html">
	    Deploy machines
	  </a>
	</li>
	<li>
	  <a href="maas-tags-834.html">
	    Tags
	  </a>
	</li>
	<li>
	  <a href="custom-machine-setup-824.html">
	    Custom machine setup
	  </a>
	</li>
	<li>
	  <a href="kernel-boot-options-827.html">
	    Kernel boot options
	  </a>
	</li>
	<li>
	  <a href="resource-pools-831.html">
	    Resource pools
	  </a>
	</li>
	<li>
	  <a href="storage-775.html">
	    Storage
	  </a>
	</li>
	<li>
	  <a href="vmware-vmfs-datastores-780.html">
	    VMware VMFS datastores
	  </a>
	</li>
	<li>
	  <a href="ubuntu-kernels-828.html">
	    Ubuntu kernels
	  </a>
	</li>
      </ul>
      <strong>
	<a href="images-754.html">
	  Images
	</a>
      </strong>
      <ul>
	<li>
	  <a href="select-and-import-images-751.html">
	    Select and import images
	  </a>
	</li>
	<li>
	  <a href="local-image-mirror-752.html">
	    Local image mirror
	  </a>
	</li>
	<li>
	  <a href="vmware-images-753.html">
	    VMWare images
	  </a>
	</li>
      </ul>
      <strong>
	<a href="networking-768.html">
	  Networking
	</a>
      </strong>
      <ul>
	<li>
	  <a href="subnet-management-766.html">
	    Subnet management
	  </a>
	</li>
	<li>
	  <a href="managing-dhcp-759.html">
	    DHCP
	  </a>
	</li>
	<li>
	  <a href="ip-ranges-760.html">
	    IP ranges
	  </a>
	</li>
	<li>
	  <a href="proxy-763.html">
	    Proxy
	  </a>
	</li>
	<li>
	  <a href="ntp-services-762.html">
	    NTP
	  </a>
	</li>
	<li>
	  <a href="network-discovery-758.html">
	    Network discovery
	  </a>
	</li>
	<li>
	  <a href="ipv6-addressing-761.html">
	    IPv6
	  </a>
	</li>
	<li>
	  <a href="configuring-tls-encryption-764.html">
	    SSL
	  </a>
	</li>
	<li>
	  <a href="managing-stp-765.html">
	    STP
	  </a>
	</li>
	<li>
	  <a href="availability-zones-820.html">
	    Availability zones (AZs)
	  </a>
	</li>
      </ul>
      <strong>
	<a href="introduction-to-vm-hosting-1524.html">
	  VM hosting
	</a>
      </strong>
      <ul>
	<li>
	  <a href="vm-host-networking-1526.html">
	    VM host networking
	  </a>
	</li>
	<li>
	  <a href="adding-a-vm-host-1549.html">
	    Add a VM host
	  </a>
	</li>
	<li>
	  <a href="vm-host-storage-pools-1525.html">
	    VM host storage pools
	  </a>
	</li>
	<li>
	  <a href="creating-and-deleting-vms-806.html">
	    Creating and deleting VMs
	  </a>
	</li>
      </ul>
      <strong>Operations
      </strong>
      <ul>
	<li>
	  <a href="prometheus-metrics-813.html">
	    Prometheus metrics
	  </a>
	</li>
	<li>
	  <a href="backup-792.html">
	    Backup
	  </a>
	</li>
	<li>
	  <a href="hardening-your-maas-installation-1381.html">
	    MAAS security
	  </a>
	</li>
	<li>
	  <a href="maas-logging-1468.html">
	    Logging
	  </a>
	</li>
	<li>
	  <a href="commissioning-logs-1478.html">
	    Commissioning logs
	  </a>
	</li>
	<li>
	  <a href="user-accounts-790.html">
	    User accounts
	  </a>
	</li>
	<li>
	  <a href="interactive-search-819.html">
	    Interactive search
	  </a>
	</li>
      </ul>
      <strong>
	<a href="concepts-and-terms-785.html">
	  Concepts &amp; terms
	</a>
      </strong>
      <ul>
	<li>
	  <a href="concepts-and-terms-785.html#heading--network-tutorial">
	    Brief network tutorial
	  </a>
	</li>
      </ul>
      <strong>
	<a href="maas-cli-802.html">
	  CLI
	</a>
      </strong>
      <ul>
	<li>
	  <a href="common-cli-tasks-794.html">
	    Common tasks
	  </a>
	</li>
	<li>
	  <a href="audit-event-logs-791.html">
	    Audit event logs
	  </a>
	</li>
	<li>
	  <a href="cli-kernel-management-799.html">
	    Kernel management
	  </a>
	</li>
	<li>
	  <a href="cli-image-management-797.html">
	    Image management
	  </a>
	</li>
	<li>
	  <a href="cli-interface-management-798.html">
	    Interface management
	  </a>
	</li>
	<li>
	  <a href="cli-tag-management-801.html">
	    Tag management
	  </a>
	</li>
	<li>
	  <a href="cli-resource-pool-management-800.html">
	    Resource pool management
	  </a>
	</li>
	<li>
	  <a href="cli-dhcp-snippet-management-796.html">
	    DHCP snippet management
	  </a>
	</li>
	<li>
	  <a href="cli-commissioning-and-hardware-testing-scripts-832.html">
	    Commissioning and hardware testing scripts
	  </a>
	</li>
	<li>
	  <a href="cli-advanced-tasks-793.html">
	    Advanced tasks
	  </a>
	</li>
	<li>
	  <a href="cli-composable-hardware-795.html">
	    Composable hardware
	  </a>
	</li>
	<li>
	  <a href="python-api-client-810.html">
	    API client
	  </a>
	</li>
      </ul>
      <strong>
	<a href="https://maas.io/docs/api">
	  API documentation
	</a>
      </strong>
      <ul>
	<li>
	  <a href="api-authentication-742.html">
	    API authentication
	  </a>
	</li>
      </ul>
      <strong>
	<a href="troubleshooting-837.html">
	  Troubleshoot
	</a>
      </strong>
      <ul>
	<li>
	  <a href="getting-help-838.html">
	    Getting help
	  </a>
	</li>
	<li>
	  <a href="tips-tricks-and-traps-1506.html">
	    Tips, tricks, and traps
	  </a>
	</li>
	<li>
	  <a href="https://old-docs.maas.io/2.5/en/">
	    MAAS 2.5 (+ earlier) doc
	  </a>
	</li>
      </ul>
      <strong>
	<a href="whats-new-in-maas-2-8-1655.html">
	  Release notes
	</a>
      </strong>
      <p/>
      <strong>
	<a href="writing-guide-747.html">
	  Help improve these docs
	</a>
      </strong>
    </div>
    <div class="container" style="float:right; width:65%; margin-top:40px; margin-right:30px">
      <h1>Install with lxd</h1><!--
Todo:
- Text needs a review
-->

<p><a href="https://linuxcontainers.org/lxd/">LXD</a> is a manager for Linux-based containers (LXC), offering a user experience similar to virtual machines without the same overheads.</p>
<p>Using LXD to install MAAS into containers is a good choice for users who want to test MAAS, or who may want to continue leveraging an existing container architecture or policy.</p>
<p>MAAS running with LXD has the following requirements:</p>
<ul>
<li>a network bridge on the LXD host (e.g. lxdbr0)</li>
<li>LXD and ZFS</li>
<li>a container profile</li>
</ul>
<h3 id="heading--install-lxd-and-zfs">Install LXD and ZFS</h3>

<p>Begin by installing LXD and ZFS:</p>
<pre><code class="bash">sudo apt install lxd zfsutils-linux
sudo modprobe zfs
sudo lxd init
</code></pre>

<p>The <em>sudo lxd init</em> command will trigger a series of configuration questions. Except in the case where the randomly chosen subnet may conflict with an existing one in your local environment, all questions can be answered with their default values.</p>
<p>The bridge network is configured via a second round of questions and is named <em>lxdbr0</em> by default.</p>
<h3 id="heading--create-a-lxc-profile-for-maas">Create a LXC profile for MAAS</h3>

<p>First create a container profile by making use of the &lsquo;default&rsquo; profile:</p>
<pre><code class="bash">lxc profile copy default maas
</code></pre>

<p>Second, bind the network interface inside the container (eth0) to the bridge on the physical host (lxdbr0):</p>
<pre><code class="bash">lxc profile device set maas eth0 parent lxdbr0
</code></pre>

<p>Thirdly, the <em>maas</em> container profile needs to be edited to include a specific set of privileges. Enter the following to open the profile in your editor of choice:</p>
<pre><code class="bash">lxc profile edit maas
</code></pre>

<p>And replace the <code>{}</code> after <em>config</em> with the following (excluding <code>config:</code>):</p>
<pre><code class="yaml">config:
  raw.lxc: |-
    lxc.cgroup.devices.allow = c 10:237 rwm
    lxc.apparmor.profile = unconfined
    lxc.cgroup.devices.allow = b 7:* rwm
  security.privileged: &quot;true&quot;
</code></pre>

<p>The final step adds the 8 necessary loop devices to LXC:</p>
<pre><code class="bash">for i in `seq 0 7`; do lxc profile device add maas loop$i unix-block path=/dev/loop$i; done
</code></pre>

<p>When correctly configured, the above command outputs <code>Device loop0 added to maas</code> for each loop device.</p>
<h3 id="heading--launch-and-access-the-lxd-container">Launch and access the LXD container</h3>

<p>Launch the LXD container:</p>
<pre><code class="bash">lxc launch -p maas ubuntu:18.04 bionic-maas
</code></pre>

<p>Once the container is running, it can be accessed with:</p>
<pre><code class="bash">lxc exec bionic-maas bash
</code></pre>

<h3 id="heading--install-maas">Install MAAS</h3>

<p>In the container (or containers),<a href="maas-installation-from-a-snap-773.html">install MAAS</a>.</p>
<!-- LINKS -->
    </div>
  </body>
</html>