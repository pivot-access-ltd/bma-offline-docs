<!DOCTYPE html>
    <html>
    <body>
    <div class="container">
    <h1>How to observe a live MAAS</h1><!-- "How to observe a live MAAS" -->

<p><a href="#heading--configuring-prometheus"><h3 id="heading--configuring-prometheus">Configuring Prometheus</h3></a></p>
<p>Once the <code>/metrics</code> endpoint is available in MAAS services, Prometheus can be configured to scrape metric values from these. You can configure this by adding a stanza like the following to the <a href="https://prometheus.io/docs/prometheus/latest/configuration/configuration/">prometheus configuration</a>:</p>
<pre><code class="language-yaml">    - job_name: maas
      static_configs:
        - targets:
          - &lt;maas-host1-IP&gt;:5239  # for regiond
          - &lt;maas-host1-IP&gt;:5249  # for rackd
          - &lt;maas-host2-IP&gt;:5239  # regiond-only
          - &lt;maas-host3-IP&gt;:5249  # rackd-only
</code></pre>
<p>If the MAAS installation includes multiple nodes, the <code>targets</code> entries must be adjusted accordingly, to match services deployed on each node.</p>
<p>If  you have enabled MAAS stats,  you must add an additional Prometheus job to the config:</p>
<pre><code class="language-yaml">    - job_name: maas
      metrics_path: /MAAS/metrics
      static_configs:
        - targets:
          - &lt;maas-host-IP&gt;:5240
</code></pre>
<p>In case of a multi-host deploy, adding a single IP for any of the MAAS hosts running <code>regiond</code> will suffice.</p>
<p><a href="#heading--deploying-prometheus-and-grafana"><h3 id="heading--deploying-prometheus-and-grafana">Deploying Prometheus and Grafana</h3></a></p>
<p><a href="https://grafana.com/">Grafana</a> and Prometheus can be easily deployed using Juju.</p>
<p>The <a href="https://git.launchpad.net/~maas-committers/maas/+git/maas-performance">MAAS performance repo</a> repository provides a sample <code>deploy-stack</code> script that will deploy and configure the stack on LXD containers.</p>
<p>First, you must install juju via:</p>
<pre><code>sudo snap install --classic juju
</code></pre>
<p>Then you can run the script from the repo:</p>
<pre><code>grafana/deploy-stack &lt;MAAS-IP&gt;
</code></pre>
<p>To follow the progress of the deployment, run the following:</p>
<pre><code>watch -c juju status --color
</code></pre>
<p>Once you deploy everything, the Grafana UI is accessible on port <code>3000</code> with the credentials <code>admin</code>/<code>grafana</code>. The Prometheus UI will be available on port <code>9090</code>.</p>
<p>The repository also provides some sample dashboard covering the most common use cases for graphs. These are available under <code>grafana/dashboards</code>.  You can import them from the Grafana UI or API.</p>
    </div>
    </body>
    </html>
    