<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" type="text/css" href="css/stylesheet.css" />
    <style>
      #selector a:link{color:black;}
      #selector a:visited{color:black;}
      #selector a:active{color:black;}
      #selector a:hover{color:blue;}
      #sidebar a:link{color:black;}
      #sidebar a:visited{color:black;}
      #sidebar a:active{color:black;}
      #sidebar a:hover{color:blue;}
      ul {margin-left:0;list-style-type:none;}
      li {margin: 4px 0;}
    </style>
  </head>
  <body>
    <div id="selector" style="top:0; position:fixed; float:right; background-color:#d9d9d9; width:100%;border-bottom:1px solid black;">
      &nbsp;&nbsp;<strong>Offline docs</strong>
      <a href="https://maas.io/docs">(switch to live docs)</a>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
	<a href="../ui/how-to-tag-machines.html">
	  UI-only
	</a>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      <span style="background-color:white;border-top:1px solid black; border-left:1px solid black; border-right:1px solid black; border-bottom:5px solid white;">
	  &nbsp;CLI-only&nbsp;
      </span>
    </div>
    <div id="sidebar" style="float:left; width:25%;margin-top:40px; margin-left:20px">
      <strong>
	<a href="maas-documentation.html">
	  Home
	</a>
      </strong>
      <ul>
	<li>
	  <a href="what-is-new-with-maas.html">
	    Release notes
	  </a>
	</li>
	<li>
	  <a href="maas-installation-requirements.html">
	    Installation requirements
	  </a>
	</li>
	<li>
	  <a href="maas-glossary.html">
	    Glossary
	  </a>
	</li>
      </ul>
      <strong>
	<a href="basic-tutorials.html">
	  Basic tutorials
	</a>
      </strong>
      <ul>
	<li>
	  <a href="maas-bootstrap-tutorial.html">
	    MAAS bootstrap tutorial
	  </a>
	</li>
	<li>
	  <a href="try-out-the-maas-cli.html">
	    Try out the MAAS CLI
	  </a>
	</li>
	<li>
	  <a href="custom-image-tutorial.html">
	    Custom image tutorial
	  </a>
	</li>
	<li>
	  <a href="using-jq-with-the-maas-cli.html">
	    Using jq with the MAAS CLI
	  </a>
	</li>
      </ul>
      <strong>
	<a href="how-to-get-started-with-maas.html">
	  How to get started with MAAS
	</a>
      </strong>
      <ul>
	<li>
	  <a href="how-to-spin-up-maas-with-ansible.html">
	    Spin up MAAS with Ansible
	  </a>
	</li>
	<li>
	  <a href="how-to-install-maas.html">
	    Install MAAS
	  </a>
	</li>
	<li>
	  <a href="how-to-upgrade-maas.html">
	    Upgrade MAAS
	  </a>
	</li>
	<li>
	  <a href="how-to-change-maas-settings.html">
	    Change MAAS settings
	  </a>
	</li>
	<li>
	  <a href="how-to-get-help.html">
	    Ask for help
	  </a>
	</li>
	<li>
	  <a href="how-to-request-a-feature.html">
	    Request a feature
	  </a>
	</li>
	<li>
	  <a href="how-to-report-a-bug.html">
	    Report a bug
	  </a>
	</li>
	<li>
	  <a href="how-to-troubleshoot-maas.html">
	    Troubleshooting
	  </a>
	</li>
      </ul>
      <strong>
	<a href="how-to-set-up-networks.html">
	  How to set up networks
	</a>
      </strong>
      <ul>
	<li>
	  <a href="how-to-connect-maas-networks.html">
	    Connect MAAS networks
	  </a>
	</li>
	<li>
	  <a href="how-to-enable-dhcp.html">
	    Enable DHCP
	  </a>
	</li>
	<li>
	  <a href="how-to-manage-availability-zones.html">
	    Manage zones (AZs)
	  </a>
	</li>
      </ul>
      <strong>
	<a href="how-to-acquire-images.html">
	  How to acquire images
	</a>
      </strong>
      <ul>
	<li>
	  <a href="how-to-use-standard-images.html">
	    Use standard images
	  </a>
	</li>
	<li>
	  <a href="how-to-mirror-images-locally.html">
	    Mirror images locally
	  </a>
	</li>
	<li>
	  <a href="how-to-build-custom-images.html">
	    Build custom images
	  </a>
	</li>
	<li>
	  <a href="how-to-employ-vmware-images.html">
	    Employ VMWare images
	  </a>
	</li>
      </ul>
      <strong>
	<a href="how-to-tune-controllers.html">
	  How to tune controllers
	</a>
      </strong>
      <ul>
	<li>
	  <a href="how-to-adjust-your-controllers.html">
	    Adjust your controllers
	  </a>
	</li>
	<li>
	  <a href="how-to-enable-high-availability.html">
	    Enable HA
	  </a>
	</li>
      </ul>
      <strong>
	<a href="how-to-deploy-physical-machines.html">
	  How to deploy physical machines
	</a>
      </strong>
      <ul>
	<li>
	  <a href="how-to-make-machines-available.html">
	    Make machines available
	  </a>
	</li>
	<li>
	  <a href="how-to-cusdomise-machines.html">
	    Customise machines
	  </a>
	</li>
	<li>
	  <a href="how-to-put-machines-to-work.html">
	    Put machines to work
	  </a>
	</li>
      </ul>
      <strong>
	<a href="how-to-deploy-virtual-machines.html">
	  How to deploy virtual machines
	</a>
      </strong>
      <ul>
	<li>
	  <a href="how-to-set-up-lxd.html">
	    Set up LXD
	  </a>
	</li>
	<li>
	  <a href="how-to-create-vm-hosts.html">
	    Create VM hosts
	  </a>
	</li>
	<li>
	  <a href="how-to-create-and-manage-vms.html">
	    Create and manage VMs
	  </a>
	</li>
      </ul>
      <strong>
	<a href="how-to-label-and-find-machines.html">
	  How to label and find machines
	</a>
      </strong>
      <ul>
	<li>
	  <a href="how-to-tag-machines.html">
	    Tag machines
	  </a>
	</li>
	<li>
	  <a href="how-to-annotate-machines.html">
	    Annotate machines
	  </a>
	</li>
	<li>
	  <a href="how-to-use-machine-tags.html">
	    Use machine tags
	  </a>
	</li>
	<li>
	  <a href="how-to-use-controller-tags.html">
	    Use controller tags
	  </a>
	</li>
	<li>
	  <a href="how-to-use-storage-tags.html">
	    Use storage tags
	  </a>
	</li>
	<li>
	  <a href="how-to-use-network-tags.html">
	    Use network tags
	  </a>
	</li>
	<li>
	  <a href="how-to-find-machines.html">
	    Find machines
	  </a>
	</li>
      </ul>
      <strong>
	How to diagnose issues
      </strong>
      <ul>
	<li>
	  <a href="how-to-work-with-log-files.html">
	    Work with log files
	  </a>
	</li>
	<li>
	  <a href="how-to-work-with-audit-event-logs.html">
	    Work with audit event logs
	  </a>
	</li>
      </ul>
      <strong>
	How to work securely
      </strong>
      <ul>
	<li>
	  <a href="how-to-improve-maas-security.html">
	    Improve MAAS security
	  </a>
	</li>
	<li>
	  <a href="how-to-enable-maas-native-tls-encryption.html">
	    Enable MAAS native TLS
	  </a>
	</li>
	<li>
	  <a href="how-to-set-up-an-air-gapped-maas.html">
	    Set up an air-gapped MAAS
	  </a>
	</li>
	<li>
	  <a href="how-to-manage-user-accounts.html">
	    Manage user accounts
	  </a>
	</li>
      </ul>
      <strong>
	How to operate reliably
      </strong>
      <ul>
	<li>
	  <a href="how-to-keep-maas-backed-up.html">
	    Keep MAAS backed up
	  </a>
	</li>
	<li>
	  <a href="how-to-observe-a-live-maas.html">
	    Observe a live MAAS
	  </a>
	</li>
      </ul>
      <strong>
	<a href="explanation.html">
	Explanations
	</a>
      </strong>
      <ul>
	<li>
	  <a href="about-vm-hosting.html">
	    VM hosting
	  </a>
	</li>
	<li>
	  <a href="understanding-maas-events.html">
	    MAAS events
	  </a>
	</li>
	<li>
	  <a href="undersdtanding-maas-audit-events.html">
	    MAAS audit events
	  </a>
	</li>
	<li>
	  <a href="about-rbac.html">
	    RBAC
	  </a>
	</li>
      </ul>
      <strong>
	API reference
      </strong>
      <ul>
	<li>
	  <a href="api-authentication-reference.html">
	    API authentication
	  </a>
	</li>
	<li>
	  <a href="python-api-client-reference.html">
	    API client
	  </a>
	</li>
	<li>
	  <a href="api.html">
	    API documentation
	  </a>
	</li>
      </ul>
      <strong>
	<a href=".html">
	  Technical reference
	</a>
      </strong>
      <ul>
	<li>
	  <a href="commissioning-scripts-reference.html">
	    Commissioning scripts
	  </a>
	</li>
	<li>
	  <a href="hardware-test-scripts-reference.html">
	    Hardware test scripts
	  </a>
	</li>
	<li>
	  <a href="audit-event-log-reference.html">
	    Audit event logs
	  </a>
	</li>
	<li>
	  <a href="maas-performance.html">
	    MAAS performance
	  </a>
	</li>
	<li>
	  <a href="power-management-reference.html">
	    Power management
	  </a>
	</li>
	<li>
	  <a href="storage-layouts-reference.html">
	    Storage layouts
	  </a>
	</li>
	<li>
	  <a href="maas-terraform-provider-reference.html">
	    Terraform provider
	  </a>
	</li>
      </ul>
    </div>
    <div class="container" style="float:right; width:65%; margin-top:40px; margin-right:30px">
  <h1>How to tag machines</h1><!-- "How to tag machines" -->
<p>Tags for different objects have similar purposes, but they aren&rsquo;t necessarily administered in the same way &ndash; so we&rsquo;ve included detailed articles for each tag type.  That said, many of the common operations regarding tags are performed in the same way.  This article will present some general, explanatory information, and then look at tag management steps that are the same (or very similar) across all types of MAAS tags.</p>
<p><a href="#heading--name-tags"><h2 id="heading--name-tags">How to name tags</h2></a></p>
<p>When working with tags, there are some universal rules you need to follow:</p>
<ol>
<li>Tag names can include any combination of alphabetic letters (a-zA-Z), numbers (0-9), dashes (-) and underscores (_).</li>
<li>Tag names can be a maximum of 256 characters in length.</li>
<li>Tag names <em>cannot</em> include spaces.</li>
</ol>
<p>In general, names that do not conform to these rules cannot be created.</p>
<p><a href="#heading--automatic-tags"><h2 id="heading--automatic-tags">About automatic tags</h2></a></p>
<p>Automatic tags are tags with a definition. The definition allows you to auto-apply tags to machines that match with an <a href="#heading--xpath-expressions">XPath expression</a> you created. Setting up an automatic tag will help you recognise special hardware characteristics and settings. For instance, we can configure the gpu passthrough by creating an XPath expression that recognises a prospective GPU, as shown in the example below.  </p>
<p>In our REST API, a tag has 4 attributes namely, name, definition, kernel options, and comment. The example below shows you how to fill in the definition attribute to create an automatic tag.  In this case, we are tagging all machines that have Intel VT-d enabled and have a Tesla v100 PCIe 16GB GPU:</p>
<p><a href="https://discourse.maas.io/uploads/default/original/2X/b/b40bc145f3129b257ba49bda53442f1b63c7b229.png" target = "_blank"><img src="https://discourse.maas.io/uploads/default/original/2X/7/7be5f2bebbba9a09f70a7dea092d091ef45228e2.png"></a></p>
<p>When this tag is created, our REST API will try to match all machines with this definition and automatically apply the <code>gpgpu-tesla-v-100</code> tag to those machines. Every time a new machine is discovered in your MAAS, if new machines match this definition, they will be automatically tagged as well.</p>
<p><a href="#heading--xpath-expressions"><h2 id="heading--xpath-expressions">About XPath expressions</h2></a></p>
<p>MAAS automatic tags accept XPath expressions in the definition attribute of the tag. XPath expressions are evaluated against <code>lshw</code>&lsquo;s XML output; they are used to locate elements or attributes of the XML document for use in configuring automatic tags. You can use the lshw output in the hardware configuration details of a machine in MAAS and use that to create an XPath expression. </p>
<p><a href="#heading--xpath-hardware-config-info"><h3 id="heading--xpath-hardware-config-info">Hardware configuration information</h3></a></p>
<p>You can download your HW configuration information in the XML format by going to the machine details page of any allocated or deployed machines.  Choose Logs &gt;&gt; Installation output &gt;&gt; Download &gt;&gt; Machine output (XML) to capture these details:</p>
<p><a href="https://discourse.maas.io/uploads/default/original/2X/3/387b8b6a7ded18e523c818500d79f0d657868b87.png" target = "_blank"><img src="https://discourse.maas.io/uploads/default/original/2X/3/387b8b6a7ded18e523c818500d79f0d657868b87.png"></a></p>
<p>You can <a href="https://ezix.org/project/wiki/HardwareLiSter">learn more about these attributes</a> if desired.  Note that:</p>
<ul style="margin-left:4px; list-style-type:disc;">
<li>Size and capacity can have various meanings depending on the device</li>
<li>The size of a node is always equal to its capacity</li>
<li>Serial refers to the device’s serial number, but is used to report the MAC address for network devices, GUID for disk partition.</li>
</ul>
<p><a href="#heading--device-classes"><h3 id="heading--device-classes">Device classes</h3></a></p>
<p>You can also find device classes from the same sources:</p>
<p><a href="https://discourse.maas.io/uploads/default/original/2X/7/7368ba42d0d34571447dbb6830b363abace580bb.png" target = "_blank"><img src="https://discourse.maas.io/uploads/default/original/2X/7/7368ba42d0d34571447dbb6830b363abace580bb.png"></a></p>
<p><a href="#heading--node-capabilities"><h3 id="heading--node-capabilities">Capabilities</h3></a></p>
<p>Capabilities are used to report features of a given node. The exact meaning of each feature depends on the type of node. It can be the presence of an arithmetical co-processor for a CPU, the ability to run at 1GB/s for a network interface, etc. In most cases, capabilities reported by lshw are auto-documented.</p>
<p>To see the capabilities of a specific machine, you can download your HW configuration information, as described above.</p>
<p><a href="#heading--kernel-options"><h2 id="heading--kernel-options">About Kernel options</h2></a></p>
<p>You can add kernel options when creating both manual and automatic tags. Kernel options will be automatically applied at boot time or when the machine with that tag is commissioned or deployed. </p>
<p>When updating kernel options on a tag that matches Deployed machines, be aware that the new kernel option will be applied during boot time, so you will need to release and re-deploy them to pick up the change. Otherwise, these deployed machines will have the old kernel options.</p>
<p>If there are multiple tags associated with a machine, the kernel options will be concatenated from all the tags combined, sorted alphabetically .</p>
<p><a href="#heading--how-to-create-automatic-tags"><h2 id="heading--how-to-create-automatic-tags">How to create automatic tags</h1></a></p>
<p>You can create an automatic tag by going to the <code>Tag</code> tab and click <code>Create new tag</code>. A tag is considered automatic when the definition field is filled with an XPath expression. The current version of our UI will only validate if your XPath expression is valid or not, but it will not show you which machines it will apply to before you create the tag.</p>
<p>Here is a thumbnail sketch of how automatic tags work:</p>
<p><a href="https://discourse.maas.io/uploads/default/original/2X/f/fb003af31284581af931868daff1d735b6a52336.png" target = "_blank"><img src="https://discourse.maas.io/uploads/default/original/2X/f/fb003af31284581af931868daff1d735b6a52336.png"></a></p>
<p>When you choose to create a new tag, you are presented with a screen similar to this one:</p>
<p><a href="https://discourse.maas.io/uploads/default/original/2X/e/e56224d790144ba30199f37370437d63aed09cd3.png" target = "_blank"><img src="https://discourse.maas.io/uploads/default/original/2X/e/e56224d790144ba30199f37370437d63aed09cd3.png"></a></p>
<p>While creating the tag, you also have an option to add kernel options to an automatic tag. Bear in mind that if a machine has multiple tags, it will be tagged alphabetically and the kernel option from the last tag will be applied to that machine. </p>
<p>Once an automatic tag is created the screen will initially show that 0 machines are tagged. That is because MAAS is running a background task to auto-apply the tag to matching machines. It can take some time to see that the number of machines tagged is populating. </p>
<p><strong>NOTE:</strong> 
Kernel options will be applied at boot time. So by default kernel options will not be applied to any machines until they are deployed. If machines are deployed before they are tagged, the kernel option will be applied when these machines are redeployed.</p>
<p><a href="#heading--how-to-update-automatic-tags"><h2 id="heading--how-to-update-automatic-tags">How to update the definition of a tag</h2></a></p>
<p>To update the definition for the automatic tag, go to the ‘Tag’ tab and click the edit icon:</p>
<p><a href="https://discourse.maas.io/uploads/default/original/2X/0/011d3179b7128fc1bee33a7368ca18267fe92c76.png" target = "_blank"><img src="https://discourse.maas.io/uploads/default/original/2X/0/011d3179b7128fc1bee33a7368ca18267fe92c76.png"></a></p>
<p>This will open up the form and allow you to make changes in edit mode:</p>
<p><a href="https://discourse.maas.io/uploads/default/original/2X/1/1f4a8159dc08a0b013df323fbf88dcf80b932e3e.png" target = "_blank"><img src="https://discourse.maas.io/uploads/default/original/2X/1/1f4a8159dc08a0b013df323fbf88dcf80b932e3e.png"></a></p>
<p>If the new definition is not a valid XPath expression, MAAS will generate an error:</p>
<p><a href="https://discourse.maas.io/uploads/default/original/2X/f/f8dff191b24ac07338c9c6e33d8a03e7e5001c46.png" target = "_blank"><img src="https://discourse.maas.io/uploads/default/original/2X/f/f8dff191b24ac07338c9c6e33d8a03e7e5001c46.png"></a></p>
<p>Keep in mind that when a new definition is updated, MAAS will re-tag all the machines that match with the new definition. This can take some time, since it is a background process. </p>
<p><a href="#heading--update-tag-kernel-options"><h2 id="heading--update-tag-kernel-options">How to update the kernel option on a Tag</h2></a></p>
<p>Kernel options can exist for both manual and automatic tags. However, they will be applied during boot time (commissioning and deploying).  To update the kernel options, go to the ‘Tag’ tab and click the edit icon. Update the text area in the kernel option in this form:</p>
<p><a href="https://discourse.maas.io/uploads/default/original/2X/2/24ba6c81862981fdb7739cf61f2936b5204378e7.png" target = "_blank"><img src="https://discourse.maas.io/uploads/default/original/2X/2/24ba6c81862981fdb7739cf61f2936b5204378e7.png"></a></p>
<p><strong>NOTE:</strong> 
If the tagged machines are deployed, the updated kernel option won’t apply until the machines are redeployed. We suggest that you release those machines prior to the update, then redeploy those machines when the kernel options of the tag are updated.</p>
<p><a href="#heading--unassign-tags-from-machines"><h2 id="heading--unassign-ags-from-machines">How to unassign tags from machines</h2></a></p>
<p>There are two ways to unassign tags. In the machine listing page, select all machines that you would like to unassign the tag then click ‘Tag’. A tag form is open. In the first field, ‘Tags’, click the x icon on the chip component to unassign the tags:</p>
<p><a href="https://discourse.maas.io/uploads/default/original/2X/7/721d2f6c087ffaa9022f9a15e18783f309a4a3d0.png" target = "_blank"><img src="https://discourse.maas.io/uploads/default/original/2X/7/721d2f6c087ffaa9022f9a15e18783f309a4a3d0.png"></a></p>
<p>Click &ldquo;Remove&rdquo; to unassign a tag:</p>
<p><a href="https://discourse.maas.io/uploads/default/original/2X/9/9d0cd6b1a09f67237d48fb634c22b5f407c1ec4a.png" target = "_blank"><img src="https://discourse.maas.io/uploads/default/original/2X/9/9d0cd6b1a09f67237d48fb634c22b5f407c1ec4a.png"></a></p>
<p>The numbers prescribed in the chip indicate the number of selected machines associated with that tag. You may click on the chip to view its information. After unassigning, click save to confirm the changes. </p>
<p><strong>NOTE:</strong> 
Automatic tags cannot be unassigned manually. You can either update or delete automatic tags.</p>
<p>You can also unassign tags individually by going to the configuration tab on the machine details page; click the &ldquo;X&rdquo; icon to unassign the tag:</p>
<p><a href="https://discourse.maas.io/uploads/default/original/2X/8/8b4cb6617d2287eca7617c962578f90722ac2332.png" target = "_blank"><img src="https://discourse.maas.io/uploads/default/original/2X/8/8b4cb6617d2287eca7617c962578f90722ac2332.png"></a></p>
<p>You may reassign the tag by typing or clicking on the text field to see existing tags. Note that the tag will be assigned to all selected machines. </p>
<p><a href="#heading--see-all-tagged-nodes"><h2 id="heading--see-all-tagged-nodes">How to see all tagged nodes</h2></a></p>
<p>To see how many nodes (Machines, controllers, devices) are tagged, search for GRUB_CMDLINE_LINUX_DEFAULT in the &ldquo;Installation output&rdquo; tab of the machine details page. That log should stay around for the lifetime of the deployment of the machine.  The log gets overwritten when you redeploy the machine.  For example:</p>
<pre><code class="language-nohighlight">GRUB_CMDLINE_LINUX_DEFAULT=&quot;sysrq_always_enabled dyndbg='file drivers/usb/* +p' console=tty1 console=ttyS0&quot;
</code></pre>
<p><a href="#heading--tag-definition-reference"><h2 id="heading--tag-definition-reference">Tag definition reference examples</h2></a></p>
<p>Here are some examples of tag definitions &ndash; <a href="https://github.com/canonical/mxt">more examples are available</a>.</p>
<p>Commonly used Xpath functions usually include:</p>
<ul style="margin-left:4px; list-style-type:disc;">
<li>contains</li>
<li>starts-with</li>
<li>ends-with</li>
</ul>
<h3>Example 1</h3>
<p>This definition will identify machines with proper CPU tags, cores, and RAM, and tag them as a hypervisor:</p>
<p><a href="https://discourse.maas.io/uploads/default/original/2X/d/d1c8e2674445045ee9c8c9f1d14f3fa413af9be8.png" target = "_blank"><img src="https://discourse.maas.io/uploads/default/original/2X/d/d1c8e2674445045ee9c8c9f1d14f3fa413af9be8.png"></a></p>
<p>This example looks for at least 40 cores and 256 GB of RAM and has all the required CPU features for being a hypervisor for both Intel and AMD.</p>
<p><strong>NOTE:</strong> 
Don&rsquo;t forget to adjust cores and RAM (in bytes) to suit your particular needs and available resources.</p>
<p>You can also define this tag with the CLI:</p>
<pre><code class="language-nohighlight">maas ${MAAS_PROFILE} tags create name=hypervisor \
definition='//node[@id=&quot;memory&quot;]/size &gt;= &quot;274877906944&quot; and \
//node[@id=&quot;cpu&quot;]/configuration/setting/id=&quot;cores&quot; &gt;= 40 and \
//node[@id=&quot;cpu&quot;]//capabilities/capability/@id = &quot;vmx&quot; or @id=&quot;svm&quot; and \
//node[@id=&quot;cpu&quot;]//capabilities/capability/@id = &quot;aes&quot; and 
//node[@id=&quot;cpu&quot;]//capabilities/capability/@id = &quot;flexpriority&quot; and 
//node[@id=&quot;cpu&quot;]//capabilities/capability/@id = &quot;tpr_shadow&quot; and 
//node[@id=&quot;cpu&quot;]//capabilities/capability/@id = &quot;ept&quot; and 
//node[@id=&quot;cpu&quot;]//capabilities/capability/@id = &quot;vpid&quot; and 
//node[@id=&quot;cpu&quot;]//capabilities/capability/@id = &quot;vnmi&quot;'
</code></pre>
<h3>Example 2</h3>
<p>This will tag UEFI enabled KVM VMs running on AMD-based servers:</p>
<p><a href="https://discourse.maas.io/uploads/default/original/2X/a/adde5f51e396a3a2d2f70daad7787fe087723664.png" target = "_blank"><img src="https://discourse.maas.io/uploads/default/original/2X/a/adde5f51e396a3a2d2f70daad7787fe087723664.png"></a></p>
<p>You can also do this with the CLI:</p>
<pre><code class="language-nohighlight">maas ${MAAS_PROFILE} tags create \
name=kvm-amd-uefi \
definition='//node[@class=&quot;system&quot;]/vendor = &quot;QEMU&quot; and //node[@id=&quot;firmware&quot;]/capabilities/capability/@id = &quot;virtualmachine&quot; and //node[@id=&quot;firmware&quot;]/capabilities/capability/@id = &quot;uefi&quot; and //node[@class=&quot;processor&quot;]/vendor[starts-with(.,&quot;Advanced Micro Devices&quot;)]' \
kernel_opts='nomodeset console=tty0 console=ttyS0,115200n8 amd_iommu=on kvm-amd.nested=1 kvm-amd.enable_apicv=n kvm.ignore_msrs=1' \
comment='Tag for automatically identifying AMD-based KVM vms (UEFI BIOS)'
</code></pre>
<h3>Example 3</h3>
<p>This will automatically tag servers that have NVME controllers:</p>
<p><a href="https://discourse.maas.io/uploads/default/original/2X/1/166cd775669610ba454b5f2883e7729b79770bd0.png" target = "_blank"><img src="https://discourse.maas.io/uploads/default/original/2X/1/166cd775669610ba454b5f2883e7729b79770bd0.png"></a></p>
<p>To accomplish the same thing in the CLI:</p>
<pre><code class="language-nohighlight">maas ${MAAS_PROFILE} tags create name=NVME comment=&quot;xpath tag for automatically tagging servers that have NVME controllers&quot; definition='//node[@id=&quot;storage&quot; and @class=&quot;storage&quot;]/description = &quot;Non-Volatile memory controller&quot;'
</code></pre>
<h3>Example 4</h3>
<p>This will tag servers with Mellanox ConnectX-5 NICs:</p>
<p><a href="https://discourse.maas.io/uploads/default/original/2X/3/34ed75cf40ded49ac5eb8d76467817b5618b11a9.png" target = "_blank"><img src="https://discourse.maas.io/uploads/default/original/2X/3/34ed75cf40ded49ac5eb8d76467817b5618b11a9.png"></a></p>
<p>And you can also do this in the CLI:</p>
<pre><code class="language-nohighlight">maas ${MAAS_PROFILE} tags create \
name=connectx-5 \
definition='//node[@class=&quot;network&quot;]/vendor[starts-with(.,&quot;Mellanox&quot;)] and //node[@class=&quot;network&quot;]/product[contains(.,&quot;ConnectX-5&quot;)]' \
comment='Tag for automatically identifying servers with Mellanox Technologies ConnectX-5 cards'
</code></pre>
<h3>Example 5</h3>
<p>This will enable GPU passthrough for Nvidia Quadro K series GPUs on AMD:</p>
<p><a href="https://discourse.maas.io/uploads/default/original/2X/3/3f258d7e98c0adc7b605b8d2846b76737d46a27e.png" target = "_blank"><img src="https://discourse.maas.io/uploads/default/original/2X/3/3f258d7e98c0adc7b605b8d2846b76737d46a27e.png"></a></p>
<p>You can also duplicate this example in the CLI:</p>
<pre><code class="language-nohighlight">maas ${MAAS_PROFILE} tags create \
name=gpgpu-quadro-k-a \
comment=&quot;Enable passthrough for Nvidia Quadro K series GPUs on AMD&quot; \
definition='//node[@id=&quot;cpu:0&quot;]/capabilities/capability/@id = &quot;svm&quot; and //node[@id=&quot;display&quot;]/vendor[contains(.,&quot;NVIDIA&quot;)] and //node[@id=&quot;display&quot;]/description[contains(.,&quot;3D&quot;)] and //node[@id=&quot;display&quot;]/product[contains(.,&quot;Quadro K&quot;)]'
</code></pre>
<p><a href="#heading--create-a-tag"><h2 id="heading--create-a-tag">How to create a tag</h2></a></p>
<p>With the CLI, you can create a tag with the following command:</p>
<pre><code class="language-nohighlight">maas $PROFILE tags create name=$TAG_NAME comment='$TAG_COMMENT'
</code></pre>
<p>For example, depending upon your system configuration, you might type a command similar to this one:</p>
<pre><code class="language-nohighlight">maas admin tags create name=&quot;new_tag&quot; comment=&quot;a new tag for test purposes&quot;
</code></pre>
<p>When the command is successful, you should see output similar to this:</p>
<pre><code class="language-nohighlight">Success.
Machine-readable output follows:
{
    &quot;name&quot;: &quot;new_tag&quot;,
    &quot;definition&quot;: &quot;&quot;,
    &quot;comment&quot;: &quot;a new tag for test purposes&quot;,
    &quot;kernel_opts&quot;: &quot;&quot;,
    &quot;resource_uri&quot;: &quot;/MAAS/api/2.0/tags/new_tag/&quot;
}
</code></pre>
<p>You can verify your work by <a href="#heading--list-all-tags-available-on-this-maas">listing all the tags on this MAAS</a>.</p>
<p><a href="#heading--create-tags-with-built-in-kernel-options"><h2 id="heading--create-tags-with-built-in-kernel-options">How to create tags with built-in kernel options</h2></a></p>
<p>You can create tags with embedded kernel boot options.  When you apply such tags to a machine, those kernel boot options will be applied to that machine on the next deployment.</p>
<p>To create a tag with embedded kernel boot options, use the following command:</p>
<pre><code class="language-nohighlight">maas $PROFILE tags create name='$TAG_NAME' \
    comment='$TAG_COMMENT' kernel_opts='$KERNEL_OPTIONS'
</code></pre>
<p>For example:</p>
<pre><code class="language-nohighlight">maas admin tags create name='nomodeset_tag' \
    comment='nomodeset_kernel_option' kernel_opts='nomodeset vga'
</code></pre>
<p>This command yields the following results:</p>
<pre><code class="language-nohighlight">Success.
Machine-readable output follows:
{
    &quot;name&quot;: &quot;nomodeset_tag&quot;,
    &quot;definition&quot;: &quot;&quot;,
    &quot;comment&quot;: &quot;nomodeset_kernel_option&quot;,
    &quot;kernel_opts&quot;: &quot;nomodeset vga&quot;,
    &quot;resource_uri&quot;: &quot;/MAAS/api/2.0/tags/nomodeset_tag/&quot;
}
</code></pre>
<p>You can check your work with a modified form of the listing command:</p>
<pre><code class="language-nohighlight">maas admin tags read | jq -r \
'([&quot;tag_name&quot;,&quot;tag_comment&quot;,&quot;kernel_options&quot;]
|(.,map(length*&quot;-&quot;))),(.[]|[.name,.comment,.kernel_opts]) 
| @tsv' | column -t
</code></pre>
<p>This should give you results something like this:</p>
<pre><code class="language-nohighlight">tag_name             tag_comment                  kernel_options                     
--------             -----------                  --------------                     
virtual                                                                              
new_tag              a-new-tag-for-test-purposes                                     
pod-console-logging  console=tty1                 console=ttyS0                      
nomodeset_tag        nomodeset_kernel_option      nomodeset       vga
</code></pre>
<p><a href="#heading--delete-a-tag"><h2 id="heading--delete-a-tag">How to delete a tag</h2></a></p>
<p>With the CLI, you can delete a tag with the following command:</p>
<pre><code class="language-nohighlight">maas $PROFILE tag delete $TAG_NAME
</code></pre>
<p>For example, depending upon your system configuration, you might type a command similar to this one:</p>
<pre><code class="language-nohighlight">maas admin tag delete how-to-tag-machines.htmlo
</code></pre>
<p>When the command is successful, you should see output similar to this:</p>
<pre><code class="language-nohighlight">Success.
Machine-readable output follows:
</code></pre>
<p>Note that there is no actual &ldquo;Machine-readable output&rdquo; produced by this command, in most cases. Also note that remove a tag removes it from any nodes where you may have assigned it, but does not affect those nodes in any other way.</p>
<p>You can check your work by <a href="#heading--list-all-tags-available-on-this-maas">listing all the tags on this MAAS</a>.</p>
<p><a href="#heading--update-a-tag"><h2 id="heading--update-a-tag">How to update a tag</h2></a></p>
<p>You can update a tag (e.g., a tag comment) like this:</p>
<pre><code class="language-nohighlight">maas $PROFILE tag update $TAG_NAME comment='$TAG_COMMENT'
</code></pre>
<p>For example:</p>
<pre><code class="language-nohighlight">maas admin tag update new_tag comment=&quot;a-new-tag-for-test-purposes&quot;
</code></pre>
<p>This should return an output similar to this one:</p>
<pre><code class="language-nohighlight">Success.
Machine-readable output follows:
{
    &quot;name&quot;: &quot;new_tag&quot;,
    &quot;definition&quot;: &quot;&quot;,
    &quot;comment&quot;: &quot;a-new-tag-for-test-purposes&quot;,
    &quot;kernel_opts&quot;: &quot;&quot;,
    &quot;resource_uri&quot;: &quot;/MAAS/api/2.0/tags/new_tag/&quot;
}
</code></pre>
<p>You can always verify by <a href="#heading--list-all-tags-available-on-this-maas">listing all the tags on this MAAS</a>.</p>
<p><a href="#heading--list-all-tags-available-on-this-maas"><h2 id="heading--list-all-tags-available-on-this-maas">How to list all tags available on this MAAS</h2></a></p>
<p>You can list all tags that currently exist in this MAAS with a command of the form:</p>
<pre><code class="language-nohighlight">maas $PROFILE tags read | jq -r '([&quot;tag_name&quot;,&quot;tag_comment&quot;]|(.,map(length*&quot;-&quot;))),(.[]|[.name,.comment]) | @tsv' | column -t
</code></pre>
<p>For example:</p>
<pre><code class="language-nohighlight">maas admin tags read | jq -r '([&quot;tag_name&quot;,&quot;tag_comment&quot;]|(.,map(length*&quot;-&quot;))),(.[]|[.name,.comment]) | @tsv' | column -t
</code></pre>
<p>Your output might look like this:</p>
<pre><code class="language-nohighlight">tag_name  tag_comment
--------  -----------
virtual   
new_tag   a-new-tag-for-test-purposes
</code></pre>
<p><a href="#heading--rebuild-a-tag"><h2 id="heading--rebuild-a-tag">How to rebuild a tag</h2></a></p>
<p>If you need to update tags for all machines – without having to recommission them – you can accomplish this with the rebuild command:</p>
<pre><code class="language-nohighlight">maas $PROFILE tag rebuild $TAG
</code></pre>
<p>This command automatically applies the tag to all machines regardless of state, even machines that are actively deployed. For example:</p>
<pre><code class="language-nohighlight">maas admin tag rebuild virtual
</code></pre>
<p>This command would produce output similar to the following:</p>
<pre><code class="language-nohighlight">Success.
Machine-readable output follows:
{
    &quot;rebuilding&quot;: &quot;virtual&quot;
}
</code></pre>
    </div>
  </body>
</html>