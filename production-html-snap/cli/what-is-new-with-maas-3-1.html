<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" type="text/css" href="css/stylesheet.css" />
    <style>
      #selector a:link{color:black;}
      #selector a:visited{color:black;}
      #selector a:active{color:black;}
      #selector a:hover{color:blue;}
      #sidebar a:link{color:black;}
      #sidebar a:visited{color:black;}
      #sidebar a:active{color:black;}
      #sidebar a:hover{color:blue;}
      ul {margin-left:0;list-style-type:none;}
      li {margin: 4px 0;}
    </style>
  </head>
  <body>
    <div id="selector" style="top:0; position:fixed; float:right; background-color:#d9d9d9; width:100%;border-bottom:1px solid black;">
      &nbsp;&nbsp;<strong>Offline docs</strong>
      <a href="https://maas.io/docs">(switch to live docs)</a>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
	<a href="../ui/what-is-new-with-maas-3-1.html">
	  UI-only
	</a>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      <span style="background-color:white;border-top:1px solid black; border-left:1px solid black; border-right:1px solid black; border-bottom:5px solid white;">
	  &nbsp;CLI-only&nbsp;
      </span>
    </div>
    <div id="sidebar" style="float:left; width:25%;margin-top:40px; margin-left:20px">
      <strong>
	<a href="maas-documentation-25.html">
	  Home
	</a>
      </strong>
      <ul>
	<li>
	  <a href="what-is-new-with-maas.html">
	    Release notes
	  </a>
	</li>
	<li>
	  <a href="maas-installation-requirements.html">
	    Installation requirements
	  </a>
	</li>
	<li>
	  <a href="maas-glossary.html">
	    Glossary
	  </a>
	</li>
      </ul>
      <strong>
	<a href="basic-tutorials.html">
	  Basic tutorials
	</a>
      </strong>
      <ul>
	<li>
	  <a href="maas-bootstrap-tutorial.html">
	    MAAS bootstrap tutorial
	  </a>
	</li>
	<li>
	  <a href="try-out-the-maas-cli.html">
	    Try out the MAAS CLI
	  </a>
	</li>
	<li>
	  <a href="custom-image-tutorial.html">
	    Custom image tutorial
	  </a>
	</li>
	<li>
	  <a href="using-jq-with-the-maas-cli.html">
	    Using jq with the MAAS CLI
	  </a>
	</li>
      </ul>
      <strong>
	<a href="how-to-get-started-with-maas.html">
	  How to get started with MAAS
	</a>
      </strong>
      <ul>
	<li>
	  <a href="how-to-spin-up-maas-with-ansible.html">
	    Spin up MAAS with Ansible
	  </a>
	</li>
	<li>
	  <a href="how-to-install-maas.html">
	    Install MAAS
	  </a>
	</li>
	<li>
	  <a href="how-to-upgrade-maas.html">
	    Upgrade MAAS
	  </a>
	</li>
	<li>
	  <a href="how-to-change-maas-settings.html">
	    Change MAAS settings
	  </a>
	</li>
	<li>
	  <a href="how-to-get-help.html">
	    Ask for help
	  </a>
	</li>
	<li>
	  <a href="how-to-request-a-feature.html">
	    Request a feature
	  </a>
	</li>
	<li>
	  <a href="how-to-report-a-bug.html">
	    Report a bug
	  </a>
	</li>
	<li>
	  <a href="how-to-troubleshoot-maas.html">
	    Troubleshooting
	  </a>
	</li>
      </ul>
      <strong>
	<a href="how-to-set-up-networks.html">
	  How to set up networks
	</a>
      </strong>
      <ul>
	<li>
	  <a href="how-to-connect-maas-networks.html">
	    Connect MAAS networks
	  </a>
	</li>
	<li>
	  <a href="how-to-enable-dhcp.html">
	    Enable DHCP
	  </a>
	</li>
	<li>
	  <a href="how-to-manage-availability-zones.html">
	    Manage zones (AZs)
	  </a>
	</li>
      </ul>
      <strong>
	<a href="how-to-acquire-images.html">
	  How to acquire images
	</a>
      </strong>
      <ul>
	<li>
	  <a href="how-to-use-standard-images.html">
	    Use standard images
	  </a>
	</li>
	<li>
	  <a href="how-to-mirror-images-locally.html">
	    Mirror images locally
	  </a>
	</li>
	<li>
	  <a href="how-to-build-custom-images.html">
	    Build custom images
	  </a>
	</li>
	<li>
	  <a href="how-to-employ-vmware-images.html">
	    Employ VMWare images
	  </a>
	</li>
      </ul>
      <strong>
	<a href="how-to-tune-controllers.html">
	  How to tune controllers
	</a>
      </strong>
      <ul>
	<li>
	  <a href="how-to-adjust-your-controllers.html">
	    Adjust your controllers
	  </a>
	</li>
	<li>
	  <a href="how-to-enable-high-availability.html">
	    Enable HA
	  </a>
	</li>
      </ul>
      <strong>
	<a href="how-to-deploy-physical-machines.html">
	  How to deploy physical machines
	</a>
      </strong>
      <ul>
	<li>
	  <a href="how-to-make-machines-available.html">
	    Make machines available
	  </a>
	</li>
	<li>
	  <a href="how-to-customise-machines.html">
	    Customise machines
	  </a>
	</li>
	<li>
	  <a href="how-to-put-machines-to-work.html">
	    Put machines to work
	  </a>
	</li>
      </ul>
      <strong>
	<a href="how-to-deploy-virtual-machines.html">
	  How to deploy virtual machines
	</a>
      </strong>
      <ul>
	<li>
	  <a href="how-to-set-up-lxd.html">
	    Set up LXD
	  </a>
	</li>
	<li>
	  <a href="how-to-create-vm-hosts.html">
	    Create VM hosts
	  </a>
	</li>
	<li>
	  <a href="how-to-create-and-manage-vms.html">
	    Create and manage VMs
	  </a>
	</li>
      </ul>
      <strong>
	<a href="how-to-label-and-find-machines.html">
	  How to label and find machines
	</a>
      </strong>
      <ul>
	<li>
	  <a href="how-to-tag-machines.html">
	    Tag machines
	  </a>
	</li>
	<li>
	  <a href="how-to-annotate-machines.html">
	    Annotate machines
	  </a>
	</li>
	<li>
	  <a href="how-to-use-machine-tags.html">
	    Use machine tags
	  </a>
	</li>
	<li>
	  <a href="how-to-use-controller-tags.html">
	    Use controller tags
	  </a>
	</li>
	<li>
	  <a href="how-to-use-storage-tags.html">
	    Use storage tags
	  </a>
	</li>
	<li>
	  <a href="how-to-use-network-tags.html">
	    Use network tags
	  </a>
	</li>
	<li>
	  <a href="how-to-find-machines.html">
	    Find machines
	  </a>
	</li>
      </ul>
      <strong>
	How to diagnose issues
      </strong>
      <ul>
	<li>
	  <a href="how-to-work-with-log-files.html">
	    Work with log files
	  </a>
	</li>
	<li>
	  <a href="how-to-work-with-audit-event-logs.html">
	    Work with audit event logs
	  </a>
	</li>
      </ul>
      <strong>
	How to work securely
      </strong>
      <ul>
	<li>
	  <a href="how-to-improve-maas-security.html">
	    Improve MAAS security
	  </a>
	</li>
	<li>
	  <a href="how-to-enable-maas-native-tls.html">
	    Enable MAAS native TLS
	  </a>
	</li>
	<li>
	  <a href="how-to-set-up-an-air-gapped-maas.html">
	    Set up an air-gapped MAAS
	  </a>
	</li>
	<li>
	  <a href="how-to-manage-user-accounts.html">
	    Manage user accounts
	  </a>
	</li>
      </ul>
      <strong>
	How to operate reliably
      </strong>
      <ul>
	<li>
	  <a href="how-to-keep-maas-backed-up.html">
	    Keep MAAS backed up
	  </a>
	</li>
	<li>
	  <a href="how-to-observe-a-live-maas.html">
	    Observe a live MAAS
	  </a>
	</li>
      </ul>
      <strong>
	API reference
      </strong>
      <ul>
	<li>
	  <a href="api-authentication-reference.html">
	    API authentication
	  </a>
	</li>
	<li>
	  <a href="python-api-client-reference.html">
	    API client
	  </a>
	</li>
	<li>
	  <a href="api.html">
	    API documentation
	  </a>
	</li>
      </ul>
      <strong>
	<a href=".html">
	  Technical reference
	</a>
      </strong>
      <ul>
	<li>
	  <a href="commissioning-scripts-reference.html">
	    Commissioning scripts
	  </a>
	</li>
	<li>
	  <a href="hardware-test-scripts-reference.html">
	    Hardware test scripts
	  </a>
	</li>
	<li>
	  <a href="audit-event-log-reference.html">
	    Audit event logs
	  </a>
	</li>
	<li>
	  <a href="maas-performance.html">
	    MAAS performance
	  </a>
	</li>
	<li>
	  <a href="power-management-reference.html">
	    Power management
	  </a>
	</li>
	<li>
	  <a href="storage-layouts-reference.html">
	    Storage layouts
	  </a>
	</li>
	<li>
	  <a href="maas-terraform-provider-reference.html">
	    Terraform provider
	  </a>
	</li>
      </ul>
    </div>
    <div class="container" style="float:right; width:65%; margin-top:40px; margin-right:30px">
  <h1>What is new with MAAS 3.1</h1><!-- "What is new with MAAS 3.1" -->

<p>We are happy to announce that MAAS 3.1 is now available. This release provides new features and critical bug fixes.</p>
<p><a href="#heading--cumulative-summary"><h3 id="heading--cumulative-summary">Cumulative summary of MAAS 3.1 features and fixes</h3></a></p>
<ul style="margin-left:4px; list-style-type:disc;">
<li>
<p><a href="#heading--lxd-clusters">Support for LXD clusters</a>: MAAS 3.1 can use LXD clusters with MAAS KVMs.</p>
</li>
<li>
<p><a href="#heading--image-sync-performance">Improved image sync performance</a>: After images are downloaded, rack controllers sync new images more quickly.</p>
</li>
<li>
<p><a href="#heading--enlist-deployed-machines">Ability to enlist deployed machines</a>: Users can enlist deployed machines, a top feature poll request.</p>
</li>
<li>
<p><a href="#heading--static-ubuntu-images">Static Ubuntu image upload and reuse</a>: Users can upload, deploy and reuse a bootable ubuntu image</p>
</li>
<li>
<p><a href="#heading--machine-cloning-ui">Machine configuration cloning UI</a>: We have extended machine cloning to the UI.</p>
</li>
<li>
<p><a href="#heading--lxd-auth-ux-improvements">LXD authentication UX improvements</a>: LXD certificates are easier to use.</p>
</li>
<li>
<p><a href="#heading--maas-3-1-cumulative-bug-fixes">MAAS 3.1 cumulative bug fixes</a></p>
</li>
</ul>
<p>Critical and high-priority fixes also extend or repair MAAS features:</p>
<ul style="margin-left:4px; list-style-type:disc;">
<li>
<p><a href="https://bugs.launchpad.net/maas/+bug/1867394">Expanded proxies</a>: Some proxies require authentication; MAAS now respects peer proxy username and password</p>
</li>
<li>
<p><a href="https://bugs.launchpad.net/bugs/1949410">Accurate storage pool sizes</a>: The UI now calculates storage pool sizes correctly for CEPH pools; shared pools are no longer stacked</p>
</li>
<li>
<p><a href="https://bugs.launchpad.net/bugs/1949485">Refresh wipeout bug</a>: MAAS does not destroy existing VMs on a refresh, or when the memory overcommit ratio is changed</p>
</li>
<li>
<p><a href="https://bugs.launchpad.net/bugs/1948500">Cloning issue fixed</a>: UI cloning has been repaired to prevent &ldquo;unsuccessful cloning&rdquo; of storage</p>
</li>
</ul>
<p><a href="#heading--installing-3-1-0"><h3 id="heading--installing-3-1-0">How to install MAAS 3.1</h3></a></p>
<p>MAAS 3.1 can be installed fresh from snaps (recommended) with:</p>
<pre><code>sudo snap install --channel=3.1 maas
</code></pre>
<p>MAAS 3.1 can also be installed via packages, by adding the <code>3.1</code> PPA:</p>
<pre><code>sudo add-apt-repository ppa:maas/3.1
sudo apt update
sudo apt install maas
</code></pre>
<p>You can then install MAAS 3.1 fresh (recommended) with:</p>
<pre><code>sudo apt-get -y install maas
</code></pre>
<p>Or, if you prefer to upgrade, you can:</p>
<pre><code>sudo apt upgrade maas
</code></pre>
<p>At this point, proceed with a normal installation.</p>
<p><a href="#heading--lxd-clusters"><h3 id="heading--lxd-clusters">LXD clusters</h3></a></p>
<p>MAAS 3.1 takes advantage of the existing LXD clustering capability.</p>
<p><a href="#heading--about-lxd-clusters"><h4 id="heading--about-lxd-clusters">About LXD clusters</h4></a></p>
<p>LXD clusters in MAAS allow you to view and manage existing VM host clusters and compose VMs within clusters.  MAAS will not create a cluster, but it will discover existing clusters.</p>
<p><a href="#heading--how-to-add-lxd-clusters"><h4 id="heading--how-to-add-lxd-clusters">How to add LXD clusters</h4></a></p>
<p>MAAS assumes you have already configured an LXD cluster. You then need to configure the cluster with a single trust which MAAS uses to communicate it. Adding a LXD cluster is like adding a single LXD host: you provide authentication in a similar way, and then select a project. MAAS then connects to the provided host to discover other hosts within the cluster, renaming the cluster host with a name you supply.</p>
<p><a href="https://discourse.maas.io/uploads/default/original/2X/3/3aba7d6e30eda61623f66cb162ca85814128864a.png" target = "_blank"><img src="https://discourse.maas.io/uploads/default/original/2X/3/3aba7d6e30eda61623f66cb162ca85814128864a.png"></a></p>
<p>First, add an LXD KVM:</p>
<p><a href="https://discourse.maas.io/uploads/default/original/2X/c/c7d35ad0d8e1d9038dd39a8965307a49f57d453a.png" target = "_blank"><img src="https://discourse.maas.io/uploads/default/original/2X/c/c7d35ad0d8e1d9038dd39a8965307a49f57d453a.png"></a></p>
<p>Next, set up credentials and let LXD trust your MAAS certificate:</p>
<p><a href="https://discourse.maas.io/uploads/default/original/2X/b/b3ea7559edc066e899e41f41846a268b2459b1a5.png" target = "_blank"><img src="https://discourse.maas.io/uploads/default/original/2X/b/b3ea7559edc066e899e41f41846a268b2459b1a5.png"></a></p>
<p>Once connected, you can select the project in that cluster:</p>
<p><a href="https://discourse.maas.io/uploads/default/original/2X/b/ba798351c1c2b37d0aa79bca8c44def38d4ab839.png" target = "_blank"><img src="https://discourse.maas.io/uploads/default/original/2X/b/ba798351c1c2b37d0aa79bca8c44def38d4ab839.png"></a></p>
<p>If the KVM host address is part of a cluster, it will show as a cluster on the listing page. </p>
<p><a href="https://discourse.maas.io/uploads/default/original/2X/0/069bae193cbb09ead3c811fd1a1d28582b946ff4.png" target = "_blank"><img src="https://discourse.maas.io/uploads/default/original/2X/0/069bae193cbb09ead3c811fd1a1d28582b946ff4.png"></a></p>
<p><a href="#heading--how-to-compose-vms-in-lxd-clusters"><h4 id="heading--how-to-compose-vms-in-lxd-clusters">How to compose VMs in LXD clusters</h4></a></p>
<p>Composing a VM in a LXD cluster via MAAS is similar to composing a VM for a single VM host. MAAS does not provide any sort of scheduling of said VM, and will instead target the host you select for composing the VM.</p>
<p>From the KVM host listing page, click on the <code>+</code> icon to add a VM to a specific host:</p>
<p><a href="https://discourse.maas.io/uploads/default/original/2X/2/219a302c245992a390cd44ada341cfe5a93a7b5a.png" target = "_blank"><img src="https://discourse.maas.io/uploads/default/original/2X/2/219a302c245992a390cd44ada341cfe5a93a7b5a.png"></a></p>
<p>If you are in a specific KVM host page, you can click <code>+ add virtual machine</code>:</p>
<p><a href="https://discourse.maas.io/uploads/default/original/2X/2/219a302c245992a390cd44ada341cfe5a93a7b5a.png" target = "_blank"><img src="https://discourse.maas.io/uploads/default/original/2X/2/219a302c245992a390cd44ada341cfe5a93a7b5a.png"></a></p>
<p><a href="#heading--how-to-delete-lxd-clusters"><h3 id="heading--how-to-delete-lxd-clusters">How to delete LXD clusters</h3></a></p>
<p>To delete an LXD cluster, simply delete any VM host within the cluster:</p>
<p><a href="https://discourse.maas.io/uploads/default/original/2X/e/ea7cd2476ae8cafe6d8e78f2b029d0cd41afa592.png" target = "_blank"><img src="https://discourse.maas.io/uploads/default/original/2X/e/ea7cd2476ae8cafe6d8e78f2b029d0cd41afa592.png"></a></p>
<p><a href="#heading--enlist-deployed-machines"><h3 id="heading--enlist-deployed-machines">Ability to enlist deployed machines</h3></a></p>
<h4>Ten words or fewer</h4>
<p>Users can enlist deployed machines, a top feature poll request.</p>
<h4>About this feature</h4>
<p>When adding machines to MAAS, MAAS (non-destructively) boots them into an ephemeral environment to gather hardware information.  Previously, this didn&rsquo;t work for deployed machines, since you don&rsquo;t want to disrupt deployed workloads or mark deployed machines as ready.</p>
<p>Now you may add deployed machines, without normal commissioning process or relabelling the machine. In order to update the information, a script is provided to run minimal commissioning scripts and update to MAAS.</p>
<h4>How to enlist a machine that’s already running a workload</h4>
<p>In order to enlist a deployed machine, you have two options:</p>
<p>Via the API/CLI, you can create a machine, passing the deployed flag:</p>
<pre><code>$ maas $profile machines create deployed=true hostname=mymachine \   
architecture=amd64 mac_addresses=00:16:3e:df:35:bb power_type=manual
</code></pre>
<p>On the machine itself (the recommended way, if the machine is running Ubuntu), you can download and run a helper script from MAAS:</p>
<pre><code>$ wget http://$MAAS_IP:5240/MAAS/maas-run-scripts
$ chmod 755 maas-run-scripts
$ ./maas-run-scripts register-machine --hostname mymachine \
 &gt; http://$MAAS_IP:5240/MAAS $MAAS_API_TOKEN
</code></pre>
<p>Now you have enlisted a deployed machine, with no hardware information yet.</p>
<h4>How to update hardware information for a deployed machine</h4>
<p>To update hardware information for a deployed machine, we recommend that you download and run the maas-run-scripts script on the machine:</p>
<pre><code>$ wget http://$MAAS_IP:5240/MAAS/maas-run-scripts
$ chmod 755 maas-run-scripts
$ ./maas-run-scripts report-results --config mymachine-creds.yaml
</code></pre>
<p>If you created the machine with the maas-run-scripts, you should have such a mymachine-creds.yaml file already. If not, it should look like this:</p>
<pre><code>reporting:
          maas:
            consumer_key: $CONSUMER_KEY
            endpoint: http://$MAAS_IP:5240/MAAS/metadata/status/$SYSTEM_ID
            token_key: $TOKEN_KEY
            token_secret: $TOKEN_SECRET
</code></pre>
<p>You may get the needed credentials from the MAAS API, for example:</p>
<pre><code>$ maas $profile machine get-token wxwwga
Success.
Machine-readable output follows:
{
        &quot;token_key&quot;: &quot;Lyy9BS4tKsQakDQScy&quot;,
        &quot;token_secret&quot;: &quot;V8vta8Azwn6FZVkfHnuTvLGLScAvEufB&quot;,
        &quot;consumer_key&quot;: &quot;YGT6QKSH65aap4tGnw&quot;
}
</code></pre>
<p><a href="#heading--static-ubuntu-images"><h3 id="heading--static-ubuntu-images">Static Ubuntu image upload and reuse</h3></a></p>
<h4>Ten words or fewer</h4>
<p>Users can upload, deploy and reuse a bootable ubuntu image</p>
<h4>About this feature</h4>
<p>MAAS supports deploying custom OS images.  Canonical provides both <a href="https://launchpad.net/maas-image-builder">lp:maas-image-builder</a> and <a href="https://github.com/canonical/packer-maas">gh:canonical/packer-maas</a> to create custom images. With 3.1, these custom images can include static Ubuntu images, created with whatever tool you choose, deployed as described below. Canonical still suggests customising Ubuntu using cloud-init user_data or Curtin preseed data, if possible.</p>
<h4>About static Ubuntu images</h4>
<p>MAAS allows you to build an Ubuntu image to deploy with MAAS, using any chosen image-building tool.  You can create the image with a fixed configuration and deploy it to many machines.  This fixed configuration can contain anything a normal image would contain: users, packages, etc.</p>
<h4>About uploading hand-built Ubuntu images</h4>
<p>You can upload and deploy hand-built Ubuntu images, containing kernel, bootloader, and fixed configuration.  The image can be built by tool, e.g., <a href="https://github.com/canonical/packer-maas">packer</a>, or by scripts. You can upload these images to the boot-resources endpoint, where they will be available for deployment.</p>
<p>The minimum image must contain a kernel, bootloader, and <code>/curtin/curtin-hooks</code> script that configures the network. Samples can be found in the <a href="https://github.com/canonical/packer-maas/tree/master/ubuntu/scripts">packer-maas repos</a>. The image must be in raw img file format so MAAS will accept the upload.  When built, you will upload this img file to the boot-resources endpoint, specifying the image architecture.</p>
<h4>About how MAAS handles these images</h4>
<p>MAAS will save the image as a <code>tar.gz</code> file in the database.  MAAS can differentiate between image types and generate appropriate pre-seed configurations.  MAAS also recognises the base Ubuntu version, so it can apply the correct ephemeral OS for installation.  Custom images are always deployed with the ephemeral OS, where the <code>base_image</code> field indicates the appropriate ephemeral version to avoid errors, ensuring smooth deployment later.</p>
<h4>About how MAAS boots these images</h4>
<p>When you deploy a machine with your custom image, MAAS ensures that the machine receives the kernel, bootloader and root file system provided in the image. The initial boot loader then boots an ephemeral OS matching the Ubuntu version of the custom image, reducing compatibility issues.  Curtin then writes your entire custom image to disk, after which it is not modified by MAAS.</p>
<p>Note that custom non-Ubuntu images still use a standard Ubuntu ephemeral OS to boot.</p>
<h4>About configuring deployed machine networking</h4>
<p>If you deploy a machine with a custom Ubuntu image, MAAS allows you to configure the deployed machine&rsquo;s networks just like any other MAAS machine.  If you create an interface and assign it to a subnet or static address, this will be reflected in the deployed machine.</p>
<p>For this reason, MAAS also does some initial diagnostics while installing the custom image.  MAAS will warn you about a missing network configuration, by checking for <code>cloud-init</code> and <code>netplan</code> in the <code>curtin</code> images. MAAS won&rsquo;t deploy machine with such images.</p>
<h4>About configuring deployed machine storage</h4>
<p>If you deploy a machine with a custom Ubuntu image, you will also want to be able to configure storage, just like any other machine.  MAAS facilitates changes to the storage configuration, such as resizing <code>/root</code>, attaching and formatting block devices, etc.</p>
<h4>About static image metrics</h4>
<p>As a user, you want to track of deployed static images. The standard MAAS dashboard now reflects these metrics.</p>
<h4>How to upload a custom Ubuntu image</h4>
<p>Custom Ubuntu images can be uploaded with the MAAS CLI by creating a boot-resource:</p>
<pre><code class="language-nohighlight">    maas $PROFILE boot-resources create \
        name='custom/ubuntu-custom'  \
        architecture=amd64/generic \
        title=’custom ubuntu’ \
        base_image=ubuntu/focal \
        filetype=ddraw \
        content@=./custom-ubuntu.img
</code></pre>
<p><strong>NOTE:</strong> 
When uploading a custom image, there is a new required field: <code>base_image</code>. This is not required for non-custom images; any image with the <code>custom</code> prefix will require it.</p>
<p><a href="#heading--machine-cloning-ui"><h3 id="heading--machine-cloning-ui">Machine configuration cloning UI</h3></a></p>
<h4>Ten words or fewer</h4>
<p>Extend machine cloning to UI, moving toward machine profile templates.</p>
<h4>About this feature</h4>
<p>MAAS 3.1 allows you to quickly clone or copy a configuration between machines, via the MAAS UI &ndash; a step towards machine templating. </p>
<p>Creating a machine profile is repetitive. We&rsquo;ve learned that most users create multiple machines of the same configuration in batches. Some users loop a template through the API, while others rely on scripts. MAAS API cloning functionality is now being exposed in the UI.</p>
<h4>About copying machine configurations</h4>
<p>As a MAAS user, you may want to copy a machine configuration to multiple existing machines. Assuming that at least one machine is already configured, you should be able to apply these settings to a list of machines.  This means that a user should be able to:</p>
<ul style="margin-left:4px; list-style-type:disc;">
<li>select the source machine to copy from.</li>
<li>validate that the source machine exists.</li>
<li>select at least 1 destination machine.</li>
<li>validate that the destination machine(s) exist.</li>
<li>edit the source machine or destination machines, if needed.</li>
<li>know at all times which machines are affected.</li>
<li>see the cloned machines when cloning is successful, or</li>
<li>get clear failure information, if cloning fails. </li>
</ul>
<h4>About choosing configuration items to copy</h4>
<p>As a MAAS user, you likely want to select whether storage, network, or both configurations should be cloned. The cloning API allows users to choose interfaces and storage separately.  Thus, this new feature also allows you to:</p>
<ul style="margin-left:4px; list-style-type:disc;">
<li>clone only the interface (network) configuration.</li>
<li>clone only the storage configuration.</li>
<li>clone both configurations.</li>
</ul>
<h4>About cloning restrictions</h4>
<p>In order for cloning to succeed, a few restrictions must be met:</p>
<ol>
<li>The destination interface names must be the same source.</li>
<li>The destination drive must be equal to or larger than the source drive.</li>
<li>For static IPs, a new IP will be allocated to the interface on the destination machine</li>
</ol>
<h4>How to clone a machine from the UI</h4>
<p>Assume you have two machines available, like this:</p>
<p><a href="https://discourse.maas.io/uploads/default/original/2X/6/6f662618011e3eb1f8e0bfe85748825db4a6ac25.png" target = "_blank"><img src="https://discourse.maas.io/uploads/default/original/2X/6/6f662618011e3eb1f8e0bfe85748825db4a6ac25.png"></p>
<p>Select the machine <em>to which you want to clone configuration</em>, and select &ldquo;Clone from&hellip;&rdquo;</p>
<p><a href="https://discourse.maas.io/uploads/default/original/2X/b/b4e42a59f1d4bc6d63f2cd24d77316eea3aada1b.png" target = "_blank"><img src="https://discourse.maas.io/uploads/default/original/2X/b/b4e42a59f1d4bc6d63f2cd24d77316eea3aada1b.png"></p>
<p>Under &ldquo;1. Select the source machine&rdquo; &ndash; choose a machine from the attached list:</p>
<p><a href="https://discourse.maas.io/uploads/default/original/2X/2/287bbf3db4bbc3253a976ecde8965c341fc1bee3.png" target = "_blank"><img src="https://discourse.maas.io/uploads/default/original/2X/2/287bbf3db4bbc3253a976ecde8965c341fc1bee3.png"></p>
<p>Under &ldquo;2. Select what to clone&rdquo;, choose &ldquo;Network&rdquo;, &ldquo;Storage&rdquo;, or both (here, we&rsquo;ve chosen &ldquo;Storage&rdquo;):</p>
<p><a href="https://discourse.maas.io/uploads/default/original/2X/6/622afe3c0bcd4775ef4c19460cf0f1f480c11efb.png" target = "_blank"><img src="https://discourse.maas.io/uploads/default/original/2X/6/622afe3c0bcd4775ef4c19460cf0f1f480c11efb.png"></p>
<p>Click &ldquo;Clone to machine&rdquo;. MAAS will report the status of the attempt.</p>
<p><a href="#heading--lxd-auth-ux-improvements"><h3 id="heading--lxd-auth-ux-improvements">LXD authentication UX improvements</h3></a></p>
<h4>Ten words or fewer</h4>
<p>Easier MAAS to LXD connection that uses certificates for authentication.</p>
<h4>About this feature</h4>
<p>MAAS 3.1 provides a smoother experience when connecting an existing LXD server to MAAS, guiding the user through manual steps and providing increased connection security with use of certificates. Currently, each MAAS region/rack controller has its own certificate. To add a LXD VM host to MAAS, the user needs to either add the certificate for each controller that can reach the LXD server to the trust list in LXD, or use the trust_password (in which case the controller talking to LXD will automatically add its certificate to the trust).</p>
<p>This doesn’t provide a great user experience, as the former process is cumbersome, and the latter is not suggested for production use for security reasons.  To improve this, MAAS 3.1 manages per-LXD keys/certificates, and provide a way for users to get the content of certificates, to authorise MAAS in LXD.</p>
<h4>About on-the-spot certificate creation</h4>
<p>As a MAAS user, you want to register a LXD host into MAAS using certificates for authentication &ndash; to follow LXD production deployment best practices.  The standard way for clients to authenticate with LXD servers is through certificates. The use of trust_password is <em>only</em> meant as a way to interact for initial setup.</p>
<p>While prior versions of MAAS support both ways of authentication (and automatically adds the certificate for the rack talking to LXD when registering the VM host), the user experience is lacking, since there&rsquo;s no control over the certificate being used.  In addition, each rack uses a different certificate, making it hard to manage scenarios where multiple racks can connect to a LXD server.</p>
<p>For these reasons, when adding a LXD host, MAAS 3.1 provides a way to generate a secret key and certificate pair to use specifically for that server, and show the certificate to the user, so that they can add it to the LXD server trust list.  The user experience changes to something like the following:</p>
<ul style="margin-left:4px; list-style-type:disc;">
<li>MAAS generates a secret key and certificate pair for use with a LXD server.</li>
<li>The user can see the certificate and is guided to add it to the LXD server trust list.</li>
<li>The user can easily complete the registration of the LXD server once the certificate is trusted in LXD.</li>
<li>All racks use the same key when talking to the LXD server. </li>
<li>If a new rack controller is added, it can communicate with the LXD server out of the box.</li>
<li>If the trust password is used, it’s not stored in MAAS persistently.</li>
<li>It’s possible to get the certificate for a LXD server from a URL (e.g. for curl use).</li>
</ul>
<h4>About bringing your own certificates</h4>
<p>As a MAAS user, you may want to register a LXD host into MAAS by providing a private key for a certificate that’s already trusted by the LXD server.  For example, you may already have set up certificates in the server trust for MAAS to use, MAAS should provide a way to import it, instead of generating a new one.</p>
<p>With MAAS 3.1, it’s possible to import an existing key/certificate pair for use with a LXD server when registering it with MAAS.  MAAS stores the key/certificate instead of generating new ones.</p>
<p><strong>NOTE:</strong> 
The imported key must not have a passphrase; otherwise, MAAS will not be able to use it.</p>
<h4>How to get started</h4>
<p>Suppose that you&rsquo;re creating a new LXD KVM, beginning from the top tab in MAAS:</p>
<p><a href="https://discourse.maas.io/uploads/default/optimized/2X/b/b7048c83a7d6e4dbca69a060a7b4bf8bc07e1953_2_690x165.png" target = "_blank"><img alt="" src="upload://5Rn9eea7n648iKo1sjohP7r5ARY.png"></a></p>
<p>Select &ldquo;Add KVM&rdquo;, which brings you to the definition screen:</p>
<p><a href="https://discourse.maas.io/uploads/default/optimized/2X/8/806d3577b11ed415574fd06de5f643f26ffb7928_2_690x257.png" target = "_blank"><img alt="" src="upload://2uPyI3yDteiWizFUhOM95C5B1Hg.png"></a></p>
<p>From here, you&rsquo;ll continue by choosing your authentication method.</p>
<h4>How to let MAAS create a certificate for you</h4>
<p>If you choose &ldquo;Generate new certificate&rdquo;, as shown above, you&rsquo;ll come to a screen like this one:</p>
<p><a href="https://discourse.maas.io/uploads/default/optimized/2X/0/08a32d9221a73f0d6f84580ab9ebeeaaf84aeb65_2_690x325.png" target = "_blank"><img alt="" src="upload://vc5IuTP53xKYzCDYkkPhLxcZFUE.png"></a></p>
<p>You can still choose to use the LXD trust password (entered when you ran <code>lxd init</code> during LXD installation).  You can also, though, choose to use the certificate MAAS has just generated for you.  To do that, select the entire contents of the text box, copy it, and paste it into a terminal window &ndash; then hit &ldquo;Enter&rdquo;:</p>
<pre><code>$ lxc config trust add - &lt;&lt;EOF
&gt; -----BEGIN CERTIFICATE-----
&gt; MIIErTCCApUCEQCGa86XdjYUGm8h8YOh4HAEMA0GCSqGSIb3DQEBDQUAMAAwHhcN
&gt; MjEwOTI0MjE1NDQ4WhcNMzEwOTIyMjE1NDQ4WjApMScwJQYDVQQDDB5teTBuZXh0
&gt; LTMuMS4wLWJldGExLWt2bUB3YWxkZW4wggIiMA0GCSqGSIb3DQEBAQUAA4ICDwAw
&gt; ggIKAoICAQC1tmJbSYx3Jb5JcuqLvyO6P0RtYWCbjVYOSAIM1PKHZJRvako6QhjR
&gt; 6wWNcVLAjDJIMuEBysrI8mcAv9D/AfT2qLQ/5mg7anbxfrd3YXG2nc70QJazpFaw
&gt; INDc85wrdJD5NEd50iaka+PztIAWzoZWQr/pLb7hUDnArzSHp5J+w0dRCUh54SyW
&gt; Du4mLpDks5UqMeONO1o7lbaQuBdzGtR4btdmvOkJfg/Pu3i/rzFZ1vvn1JhZTX96
&gt; +xH7tJQiqOk0SXG7F2RmbYiYDhAkiysbMoyOHBCf/qFWq4Vtd/VMxOAT1WERrgWn
&gt; 8nL5kRBozV94QocJaOe+GUSWLHsRpsVa8jiAj3LS2CFQfpaEsrzLSlQOeN2rNB9z
&gt; DO9yGXGql4tUpgtyEvxB/zVrIGd04iTC3D4S9b1KyzTbSsyjTc/XJhUStnn49ySW
&gt; Iwv1eHa2jMvIjRVm5sRfpf0EOZW27HLI1AqDOXR0DmlM2mWvndjvfacX+41I8vuG
&gt; +RPq0ZjDhwfRmUaLiebzcExwPmSHAxqiaV+t0n6ivDWTNk6cNc38rZBh3x6I7JMR
&gt; /85Rc1blLSF7QBMA1HxheCUYzBPTKsdE2btygq9vShRXCdSekV0jGoL1g0n6T59r
&gt; +9nHShgc/Bzk42kcddQySlrqWWHrXX6Z2N1R3eYpuvSEaKsnsjqjwwIDAQABMA0G
&gt; CSqGSIb3DQEBDQUAA4ICAQA4d1Xqi941ssyJoiovTzBgMDSp9kqjpB83BRqbF9oZ
&gt; fQGkezn2jF7SnaXbTyR/K+nir5Rms8OZfUxyZJwYh/YCdnIF8hzC32mLJbP6jcJV
&gt; LS0OD+EipwyRLSe9g2it68TtAhhVXKPx3tGQWWiXtJOF631sJRcRUZATc9nco5H2
&gt; 91GKog4LdFeKD3ArOq1GkE9r95WauTV37x0c474XBt2mVcEvFW50oZbIBPaWLt8E
&gt; q8NG0KYkfIHkhXDGqPDkUtdPJlkiGwqXdaqghuG31a4Or9IKcNmDlli47apaWWJW
&gt; /gqZfFALbOrSJHg10PCqNsfoKmQr2YZzPlTjG39RA7sA1XR6y+lQZqwcXnXk2iAE
&gt; n62OkRUrYVXzBo99zk5jQJVEg6zhfPH9zl6Jmn/vBu0p6RqmqNLTTlMOio8VOp9e
&gt; 9Gyb9uRwzwZ9zgydgI4bHMvcIAq+46wTruOfXBNATWLC2YqXbc+9QqemJebcXULW
&gt; Wf7Sc+SHHx2cVb4OUvUD8keZN37No/2vfZ9NI2SJOI4SxlV2yf6ZRyb7MYIwpm1h
&gt; YTzyS+ywUN4C8p1PsU5iT8DGdcg7Kcso4/DDZeZkLKNeCKizkdMreF7qV0qHTW8z
&gt; PyfZHcR/xWMkjxYZoFu4rVyxpsUJYItJNUNk6vZvSnSDfC2e2JJFfMws+fntNy14
&gt; /w==
&gt; -----END CERTIFICATE-----
&gt; EOF
$ 
</code></pre>
<p>The certificate will be created for you.  When you click the &ldquo;Check authentication&rdquo; button, you will be brought to this screen:</p>
<p><a href="https://discourse.maas.io/uploads/default/optimized/2X/a/ad3f6fd06fdef3ce5be467816b2fc3667550f397_2_690x204.png" target = "_blank"><img alt="" src="upload://5J5yTzf8p1wHMmyaB8Af6rRBTPC.png"></a></p>
<p>from which you can continue with normal LXD KVM setup.</p>
<h4>How to use your own, existing certificate</h4>
<p>Suppose that, after identifying your LXD KVM, you choose &ldquo;Provide certificate and private key&rdquo;.  When you do so, the screen will extend to allow you to upload these items:</p>
<p><a href="https://discourse.maas.io/uploads/default/optimized/2X/f/fa0bf04654e495ff1233defba4fc8768c06dd25f_2_690x443.png" target = "_blank"><img alt="" src="upload://rQ83izglHaGONtR03yUSYuDY9Sc.png"></a></p>
<p>Paste or upload your certificate and private key, then click &ldquo;Next&rdquo; to validate your authentication criteria, before continuing through the normal LXD KVM creation process.  If your certificate and/or key aren&rsquo;t usable for some reason, MAAS will return an error (in this case, the private key was entered as gibberish, to produce an error output):</p>
<p><a href="https://discourse.maas.io/uploads/default/original/2X/2/286e648de20c9db3bb6c56c5855647c23a5d9e2e.png" target = "_blank"><img src="https://discourse.maas.io/uploads/default/original/2X/2/286e648de20c9db3bb6c56c5855647c23a5d9e2e.png"></a></p>
<p><a href="#heading--image-sync-performance"><h3 id="heading--image-sync-performance">Improved image sync performance</h3></a></p>
<h4>Ten words or fewer</h4>
<p>After downloading images, the rack controller syncs them much faster.</p>
<h4>About this feature</h4>
<p>Downloading and syncing images is a known delay element in MAAS.  While images aren&rsquo;t small, and do take some time to download, we decided to try to speed up the process as much as possible.  After the region has downloaded new images, the rack controllers are now much quicker at syncing the new images.</p>
<h4>How to take advantage of this new feature</h4>
<p>There is nothing required of our users to experience this improved sync performance, other than upgrading to 3.1.</p>
<p><a href="#heading--maas-3-1-cumulative-bug-fixes"><h3 id="heading--maas-3-1-cumulative-bug-fixes">MAAS 3.1 cumulative bug fixes</h3></a></p>
<p>MAAS 3.1 bug fixes can be found in the following milestones:</p>
<ul style="margin-left:4px; list-style-type:disc;">
<li><a href="https://launchpad.net/maas/+milestone/3.1.0-beta5">MAAS 3.1 Beta5 bug fixes</a></li>
<li><a href="https://launchpad.net/maas/+milestone/3.1.0-beta4">MAAS 3.1 Beta4 bug fixes</a></li>
<li><a href="https://launchpad.net/maas/+milestone/3.1.0-beta3">MAAS 3.1 Beta3 bug fixes</a></li>
<li><a href="https://launchpad.net/maas/+milestone/3.1.0-beta2">MAAS 3.1 Beta2 bug fixes</a></li>
<li><a href="https://launchpad.net/maas/+milestone/3.1.0-beta1">MAAS 3.1 Beta1 bug fixes</a></li>
</ul>
    </div>
  </body>
</html>