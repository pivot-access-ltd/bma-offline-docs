<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" type="text/css" href="css/stylesheet.css" />
    <style>
      #selector a:link{color:black;}
      #selector a:visited{color:black;}
      #selector a:active{color:black;}
      #selector a:hover{color:blue;}
      #sidebar a:link{color:black;}
      #sidebar a:visited{color:black;}
      #sidebar a:active{color:black;}
      #sidebar a:hover{color:blue;}
      ul {margin-left:0;list-style-type:none;}
      li {margin: 4px 0;}
    </style>
  </head>
  <body>
    <div id="selector" style="top:0; position:fixed; float:right; background-color:#d9d9d9; width:100%;border-bottom:1px solid black;">
      &nbsp;&nbsp;<strong>Offline docs</strong>
      <a href="https://maas.io/docs">(switch to live docs)</a>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
	<a href="../ui/how-to-connect-maas-networks.html">
	  UI-only
	</a>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      <span style="background-color:white;border-top:1px solid black; border-left:1px solid black; border-right:1px solid black; border-bottom:5px solid white;">
	  &nbsp;CLI-only&nbsp;
      </span>
    </div>
    <div id="sidebar" style="float:left; width:25%;margin-top:40px; margin-left:20px">
      <strong>
	<a href="ui/maas-documentation-25.html">
	  Home
	</a>
      </strong>
      <p>
      <strong>
	<a href="ui/tutorials.html">
	  Tutorials
	</a>
      </strong>
      <ul>
	<li>
	  <a href="ui/bootstrap-maas.html">
	    Bootstrap MAAS
	  </a>
	</li>
	<li>
	  <a href="ui/try-out-the-maas-cli.html">
	    Try out the MAAS CLI
	  </a>
	</li>
	<li>
	  <a href="ui/create-a-custom-image.html">
	    Create a custom image
	  </a>
	</li>
	<li>
	  <a href="ui/get-fancy-cli-output.html">
	    Get fancy CLI output
	  </a>
	</li>
      </ul>
      <strong>
	<a href="ui/how-to-get-started-with-maas.html">
	  How to get started with MAAS
	</a>
      </strong>
      <ul>
	<li>
	  <a href="ui/how-to-do-a-fresh-install-of-maas.html">
	    Do a fresh install of MAAS
	  </a>
	</li>
	<li>
	  <a href="ui/how-to-upgrade-maas.html">
	    Upgrade MAAS
	  </a>
	</li>
	<li>
	  <a href="ui/how-to-spin-up-maas-with-ansible.html">
	    Spin up MAAS with Ansible
	  </a>
	</li>
      </ul>
      <strong>
	<a href="ui/how-to-set-up-networks.html">
	  How to set up networks
	</a>
      </strong>
      <ul>
	<li>
	  <a href="ui/how-to-connect-maas-networks.html">
	    Connect MAAS networks
	  </a>
	</li>
	<li>
	  <a href="ui/how-to-enable-dhcp.html">
	    Enable DHCP
	  </a>
	</li>
	<li>
	  <a href="ui/how-to-use-availability-zones.html">
	    Use availability zones
	  </a>
	</li>
      </ul>
      <strong>
	<a href="ui/how-to-use-images.html">
	  How to use images
	</a>
      </strong>
      <ul>
	<li>
	  <a href="ui/how-to-use-standard-images.html">
	    Use standard images
	  </a>
	</li>
	<li>
	  <a href="ui/how-to-mirror-images-locally.html">
	    Mirror images locally
	  </a>
	</li>
	<li>
	  <a href="ui/how-to-customise-images.html">
	    Customise images
	  </a>
	</li>
	<li>
	  <a href="ui/how-to-employ-vmware-images.html">
	    Employ VMWare images
	  </a>
	</li>
	<li>
	  <a href="ui/how-to-deploy-a-real-time-kernel.html">
	    Deploy a RT kernel
	  </a>
	</li>
      </ul>
      <strong>
	<a href="ui/how-to-manage-controllers.html">
	  How to manage controllers
	</a>
      </strong>
      <ul>
	<li>
	  <a href="ui/how-to-configure-controllers.html">
	    Configure controllers
	  </a>
	</li>
	<li>
	  <a href="ui/how-to-enable-high-availability.html">
	    Enable HA
	  </a>
	</li>
      </ul>
      <strong>
	<a href="ui/how-to-manage-machines.html">
	  How to manage machines
	</a>
      </strong>
      <ul>
	<li>
	  <a href="ui/how-to-make-machines-available.html">
	    Make machines available
	  </a>
	</li>
	<li>
	  <a href="ui/how-to-customise-machines.html">
	    Customise machines
	  </a>
	</li>
	<li>
	  <a href="ui/how-to-put-machines-to-work.html">
	    Put machines to work
	  </a>
	</li>
      </ul>
      <strong>
	<a href="ui/how-to-use-virtual-machines.html">
	  How to use virtual machines
	</a>
      </strong>
      <ul>
	<li>
	  <a href="ui/how-to-set-up-lxd.html">
	    Set up LXD
	  </a>
	</li>
	<li>
	  <a href="ui/how-to-manage-vm-hosts.html">
	    Manage VM hosts
	  </a>
	</li>
	<li>
	  <a href="ui/how-to-manage-virtual-machines.html">
	    Manage virtual machines
	  </a>
	</li>
      </ul>
      <strong>
	<a href="ui/how-to-label-devices.html">
	  How to label devices
	</a>
      </strong>
      <ul>
	<li>
	  <a href="ui/how-to-tag-machines.html">
	    Tag machines
	  </a>
	</li>
	<li>
	  <a href="ui/how-to-annotate-machines.html">
	    Annotate machines
	  </a>
	</li>
	<li>
	  <a href="ui/how-to-use-machine-tags.html">
	    Use machine tags
	  </a>
	</li>
	<li>
	  <a href="ui/how-to-use-controller-tags.html">
	    Use controller tags
	  </a>
	</li>
	<li>
	  <a href="ui/how-to-use-storage-tags.html">
	    Use storage tags
	  </a>
	</li>
	<li>
	  <a href="ui/how-to-use-network-tags.html">
	    Use network tags
	  </a>
	</li>
      </ul>
      <strong>
	<a href="ui/how-to-secure-maas.html">
	  How to secure MAAS
	</a>
      </strong>
      <ul>
	<li>
	  <a href="ui/how-to-improve-maas-security.html">
	    Improve MAAS security
	  </a>
	</li>
	<li>
	  <a href="ui/how-to-manage-user-accounts.html">
	    Manage user accounts
	  </a>
	</li>
	<li>
	  <a href="ui/how-to-enable-maas-native-tls.html">
	    Enable MAAS native TLS
	  </a>
	</li>
	<li>
	  <a href="ui/how-to-use-hashicorp-vault-with-maas.html">
	    Use Vault with MAAS
	  </a>
	</li>
	<li>
	  <a href="ui/how-to-set-up-an-air-gapped-maas.html">
	    Set up an air-gapped MAAS
	  </a>
	</li>
      </ul>
      <strong>
	<a href="ui/how-to-operate-maas.html">
	  How to operate MAAS
	</a>
      </strong>
      <ul>
	<li>
	  <a href="ui/how-to-find-machines.html">
	    Find machines
	  </a>
	</li>
	<li>
	  <a href="ui/how-to-back-up-maas.html">
	    Back up MAAS
	  </a>
	</li>
	<li>
	  <a href="ui/how-to-monitor-maas.html">
	    Monitor MAAS
	  </a>
	</li>
	<li>
	  <a href="ui/how-to-audit-maas.html">
	    Audit MAAS
	  </a>
	</li>
	<li>
	  <a href="ui/how-to-troubleshoot-maas.html">
	    Troubleshoot MAAS
	  </a>
	</li>
      </ul>
      <strong>
	<a href="ui/how-to-give-and-receive-help.html">
	  How to give and receive help
	</a>
      </strong>
      <ul>
	<li>
	  <a href="ui/how-to-use-our-discourse-forum.html">
	    Use our discourse forum
	  </a>
	</li>
	<li>
	  <a href="how-to-contact-us">
	    Get support↗
	  </a>
	</li>
	<li>
	  <a href="ui/how-to-request-new-features.html">
	    Request new features
	  </a>
	</li>
	<li>
	  <a href="ui/how-to-review-and-report-bugs.html">
	    Review and report bugs
	  </a>
	</li>
	<li>
	  <a href="ui/how-to-contribute-doc.html">
	    Contribute documentation
	  </a>
	</li>
      </ul>
      <strong>
	<a href="ui/general-reference.html">
	  General reference
	</a>
      </strong>
      <ul>
	<li>
	  <a href="ui/what-is-new-with-maas.html">
	    Release notes
	  </a>
	</li>
	<li>
	  <a href="ui/maas-installation-requirements.html">
	    Installation requirements
	  </a>
	</li>
	<li>
	  <a href="ui/maas-settings-reference.html">
	    MAAS settings
	  </a>
	</li>
	<li>
	  <a href="ui/https://launchpad.net/maas.html">
	    MAAS source code↗
	  </a>
	</li>
	<li>
	  <a href="ui/how-to-help-improve-the-doc.html">
	    Doc style guide
	  </a>
	</li>
	<li>
	  <a href="ui/maas-glossary.html">
	    Glossary
	  </a>
	</li>
	<li>
	  <a href="https://ubuntu.com/community/code-of-conduct">
	    Code of conduct↗
	  </a>
	</li>
      </ul>
      <strong>
	<a href="ui/api-reference.html">
	  API reference
	</a>
      </strong>
      <ul>
	<li>
	  <a href="ui/api-authentication-reference.html">
	    API authentication
	  </a>
	</li>
	<li>
	  <a href="ui/python-api-client-reference.html">
	    Python API client
	  </a>
	</li>
	<li>
	  <a href="api">
	    API documentation↗
	  </a>
	</li>
      </ul>
      <strong>
	<a href="ui/maas-scripts-reference.html">
	  Scripts reference
	</a>
      </strong>
      <ul>
	<li>
	  <a href="ui/commissioning-scripts-reference.html">
	    Commissioning scripts
	  </a>
	</li>
	<li>
	  <a href="ui/hardware-test-scripts-reference.html">
	    Hardware test scripts
	  </a>
	</li>
	<li>
	  <a href="ui/maas-terraform-reference.html">
	    Terraform
	  </a>
	</li>
      </ul>
      <strong>
	<a href="ui/maas-logs-reference.html">
	  Log reference
	</a>
      </strong>
      <ul>
	<li>
	  <a href="ui/event-logs-reference.html">
	    Event logs
	  </a>
	</li>
	<li>
	  <a href="ui/audit-event-logs-reference.html">
	    Audit event logs
	  </a>
	</li>
	<li>
	  <a href="ui/commissioning-logs-reference.html">
	    Commissioning logs
	  </a>
	</li>
	<li>
	  <a href="ui/testing-logs-reference.html">
	    Testing logs
	  </a>
	</li>
      </ul>
      <strong>
	<a href="ui/machine-parameters-reference.html">
	  Machine parameters reference
	</a>
      </strong>
      <ul>
	<li>
	  <a href="ui/power-drivers-reference.html">
	    Power drivers
	  </a>
	</li>
	<li>
	  <a href="ui/storage-layouts-reference.html">
	    Storage layouts
	  </a>
	</li>
	<li>
	  <a href="ui/device-labelling-reference.html">
	    Device labelling
	  </a>
	</li>
      </ul>
      <strong>
	<a href="ui/.html">
	  Explanation
	</a>
      </strong>
      <ul>
	<li>
	  <a href="ui/about-maas.html">
	    About MAAS
	  </a>
	</li>
	<li>
	  <a href="ui/about-networking.html">
	    About networking
	  </a>
	</li>
	<li>
	  <a href="ui/about-images.html">
	    About images
	  </a>
	</li>
	<li>
	  <a href="ui/about-controllers.html">
	    About controllers
	  </a>
	</li>
	<li>
	  <a href="ui/about-machines.html">
	    About machines
	  </a>
	</li>
	<li>
	  <a href="ui/about-virtual-machines.html">
	    About virtual machines
	  </a>
	</li>
	<li>
	  <a href="ui/about-device-labels.html">
	    About device labels
	  </a>
	</li>
	<li>
	  <a href="ui/about-maas-events.html">
	    About MAAS events
	  </a>
	</li>
	<li>
	  <a href="ui/about-maas-audit-events.html">
	    About audit events
	  </a>
	</li>
	<li>
	  <a href="ui/about-maas-logging.html">
	    About MAAS logging
	  </a>
	</li>
	<li>
	  <a href="ui/about-maas-security.html">
	    About MAAS security
	  </a>
	</li>
	<li>
	  <a href="ui/about-maas-performance.html">
	    About MAAS performance
	  </a>
	</li>
	<li>
	  <a href="ui/about-ansible.html">
	    About Ansible
	  </a>
	</li>
      </ul>
    </div>
    <div class="container" style="float:right; width:65%; margin-top:40px; margin-right:30px">
      <h1>How to connect MAAS networks</h1><!-- "How to connect MAAS networks" -->
<p>You can easily manage the basic networking elements of MAAS, including subnets, fabrics, VLANs, spaces, IP ranges, machine interfaces, and proxies.</p>
<p>This article will help you learn:</p>
<ul style="margin-left:4px; list-style-type:disc;">
<li><a href="#heading--how-to-manage-MAAS-network-elements">How to manage MAAS network elements</a></li>
<li><a href="#heading--how-to-manage-machine-interfaces">How to manage machine interfaces</a></li>
<li><a href="#heading--how-to-manage-proxies">How to manage proxies</a></li>
<li><a href="#heading--how-to-set-up-ntp">How to set up Network Time Protocol (NTP)</a></li>
</ul>
<p>Feel free to review some of the <a href="networking.html">theory</a> first.</p>
<p><a href="#heading--how-to-manage-MAAS-network-elements"><h2 id="heading--how-to-manage-MAAS-network-elements">How to manage MAAS network elements</h2></a></p>
<p>This section will show you:</p>
<ul style="margin-left:4px; list-style-type:disc;">
<li><a href="#heading--how-to-enable-network-discovery">How to enable network discovery</a></li>
<li><a href="#heading--how-to-toggle-subnet-management">How to toggle subnet management</a></li>
<li><a href="#heading--how-to-determine-fabric-id">How to determine fabric ID</a></li>
<li><a href="#heading--how-to-set-a-default-gateway">How to set a default gateway</a></li>
<li><a href="#heading--how-to-set-a-dns-server">How to set a DNS server</a></li>
<li><a href="#heading--cli-list-available-subnets">How to list available subnets</a></li>
<li><a href="#heading--cli-how-to-view-subnet-details">How to view subnet details</a></li>
<li><a href="#heading--how-to-manage-static-routes">How to manage static routes between subnets</a></li>
<li><a href="#heading--how-to-set-up-a-bridge-with-maas">How to set up a bridge with MAAS</a></li>
<li><a href="#heading--how-to-set-up-a-bridge-with-netplan">How to set up a bridge with netplan</a></li>
</ul>
<p><a href="#heading--how-to-enable-network-discovery"><h3 id="heading--how-to-enable-network-discovery">How to enable network discovery</h3></a></p>
<p>To enable network discovery, enter the following at the command line:</p>
<pre><code class="language-nohighlight">maas $PROFILE maas set-config name=network_discovery value=&quot;enabled&quot;
</code></pre>
<p>If successful, you should receive output similar to:</p>
<pre><code class="language-nohighlight">Success.
Machine-readable output follows:
OK
</code></pre>
<p>Network discovery can be disabled or re-enabled at any time with this CLI command.</p>
<p><a href="#heading--how-to-toggle-subnet-management"><h3 id="heading--how-to-toggle-subnet-management">How to toggle subnet management</h3></a></p>
<p>To enable or disable subnet management:</p>
<pre><code class="language-nohighlight">maas $PROFILE subnet update $SUBNET_CIDR managed=false|true
</code></pre>
<p>For example, to disable subnet management:</p>
<pre><code class="language-nohighlight">maas $PROFILE subnet update 192.168.1.0/24 managed=false
</code></pre>
<p>You can use the subnets ID in place of the CIDR address.</p>
<p><a href="#heading--how-to-determine-fabric-id"><h3 id="heading--how-to-determine-fabric-id">How to determine fabric ID</h3></a></p>
<p>To determine a fabric ID based on a subnet address:</p>
<pre><code class="language-nohighlight">FABRIC_ID=$(maas $PROFILE subnet read $SUBNET_CIDR \
    | grep fabric | cut -d ' ' -f 10 | cut -d '&quot;' -f 2)
</code></pre>
<p>This may come in handy when you need a fabric ID for other CLI calls.</p>
<p><a href="#heading--how-to-set-a-default-gateway"><h3 id="heading--how-to-set-a-default-gateway">How to set a default gateway</h3></a></p>
<p>To set the default gateway for a subnet:</p>
<pre><code class="language-nohighlight">maas $PROFILE subnet update $SUBNET_CIDR gateway_ip=$MY_GATEWAY
</code></pre>
<p><a href="#heading--how-to-set-a-dns-server"><h3 id="heading--how-to-set-a-dns-server">How to set a DNS server</h3></a></p>
<p>To set the DNS server for a subnet:</p>
<pre><code class="language-nohighlight">maas $PROFILE subnet update $SUBNET_CIDR dns_servers=$MY_NAME SERVER
</code></pre>
<p><a href="#heading--cli-list-available-subnets"><h3 id="heading--cli-list-available-subnets">How to list available subnets</h3></a></p>
<p>To view the list of available subnets, enter the following command:</p>
<pre><code class="language-nohighlight">maas admin subnets read | \
jq -r '([&quot;FABRIC&quot;, &quot;VLAN&quot;, &quot;DHCP&quot;, &quot;SUBNET&quot;]
| (., map(length*&quot;-&quot;))),
(.[] | [.vlan.fabric, .vlan.name, .vlan.dhcp_on, .cidr])
| @tsv' \
| column -t
</code></pre>
<p><a href="#heading--cli-how-to-view-subnet-details"><h3 id="heading--cli-how-to-view-subnet-details">How to view subnet details</h3></a></p>
<p>View the details of an individual subnet with the command:</p>
<pre><code class="language-nohighlight">maas $PROFILE subnet read $SUBNET_ID \
| jq -r '([&quot;NAME&quot;,&quot;CIDR&quot;,&quot;GATEWAY&quot;,&quot;DNS&quot;,&quot;DISCOVERY&quot;,&quot;FABRIC&quot;,&quot;VLAN&quot;]
| (., map(length*&quot;-&quot;))), ([.name,.cidr,.gateway_ip // &quot;-&quot;, .allow_dns,.active_discovery,.vlan.name,.vlan.fabric]) | @tsv' | column -t
</code></pre>
<p>Look up the subnet ID like this:</p>
<pre><code class="language-nohighlight">maas $PROFILE subnets read \
| jq -r '([&quot;NAME&quot;, &quot;SUBNET_ID&quot;]
| (., map(length*&quot;-&quot;))), (.[] | [.name, .id]) | @tsv' \
| column -t | grep $SUBNET_NAME
</code></pre>
<p>For example, using the &ldquo;admin&rdquo; profile with a subnet name containing &ldquo;192.168.123,&rdquo; find the subnet ID with this command:</p>
<pre><code class="language-nohighlight">maas admin subnets read \
| jq -r '([&quot;NAME&quot;, &quot;SUBNET_ID&quot;]
| (., map(length*&quot;-&quot;))), (.[] | [.name, .id]) | @tsv' \
| column -t | grep 192.168.123
</code></pre>
<p><a href="#heading--how-to-manage-static-routes"><h3 id="heading--how-to-manage-static-routes">How to manage static routes between subnets</h3></a></p>
<p>To create a static route between two subnets, use the following command:</p>
<pre><code class="language-nohighlight">maas admin static-routes create source=$SOURCE_SUBNET destination=$DEST_SUBNET \
gateway_ip=$GATEWAY_IP
</code></pre>
<p><a href="#heading--how-to-set-up-a-bridge-with-maas"><h3 id="heading--how-to-set-up-a-bridge-with-maas">How to set up a bridge with MAAS</h3></a></p>
<p>You can use the MAAS CLI/API to configure a bridge via the following procedure:</p>
<ol>
<li>
<p>Select the interface on which you wish to configure the bridge. This example uses the boot interface, since the boot interface must be connected to a MAAS controlled network &ndash; but any interface is allowed:</p>
<pre><code>INTERFACE_ID=$(maas $PROFILE machine read $SYSTEM_ID | jq .boot_interface.id)
</code></pre>
</li>
<li>
<p>Create the bridge:</p>
<pre><code> BRIDGE_ID=$(maas $PROFILE interfaces create-bridge $SYSTEM_ID name=br0 parent=$INTERFACE_ID | jq .id)
</code></pre>
</li>
<li>
<p>Select the subnet where you want the bridge (this should be a MAAS controlled subnet):</p>
<pre><code>SUBNET_ID=$(maas $PROFILE subnets read | jq -r '.[] | select(.cidr == "10.0.0.0/24" and .managed == true).id')
</code></pre>
</li>
<li>
<p>Connect the bridge to the subnet:</p>
<pre><code>  maas $PROFILE interface link-subnet $SYSTEM_ID $BRIDGE_ID subnet=$SUBNET_ID mode="STATIC" ip_address="10.0.0.101"
</code></pre>
</li>
</ol>
<p><a href="#heading--how-to-set-up-a-bridge-with-netplan"><h3 id="heading--how-to-set-up-a-bridge-with-netplan">How to set up a bridge with netplan</h3></a></p>
<p>To use netplan to configure a bridge:</p>
<ol>
<li>
<p>Open your netplan configuration file.  This should be in <code>/etc/netplan</code>.  It could be called <code>50-cloud-init.yaml</code>, <code>netplan.yaml</code>, or something else.  </p>
</li>
<li>
<p>Modify the file to add a bridge, using the following example as a guide:</p>
</li>
</ol>
<pre><code class="language-nohighlight">network:
    bridges:
        br0:
            addresses:
            - 10.0.0.101/24
            gateway4: 10.0.0.1
            interfaces:
            - enp1s0
            mac address: 52:54:00:39:9d:f9
            mtu: 1500
            name servers:
                addresses:
                - 10.0.0.2
                search:
                - maas
            parameters:
                forward-delay: 15
                stp: false
    Ethernet's:
        enp1s0:
            match:
                mac address: 52:54:00:39:9d:f9
            mtu: 1500
            set-name: enp1s0
        enp2s0:
            match:
                mac address: 52:54:00:df:87:ac
            mtu: 1500
            set-name: enp2s0
        enp3s0:
            match:
                mac address: 52:54:00:a7:ac:46
            mtu: 1500
            set-name: enp3s0
    version: 2
</code></pre>
<ol>
<li>Apply the new configuration with <code>netplan apply</code>.</li>
</ol>
<p><a href="#heading--how-to-manage-machine-interfaces"><h2 id="heading--how-to-manage-machine-interfaces">How to manage machine interfaces</h2></a></p>
<p>This section will explain the following procedures related to machine interfaces:</p>
<ul style="margin-left:4px; list-style-type:disc;">
<li><a href="#heading--how-to-edit-interfaces&quot;">How to edit machine interfaces</a></li>
<li><a href="#heading--bond-interfaces">How to create a bond interface</a></li>
<li><a href="#heading--bridge-interfaces">How to create a bridge interface</a></li>
<li><a href="#heading--delete-an-interface">How to delete an interface</a></li>
<li><a href="#heading--assign-a-network-interface-to-a-fabric">How to assign a network interface to a fabric</a></li>
<li><a href="#heading--interface-identifiers">How to discover interface identifiers</a></li>
<li><a href="#heading--create-a-vlan-interface">How to create a VLAN interface</a></li>
<li><a href="#heading--delete-a-vlan-interface">How to delete a VLAN interface</a></li>
</ul>
<p><a href="#heading--how-to-edit-interfaces"><h3 id="heading--how-to-edit-interfaces">How to edit machine interfaces</h3></a></p>
<p>To edit the IP assignment mode of a network interface, perform the following steps:</p>
<ol>
<li>Find the interface ID and subnet link ID with the command:</li>
</ol>
<pre><code class="language-bash">maas $PROFILE node read $SYSTEM_ID
</code></pre>
<ol>
<li>Unlink the old interface:</li>
</ol>
<pre><code class="language-bash">maas $PROFILE interface unlink-subnet $SYSTEM_ID $INTERFACE_ID id=$SUBNET_LINK_ID
</code></pre>
<ol>
<li>Link the new interface:</li>
</ol>
<pre><code class="language-bash">maas $PROFILE interface link-subnet $SYSTEM_ID $INTERFACE_ID mode=$IP_MODE subnet=$SUBNET_CIDR [$OPTIONS]
</code></pre>
<p>See <a href="maas-glossary.html#heading--ip-ranges">the glossary</a> for the definitions of reserved range types.</p>
<p><a href="#heading--bond-interfaces"><h3 id="heading--bond-interfaces">How to create a bond interface</h3></a></p>
<p>To create a bond, execute the following command:</p>
<pre><code>maas $PROFILE interfaces create-bond $SYSTEM_ID name=$BOND_NAME \
parents=$IFACE1_ID mac_address=$MAC_ADDR \ 
parents=$IFACE2_ID bond_mode=$BOND_MODE \
bond_updelay=$BOND_UP bond_downdelay=$BOND_DOWN mtu=$MTU
</code></pre>
<p>Note that: </p>
<ul style="margin-left:4px; list-style-type:disc;">
<li>
<p>The <code>parents</code> parameters define which interfaces form the aggregate interface.</p>
</li>
<li>
<p>The <code>bond_updelay</code> and <code>bond_downdelay</code> parameters specify the number of milliseconds to wait before either enabling or disabling a follower after a failure has been detected.</p>
</li>
<li>
<p>There are a wide range of bond parameters you can choose when creating a bond:</p>
</li>
</ul>
<table>
<thead>
<tr>
<th align="left">Parameter</th>
<th align="left">Type and description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>mac_address</code></td>
<td align="left">Optional string.  MAC address of the interface.</td>
</tr>
<tr>
<td align="left"><code>tags</code></td>
<td align="left">Optional string.  Tags for the interface.</td>
</tr>
<tr>
<td align="left"><code>vlan</code></td>
<td align="left">Optional string.  VLAN the interface is connected to. If not provided then the interface is considered disconnected.</td>
</tr>
<tr>
<td align="left"><code>parents</code></td>
<td align="left">Required integer.  Parent interface ids that make this bond.</td>
</tr>
<tr>
<td align="left"><code>bond_miimon</code></td>
<td align="left">Optional integer.  The link monitoring frequency in milliseconds. (Default: 100).</td>
</tr>
<tr>
<td align="left"><code>bond_downdelay</code></td>
<td align="left">Optional integer.  Specifies the time, in milliseconds, to wait before disabling a follower after a link failure has been detected.</td>
</tr>
<tr>
<td align="left"><code>bond_updelay</code></td>
<td align="left">Optional integer.  Specifies the time, in milliseconds, to wait before enabling a follower after a link recovery has been detected.</td>
</tr>
<tr>
<td align="left"><code>bond_lacp_rate</code></td>
<td align="left">Optional string.  Option specifying the rate at which to ask the link partner to transmit LACPDU packets in 802.3ad mode. Available options are <code>fast</code> or <code>slow</code>. (Default: <code>slow</code>).</td>
</tr>
<tr>
<td align="left"><code>bond_xmit_hash_policy</code></td>
<td align="left">Optional string.  The transmit hash policy to use for follower selection in balance-xor, 802.3ad, and tlb modes. Possible values are: <code>layer2</code>, <code>layer2+3</code>, <code>layer3+4</code>, <code>encap2+3</code>, <code>encap3+4</code>. (Default: <code>layer2</code>)</td>
</tr>
<tr>
<td align="left"><code>bond_num_grat_arp</code></td>
<td align="left">Optional integer.  The number of peer notifications (IPv4 ARP or IPv6 Neighbour Advertisements) to be issued after a failover. (Default: 1)</td>
</tr>
<tr>
<td align="left"><code>mtu</code></td>
<td align="left">Optional integer.  Maximum transmission unit.</td>
</tr>
<tr>
<td align="left"><code>accept_ra</code></td>
<td align="left">Optional Boolean.  Accept router advertisements. (IPv6 only)</td>
</tr>
<tr>
<td align="left"><code>autoconf</code></td>
<td align="left">Optional Boolean.  Perform stateless autoconfiguration. (IPv6 only)</td>
</tr>
<tr>
<td align="left"><code>bond_mode</code></td>
<td align="left">Optional string.  The operating mode of the bond.  (Default: active-backup).</td>
</tr>
</tbody>
</table>
<ul style="margin-left:4px; list-style-type:disc;">
<li>Supported bonding modes include:</li>
</ul>
<table>
<thead>
<tr>
<th align="left">Mode</th>
<th align="left">Behaviour</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>balance-rr</code>:</td>
<td align="left">Transmit packets in sequential order from the first available follower through the last. This mode provides load balancing and fault tolerance.</td>
</tr>
<tr>
<td align="left"><code>active-backup</code></td>
<td align="left">Only one follower in the bond is active. A different follower becomes active if, and only if, the active follower fails. The bond&rsquo;s MAC address is externally visible on only one port (network adaptor) to avoid confusing the switch.</td>
</tr>
<tr>
<td align="left"><code>balance-xor</code></td>
<td align="left">Transmit based on the selected transmit hash policy. The default policy is a simple [(source MAC address XOR&rsquo;d with destination MAC address XOR packet type ID) modulo follower count].</td>
</tr>
<tr>
<td align="left"><code>broadcast</code></td>
<td align="left">Transmits everything on all follower interfaces. This mode provides fault tolerance.</td>
</tr>
<tr>
<td align="left"><code>802.3ad</code></td>
<td align="left">IEEE 802.3ad dynamic link aggregation. Creates aggregation groups that share the same speed and duplex settings. Uses all followers in the active aggregator according to the 802.3ad specification.</td>
</tr>
<tr>
<td align="left"><code>balance-tlb</code></td>
<td align="left">Adaptive transmit load balancing: channel bonding that does not require any special switch support.</td>
</tr>
<tr>
<td align="left"><code>balance-alb</code></td>
<td align="left">Adaptive load balancing: includes balance-tlb plus receive load balancing (rlb) for IPV4 traffic, and does not require any special switch support. The receive load balancing is achieved by ARP negotiation.</td>
</tr>
</tbody>
</table>
<p><a href="#heading--bridge-interfaces"><h3 id="heading--bridge-interfaces">How to create a bridge interface</h3></a></p>
<p>Please use the UI interface to create a bridge interface.  Select the &ldquo;UI&rdquo; dropdown above to see how.</p>
<p><a href="#heading--delete-an-interface"><h3 id="heading--delete-an-interface">How to delete an interface</h3></a></p>
<p>To create a bridge interface:</p>
<pre><code>maas $PROFILE interfaces create-bridge $SYSTEM_ID name=$BRIDGE_NAME \
parent=$IFACE_ID
</code></pre>
<p>Use <code>parent</code> to define the primary interface used for the bridge:</p>
<pre><code>maas admin interfaces create-bridge 4efwb4 name=bridged0 parent=4
</code></pre>
<p>The following parameters may be applied when creating a bridge:</p>
<ul style="margin-left:4px; list-style-type:disc;">
<li>
<p><code>name</code>: Optional string.  Name of the interface.</p>
</li>
<li>
<p><code>mac_address</code>: Optional string.  MAC address of the interface.</p>
</li>
<li>
<p><code>tags</code>: Optional string.  Tags for the interface.</p>
</li>
<li>
<p><code>vlan</code>: Optional string.  VLAN the interface is connected to.</p>
</li>
<li>
<p><code>parent</code>: Optional integer.  Parent interface id for this bridge interface.</p>
</li>
<li>
<p><code>bridge_type</code>: Optional string.  The type of bridge to create. Possible values are: <code>standard</code>, <code>ovs</code>.</p>
</li>
<li>
<p><code>bridge_stp</code>: Optional Boolean.  Turn spanning tree protocol on or off. (Default: False).</p>
</li>
<li>
<p><code>bridge_fd</code>: Optional integer.  Set bridge forward delay to time seconds. (Default: 15).</p>
</li>
<li>
<p><code>mtu</code>: Optional integer.  Maximum transmission unit.</p>
</li>
<li>
<p><code>accept_ra</code>: Optional Boolean.  Accept router advertisements. (IPv6 only)</p>
</li>
<li>
<p><code>autoconf</code>: Optional Boolean.  Perform stateless autoconfiguration. (IPv6 only)</p>
</li>
</ul>
<p>The &ldquo;delete&rdquo; command can be used to delete a bridge interface, a bond interface or a physical interface:</p>
<pre><code>maas $PROFILE interface delete $SYSTEM_ID $IFACE_ID
</code></pre>
<p>For example:</p>
<pre><code>maas admin interface delete 4efwb4 15
</code></pre>
<p>The following is output after the successful deletion of an interface:</p>
<pre><code>Success.
Machine-readable output follows:
</code></pre>
<p>Note that while the label is presented, there is no machine-readable output expected after the successful execution of the delete command.</p>
<p><a href="#heading--assign-a-network-interface-to-a-fabric"><h3 id="heading--assign-a-network-interface-to-a-fabric">How to assign a network interface to a fabric</h3></a></p>
<p>This task is made easier with the aid of the <code>jq</code> utility. It filters the <code>maas</code> command (JSON formatted) output and prints it in the desired way, which allows you to view and compare data quickly. Go ahead and install it:</p>
<pre><code class="language-bash">sudo apt install jq
</code></pre>
<p>In summary, MAAS assigns an interface to a fabric by assigning it to a VLAN. First, we need to gather various bits of data.</p>
<p>List some information on all machines:</p>
<pre><code class="language-bash">maas $PROFILE machines read | jq &quot;.[] | \
    {hostname:.hostname, system_id: .system_id, status:.status}&quot; --compact-output
</code></pre>
<p>Example output:</p>
<pre><code class="language-no-highlight">{&quot;hostname&quot;:&quot;machine1&quot;,&quot;system_id&quot;:&quot;dfgnnd&quot;,&quot;status&quot;:4}
{&quot;hostname&quot;:&quot;machine2&quot;,&quot;system_id&quot;:&quot;bkaf6e&quot;,&quot;status&quot;:6}
{&quot;hostname&quot;:&quot;machine4&quot;,&quot;system_id&quot;:&quot;63wqky&quot;,&quot;status&quot;:6}
{&quot;hostname&quot;:&quot;machine3&quot;,&quot;system_id&quot;:&quot;qwkmar&quot;,&quot;status&quot;:4}
</code></pre>
<p><strong>NOTE:</strong> 
You can only edit an interface when the corresponding machine has a status of &lsquo;Ready&rsquo;. This state is numerically denoted by the integer &lsquo;4&rsquo;.</p>
<p>List some information for all interfaces on the machine in question (identified by its system id &lsquo;dfgnnd&rsquo;):</p>
<pre><code class="language-bash">maas $PROFILE interfaces read dfgnnd | jq &quot;.[] | \
    {id:.id, name:.name, mac:.mac_address, vid:.vlan.vid, fabric:.vlan.fabric}&quot; --compact-output
</code></pre>
<p>Example output:</p>
<pre><code class="language-no-highlight">{&quot;id&quot;:8,&quot;name&quot;:&quot;eth0&quot;,&quot;mac&quot;:&quot;52:54:00:01:01:01&quot;,&quot;vid&quot;:0,&quot;fabric&quot;:&quot;fabric-1&quot;}
{&quot;id&quot;:9,&quot;name&quot;:&quot;eth1&quot;,&quot;mac&quot;:&quot;52:54:00:01:01:02&quot;,&quot;vid&quot;:null,&quot;fabric&quot;:null}
</code></pre>
<p>List some information for all fabrics:</p>
<pre><code class="language-bash">maas $PROFILE fabrics read | jq &quot;.[] | \
    {name:.name, vlans:.vlans[] | {id:.id, vid:.vid}}&quot; --compact-output
</code></pre>
<p>Example output:</p>
<pre><code class="language-no-highlight">{&quot;name&quot;:&quot;fabric-0&quot;,&quot;vlans&quot;:{&quot;id&quot;:5001,&quot;vid&quot;:0}}
{&quot;name&quot;:&quot;fabric-1&quot;,&quot;vlans&quot;:{&quot;id&quot;:5002,&quot;vid&quot;:0}}
{&quot;name&quot;:&quot;fabric-2&quot;,&quot;vlans&quot;:{&quot;id&quot;:5003,&quot;vid&quot;:0}}
</code></pre>
<p>This example will show how to move interface &lsquo;8&rsquo; (on machine &lsquo;dfgnnd&rsquo;) from &lsquo;fabric-1&rsquo; to &lsquo;fabric-0&rsquo;. Based on the gathered information, this will consist of changing the interface&rsquo;s VLAN from &lsquo;5002&rsquo; to &lsquo;5001&rsquo;:</p>
<pre><code class="language-bash">maas $PROFILE interface update dfgnnd 8 vlan=5001 &gt;/dev/null
</code></pre>
<p>Verify the operation by relisting information for the machine&rsquo;s interface:</p>
<pre><code class="language-bash">maas $PROFILE interfaces read dfgnnd | jq &quot;.[] | \
    {id:.id, name:.name, mac:.mac_address, vid:.vlan.vid, fabric:.vlan.fabric}&quot; --compact-output
</code></pre>
<p>The output shows that the interface is now on fabric-0:</p>
<pre><code class="language-no-highlight">{&quot;id&quot;:8,&quot;name&quot;:&quot;eth0&quot;,&quot;mac&quot;:&quot;52:54:00:01:01:01&quot;,&quot;vid&quot;:0,&quot;fabric&quot;:&quot;fabric-0&quot;}
{&quot;id&quot;:9,&quot;name&quot;:&quot;eth1&quot;,&quot;mac&quot;:&quot;52:54:00:01:01:02&quot;,&quot;vid&quot;:null,&quot;fabric&quot;:null}
</code></pre>
<p><a href="#heading--interface-identifiers"><h3 id="heading--interface-identifiers">How to discover interface identifiers</h3></a></p>
<p>The MAAS CLI uses a numeric interface identifier for many interface operations. Use the following command to retrieve the identifier(s):</p>
<pre><code class="language-bash">maas $PROFILE interfaces read $SYSTEM_ID
</code></pre>
<p>Look for either id or the number at the end of an interface&rsquo;s resource URI, such as <strong>15</strong> in the following example output:</p>
<pre><code class="language-json">&quot;id&quot;: 15,
&quot;mac_address&quot;: &quot;52:54:00:55:06:40&quot;,
...
&quot;name&quot;: &quot;ens9&quot;,
...
&quot;resource_uri&quot;: &quot;/MAAS/api/2.0/nodes/4efwb4/interfaces/15/&quot;
</code></pre>
<p><a href="#heading--create-a-vlan-interface"><h3 id="heading--create-a-vlan-interface">How to create a VLAN interface</h3></a></p>
<p>To create a VLAN interface, use the following syntax:</p>
<pre><code class="language-bash">maas $PROFILE vlans create $FABRIC_ID name=$NAME vid=$VLAN_ID
</code></pre>
<p>For example, the following command creates a VLAN called &lsquo;Storage network:</p>
<pre><code class="language-bash">maas admin vlans create 0 name=&quot;Storage network&quot; vid=100
</code></pre>
<p>The above command generates the following output:</p>
<pre><code class="language-no-output">Success.
Machine-readable output follows:
{
    &quot;vid&quot;: 100,
    &quot;mtu&quot;: 1500,
    &quot;dhcp_on&quot;: false,
    &quot;external_dhcp&quot;: null,
    &quot;relay_vlan&quot;: null,
    &quot;name&quot;: &quot;Storage network&quot;,
    &quot;space&quot;: &quot;undefined&quot;,
    &quot;fabric&quot;: &quot;fabric-0&quot;,
    &quot;id&quot;: 5004,
    &quot;primary_rack&quot;: null,
    &quot;fabric_id&quot;: 0,
    &quot;secondary_rack&quot;: null,
    &quot;resource_uri&quot;: &quot;/MAAS/api/2.0/vlans/5004/&quot;
}
</code></pre>
<p>Be aware that the $VLAN_ID parameter does not indicate a VLAN ID that corresponds to the VLAN tag. You must first create the VLAN and then associate it with the interface:</p>
<pre><code class="language-bash">maas $PROFILE interfaces create-vlan $SYSTEM_ID vlan=$OUTPUT_VLAN_ID \
parent=$IFACE_ID
</code></pre>
<p><strong>NOTE:</strong> 
<strong>OUTPUT_VLAN_ID</strong> corresponds to the id value output when MAAS created the VLAN.</p>
<p>The following example contains values that correspond to the output above:</p>
<pre><code class="language-bash">maas admin interfaces create-vlan 4efwb4 vlan=5004 parent=4
</code></pre>
<p>The above command generates the following output:</p>
<pre><code class="language-json">Success.
Machine-readable output follows:
{
    &quot;tags&quot;: [],
    &quot;type&quot;: &quot;vlan&quot;,
    &quot;enabled&quot;: true,
    &quot;system_id&quot;: &quot;4efwb4&quot;,
    &quot;id&quot;: 21,
    &quot;children&quot;: [],
    &quot;mac_address&quot;: &quot;52:54:00:eb:f2:29&quot;,
    &quot;params&quot;: {},
    &quot;vlan&quot;: {
        &quot;vid&quot;: 100,
        &quot;mtu&quot;: 1500,
        &quot;dhcp_on&quot;: false,
        &quot;external_dhcp&quot;: null,
        &quot;relay_vlan&quot;: null,
        &quot;id&quot;: 5004,
        &quot;secondary_rack&quot;: null,
        &quot;fabric_id&quot;: 0,
        &quot;space&quot;: &quot;undefined&quot;,
        &quot;fabric&quot;: &quot;fabric-0&quot;,
        &quot;name&quot;: &quot;Storage network&quot;,
        &quot;primary_rack&quot;: null,
        &quot;resource_uri&quot;: &quot;/MAAS/api/2.0/vlans/5004/&quot;
    },
    &quot;parents&quot;: [
        &quot;ens3&quot;
    ],
    &quot;effective_mtu&quot;: 1500,
    &quot;links&quot;: [
        {
            &quot;id&quot;: 55,
            &quot;mode&quot;: &quot;link_up&quot;
        }
    ],
    &quot;discovered&quot;: null,
    &quot;name&quot;: &quot;ens3.100&quot;,
    &quot;resource_uri&quot;: &quot;/MAAS/api/2.0/nodes/4efwb4/interfaces/21/&quot;
}
</code></pre>
<p><a href="#heading--delete-a-vlan-interface"><h3 id="heading--delete-a-vlan-interface">How to delete a VLAN interface</h3></a></p>
<p>The following command outlines the syntax required to delete a VLAN interface from the command line:</p>
<pre><code class="language-bash">maas $PROFILE vlan delete $FABRIC__ID $VLAN_ID
</code></pre>
<p>Using the values from previous examples, you executed this step as follows:</p>
<pre><code class="language-bash">maas admin vlan delete 0 100
</code></pre>
<p><a href="#heading--how-to-manage-proxies"><h2 id="heading--how-to-manage-proxies">How to manage proxies</h2></a></p>
<p>MAAS provides a way for its managed machines to use a proxy server when they need to access HTTP/HTTPS-based resources, such as the Ubuntu package archive.</p>
<p>There are three possible options:</p>
<ol>
<li>internal proxy (default)</li>
<li>external proxy</li>
<li>no proxy</li>
</ol>
<p>Configuring a proxy with MAAS consists of enabling/disabling one of the above three options and enabling/disabling proxying on a specific subnet. This article will help you learn:</p>
<ul style="margin-left:4px; list-style-type:disc;">
<li><a href="#heading--internal-proxy-maas-proxy">About the MAAS internal proxy</a></li>
<li><a href="#heading--configure-proxy">How to create an external proxy</a></li>
</ul>
<p><a href="#heading--configure-proxy"><h3 id="heading--configure-proxy">How to create an external proxy</h3></a></p>
<p>Enabling and disabling proxying, in general, is done via a Boolean option (&lsquo;true&rsquo; or &lsquo;false&rsquo;). The following command will disable proxying completely:</p>
<pre><code class="language-bash">maas $PROFILE maas set-config name=enable_http_proxy value=false
</code></pre>
<p>To set an external proxy, ensure proxying is enabled (see above) and then define it:</p>
<pre><code class="language-bash">maas $PROFILE maas set-config name=http_proxy value=$EXTERNAL_PROXY
</code></pre>
<p>For example,</p>
<pre><code class="language-bash">maas $PROFILE maas set-config name=enable_http_proxy value=true
maas $PROFILE maas set-config name=http_proxy value=http://squid.example.com:3128/
</code></pre>
<p>Enabling and disabling proxying per subnet is done via a Boolean option (&lsquo;true&rsquo; or &lsquo;false&rsquo;). Here is how you can disable proxying on a per-subnet basis:</p>
<pre><code class="language-bash">maas $PROFILE subnet update $SUBNET_CIDR allow_proxy=false
</code></pre>
<p>For example,</p>
<pre><code class="language-bash">maas $PROFILE subnet update 192.168.0.0/22 allow_proxy=false
</code></pre>
<p><strong>NOTE</strong> that the proxy service will still be running.</p>
<p><a href="#heading--how-to-set-up-ntp"><h2 id="heading--how-to-set-up-ntp">How to set up Network Time Protocol (NTP)</h2></a></p>
<p>MAAS provides managed NTP services (with <a href="https://chrony.tuxfamily.org/">Chrony</a><code>↗</code>) for all region and rack controllers. This arrangement allows MAAS to both keep its controllers synchronised, and keep deployed machines synchronised as well. You can configure NTP on the &lsquo;Network services&rsquo; tab of the &lsquo;Settings&rsquo; page. </p>
<p>The region controller configures the NTP service to keep its time synchronised from one or more external sources. By default, the MAAS region controller uses <code>ntp.ubuntu.com</code>. Rack controllers also configure the NTP service, synchronising their time with the region controllers.  Rack controllers also configure DHCP with the correct NTP information, so that the DHCP servers can manage the NTP clients for the rack. Any machine on the network that obtains a DHCP lease from MAAS will benefit from NTP support.</p>
<p><a href="#heading--setting-ntp-server"><h2 id="heading--setting-ntp-server">Setting an external NTP server</h2></a></p>
<p>External sites, such as an existing NTP infrastructure, can be used directly as a time source for both rack controllers and machines.</p>
<p>You can specify an external NTP server with two successive commands:</p>
<pre><code>maas $PROFILE maas set-config name=ntp_servers value=$NTP_IP_ADDRESS
</code></pre>
<p>followed by:</p>
<pre><code>maas admin maas set-config name=ntp_external_only value=true
</code></pre>
    </div>
  </body>
</html>