<!DOCTYPE html>
    <html>
    <body>
    <div class="container">
    <h1>API authentication reference</h1><!-- "API authentication reference" -->
<p>The MAAS API uses <a href="http://en.wikipedia.org/wiki/OAuth">OAuth</a> as its authentication mechanism. This isn&rsquo;t third-party (3-legged) OAuth, so the process used is what&rsquo;s commonly referred to as 0-legged OAuth: the consumer accesses protected resources by submitting OAuth signed requests.</p>
<p>Note that some API endpoints support unauthenticated requests (i.e. anonymous access). This article will help you learn:</p>
<ul style="margin-left:4px; list-style-type:disc;">
<li><a href="#heading--python">How to perform authenticated requests in Python</a></li>
<li><a href="#heading--ruby">How to perform authenticated requests in Ruby</a></li>
</ul>
<p>Here are two examples on how to perform an authenticated GET request to retrieve the list of nodes. The &lt;consumer_key&gt;, &lt;consumer_token&gt;, &lt;secret&gt; tokens are the three elements that compose the API key (API key = &lsquo;&lt;consumer_key&gt;:&lt;consumer_token&gt;:&lt;secret&gt;&lsquo;).</p>
<p><a href="#heading--python"><h2 id="heading--python">How to perform authenticated requests in Python</h2></a></p>
<p>Note: the below example uses <a href="https://fades.readthedocs.io/">fades</a>, but you can also install the <code>requests_oauthlib</code> (<a href="https://pypi.org/project/requests-oauthlib/">pypi link</a>) and <code>oauthlib</code> (<a href="https://pypi.org/project/oauthlib/">pypi link</a>) packages with <code>pip</code>. Replace <code>&lt;MAAS_SERVER_IP&gt;</code> with your server&rsquo;s IP address, and <code>&lt;API-KEY&gt;</code> with your API key.</p>
<pre><code class="language-python">from oauthlib.oauth1 import SIGNATURE_PLAINTEXT # fades
from requests_oauthlib import OAuth1Session # fades

MAAS_HOST = &quot;http://&lt;MAAS_SERVER_IP&gt;:5240/MAAS&quot;
CONSUMER_KEY, CONSUMER_TOKEN, SECRET = &quot;&lt;API-KEY&gt;&quot;.split(&quot;:&quot;)

maas = OAuth1Session(CONSUMER_KEY, resource_owner_key=CONSUMER_TOKEN, resource_owner_secret=SECRET, signature_method=SIGNATURE_PLAINTEXT)

nodes = maas.get(f&quot;{MAAS_HOST}/api/2.0/machines/&quot;, params={&quot;op&quot;: &quot;list_allocated&quot;})
nodes.raise_for_status()

print(nodes.json())
</code></pre>
<p><a href="#heading--ruby"><h2 id="heading--ruby">How to perform authenticated requests in Ruby</h2></a></p>
<pre><code class="language-ruby">require 'oauth'
require 'oauth/signature/plaintext'

def perform_API_request(site, uri, key, secret, consumer_key)
    consumer = OAuth::Consumer.new(
        consumer_key, &quot;&quot;,
        { :site =&gt; &quot;http://localhost:5240/MAAS/api/2.0&quot;,
          :scheme =&gt; :header, :signature_method =&gt; &quot;PLAINTEXT&quot;})
    access_token = OAuth::AccessToken.new(consumer, key, secret)
    return access_token.request(:get, &quot;/nodes/?op=list&quot;)
end

# API key = &quot;&lt;consumer_key&gt;:&lt;key&gt;:&lt;secret&gt;&quot;
response = perform_API_request(
     &quot;http://server:5240/MAAS/api/2.0&quot;, &quot;/nodes/?op=list&quot;, &quot;&lt;key&gt;&quot;, &quot;&lt;secret&gt;&quot;,
     &quot;consumer_key&gt;&quot;)
</code></pre>
    </div>
    </body>
    </html>
    