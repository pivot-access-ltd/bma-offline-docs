<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" type="text/css" href="css/stylesheet.css" />
    <style>
      #selector a:link{color:black;}
      #selector a:visited{color:black;}
      #selector a:active{color:black;}
      #selector a:hover{color:blue;}
      #sidebar a:link{color:black;}
      #sidebar a:visited{color:black;}
      #sidebar a:active{color:black;}
      #sidebar a:hover{color:blue;}
      ul {margin-left:0;list-style-type:none;}
      li {margin: 4px 0;}
    </style>
  </head>
  <body>
    <div id="selector" style="top:0; position:fixed; float:right; background-color:#d9d9d9; width:100%;border-bottom:1px solid black;">
      &nbsp;&nbsp;<strong>Offline docs</strong>
      <a href="https://maas.io/docs">(switch to live docs)</a>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
	<a href="../ui/how-to-manage-vm-hosts.html">
	  UI-only
	</a>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      <span style="background-color:white;border-top:1px solid black; border-left:1px solid black; border-right:1px solid black; border-bottom:5px solid white;">
	  &nbsp;CLI-only&nbsp;
      </span>
    </div>
    <div id="sidebar" style="float:left; width:25%;margin-top:40px; margin-left:20px">
      <strong>
	<a href="maas-documentation.html">
	  Home
	</a>
      </strong>
      <p/>
      <strong>
	  Tutorials
      </strong>
      <ul>
	<li>
	  <a href="get-started-with-maas.html">
	    Get started with MAAS
	  </a>
	</li>
	<li>
	  <a href="maas-cli-tutorial.html">
	    Try out the MAAS CLI
	  </a>
	</li>
	<li>
	  <a href="using-jq-with-the-maas-cli.html">
	    Using jq with the MAAS CLI
	  </a>
	</li>
      </ul>
      <strong>
	  How to get MAAS running
      </strong>
      <ul>
	<li>
	  <a href="how-to-install-maas.html">
	    Install MAAS
	  </a>
	</li>
	<li>
	  <a href="how-to-troubleshoot-maas.html">
	    Troubleshooting
	  </a>
	</li>
      </ul>
      <strong>
	  How to configure networking
      </strong>
      <ul>
	<li>
	  <a href="how-to-manage-networks.html">
	    Manage networks
	  </a>
	</li>
	<li>
	  <a href="how-to-manage-ip-addresses.html">
	    Manage IP addresses
	  </a>
	</li>
	<li>
	  <a href="how-to-enable-tls-encryption.html">
	    Enable TLS
	  </a>
	</li>
	<li>
	  <a href="how-to-manage-availability-zones.html">
	    Manage zones
	  </a>
	</li>
      </ul>
      <strong>
	  How to choose images
      </strong>
      <ul>
	<li>
	  <a href="how-to-import-images.html">
	    Import images
	  </a>
	</li>
	<li>
	  <a href="how-to-build-maas-images.html">
	    Build MAAS images
	  </a>
	</li>
	<li>
	  <a href="how-to-create-a-custom-ubuntu-image.html">
	    Create custom images
	  </a>
	</li>
	<li>
	  <a href="how-to-use-image-streams.html">
	    Use image streams
	  </a>
	</li>
	<li>
	  <a href="how-to-mirror-images-locally.html">
	    Mirror images locally
	  </a>
	</li>
	<li>
	  <a href="how-to-manage-vmware-images.html">
	    Manage VMWare images
	  </a>
	</li>
      </ul>
      <strong>
	  How to deploy MAAS
      </strong>
      <ul>
	<li>
	  <a href="how-to-manage-racks.html">
	    Manage racks
	  </a>
	</li>
	<li>
	  <a href="how-to-manage-regions.html">
	    Manage regions
	  </a>
	</li>
	<li>
	  <a href="how-to-enable-high-availability.html">
	    Enable HA
	  </a>
	</li>
	<li>
	  <a href="how-to-manage-machines.html">
	    Manage machines
	  </a>
	</li>
	<li>
	  <a href="how-to-deploy-machines.html">
	    Commission and deploy machines
	  </a>
	</li>
	<li>
	  <a href="how-to-customise-machines.html">
	    Customise machines
	  </a>
	</li>
	<li>
	  <a href="how-to-manage-vm-hosts.html">
	    Manage VM hosts
	  </a>
	</li>
	<li>
	  <a href="how-to-manage-vms.html">
	    Manage VMs
	  </a>
	</li>
	<li>
	  <a href="how-to-use-lxd.html">
	    Use LXD
	  </a>
	</li>
      </ul>
      <strong>
	  How to use tags
      </strong>
      <ul>
	<li>
	  <a href="how-to-work-with-tags.html">
	    Work with tags
	  </a>
	</li>
	<li>
	  <a href="how-to-work-with-annotations.html">
	    Work with annotations
	  </a>
	</li>
	<li>
	  <a href="how-to-use-machine-tags.html">
	    Use machine tags
	  </a>
	</li>
	<li>
	  <a href="how-to-use-controller-tags.html">
	    Use controller tags
	  </a>
	</li>
	<li>
	  <a href="how-to-use-storage-tags.html">
	    Use storage tags
	  </a>
	</li>
	<li>
	  <a href="how-to-use-network-tags.html">
	    Use network tags
	  </a>
	</li>
      </ul>
      <strong>
	  How to operate MAAS
      </strong>
	<ul>
	  <li>
	    <a href="how-to-set-up-maas-metrics.html">
	      Set up MAAS metrics
	    </a>
	  </li>
	  <li>
	    <a href="how-to-work-with-audit-event-logs.html">
	      Work with audit event logs
	    </a>
	  </li>
	<li>
	  <a href="how-to-use-maas-in-an-air-gapped-environment.html">
	    Use air-gapped MAAS
	  </a>
	</li>
	  <li>
	  <a href="how-to-back-up-maas.html">
	    Back up MAAS
	  </a>
	</li>
	<li>
	  <a href="how-to-secure-maas.html">
	    Secure MAAS
	  </a>
	</li>
	<li>
	  <a href="how-to-manage-user-accounts.html">
	    Manage users
	  </a>
	</li>
	<li>
	  <a href="how-to-search-maas.html">
	    Search MAAS
	  </a>
	</li>
	<li>
	  <a href="how-to-upgrade-maas.html">
	    Upgrade older versions
	  </a>
	</li>
      </ul>
      <strong>
	  Reference
      </strong>
      <ul>
	<li>
	  <a href="what-is-new-with-maas.html">
	    Release notes
	  </a>
	</li>
	<li>
	  <a href="power-management-reference.html">
	    Power management
	  </a>
	</li>
	<li>
	  <a href="commissioning-scripts-reference.html">
	    Commissioning scripts
	  </a>
	</li>
	<li>
	  <a href="hardware-test-scripts-reference.html">
	    Hardware test scripts
	  </a>
	</li>
	<li>
	  <a href="maas-logging-reference.html">
	    Log files
	  </a>
	</li>
	<li>
	  <a href="audit-event-log-reference.html">
	    Audit event log reference
	  </a>
	</li>
	<li>
	  <a href="api.html">
	    API documentation
	  </a>
	</li>
	<li>
	  <a href="python-api-client-reference.html">
	    API client
	  </a>
	</li>
	<li>
	  <a href="api-authentication-reference.html">
	    API authentication
	  </a>
	</li>
	<li>
	  <a href="maas-concepts-and-terms-reference.html">
	    Concepts & terms
	  </a>
	</li>
	<li>
	  <a href="how-to-get-help.html">
	    Getting help
	  </a>
	</li>
      </ul>
      <strong>
	  Explanation
      </strong>
      <ul>
	<li>
	  <a href="about-maas.html">
	    About MAAS
	  </a>
	</li>
	<li>
	  <a href="about-controllers.html">
	    About controllers
	  </a>
	</li>
	<li>
	  <a href="about-machines.html">
	    About machines
	  </a>
	</li>
	<li>
	  <a href="about-vm-hosting.html">
	    About VM hosting
	  </a>
	</li>
	<li>
	  <a href="about-tcp-ip-networks.html">
	    About TCP/IP networks
	  </a>
	</li>
	<li>
	  <a href="about-cloud-networks.html">
	    About cloud networks
	  </a>
	</li>
	<li>
	  <a href="about-dhcp.html">
	    About DHCP
	  </a>
	</li>
	<li>
	  <a href="about-networking.html">
	    About MAAS networks
	  </a>
	</li>
	<li>
	  <a href="about-images.html">
	    About images
	  </a>
	</li>
      </ul>
    </div>
    <div class="container" style="float:right; width:65%; margin-top:40px; margin-right:30px">
  <h1>How to manage VM hosts</h1><!-- "How to manage VM hosts" -->
<p>In order to  deploy a VM host in your MAAS network, you first need to set up a bridge to connect between your VM host and MAAS itself. Once that&rsquo;s done, you can add and manage VM hosts &ndash; and subsequently, create VMs to act as MAAS machines.  This article explains:</p>
<ul style="margin-left:4px; list-style-type:disc;">
<li><a href="#heading--maas-bridge-cli">How to set up a VM host bridge with the MAAS CLI/API</a></li>
<li><a href="#heading--maas-bridge-netplan">How to set up a VM host bridge with netplan</a></li>
<li><a href="#heading--maas-bridge-libvirt">How to set up a VM host bridge with libvirt</a></li>
<li><a href="#heading--set-up-ssh">How to set up SSH for use by libvirt</a></li>
<li><a href="#heading--adding-a-vm-host">How to add a VM host</a></li>
<li><a href="#heading--configuration">How to configure a VM host</a></li>
<li><a href="#heading--list-vm-hosts">How to list VM-hosts</a></li>
<li><a href="#heading--list-config-params">How to list configurable VM host parameters</a></li>
<li><a href="#heading--change-vm-host-name">How to change a VM host&rsquo;s name</a></li>
<li><a href="#heading--change-vm-host-pool">How to change a VM host&rsquo;s pool</a></li>
<li><a href="#heading--list-resources-of-all-vm-hosts">How to list the resources of all VM hosts</a></li>
<li><a href="#heading--list-resources-of-a-vm-host">How to list the resources of a single VM host</a></li>
<li><a href="#heading--update-vm-host-configuration">How to update a VM host&rsquo;s configuration</a></li>
<li><a href="#heading--list-vm-host-connection-parameters">How to list a VM host&rsquo;s connection parameters</a></li>
<li><a href="#heading--lxd-clusters">How to use LXD clusters</a></li>
</ul>
<p>To enable VM host networking features, MAAS must match the VM host IP address of a potential VM host with a known device (a machine or controller). For example, if a machine not known to MAAS is set up as a VM host, enhanced interface selection features will not be available.</p>
<p><strong>NOTE:</strong> 
It&rsquo;s essential to enforce usage of IP addresses to avoid domain name conflicts, should different controllers resolve the same domain name with different IP addresses. You should also avoid using 127.0.0.1 when running multiple controllers, as it would confuse MAAS.</p>
<p><a href="#heading--maas-bridge-cli"><h2 id="heading--maas-bridge-cli">How to use the MAAS API to configure a bridge</h2></a></p>
<p>You can also use the MAAS CLI/API to configure a VM host bridge, with the following procedure:</p>
<ol>
<li>
<p>Select the interface you wish to configure the bridge on. This example uses the boot interface, since the boot interface must be connected to a MAAS controlled network &ndash; but any interface is allowed:</p>
<pre><code>INTERFACE_ID=$(maas $PROFILE machine read $SYSTEM_ID | jq .boot_interface.id)
</code></pre>
</li>
<li>
<p>Create the bridge:</p>
<pre><code> BRIDGE_ID=$(maas $PROFILE interfaces create-bridge $SYSTEM_ID name=br0 parent=$INTERFACE_ID | jq .id)
</code></pre>
</li>
<li>
<p>Select the subnet where you want the bridge (this should be a MAAS controlled subnet):</p>
<pre><code>SUBNET_ID=$(maas $PROFILE subnets read | jq -r '.[] | select(.cidr == "10.0.0.0/24" and .managed == true).id')
</code></pre>
</li>
<li>
<p>Connect the bridge to the subnet:</p>
<pre><code>  maas $PROFILE interface link-subnet $SYSTEM_ID $BRIDGE_ID subnet=$SUBNET_ID mode="STATIC" ip_address="10.0.0.101"
</code></pre>
</li>
</ol>
<p><a href="#heading--maas-bridge-netplan"><h2 id="heading--maas-bridge-netplan">How to set up a VM host bridge with netplan</h2></a></p>
<p>You can also use netplan to configure a VM host bridge:</p>
<p>Open your netplan configuration file.  This should be in <code>/etc/netplan</code>.  It could be called <code>50-cloud-init.yaml</code>, <code>netplan.yaml</code>, or something else.  Modify the file to add a bridge, using the example below to guide you:</p>
<pre><code class="language-nohighlight">network:
    bridges:
        br0:
            addresses:
            - 10.0.0.101/24
            gateway4: 10.0.0.1
            interfaces:
            - enp1s0
            macaddress: 52:54:00:39:9d:f9
            mtu: 1500
            nameservers:
                addresses:
                - 10.0.0.2
                search:
                - maas
            parameters:
                forward-delay: 15
                stp: false
    ethernets:
        enp1s0:
            match:
                macaddress: 52:54:00:39:9d:f9
            mtu: 1500
            set-name: enp1s0
        enp2s0:
            match:
                macaddress: 52:54:00:df:87:ac
            mtu: 1500
            set-name: enp2s0
        enp3s0:
            match:
                macaddress: 52:54:00:a7:ac:46
            mtu: 1500
            set-name: enp3s0
    version: 2
</code></pre>
<p>Apply the new configuration with <code>netplan apply</code>.</p>
<p><a href="#heading--maas-bridge-libvirt"><h2 id="heading--maas-bridge-libvirt">How to set up a VM host bridge with libvirt</h2></a></p>
<p>It is also possible to use <a href="https://ubuntu.com/server/docs/virtualization-libvirt">libvirt</a> to configure a virtual bridge.  This method will also work for LXD VM hosts running on Ubuntu.  Be aware that other methods may be required if you are configuring LXD on an OS other than Ubuntu.</p>
<p>By default, libvirt creates a virtual bridge, <code>virbr0</code>, through which VMs communicate with each other and the Internet. DHCP, supplied by libvirt, automatically assigns an IP address to each VM.  However, to enable network booting in MAAS, you’ll need to provide DHCP in MAAS and either:</p>
<ul style="margin-left:4px; list-style-type:disc;">
<li>Disable DHCP on libvirt’s <code>default</code> network, or</li>
<li>Create a new libvirt network <code>maas</code> with DHCP disabled.</li>
</ul>
<p>You can set up such a <code>maas</code> network like this:</p>
<pre><code class="language-nohighlight">cat &lt;&lt; EOF &gt; maas.xml
&lt;network&gt;
 &lt;name&gt;maas&lt;/name&gt;
 &lt;forward mode='nat'&gt;
   &lt;nat&gt;
     &lt;port start='1024' end='65535'/&gt;
   &lt;/nat&gt;
 &lt;/forward&gt;
 &lt;dns enable=&quot;no&quot; /&gt;
 &lt;bridge name='virbr1' stp='off' delay='0'/&gt;
 &lt;domain name='testnet'/&gt;
 &lt;ip address='172.16.99.1' netmask='255.255.255.0'&gt;
 &lt;/ip&gt;
&lt;/network&gt;
EOF
virsh net-define maas.xml
</code></pre>
<p>Note that this network also has NAT port forwarding enabled to allow VMs to communicate with the Internet at large. Port forwarding is very useful in test environments.</p>
<p><a href="#heading--set-up-ssh"><h2 id="heading--set-up-ssh">How to set up SSH for use by libvirt</h2></a></p>
<p>For MAAS to successfully communicate with libvirt on your VM host machine &ndash; whether you&rsquo;re running from snap or package, or running rack controllers in LXD containers or on localhost &ndash; this example command must succeed from every rack controller:</p>
<pre><code class="language-nohighlight">virsh -c qemu+ssh://$USER@$VM_HOST_IP/system list --all
</code></pre>
<p>Here, <code>$USER</code> is a user on your VM host who is a member of the <code>libvirtd</code> Unix group on the VM host, and <code>$VM_HOST_IP</code> is the IP of your VM host.  <strong>Note</strong> that insufficient permissions for <code>$USER</code> may cause the <code>virsh</code> command to fail with an error such as <code>failed to connect to the hypervisor</code>. Check the <code>$USER</code> group membership to make sure <code>$USER</code> is a member of the <code>libvirtd</code> group.</p>
<p><a href="#heading--set-up-ssah-lv"><h3 id="heading--set-up-ssah-lv">How to set up SSH (libvirt only)</h3></a></p>
<p>If you installed MAAS via snap, then create the needed SSH keys this way:</p>
<pre><code class="language-nohighlight">sudo mkdir -p /var/snap/maas/current/root/.ssh
cd /var/snap/maas/current/root/.ssh
sudo ssh-keygen -f id_rsa
</code></pre>
<p>Finally, on the VM host, you&rsquo;ll need to add <code>id_rsa.pub</code> to the <code>authorized_keys</code> file in <code>/home/&lt;vm-host-user-homedir-name&gt;/.ssh/</code>,  where <code>&lt;vm-host-user-homedir-name&gt;</code> is the name of your VM host user.</p>
<p><a href="#heading--adding-a-vm-host"><h2 id="heading--adding-a-vm-host">How to add a VM host</h2></a></p>
<p>To add a VM host:</p>
<pre><code class="language-nohighlight">maas $PROFILE vm-host create type=$VM_HOST_TYPE power_address=$POWER_ADDRESS \
    [power_user=$USERNAME] power_pass=$PASSWORD {project=$PROJECT} \
    [zone=$ZONE] [tags=$TAG1,$TAG2,...]
</code></pre>
<p>$VM_HOST_TYPE can currently take two values: <code>virsh</code> and <code>lxd</code>.</p>
<p>$POWER_ADDRESS typically looks like the following for libvirt:</p>
<pre><code>qemu+ssh://&lt;vm host IP&gt;/system
</code></pre>
<p>of like this for LXD (Beta):</p>
<pre><code>https://10.0.0.100:8443
</code></pre>
<p>Both $USERNAME and $PASSWORD are optional for the virsh power type. $ZONE and $TAGS are optional for all VM hosts.</p>
<p>The <code>power_...</code> parameters will vary with power type.  See the <a href="/docs/api#power-types">API reference</a> for a listing of available power types.</p>
<p>For example, to create a LXD VM host, enter the following:</p>
<pre><code class="language-nohighlight">maas $PROFILE vm-hosts create type=lxd power_address=$LXD_BRIDGE_ADDRESS \
   power_pass=$LXD_TRUST_PASSWORD project=$PROJECT_NAME
</code></pre>
<p>Note that for LXD VM hosts, a project name is not optional.  Project names cannot contain spaces or special characters. If you enter a project name which doesn&rsquo;t exist, MAAS will create the LXD project for you.</p>
<p><strong>NOTE:</strong> 
MAAS will automatically discover and store the resources your VM host contains. Any existing machines will also appear on the &lsquo;Machines&rsquo; page, and MAAS will automatically attempt to commission them.</p>
<p><a href="#heading--configuration"><h2 id="heading--configuration">How to configure a VM host</h2></a></p>
<p>Using the CLI, it&rsquo;s possible to update the configuration of a VM host.  You can change these configurable parameters with an <code>update</code> command &ndash; but first, you&rsquo;ll want to know how to check the values of configurable parameters, both before and after the change.</p>
<p><a href="#heading--list-vm-hosts"><h3 id="heading--list-vm-hosts">How to list VM-hosts</h3></a></p>
<p>To begin, you can list your available KVM-hosts with the following command:</p>
<pre><code class="language-nohighlight">maas admin vm-hosts read | jq -r '([&quot;ID, &quot;VM-HOST&quot;,&quot;SYSID&quot;,&quot;CORES&quot;,
&quot;USED&quot;,&quot;RAM&quot;, &quot;USED&quot;,&quot;STORAGE&quot;, &quot;USED&quot;] | (., map(length*&quot;-&quot;))),
(.[]| [.id,.name,.host.system_id,.total.cores, .used.cores, .total.memory, .used.memory,.total.local_storage, .used.local_storage])
| @tsv' | column -t
</code></pre>
<p><a href="#heading--list-config-params"><h3 id="heading--list-config-params">How to list configurable VM host parameters</h3></a></p>
<p>There are just a few parameters that you can change for a VM host.  You can list these, on a per-host basis, using the following two-step procedure:</p>
<ol>
<li>
<p>Run the command above to get the VM host ID (different from the System ID, see the first column in the listing).</p>
</li>
<li>
<p>Enter the following command to list configurable parameters:</p>
</li>
</ol>
<pre><code class="language-nohighlight">maas admin vm-host read $ID | jq -r '([&quot;ID&quot;,&quot;NAME&quot;,&quot;POOL&quot;,&quot;ZONE&quot;,
&quot;CPU-O/C&quot;, &quot;RAM-O/C&quot;, &quot;TAGS&quot;] | (., map(length*&quot;-&quot;))), (.| [.id,.name,
.pool.name, .zone.name,.cpu_over_commit_ratio, 
.memory_over_commit_ratio, .tags[]]) | @tsv' | column -t
</code></pre>
<p>where $ID is the ID (not System ID) of the VM-host.</p>
<p><a href="#heading--change-vm-host-name"><h3 id="heading--change-vm-host-name">How to change a VM host&rsquo;s name</h3></a></p>
<p>You can change the VM host&rsquo;s name very simply, with this command:</p>
<pre><code>maas admin vm-host update $ID name=$NEW_NAME
</code></pre>
<p>where $ID is the VM host&rsquo;s ID (not System ID), and $NEW_NAME is the new name you want to assign.  You can check that the change was successful by just printing out the ID and name, like this:</p>
<pre><code class="language-nohighlight">maas admin vm-host read $ID | jq -r '([&quot;ID&quot;,&quot;NAME&quot;] 
| (., map(length*&quot;-&quot;))), (.| [.id,.name]) 
| @tsv' | column -t
</code></pre>
<p><a href="#heading--change-vm-host-pool"><h3 id="heading--change-vm-host-pool">How to change a VM host&rsquo;s pool</h3></a></p>
<p>You can also change the VM host&rsquo;s pool with a simple command:</p>
<pre><code class="language-nohighlight">maas admin vm-host update $ID pool=$VALID_POOL
</code></pre>
<p>where $ID is the VM host&rsquo;s ID (not System ID), and $VALID_POOL is the name of a pool that already exists.  If you mention a pool you haven&rsquo;t created yet, you&rsquo;ll get an error like this:</p>
<pre><code class="language-nohighlight">{&quot;pool&quot;: [&quot;Select a valid choice. That choice is not one of the available choices.&quot;]}
</code></pre>
<pre><code class="language-nohighlight">maas admin resource-pools read | jq -r '.[] | (.name)'
</code></pre>
<p>If you really want to set your VM host to a new one, you just need to create a new one with this command:</p>
<pre><code class="language-nohighlight">maas admin resource-pools create name=$NEW_POOL_NAME
</code></pre>
<p>Then double-check it with <code>catvmpools</code>, and assign your VM host to it using the earlier command. </p>
<p><a href="#heading--list-resources-of-all-vm-hosts"><h2 id="heading--list-resources-of-all-vm-hosts">How to list the resources of all VM hosts</h2></a></p>
<pre><code class="language-nohighlight">maas $PROFILE vm-hosts read
</code></pre>
<p>A portion of the sample output:</p>
<pre><code class="language-no-highlight">        &quot;id&quot;: 93,
        &quot;capabilities&quot;: [
            &quot;composable&quot;,
            &quot;fixed_local_storage&quot;,
            &quot;iscsi_storage&quot;
        ],
        &quot;name&quot;: &quot;civil-hermit&quot;,
</code></pre>
<p><a href="#heading--list-resources-of-a-vm-host"><h2 id="heading--list-resources-of-a-vm-host">How to list the resources of a single VM host</h2></a></p>
<p>To list an individual VM host&rsquo;s resources:</p>
<pre><code class="language-nohighlight">maas $PROFILE vm-host read $VM_HOST_ID
</code></pre>
<p><a href="#heading--update-vm-host-configuration"><h2 id="heading--update-vm-host-configuration">How to update a VM host&rsquo;s configuration</h2></a></p>
<p>Update overcommit ratios for a KVM host:</p>
<pre><code class="language-nohighlight">maas $PROFILE vm-host update $VM_HOST_ID power_address=qemu+ssh://ubuntu@192.168.1.2/system \
        power_pass=example cpu_over_commit_ratio=2.5 memory_over_commit_ratio=10.0
</code></pre>
<p>Update the default storage pool used by a KVM host:</p>
<pre><code class="language-nohighlight">maas $PROFILE vm-host update $VM_HOST_ID power_address=qemu+ssh://ubuntu@192.168.1.2/system \
        power_pass=example default_storage_pool=pool2
</code></pre>
<p><a href="#heading--list-vm-host-connection-parameters"><h2 id="heading--list-vm-host-connection-parameters">How to list a VM host&rsquo;s connection parameters</h2></a></p>
<p>To list a VM host&rsquo;s connection parameters:</p>
<pre><code class="language-nohighlight">maas $PROFILE vm-host parameters $VM_HOST_ID
</code></pre>
<p>Example output:</p>
<pre><code class="language-no-highlight">{
    &quot;power_address&quot;: &quot;10.3.0.1:8443&quot;,
    &quot;power_pass&quot;: &quot;admin&quot;,
    &quot;power_user&quot;: &quot;admin&quot;
}
</code></pre>
<p><a href="#heading--lxd-clusters"><h3 id="heading--lxd-clusters">LXD clusters</h3></a></p>
<p>MAAS 3.1 allows MAAS to take advantage of the existing LXD clustering capability.</p>
<p><a href="#heading--about-lxd-clusters"><h4 id="heading--about-lxd-clusters">About LXD clusters</h4></a></p>
<p>LXD clusters within the context of MAAS are a way of viewing and managing existing VM host clusters and composing VMs within said cluster.  MAAS will not create a new cluster, but will discover an existing cluster when you provide the info for adding a single clustered host.</p>
<p><a href="#heading--how-to-add-lxd-clusters"><h4 id="heading--how-to-add-lxd-clusters">How to add LXD clusters</h4></a></p>
<p>MAAS assumes you have already configured a cluster within the context of LXD. You then need to configure said cluster with a single trust MAAS will use to communicate with said cluster. Adding a LXD cluster is similar to adding a single LXD host, in that you provide authentication the same way for a single host within the cluster, and then select a project. The only difference is the name you provide will be used for the cluster instead of the individual host. MAAS will then connect to the provided host and discover the other hosts within the cluster, and rename the initially defined host with the cluster member name configured in LXD.</p>
<p><a href="../images/3aba7d6e30eda61623f66cb162ca85814128864a.png" target = "_blank"><img alt="unlabeled image" width="690" src="../images/3aba7d6e30eda61623f66cb162ca85814128864a.png"></a></p>
<p>First, add an LXD KVM:</p>
<p><a href="../images/c7d35ad0d8e1d9038dd39a8965307a49f57d453a.png" target = "_blank"><img alt="unlabeled image" width="690" src="../images/c7d35ad0d8e1d9038dd39a8965307a49f57d453a.png"></a></p>
<p>Next, set up credentials and get your MAAS certificate trusted by LXD:</p>
<p><a href="../images/b3ea7559edc066e899e41f41846a268b2459b1a5.png" target = "_blank"><img alt="unlabeled image" width="690" src="../images/b3ea7559edc066e899e41f41846a268b2459b1a5.png"></a></p>
<p>Once it is connected, you can select the project in that cluster:</p>
<p><a href="../images/ba798351c1c2b37d0aa79bca8c44def38d4ab839.png" target = "_blank"><img alt="unlabeled image" width="690" src="../images/ba798351c1c2b37d0aa79bca8c44def38d4ab839.png"></a></p>
<p>If the KVM host address is part of a cluster, it will show as a Cluster on the listing page. </p>
<p><a href="../images/069bae193cbb09ead3c811fd1a1d28582b946ff4.png" target = "_blank"><img alt="unlabeled image" width="690" src="../images/069bae193cbb09ead3c811fd1a1d28582b946ff4.png"></a></p>
<p><a href="#heading--how-to-compose-vms-in-lxd-clusters"><h4 id="heading--how-to-compose-vms-in-lxd-clusters">How to compose VMs in LXD clusters</h4></a></p>
<p>Composing a VM in a LXD cluster via MAAS is similar to composing a VM for a single VM host. MAAS does not provide any sort of scheduling of said VM, and will instead target the host you select for composing the VM.</p>
<p>From the KVM host listing page, click on the <code>+</code> icon to add a VM to a specific host:</p>
<p><a href="../images/219a302c245992a390cd44ada341cfe5a93a7b5a.png" target = "_blank"><img alt="unlabeled image" width="690" src="../images/219a302c245992a390cd44ada341cfe5a93a7b5a.png"></a></p>
<p>If you are in a specific KVM host page, you can click <code>+ add virtual machine</code>:</p>
<p><a href="../images/219a302c245992a390cd44ada341cfe5a93a7b5a.png" target = "_blank"><img alt="unlabeled image" width="690" src="../images/219a302c245992a390cd44ada341cfe5a93a7b5a.png"></a></p>
<p><a href="#heading--how-to-delete-lxd-clusters"><h3 id="heading--how-to-delete-lxd-clusters">How to delete LXD clusters</h3></a></p>
<p>To delete a LXD cluster, delete any one VM host within the cluster, this will delete the cluster and all members within the cluster:</p>
<p><a href="../images/ea7cd2476ae8cafe6d8e78f2b029d0cd41afa592.png" target = "_blank"><img alt="unlabeled image" width="690" src="../images/ea7cd2476ae8cafe6d8e78f2b029d0cd41afa592.png"></a></p>
    </div>
  </body>
</html>