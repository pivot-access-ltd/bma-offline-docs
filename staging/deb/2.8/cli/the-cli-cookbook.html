<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" type="text/css" href="css/stylesheet.css" />
    <style>
      #selector a:link{color:black;}
      #selector a:visited{color:black;}
      #selector a:active{color:black;}
      #selector a:hover{color:blue;}
      #sidebar a:link{color:black;}
      #sidebar a:visited{color:black;}
      #sidebar a:active{color:black;}
      #sidebar a:hover{color:blue;}
      ul {margin-deb-2-8-clileft:0;list-deb-2-8-clistyle-deb-2-8-clitype:none;}
      li {margin: 4px 0;}
    </style>
  </head>
  <body>
    <div id="selector" style="top:0; position:fixed; float:right; background-deb-2-8-clicolor:#d9d9d9; width:100%;border-deb-2-8-clibottom:1px solid black;">
      &nbsp;&nbsp;<strong>Offline docs</strong>
      <a href="https://maas.io/docs">(switch to live docs)</a>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
	<a href="../ui/the-deb-2-8-clicli-deb-2-8-clicookbook.html">
	  &nbsp;UI-deb-2-8-clionly&nbsp;
	</a>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      <span style="background-deb-2-8-clicolor:white;border-deb-2-8-clitop:1px solid black; border-deb-2-8-clileft:1px solid black; border-deb-2-8-cliright:1px solid black; border-deb-2-8-clibottom:5px solid white;">
	  CLI-deb-2-8-clionly
      </span>
    </div>
    <div id="sidebar" style="float:left; width:25%;margin-deb-2-8-clitop:40px; margin-deb-2-8-clileft:20px">
      <strong>
	<a href="maas-deb-2-8-clidocumentation.html">
	  Introduction
	</a>
      </strong>
      <ul>
	<li>
	  <a href="about-deb-2-8-climaas.html">
	    About MAAS
	  </a>
	</li>
	<li>
	  <a href="give-deb-2-8-clime-deb-2-8-clian-deb-2-8-cliexample-deb-2-8-cliof-deb-2-8-climaas.html">
	    &ldquo;Give me an example&rdquo;
	  </a>
	</li>
	<li>
	  <a href="whats-deb-2-8-clinew-deb-2-8-cliin-deb-2-8-climaas.html">
	    What&rsquo;s new in 2.8
	  </a>
	</li>
	<li>
	  <a href="maas-deb-2-8-clirequirements.html">
	    Requirements
	  </a>
	</li>
	<li>
	  <a href="maas-deb-2-8-cliinstallation.html">
	    Installation
	  </a>
	</li>
	<li>
	  <a href="configuration-deb-2-8-clijourney.html">
	    Configuration journey
	  </a>
	</li>
      <strong>
	<a href="controllers.html">
	  Controllers
	</a>
      </strong>
      <ul>
	<li>
	  <a href="maas-deb-2-8-clicommunication.html">
	    Communication
	  </a>
	</li>
	<li>
	  <a href="rack-deb-2-8-clicontrollers.html">
	    Rack controllers
	  </a>
	</li>
	<li>
	  <a href="region-deb-2-8-clicontrollers.html">
	    Region controllers
	  </a>
	</li>
	<li>
	  <a href="high-deb-2-8-cliavailability.html">
	    High availability
	  </a>
	</li>
      </ul>
      <strong>
	<a href="machines.html">
	  Machines
	</a>
      </strong>
      <ul>
	<li>
	  <a href="add-deb-2-8-climachines.html">
	    Add machines
	  </a>
	</li>
	<li>
	  <a href="power-deb-2-8-climanagement.html">
	    Power management
	  </a>
	</li>
	<li>
	  <a href="commission-deb-2-8-climachines.html">
	    Commission machines
	  </a>
	</li>
	<li>Testing
	</li>
	<li>
	  <a href="hardware-deb-2-8-clitesting.html">
	    Hardware testing
	  </a>
	</li>
	<li>
	  <a href="network-deb-2-8-clitesting.html">
	    Network testing
	  </a>
	</li>
	<li>
	  <a href="commissioning-deb-2-8-cliand-deb-2-8-clihardware-deb-2-8-clitesting-deb-2-8-cliscripts.html">
	    Commissioning and hardware testing scripts
	  </a>
	</li>
	<li>
	  <a href="deploy-deb-2-8-climachines.html">
	    Deploy machines
	  </a>
	</li>
	<li>
	  <a href="maas-deb-2-8-clitags.html">
	    Tags
	  </a>
	</li>
	<li>
	  <a href="custom-deb-2-8-climachine-deb-2-8-clisetup.html">
	    Custom machine setup
	  </a>
	</li>
	<li>
	  <a href="kernel-deb-2-8-cliboot-deb-2-8-clioptions.html">
	    Kernel boot options
	  </a>
	</li>
	<li>
	  <a href="resource-deb-2-8-clipools.html">
	    Resource pools
	  </a>
	</li>
	<li>
	  <a href="storage.html">
	    Storage
	  </a>
	</li>
	<li>
	  <a href="vmware-deb-2-8-clivmfs-deb-2-8-clidatastores.html">
	    VMware VMFS datastores
	  </a>
	</li>
	<li>
	  <a href="ubuntu-deb-2-8-clikernels.html">
	    Ubuntu kernels
	  </a>
	</li>
      </ul>
      <strong>
	<a href="images.html">
	  Images
	</a>
      </strong>
      <ul>
	<li>
	  <a href="select-deb-2-8-cliand-deb-2-8-cliimport-deb-2-8-cliimages.html">
	    Select and import images
	  </a>
	</li>
	<li>
	  <a href="local-deb-2-8-cliimage-deb-2-8-climirror.html">
	    Local image mirror
	  </a>
	</li>
	<li>
	  <a href="vmware-deb-2-8-cliimages.html">
	    VMWare images
	  </a>
	</li>
      </ul>
      <strong>
	<a href="networking.html">
	  Networking
	</a>
      </strong>
      <ul>
	<li>
	  <a href="subnet-deb-2-8-climanagement.html">
	    Subnet management
	  </a>
	</li>
	<li>
	  <a href="managing-deb-2-8-clidhcp.html">
	    DHCP
	  </a>
	</li>
	<li>
	  <a href="ip-deb-2-8-cliranges.html">
	    IP ranges
	  </a>
	</li>
	<li>
	  <a href="proxy.html">
	    Proxy
	  </a>
	</li>
	<li>
	  <a href="ntp-deb-2-8-cliservices.html">
	    NTP
	  </a>
	</li>
	<li>
	  <a href="network-deb-2-8-clidiscovery.html">
	    Network discovery
	  </a>
	</li>
	<li>
	  <a href="ipv6-deb-2-8-cliaddressing.html">
	    IPv6
	  </a>
	</li>
	<li>
	  <a href="configuring-deb-2-8-clitls-deb-2-8-cliencryption.html">
	    SSL
	  </a>
	</li>
	<li>
	  <a href="managing-deb-2-8-clistp.html">
	    STP
	  </a>
	</li>
	<li>
	  <a href="availability-deb-2-8-clizones.html">
	    Availability zones (AZs)
	  </a>
	</li>
      </ul>
      <strong>
	<a href="vm-deb-2-8-clihosting.html">
	  VM hosting
	</a>
      </strong>
      <ul>
	<li>
	  <a href="vm-deb-2-8-clihost-deb-2-8-clinetworking.html">
	    VM host networking
	  </a>
	</li>
	<li>
	  <a href="adding-deb-2-8-clia-deb-2-8-clivm-deb-2-8-clihost.html">
	    Add a VM host
	  </a>
	</li>
	<li>
	  <a href="vm-deb-2-8-clihost-deb-2-8-clistorage-deb-2-8-clipools.html">
	    VM host storage pools
	  </a>
	</li>
	<li>
	  <a href="creating-deb-2-8-cliand-deb-2-8-clideleting-deb-2-8-clivms.html">
	    Creating and deleting VMs
	  </a>
	</li>
      </ul>
      <strong>Operations
      </strong>
      <ul>
	<li>
	  <a href="prometheus-deb-2-8-climetrics.html">
	    Prometheus metrics
	  </a>
	</li>
	<li>
	  <a href="backup.html">
	    Backup
	  </a>
	</li>
	<li>
	  <a href="hardening-deb-2-8-cliyour-deb-2-8-climaas-deb-2-8-cliinstallation.html">
	    MAAS security
	  </a>
	</li>
	<li>
	  <a href="maas-deb-2-8-clilogging.html">
	    Logging
	  </a>
	</li>
	<li>
	  <a href="commissioning-deb-2-8-clilogs.html">
	    Commissioning logs
	  </a>
	</li>
	<li>
	  <a href="user-deb-2-8-cliaccounts.html">
	    User accounts
	  </a>
	</li>
	<li>
	  <a href="interactive-deb-2-8-clisearch.html">
	    Interactive search
	  </a>
	</li>
      </ul>
      <strong>
	<a href="concepts-deb-2-8-cliand-deb-2-8-cliterms.html">
	  Concepts &amp; terms
	</a>
      </strong>
      <ul>
	<li>
	  <a href="concepts-deb-2-8-cliand-deb-2-8-cliterms.html#heading-deb-2-8-cli-deb-2-8-clinetwork-deb-2-8-clitutorial">
	    Brief network tutorial
	  </a>
	</li>
      </ul>
      <strong>
	<a href="maas-deb-2-8-clicli.html">
	  CLI
	</a>
      </strong>
      <ul>
	<li>
	  <a href="common-deb-2-8-clicli-deb-2-8-clitasks.html">
	    The CLI cookbook
	  </a>
	</li>
	<li>
	  <a href="common-deb-2-8-clicli-deb-2-8-clitasks.html">
	    Common tasks
	  </a>
	</li>
	<li>
	  <a href="audit-deb-2-8-clievent-deb-2-8-clilogs.html">
	    Audit event logs
	  </a>
	</li>
	<li>
	  <a href="cli-deb-2-8-clikernel-deb-2-8-climanagement.html">
	    Kernel management
	  </a>
	</li>
	<li>
	  <a href="cli-deb-2-8-cliimage-deb-2-8-climanagement.html">
	    Image management
	  </a>
	</li>
	<li>
	  <a href="cli-deb-2-8-cliinterface-deb-2-8-climanagement.html">
	    Interface management
	  </a>
	</li>
	<li>
	  <a href="cli-deb-2-8-cliadvanced-deb-2-8-clitasks.html">
	    Advanced tasks
	  </a>
	</li>
	<li>
	  <a href="cli-deb-2-8-clicomposable-deb-2-8-clihardware.html">
	    Composable hardware
	  </a>
	</li>
	<li>
	  <a href="python-deb-2-8-cliapi-deb-2-8-cliclient.html">
	    API client
	  </a>
	</li>
      </ul>
      <strong>
	<a href="api.html">
	  API documentation
	</a>
      </strong>
      <ul>
	<li>
	  <a href="api-deb-2-8-cliauthentication.html">
	    API authentication
	  </a>
	</li>
      </ul>
      <strong>
	<a href="troubleshooting.html">
	  Troubleshoot
	</a>
      </strong>
      <ul>
	<li>
	  <a href="getting-deb-2-8-clihelp.html">
	    Getting help
	  </a>
	</li>
	<li>
	  <a href="tips-deb-2-8-clitricks-deb-2-8-cliand-deb-2-8-clitraps.html">
	    Tips, tricks, and traps
	  </a>
	</li>
	<li>
	  <a href="https://old-deb-2-8-clidocs.maas.io/2.5/en/">
	    MAAS 2.5 (+ earlier) doc
	  </a>
	</li>
      </ul>
      <strong>
	<a href="whats-deb-2-8-clinew-deb-2-8-cliin-deb-2-8-climaas.html">
	  Release notes
	</a>
      </strong>
      <p/>
      <strong>
	<a href="writing-deb-2-8-cliguide.html">
	  Help improve these docs
	</a>
      </strong>
    </div>
    <div class="container" style="float:right; width:65%; margin-deb-2-8-clitop:40px; margin-deb-2-8-cliright:30px">
      <h1>The CLI cookbook</h1><p>The following recipes may help you make better use of the <a href="maas-deb-2-8-clicli.html">MAAS CLI</a>.  Each recipe includes the relevant CLI command sequence, with the results processed through <code>jq</code> and other relevant command-deb-2-8-cliline utilities to produce cleaner output.  Understand that this material isn&rsquo;t meant to replace the CLI, just to give you some hints about using it.</p>
<h4>Catalogue of recipes:</h4>
<ul>
<li><a href="the-deb-2-8-clicli-deb-2-8-clicookbook.html#heading-deb-2-8-cli-deb-2-8-clibasic-deb-2-8-climachine-deb-2-8-clilist">Basic machine list</a></li>
<li><a href="the-deb-2-8-clicli-deb-2-8-clicookbook.html#heading-deb-2-8-cli-deb-2-8-clisorted-deb-2-8-cliby-deb-2-8-climachine-deb-2-8-cliname">sorted by machine name</a></li>
<li><a href="the-deb-2-8-clicli-deb-2-8-clicookbook.html#heading-deb-2-8-cli-deb-2-8-clisorted-deb-2-8-cliby-deb-2-8-clisystem-deb-2-8-cliid">sorted by system ID</a></li>
<li><a href="the-deb-2-8-clicli-deb-2-8-clicookbook.html#heading-deb-2-8-cli-deb-2-8-clisorted-deb-2-8-cliby-deb-2-8-clipower-deb-2-8-clistate">sorted by power state</a></li>
<li><a href="the-deb-2-8-clicli-deb-2-8-clicookbook.html#heading-deb-2-8-cli-deb-2-8-clisorted-deb-2-8-cliby-deb-2-8-climachine-deb-2-8-clistatus">sorted by machine status</a></li>
<li><a href="the-deb-2-8-clicli-deb-2-8-clicookbook.html#heading-deb-2-8-cli-deb-2-8-clisorted-deb-2-8-cliby-deb-2-8-clifirst-deb-2-8-clitag">sorted by first tag</a></li>
<li><a href="the-deb-2-8-clicli-deb-2-8-clicookbook.html#heading-deb-2-8-cli-deb-2-8-clisorted-deb-2-8-cliby-deb-2-8-clipool">sorted by pool</a></li>
<li><a href="the-deb-2-8-clicli-deb-2-8-clicookbook.html#heading-deb-2-8-cli-deb-2-8-clisorted-deb-2-8-cliby-deb-2-8-clivlan">sorted by VLAN</a></li>
<li><a href="the-deb-2-8-clicli-deb-2-8-clicookbook.html#heading-deb-2-8-cli-deb-2-8-clisorted-deb-2-8-cliby-deb-2-8-clifabric">sorted by fabric</a></li>
<li><a href="the-deb-2-8-clicli-deb-2-8-clicookbook.html#heading-deb-2-8-cli-deb-2-8-clisorted-deb-2-8-cliby-deb-2-8-clisubnet">sorted by subnet</a></li>
<li><a href="the-deb-2-8-clicli-deb-2-8-clicookbook.html#heading-deb-2-8-cli-deb-2-8-climake-deb-2-8-climachines">Make machines</a></li>
<li><a href="the-deb-2-8-clicli-deb-2-8-clicookbook.html#heading-deb-2-8-cli-deb-2-8-clivm-deb-2-8-clihost-deb-2-8-clilist">VM host list</a></li>
<li><a href="the-deb-2-8-clicli-deb-2-8-clicookbook.html#heading-deb-2-8-cli-deb-2-8-clicreate-deb-2-8-clikvm">Creating KVMs &amp; getting feedback</a></li>
</ul>
<p><a href="#heading-deb-2-8-cli-deb-2-8-clibasic-deb-2-8-climachine-deb-2-8-clilist"><h2 id="heading-deb-2-8-cli-deb-2-8-clibasic-deb-2-8-climachine-deb-2-8-clilist">Basic machine list</h2></a></p>
<pre><code>maas admin machines read | jq -deb-2-8-clir '([&quot;HOSTNAME&quot;,&quot;SYSID&quot;,&quot;POWER&quot;,&quot;STATUS&quot;,
&quot;OWNER&quot;, &quot;TAGS&quot;, &quot;POOL&quot;, &quot;VLAN&quot;,&quot;FABRIC&quot;,&quot;SUBNET&quot;] | (., map(length*&quot;-deb-2-8-cli&quot;))),
(.[] | [.hostname, .system_id, .power_state, .status_name, .owner // &quot;-deb-2-8-cli&quot;, 
.tag_names[0] // &quot;-deb-2-8-cli&quot;, .pool.name,
.boot_interface.vlan.name, .boot_interface.vlan.fabric,
.boot_interface.links[0].subnet.name]) | @tsv' | column -deb-2-8-clit
</code></pre>

<p><a href="#heading-deb-2-8-cli-deb-2-8-clisorted-deb-2-8-cliby-deb-2-8-climachine-deb-2-8-cliname"><h3 id="heading-deb-2-8-cli-deb-2-8-clisorted-deb-2-8-cliby-deb-2-8-climachine-deb-2-8-cliname">Machine list sorted by machine name</h3></a></p>
<pre><code>maas admin machines read | jq -deb-2-8-clir '([&quot;HOSTNAME&quot;,&quot;SYSID&quot;,&quot;POWER&quot;,&quot;STATUS&quot;,
&quot;OWNER&quot;, &quot;TAGS&quot;, &quot;POOL&quot;, &quot;VLAN&quot;,&quot;FABRIC&quot;,&quot;SUBNET&quot;] | (., map(length*&quot;-deb-2-8-cli&quot;))),
(.[] | [.hostname, .system_id, .power_state, .status_name, .owner // &quot;-deb-2-8-cli&quot;, 
.tag_names[0] // &quot;-deb-2-8-cli&quot;, .pool.name,
.boot_interface.vlan.name, .boot_interface.vlan.fabric,
.boot_interface.links[0].subnet.name]) | @tsv' | column -deb-2-8-clit \
| sort -deb-2-8-clik 1
</code></pre>

<p><a href="#heading-deb-2-8-cli-deb-2-8-clisorted-deb-2-8-cliby-deb-2-8-clisystem-deb-2-8-cliid"><h3 id="heading-deb-2-8-cli-deb-2-8-clisorted-deb-2-8-cliby-deb-2-8-clisystem-deb-2-8-cliid">Machine list sorted by system ID</h3></a></p>
<pre><code>maas admin machines read | jq -deb-2-8-clir '([&quot;HOSTNAME&quot;,&quot;SYSID&quot;,&quot;POWER&quot;,&quot;STATUS&quot;,
&quot;OWNER&quot;, &quot;TAGS&quot;, &quot;POOL&quot;, &quot;VLAN&quot;,&quot;FABRIC&quot;,&quot;SUBNET&quot;] | (., map(length*&quot;-deb-2-8-cli&quot;))),
(.[] | [.hostname, .system_id, .power_state, .status_name, .owner // &quot;-deb-2-8-cli&quot;, 
.tag_names[0] // &quot;-deb-2-8-cli&quot;, .pool.name,
.boot_interface.vlan.name, .boot_interface.vlan.fabric,
.boot_interface.links[0].subnet.name]) | @tsv' | column -deb-2-8-clit \
| sort -deb-2-8-clik 1
</code></pre>

<p><a href="#heading-deb-2-8-cli-deb-2-8-clisorted-deb-2-8-cliby-deb-2-8-clipower-deb-2-8-clistate"><h3 id="heading-deb-2-8-cli-deb-2-8-clisorted-deb-2-8-cliby-deb-2-8-clipower-deb-2-8-clistate">Machine list sorted by power state</h3></a></p>
<pre><code>maas admin machines read | jq -deb-2-8-clir '([&quot;HOSTNAME&quot;,&quot;SYSID&quot;,&quot;POWER&quot;,&quot;STATUS&quot;,
&quot;OWNER&quot;, &quot;TAGS&quot;, &quot;POOL&quot;, &quot;VLAN&quot;,&quot;FABRIC&quot;,&quot;SUBNET&quot;] | (., map(length*&quot;-deb-2-8-cli&quot;))),
(.[] | [.hostname, .system_id, .power_state, .status_name, .owner // &quot;-deb-2-8-cli&quot;, 
.tag_names[0] // &quot;-deb-2-8-cli&quot;, .pool.name,
.boot_interface.vlan.name, .boot_interface.vlan.fabric,
.boot_interface.links[0].subnet.name]) | @tsv' | column -deb-2-8-clit \
| sort -deb-2-8-clik 1
</code></pre>

<p><a href="#heading-deb-2-8-cli-deb-2-8-clisorted-deb-2-8-cliby-deb-2-8-climachine-deb-2-8-clistatus"><h3 id="heading-deb-2-8-cli-deb-2-8-clisorted-deb-2-8-cliby-deb-2-8-climachine-deb-2-8-clistatus">Machine list sorted by machine status</h3></a></p>
<pre><code>maas admin machines read | jq -deb-2-8-clir '([&quot;HOSTNAME&quot;,&quot;SYSID&quot;,&quot;POWER&quot;,&quot;STATUS&quot;,
&quot;OWNER&quot;, &quot;TAGS&quot;, &quot;POOL&quot;, &quot;VLAN&quot;,&quot;FABRIC&quot;,&quot;SUBNET&quot;] | (., map(length*&quot;-deb-2-8-cli&quot;))),
(.[] | [.hostname, .system_id, .power_state, .status_name, .owner // &quot;-deb-2-8-cli&quot;, 
.tag_names[0] // &quot;-deb-2-8-cli&quot;, .pool.name,
.boot_interface.vlan.name, .boot_interface.vlan.fabric,
.boot_interface.links[0].subnet.name]) | @tsv' | column -deb-2-8-clit \
| sort -deb-2-8-clik 1
</code></pre>

<p><a href="#heading-deb-2-8-cli-deb-2-8-clisorted-deb-2-8-cliby-deb-2-8-clifirst-deb-2-8-clitag"><h3 id="heading-deb-2-8-cli-deb-2-8-clisorted-deb-2-8-cliby-deb-2-8-clifirst-deb-2-8-clitag">Machine list sorted by first tag</h3></a></p>
<pre><code>maas admin machines read | jq -deb-2-8-clir '([&quot;HOSTNAME&quot;,&quot;SYSID&quot;,&quot;POWER&quot;,&quot;STATUS&quot;,
&quot;OWNER&quot;, &quot;TAGS&quot;, &quot;POOL&quot;, &quot;VLAN&quot;,&quot;FABRIC&quot;,&quot;SUBNET&quot;] | (., map(length*&quot;-deb-2-8-cli&quot;))),
(.[] | [.hostname, .system_id, .power_state, .status_name, .owner // &quot;-deb-2-8-cli&quot;, 
.tag_names[0] // &quot;-deb-2-8-cli&quot;, .pool.name,
.boot_interface.vlan.name, .boot_interface.vlan.fabric,
.boot_interface.links[0].subnet.name]) | @tsv' | column -deb-2-8-clit \
| sort -deb-2-8-clik 1
</code></pre>

<p><a href="#heading-deb-2-8-cli-deb-2-8-clisorted-deb-2-8-cliby-deb-2-8-clipool"><h3 id="heading-deb-2-8-cli-deb-2-8-clisorted-deb-2-8-cliby-deb-2-8-clipool">Machine list sorted by pool</h3></a></p>
<pre><code>maas admin machines read | jq -deb-2-8-clir '([&quot;HOSTNAME&quot;,&quot;SYSID&quot;,&quot;POWER&quot;,&quot;STATUS&quot;,
&quot;OWNER&quot;, &quot;TAGS&quot;, &quot;POOL&quot;, &quot;VLAN&quot;,&quot;FABRIC&quot;,&quot;SUBNET&quot;] | (., map(length*&quot;-deb-2-8-cli&quot;))),
(.[] | [.hostname, .system_id, .power_state, .status_name, .owner // &quot;-deb-2-8-cli&quot;, 
.tag_names[0] // &quot;-deb-2-8-cli&quot;, .pool.name,
.boot_interface.vlan.name, .boot_interface.vlan.fabric,
.boot_interface.links[0].subnet.name]) | @tsv' | column -deb-2-8-clit \
| sort -deb-2-8-clik 1
</code></pre>

<p><a href="#heading-deb-2-8-cli-deb-2-8-clisorted-deb-2-8-cliby-deb-2-8-clivlan"><h3 id="heading-deb-2-8-cli-deb-2-8-clisorted-deb-2-8-cliby-deb-2-8-clivlan">Machine list sorted by VLAN</h3></a></p>
<pre><code>maas admin machines read | jq -deb-2-8-clir '([&quot;HOSTNAME&quot;,&quot;SYSID&quot;,&quot;POWER&quot;,&quot;STATUS&quot;,
&quot;OWNER&quot;, &quot;TAGS&quot;, &quot;POOL&quot;, &quot;VLAN&quot;,&quot;FABRIC&quot;,&quot;SUBNET&quot;] | (., map(length*&quot;-deb-2-8-cli&quot;))),
(.[] | [.hostname, .system_id, .power_state, .status_name, .owner // &quot;-deb-2-8-cli&quot;, 
.tag_names[0] // &quot;-deb-2-8-cli&quot;, .pool.name,
.boot_interface.vlan.name, .boot_interface.vlan.fabric,
.boot_interface.links[0].subnet.name]) | @tsv' | column -deb-2-8-clit \
| sort -deb-2-8-clik 1
</code></pre>

<p><a href="#heading-deb-2-8-cli-deb-2-8-clisorted-deb-2-8-cliby-deb-2-8-clifabric"><h3 id="heading-deb-2-8-cli-deb-2-8-clisorted-deb-2-8-cliby-deb-2-8-clifabric">Machine list sorted by fabric</h3></a></p>
<pre><code>maas admin machines read | jq -deb-2-8-clir '([&quot;HOSTNAME&quot;,&quot;SYSID&quot;,&quot;POWER&quot;,&quot;STATUS&quot;,
&quot;OWNER&quot;, &quot;TAGS&quot;, &quot;POOL&quot;, &quot;VLAN&quot;,&quot;FABRIC&quot;,&quot;SUBNET&quot;] | (., map(length*&quot;-deb-2-8-cli&quot;))),
(.[] | [.hostname, .system_id, .power_state, .status_name, .owner // &quot;-deb-2-8-cli&quot;, 
.tag_names[0] // &quot;-deb-2-8-cli&quot;, .pool.name,
.boot_interface.vlan.name, .boot_interface.vlan.fabric,
.boot_interface.links[0].subnet.name]) | @tsv' | column -deb-2-8-clit \
| sort -deb-2-8-clik 1
</code></pre>

<p><a href="#heading-deb-2-8-cli-deb-2-8-clisorted-deb-2-8-cliby-deb-2-8-clisubnet"><h3 id="heading-deb-2-8-cli-deb-2-8-clisorted-deb-2-8-cliby-deb-2-8-clisubnet">Machine list sorted by subnet</h3></a></p>
<pre><code>maas admin machines read | jq -deb-2-8-clir '([&quot;HOSTNAME&quot;,&quot;SYSID&quot;,&quot;POWER&quot;,&quot;STATUS&quot;,
&quot;OWNER&quot;, &quot;TAGS&quot;, &quot;POOL&quot;, &quot;VLAN&quot;,&quot;FABRIC&quot;,&quot;SUBNET&quot;] | (., map(length*&quot;-deb-2-8-cli&quot;))),
(.[] | [.hostname, .system_id, .power_state, .status_name, .owner // &quot;-deb-2-8-cli&quot;, 
.tag_names[0] // &quot;-deb-2-8-cli&quot;, .pool.name,
.boot_interface.vlan.name, .boot_interface.vlan.fabric,
.boot_interface.links[0].subnet.name]) | @tsv' | column -deb-2-8-clit \
| sort -deb-2-8-clik 1
</code></pre>

<p><a href="#heading-deb-2-8-cli-deb-2-8-clivm-deb-2-8-clihost-deb-2-8-clilist"><h2 id="heading-deb-2-8-cli-deb-2-8-clivm-deb-2-8-clihost-deb-2-8-clilist">List of VM hosts</h2></a></p>
<pre><code>maas admin vm-deb-2-8-clihosts read | jq -deb-2-8-clir '([&quot;ID&quot;,&quot;VM-deb-2-8-cliHOST&quot;,&quot;SYSID&quot;,&quot;CORES&quot;,&quot;USED&quot;,&quot;RAM&quot;,
&quot;USED&quot;,&quot;STORAGE&quot;, &quot;USED&quot;] | (., map(length*&quot;-deb-2-8-cli&quot;))), (.[]| [.id,.name,.host.system_id,
.total.cores, .used.cores, .total.memory, .used.memory,.total.local_storage,
.used.local_storage]) | @tsv' | column -deb-2-8-clit
</code></pre>

<p><a href="#heading-deb-2-8-cli-deb-2-8-clicreate-deb-2-8-clikvm"><h2 id="heading-deb-2-8-cli-deb-2-8-clicreate-deb-2-8-clikvm">Creating a KVM with confirmation</h2></a></p>
<p>Note that most of these can be entered directly at the command line using copy/paste &ndash; even the <code>#!/bin/bash</code> won&rsquo;t hurt, as it will be ignored by the shell.</p>
<p><strong>NOTE:</strong> 
Remember to:
1. login to the MAAS CLI before using these commands.
2. substitute your administrator profile for &ldquo;admin&rdquo; if you&rsquo;ve assigned a different admin username.</p>
<p><details><summary>Also, be aware of how multiple lines are parsed by the shell:</summary></p>
<ul>
<li>
<p>Quoted sections, such as the long command generally following <code>jq</code>, need no special accommodations to break lines.  You can break the lines anywhere that&rsquo;s convenient for you, as long as you maintain at least a single space between &ldquo;words.&rdquo;  </p>
</li>
<li>
<p>Any non-deb-2-8-cliquoted section (i.e., part of a shell command) must have a <code>\</code> at the end of each line, before a continuation line.</p>
</li>
</ul>
<p>For example, this configuration works fine:</p>
<pre><code>| jq -deb-2-8-clir '(["HOSTNAME",
"SYSID",....
....' | column -deb-2-8-clit
</code></pre>
<p>But this one will produce an error:</p>
<pre><code>| jq
-deb-2-8-clir '(["HOSTNAME",....
</code></pre>
<p>We&rsquo;ve tried to break them so that they fit on an average terminal line, but your mileage may vary.
</details></p>
<h2>lsmm series: Listing MAAS machines</h2>

<p>The <code>lsmm</code> script, defined below, is something we use to quickly get machine information from the command line.  For those of us who prefer the CLI, it&rsquo;s an easy way to gather the same information you&rsquo;d get in the web UI machine list, but more focused in each option.</p>
<p><a href="#heading-deb-2-8-cli-deb-2-8-clilsmm"><a href="#heading-deb-2-8-cli-deb-2-8-clilsmm"><h3 id="heading-deb-2-8-cli-deb-2-8-clilsmm">lsmm: List MAAS machines</h3></a></a></p>
<p>This recipe prints a basic machine list.  Here&rsquo;s the command to paste into the command line:</p>
<pre><code>maas admin machines read | jq -deb-2-8-clir '(["HOSTNAME","SYSID","POWER","STATUS",
"OWNER", "POOL", "VLAN","FABRIC","SUBNET"] | (., map(length*"-deb-2-8-cli"))),
(.[] | [.hostname, .system_id, .power_state, .status_name, .owner, .pool.name,
.boot_interface.vlan.name, .boot_interface.vlan.fabric,
.boot_interface.links[0].subnet.name]) | @tsv' | column -deb-2-8-clit
</code></pre>
<p>And here&rsquo;s the command as part of the <code>lsmm</code> shellscript:</p>
<pre><code>#!/bin/bash
# lsmm -deb-2-8-cli list maas machines
# make sure to chmod this file so it can execute
#
maas admin machines read | jq -deb-2-8-clir '(["HOSTNAME","SYSID","POWER","STATUS",
"OWNER", "POOL", "VLAN","FABRIC","SUBNET"] | (., map(length*"-deb-2-8-cli"))),
(.[] | [.hostname, .system_id, .power_state, .status_name, .owner, .pool.name,
.boot_interface.vlan.name, .boot_interface.vlan.fabric,
.boot_interface.links[0].subnet.name]) | @tsv' | column -deb-2-8-clit
</code></pre>
<p>If you save this to a file, make sure to <code>chmod</code> the file so it will execute.  You might also add it to your path, or perhaps even place it in <code>/usr/bin</code> if desired.</p>
<p><a href="#heading-deb-2-8-cli-deb-2-8-clilsmm-deb-2-8-clit"><h3 id="heading-deb-2-8-cli-deb-2-8-clilsmm-deb-2-8-clit">lsmm -deb-2-8-clit: List MAAS machines with first tag</h3></a></p>
<p>It&rsquo;s a good idea to keep your most important machine tag first, as it&rsquo;s the first one you&rsquo;ll see.  It makes scanning your list (UI or CLI/jq) much more efficient.  Here&rsquo;s a recipe that adds the first tag to the console-deb-2-8-cliprinted machine list:</p>
<pre><code>maas admin machines read | jq -deb-2-8-clir '(["HOSTNAME","SYSID","POWER","STATUS",
"OWNER", "TAGS", "POOL", "VLAN","FABRIC","SUBNET"] | (., map(length*"-deb-2-8-cli"))),
(.[] | [.hostname, .system_id, .power_state, .status_name, .owner // "-deb-2-8-cli", 
.tag_names[0] // "-deb-2-8-cli", .pool.name,
.boot_interface.vlan.name, .boot_interface.vlan.fabric,
.boot_interface.links[0].subnet.name]) | @tsv' | column -deb-2-8-clit
</code></pre>
<p>And here&rsquo;s an expanded version of <code>lsmm</code> that takes a <code>-deb-2-8-clit</code> options, for &ldquo;tags:&rdquo;</p>
<pre><code>#!/bin/bash
# lsmm -deb-2-8-cli list maas machines
# make sure to chmod this file so it can execute
# and make sure it's in the path (if you're not typing "./")
#
if [ -deb-2-8-cliz "$1" ]
   then
maas admin machines read | jq -deb-2-8-clir '(["HOSTNAME","SYSID","POWER","STATUS",
"OWNER", "POOL", "VLAN","FABRIC","SUBNET"] | (., map(length*"-deb-2-8-cli"))),
(.[] | [.hostname, .system_id, .power_state, .status_name, .owner, .pool.name,
.boot_interface.vlan.name, .boot_interface.vlan.fabric,
.boot_interface.links[0].subnet.name]) | @tsv' | column -deb-2-8-clit
fi

if [ "$1" == "-deb-2-8-clit" ]
   then
maas admin machines read | jq -deb-2-8-clir '(["HOSTNAME","SYSID","POWER","STATUS",
"OWNER", "TAGS", "POOL", "VLAN","FABRIC","SUBNET"] | (., map(length*"-deb-2-8-cli"))),
(.[] | [.hostname, .system_id, .power_state, .status_name, .owner // "-deb-2-8-cli", 
.tag_names[0] // "-deb-2-8-cli", .pool.name,
.boot_interface.vlan.name, .boot_interface.vlan.fabric,
.boot_interface.links[0].subnet.name]) | @tsv' | column -deb-2-8-clit
fi
</code></pre>
<p>Note that with no option (e.g., just <code>lsmm</code> on the command line), this script will print the basic machine list from the previous recipe.</p>
<p><a href="#heading-deb-2-8-cli-deb-2-8-clilsmm-deb-2-8-clivmh"><h3 id="heading-deb-2-8-cli-deb-2-8-clilsmm-deb-2-8-clivmh">lsmm &ndash;vmhost: List VM hosts</h3></a></p>
<p>Here&rsquo;s a recipe that gives a quick overview of your existing VM hosts:</p>
<pre><code>maas admin vm-deb-2-8-clihosts read | jq -deb-2-8-clir '(["ID","VM-deb-2-8-cliHOST","SYSID","CORES","USED","RAM",
"USED","STORAGE", "USED"] | (., map(length*"-deb-2-8-cli"))), (.[]| [.id,.name,.host.system_id,
.total.cores, .used.cores, .total.memory, .used.memory,.total.local_storage,
.used.local_storage]) | @tsv' | column -deb-2-8-clit
</code></pre>
<p>And here it is as part of an expanded <code>lsmm</code> script, under the new option <code>-deb-2-8-clivmh</code>:</p>
<pre><code>#!/bin/bash
# lsmm -deb-2-8-cli list maas machines
# make sure to chmod this file so it can execute
# and make sure it's in the path (if you're not typing "./")
#
if [ -deb-2-8-cliz "$1" ]
   then
maas admin machines read | jq -deb-2-8-clir '(["HOSTNAME","SYSID","POWER","STATUS",
"OWNER", "POOL", "VLAN","FABRIC","SUBNET"] | (., map(length*"-deb-2-8-cli"))),
(.[] | [.hostname, .system_id, .power_state, .status_name, .owner, .pool.name,
.boot_interface.vlan.name, .boot_interface.vlan.fabric,
.boot_interface.links[0].subnet.name]) | @tsv' | column -deb-2-8-clit
fi

if [ "$1" == "-deb-2-8-clit" ]
   then
maas admin machines read | jq -deb-2-8-clir '(["HOSTNAME","SYSID","POWER","STATUS",
"OWNER", "TAGS", "POOL", "VLAN","FABRIC","SUBNET"] | (., map(length*"-deb-2-8-cli"))),
(.[] | [.hostname, .system_id, .power_state, .status_name, .owner // "-deb-2-8-cli", 
.tag_names[0] // "-deb-2-8-cli", .pool.name,
.boot_interface.vlan.name, .boot_interface.vlan.fabric,
.boot_interface.links[0].subnet.name]) | @tsv' | column -deb-2-8-clit
fi

if [ "$1" == "-deb-2-8-cli-deb-2-8-clivmhost" ]
   then
maas admin vm-deb-2-8-clihosts read | jq -deb-2-8-clir '(["ID","VM-deb-2-8-cliHOST","SYSID","CORES","USED","RAM",
"USED","STORAGE", "USED"] | (., map(length*"-deb-2-8-cli"))), (.[]| [.id,.name,.host.system_id,
.total.cores, .used.cores, .total.memory, .used.memory,.total.local_storage,
.used.local_storage]) | @tsv' | column -deb-2-8-clit
fi
</code></pre>
<p>Remember to chmod and path the script so it will run.</p>
<p><a href="#heading-deb-2-8-cli-deb-2-8-clilsmm-deb-2-8-clivmhc"><h3 id="heading-deb-2-8-cli-deb-2-8-clilsmm-deb-2-8-clivmhc">lsmm &ndash;vmhost -deb-2-8-clic: List VM host configurable parameters</h3></a></p>
<p>Here&rsquo;s a command line recipe to list the configurable parameters of a specific host:</p>
<pre><code>maas admin vm-deb-2-8-clihost read $ID | jq -deb-2-8-clir '([&quot;ID&quot;,&quot;NAME&quot;,&quot;POOL&quot;,&quot;ZONE&quot;,
&quot;CPU-deb-2-8-cliO/C&quot;, &quot;RAM-deb-2-8-cliO/C&quot;, &quot;TAGS&quot;] | (., map(length*&quot;-deb-2-8-cli&quot;))), (.| [.id,.name,
.pool.name, .zone.name,.cpu_over_commit_ratio, 
.memory_over_commit_ratio, .tags[]]) | @tsv' | column -deb-2-8-clit
</code></pre>

<p>where $ID is the VM host ID (not the System ID; run <code>lsmm -deb-2-8-cli-deb-2-8-clivmhost</code> if you&rsquo;re not sure).  Here&rsquo;s an updated version of <code>lsmm</code> with the <code>-deb-2-8-clivmhost -deb-2-8-clic</code> options:</p>
<pre><code>#!/bin/bash 
# lsmm -deb-2-8-cli list maas machines 
# make sure to chmod this file so it can execute 
# and make sure it's in the path (if you're not typing &quot;./&quot;) 
# 
# for the &quot;-deb-2-8-clivmhost -deb-2-8-clic&quot; option, don't forget to type $3 as the ID of the VM host 
# 
if [ -deb-2-8-cliz &quot;$1&quot; ] 
   then 
    maas admin machines read | jq -deb-2-8-clir '([&quot;HOSTNAME&quot;,&quot;SYSID&quot;,&quot;POWER&quot;,&quot;STATUS&quot;, 
    &quot;OWNER&quot;, &quot;POOL&quot;, &quot;VLAN&quot;,&quot;FABRIC&quot;,&quot;SUBNET&quot;] | (., map(length*&quot;-deb-2-8-cli&quot;))), 
    (.[] | [.hostname, .system_id, .power_state, .status_name, .owner, .pool.name, 
    .boot_interface.vlan.name, .boot_interface.vlan.fabric, 
    .boot_interface.links[0].subnet.name]) | @tsv' | column -deb-2-8-clit 
elif [ &quot;$1&quot; == &quot;-deb-2-8-clit&quot; ] 
     then 
    maas admin machines read | jq -deb-2-8-clir '([&quot;HOSTNAME&quot;,&quot;SYSID&quot;,&quot;POWER&quot;,&quot;STATUS&quot;, 
    &quot;OWNER&quot;, &quot;TAGS&quot;, &quot;POOL&quot;, &quot;VLAN&quot;,&quot;FABRIC&quot;,&quot;SUBNET&quot;] | (., map(length*&quot;-deb-2-8-cli&quot;))), 
    (.[] | [.hostname, .system_id, .power_state, .status_name, .owner // &quot;-deb-2-8-cli&quot;, 
    .tag_names[0] // &quot;-deb-2-8-cli&quot;, .pool.name, 
    .boot_interface.vlan.name, .boot_interface.vlan.fabric, 
    .boot_interface.links[0].subnet.name]) | @tsv' | column -deb-2-8-clit 
elif [ &quot;$1&quot; == &quot;-deb-2-8-cli-deb-2-8-clivmhost&quot; -deb-2-8-clia -deb-2-8-cliz &quot;$2&quot; ]
     then 
    maas admin vm-deb-2-8-clihosts read | jq -deb-2-8-clir '([&quot;ID&quot;,&quot;VM-deb-2-8-cliHOST&quot;,&quot;SYSID&quot;,&quot;CORES&quot;,&quot;USED&quot;,&quot;RAM&quot;, 
    &quot;USED&quot;,&quot;STORAGE&quot;, &quot;USED&quot;] | (., map(length*&quot;-deb-2-8-cli&quot;))), (.[]| [.id,.name,.host.system_id, 
    .total.cores, .used.cores, .total.memory, .used.memory,.total.local_storage, 
    .used.local_storage]) | @tsv' | column -deb-2-8-clit 
elif [ &quot;$1&quot; == &quot;-deb-2-8-cli-deb-2-8-clivmhost&quot; -deb-2-8-clia &quot;$2&quot; == &quot;-deb-2-8-clic&quot; ]
     then 
    maas admin vm-deb-2-8-clihost read $3 | jq -deb-2-8-clir '([&quot;ID&quot;,&quot;NAME&quot;,&quot;POOL&quot;,&quot;ZONE&quot;, 
    &quot;CPU-deb-2-8-cliO/C&quot;, &quot;RAM-deb-2-8-cliO/C&quot;, &quot;TAGS&quot;] | (., map(length*&quot;-deb-2-8-cli&quot;))), (.| [.id,.name, 
    .pool.name, .zone.name,.cpu_over_commit_ratio, 
    .memory_over_commit_ratio, .tags[]]) | @tsv' | column -deb-2-8-clit
fi 
</code></pre>

<p>Don&rsquo;t forget to invoke this script with two parameters, like this:</p>
<pre><code>lsmm -deb-2-8-cli-deb-2-8-clivmhost -deb-2-8-clic $ID
</code></pre>

<p>So if your desired VM host is ID 4, you&rsquo;d type:</p>
<pre><code>lsmm -deb-2-8-cli-deb-2-8-clivmhost -deb-2-8-clic 4
</code></pre>

<h2>Recipes for creating MAAS machines</h2>

<p>The following scripts walk you through creating MAAS machines of various types.  In these simple recipes, there&rsquo;s <strong>no validation</strong> of input, so use at your own risk &ndash; although it would be trivial to add validation for your favourite machine types.</p>
<p>&lt;a href=&rdquo;#ion** of input, so use at your own risk &ndash; although it would be trivial to add validation for your favourite machine types.</p>
<p><a href="#><h3 id="><h3 id="><h3 id="heading-deb-2-8-cli-deb-2-8-climake-deb-2-8-climachines">Make a libvirt VM</h3></a></a></p>
<p>This very basic recipe creates a libvirt virtual machine.  The parameters can be entered interactively (<code>&lt;scriptname&gt; -deb-2-8-cli-deb-2-8-clikvm -deb-2-8-clii</code>) or in &ldquo;batch&rdquo; mode (for scripting commands in a batch shellscript) by using <code>&lt;scriptname&gt; -deb-2-8-cli-deb-2-8-clikvm -deb-2-8-clib</code>, where <scriptname> is up to you:</p>
<pre><code>#!/bin/bash
#
# MAAS CLI make machines recipe
#  -deb-2-8-cli-deb-2-8-clikvm = create a libvirt KVM
#
# -deb-2-8-clii = interactive mode
# -deb-2-8-clib = batch mode

if [ &quot;$1&quot; == &quot;-deb-2-8-cli-deb-2-8-clikvm&quot; -deb-2-8-clia &quot;$2&quot; == &quot;-deb-2-8-clii&quot; ]
   then
    read -deb-2-8-clip &quot;architecture? &quot; arch
    read -deb-2-8-clip &quot;MAC address? &quot; macaddr
    read -deb-2-8-clip &quot;power ID? &quot; powerid
    read -deb-2-8-clip &quot;power address? &quot; poweraddr
    read -deb-2-8-clip &quot;power password? &quot; powerpw
    maas admin machines create \
    architecture=$arch \
    mac_addresses=$macaddr \
    power_type=virsh \
    power_parameters_power_id=$powerid \
    power_parameters_power_address=$poweraddr \
    power_parameters_power_pass=$powerpw
elif [ &quot;$1&quot; == &quot;-deb-2-8-cli-deb-2-8-clikvm&quot; -deb-2-8-clia &quot;$2&quot; == &quot;-deb-2-8-clib&quot; ]
    then
    maas admin machines create \
    architecture=$3 \
    mac_addresses=$4 \
    power_type=virsh \
    power_parameters_power_id=$5 \
    power_parameters_power_address=$6 \
    power_parameters_power_pass=$7
fi
</code></pre>

<p>In interactive mode, the script prompts you for all needed parameters; note that the power type isn&rsquo;t needed, because it&rsquo;s &ldquo;virsh&rdquo; in this case.  Interactive mode looks like this:</p>
<pre><code>stormrider@wintermute:tmp$ foo -deb-2-8-cli-deb-2-8-clikvm -deb-2-8-clii
architecture? amd64
MAC address? 52:54:00:1e:a5:7e
power ID? e9f84356-deb-2-8-cli5106-deb-2-8-cli40ee-deb-2-8-cli9088-deb-2-8-cli3e35ec7d50cf
power address? qemu+ssh://stormrider@192.168.123.1/system
power password? xxxxxxx
</code></pre>

<p>If you prefer to batch your machine creation in shellscripts, you can use the <code>-deb-2-8-clib</code> option instead, like this:</p>
<pre><code>#!/bin/bash
foo -deb-2-8-cli-deb-2-8-clikvm -deb-2-8-clib amd64 52:54:00:1e:a5:7e e9f84356-deb-2-8-cli5106-deb-2-8-cli40ee-deb-2-8-cli9088-deb-2-8-cli3e35ec7d50cf qemu+ssh://stormrider@192.168.123.1/system xxxxxxx
</code></pre>

<p>This mode allows you to add a number of lines to a longer shellscript, facilitating automatic creation or even the use of a makefile (if you&rsquo;re creative).</p>
    </div>
  </body>
</html>