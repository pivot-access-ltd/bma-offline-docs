<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" type="text/css" href="css/stylesheet.css" />
    <style>
      #selector a:link{color:black;}
      #selector a:visited{color:black;}
      #selector a:active{color:black;}
      #selector a:hover{color:blue;}
      #sidebar a:link{color:black;}
      #sidebar a:visited{color:black;}
      #sidebar a:active{color:black;}
      #sidebar a:hover{color:blue;}
      ul {margin-deb-2-8-clileft:0;list-deb-2-8-clistyle-deb-2-8-clitype:none;}
      li {margin: 4px 0;}
    </style>
  </head>
  <body>
    <div id="selector" style="top:0; position:fixed; float:right; background-deb-2-8-clicolor:#d9d9d9; width:100%;border-deb-2-8-clibottom:1px solid black;">
      &nbsp;&nbsp;<strong>Offline docs</strong>
      <a href="https://maas.io/docs">(switch to live docs)</a>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
	<a href="../ui/vm-deb-2-8-clihosting.html">
	  &nbsp;UI-deb-2-8-clionly&nbsp;
	</a>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      <span style="background-deb-2-8-clicolor:white;border-deb-2-8-clitop:1px solid black; border-deb-2-8-clileft:1px solid black; border-deb-2-8-cliright:1px solid black; border-deb-2-8-clibottom:5px solid white;">
	  CLI-deb-2-8-clionly
      </span>
    </div>
    <div id="sidebar" style="float:left; width:25%;margin-deb-2-8-clitop:40px; margin-deb-2-8-clileft:20px">
      <strong>
	<a href="maas-deb-2-8-clidocumentation.html">
	  Introduction
	</a>
      </strong>
      <ul>
	<li>
	  <a href="about-deb-2-8-climaas.html">
	    About MAAS
	  </a>
	</li>
	<li>
	  <a href="give-deb-2-8-clime-deb-2-8-clian-deb-2-8-cliexample-deb-2-8-cliof-deb-2-8-climaas.html">
	    &ldquo;Give me an example&rdquo;
	  </a>
	</li>
	<li>
	  <a href="whats-deb-2-8-clinew-deb-2-8-cliin-deb-2-8-climaas.html">
	    What&rsquo;s new in 2.8
	  </a>
	</li>
	<li>
	  <a href="maas-deb-2-8-clirequirements.html">
	    Requirements
	  </a>
	</li>
	<li>
	  <a href="maas-deb-2-8-cliinstallation.html">
	    Installation
	  </a>
	</li>
	<li>
	  <a href="configuration-deb-2-8-clijourney.html">
	    Configuration journey
	  </a>
	</li>
      <strong>
	<a href="controllers.html">
	  Controllers
	</a>
      </strong>
      <ul>
	<li>
	  <a href="maas-deb-2-8-clicommunication.html">
	    Communication
	  </a>
	</li>
	<li>
	  <a href="rack-deb-2-8-clicontrollers.html">
	    Rack controllers
	  </a>
	</li>
	<li>
	  <a href="region-deb-2-8-clicontrollers.html">
	    Region controllers
	  </a>
	</li>
	<li>
	  <a href="high-deb-2-8-cliavailability.html">
	    High availability
	  </a>
	</li>
      </ul>
      <strong>
	<a href="machines.html">
	  Machines
	</a>
      </strong>
      <ul>
	<li>
	  <a href="add-deb-2-8-climachines.html">
	    Add machines
	  </a>
	</li>
	<li>
	  <a href="power-deb-2-8-climanagement.html">
	    Power management
	  </a>
	</li>
	<li>
	  <a href="commission-deb-2-8-climachines.html">
	    Commission machines
	  </a>
	</li>
	<li>Testing
	</li>
	<li>
	  <a href="hardware-deb-2-8-clitesting.html">
	    Hardware testing
	  </a>
	</li>
	<li>
	  <a href="network-deb-2-8-clitesting.html">
	    Network testing
	  </a>
	</li>
	<li>
	  <a href="commissioning-deb-2-8-cliand-deb-2-8-clihardware-deb-2-8-clitesting-deb-2-8-cliscripts.html">
	    Commissioning and hardware testing scripts
	  </a>
	</li>
	<li>
	  <a href="deploy-deb-2-8-climachines.html">
	    Deploy machines
	  </a>
	</li>
	<li>
	  <a href="maas-deb-2-8-clitags.html">
	    Tags
	  </a>
	</li>
	<li>
	  <a href="custom-deb-2-8-climachine-deb-2-8-clisetup.html">
	    Custom machine setup
	  </a>
	</li>
	<li>
	  <a href="kernel-deb-2-8-cliboot-deb-2-8-clioptions.html">
	    Kernel boot options
	  </a>
	</li>
	<li>
	  <a href="resource-deb-2-8-clipools.html">
	    Resource pools
	  </a>
	</li>
	<li>
	  <a href="storage.html">
	    Storage
	  </a>
	</li>
	<li>
	  <a href="vmware-deb-2-8-clivmfs-deb-2-8-clidatastores.html">
	    VMware VMFS datastores
	  </a>
	</li>
	<li>
	  <a href="ubuntu-deb-2-8-clikernels.html">
	    Ubuntu kernels
	  </a>
	</li>
      </ul>
      <strong>
	<a href="images.html">
	  Images
	</a>
      </strong>
      <ul>
	<li>
	  <a href="select-deb-2-8-cliand-deb-2-8-cliimport-deb-2-8-cliimages.html">
	    Select and import images
	  </a>
	</li>
	<li>
	  <a href="local-deb-2-8-cliimage-deb-2-8-climirror.html">
	    Local image mirror
	  </a>
	</li>
	<li>
	  <a href="vmware-deb-2-8-cliimages.html">
	    VMWare images
	  </a>
	</li>
      </ul>
      <strong>
	<a href="networking.html">
	  Networking
	</a>
      </strong>
      <ul>
	<li>
	  <a href="subnet-deb-2-8-climanagement.html">
	    Subnet management
	  </a>
	</li>
	<li>
	  <a href="managing-deb-2-8-clidhcp.html">
	    DHCP
	  </a>
	</li>
	<li>
	  <a href="ip-deb-2-8-cliranges.html">
	    IP ranges
	  </a>
	</li>
	<li>
	  <a href="proxy.html">
	    Proxy
	  </a>
	</li>
	<li>
	  <a href="ntp-deb-2-8-cliservices.html">
	    NTP
	  </a>
	</li>
	<li>
	  <a href="network-deb-2-8-clidiscovery.html">
	    Network discovery
	  </a>
	</li>
	<li>
	  <a href="ipv6-deb-2-8-cliaddressing.html">
	    IPv6
	  </a>
	</li>
	<li>
	  <a href="configuring-deb-2-8-clitls-deb-2-8-cliencryption.html">
	    SSL
	  </a>
	</li>
	<li>
	  <a href="managing-deb-2-8-clistp.html">
	    STP
	  </a>
	</li>
	<li>
	  <a href="availability-deb-2-8-clizones.html">
	    Availability zones (AZs)
	  </a>
	</li>
      </ul>
      <strong>
	<a href="vm-deb-2-8-clihosting.html">
	  VM hosting
	</a>
      </strong>
      <ul>
	<li>
	  <a href="vm-deb-2-8-clihost-deb-2-8-clinetworking.html">
	    VM host networking
	  </a>
	</li>
	<li>
	  <a href="adding-deb-2-8-clia-deb-2-8-clivm-deb-2-8-clihost.html">
	    Add a VM host
	  </a>
	</li>
	<li>
	  <a href="vm-deb-2-8-clihost-deb-2-8-clistorage-deb-2-8-clipools.html">
	    VM host storage pools
	  </a>
	</li>
	<li>
	  <a href="creating-deb-2-8-cliand-deb-2-8-clideleting-deb-2-8-clivms.html">
	    Creating and deleting VMs
	  </a>
	</li>
      </ul>
      <strong>Operations
      </strong>
      <ul>
	<li>
	  <a href="prometheus-deb-2-8-climetrics.html">
	    Prometheus metrics
	  </a>
	</li>
	<li>
	  <a href="backup.html">
	    Backup
	  </a>
	</li>
	<li>
	  <a href="hardening-deb-2-8-cliyour-deb-2-8-climaas-deb-2-8-cliinstallation.html">
	    MAAS security
	  </a>
	</li>
	<li>
	  <a href="maas-deb-2-8-clilogging.html">
	    Logging
	  </a>
	</li>
	<li>
	  <a href="commissioning-deb-2-8-clilogs.html">
	    Commissioning logs
	  </a>
	</li>
	<li>
	  <a href="user-deb-2-8-cliaccounts.html">
	    User accounts
	  </a>
	</li>
	<li>
	  <a href="interactive-deb-2-8-clisearch.html">
	    Interactive search
	  </a>
	</li>
      </ul>
      <strong>
	<a href="concepts-deb-2-8-cliand-deb-2-8-cliterms.html">
	  Concepts &amp; terms
	</a>
      </strong>
      <ul>
	<li>
	  <a href="concepts-deb-2-8-cliand-deb-2-8-cliterms.html#heading-deb-2-8-cli-deb-2-8-clinetwork-deb-2-8-clitutorial">
	    Brief network tutorial
	  </a>
	</li>
      </ul>
      <strong>
	<a href="maas-deb-2-8-clicli.html">
	  CLI
	</a>
      </strong>
      <ul>
	<li>
	  <a href="common-deb-2-8-clicli-deb-2-8-clitasks.html">
	    The CLI cookbook
	  </a>
	</li>
	<li>
	  <a href="common-deb-2-8-clicli-deb-2-8-clitasks.html">
	    Common tasks
	  </a>
	</li>
	<li>
	  <a href="audit-deb-2-8-clievent-deb-2-8-clilogs.html">
	    Audit event logs
	  </a>
	</li>
	<li>
	  <a href="cli-deb-2-8-clikernel-deb-2-8-climanagement.html">
	    Kernel management
	  </a>
	</li>
	<li>
	  <a href="cli-deb-2-8-cliimage-deb-2-8-climanagement.html">
	    Image management
	  </a>
	</li>
	<li>
	  <a href="cli-deb-2-8-cliinterface-deb-2-8-climanagement.html">
	    Interface management
	  </a>
	</li>
	<li>
	  <a href="cli-deb-2-8-cliadvanced-deb-2-8-clitasks.html">
	    Advanced tasks
	  </a>
	</li>
	<li>
	  <a href="cli-deb-2-8-clicomposable-deb-2-8-clihardware.html">
	    Composable hardware
	  </a>
	</li>
	<li>
	  <a href="python-deb-2-8-cliapi-deb-2-8-cliclient.html">
	    API client
	  </a>
	</li>
      </ul>
      <strong>
	<a href="api.html">
	  API documentation
	</a>
      </strong>
      <ul>
	<li>
	  <a href="api-deb-2-8-cliauthentication.html">
	    API authentication
	  </a>
	</li>
      </ul>
      <strong>
	<a href="troubleshooting.html">
	  Troubleshoot
	</a>
      </strong>
      <ul>
	<li>
	  <a href="getting-deb-2-8-clihelp.html">
	    Getting help
	  </a>
	</li>
	<li>
	  <a href="tips-deb-2-8-clitricks-deb-2-8-cliand-deb-2-8-clitraps.html">
	    Tips, tricks, and traps
	  </a>
	</li>
	<li>
	  <a href="https://old-deb-2-8-clidocs.maas.io/2.5/en/">
	    MAAS 2.5 (+ earlier) doc
	  </a>
	</li>
      </ul>
      <strong>
	<a href="whats-deb-2-8-clinew-deb-2-8-cliin-deb-2-8-climaas.html">
	  Release notes
	</a>
      </strong>
      <p/>
      <strong>
	<a href="writing-deb-2-8-cliguide.html">
	  Help improve these docs
	</a>
      </strong>
    </div>
    <div class="container" style="float:right; width:65%; margin-deb-2-8-clitop:40px; margin-deb-2-8-cliright:30px">
      <h1>VM hosting</h1><!-deb-2-8-cli-deb-2-8-cli deb-deb-2-8-cli2-deb-2-8-cli7-deb-2-8-clicli
 deb-deb-2-8-cli2-deb-2-8-cli7-deb-2-8-clicli -deb-2-8-cli-deb-2-8-cli>

<!-deb-2-8-cli-deb-2-8-cli deb-deb-2-8-cli2-deb-2-8-cli7-deb-2-8-cliui
 deb-deb-2-8-cli2-deb-2-8-cli7-deb-2-8-cliui -deb-2-8-cli-deb-2-8-cli>

<!-deb-2-8-cli-deb-2-8-cli deb-deb-2-8-cli2-deb-2-8-cli8-deb-2-8-cliui
 deb-deb-2-8-cli2-deb-2-8-cli8-deb-2-8-cliui -deb-2-8-cli-deb-2-8-cli>

<!-deb-2-8-cli-deb-2-8-cli deb-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-clicli
 deb-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-clicli -deb-2-8-cli-deb-2-8-cli>

<!-deb-2-8-cli-deb-2-8-cli deb-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-cliui
 deb-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-cliui -deb-2-8-cli-deb-2-8-cli>

<!-deb-2-8-cli-deb-2-8-cli snap-deb-2-8-cli2-deb-2-8-cli7-deb-2-8-clicli
 snap-deb-2-8-cli2-deb-2-8-cli7-deb-2-8-clicli -deb-2-8-cli-deb-2-8-cli>

<!-deb-2-8-cli-deb-2-8-cli snap-deb-2-8-cli2-deb-2-8-cli7-deb-2-8-cliui
 snap-deb-2-8-cli2-deb-2-8-cli7-deb-2-8-cliui -deb-2-8-cli-deb-2-8-cli>

<!-deb-2-8-cli-deb-2-8-cli snap-deb-2-8-cli2-deb-2-8-cli8-deb-2-8-clicli
 snap-deb-2-8-cli2-deb-2-8-cli8-deb-2-8-clicli -deb-2-8-cli-deb-2-8-cli>

<!-deb-2-8-cli-deb-2-8-cli snap-deb-2-8-cli2-deb-2-8-cli8-deb-2-8-cliui
 snap-deb-2-8-cli2-deb-2-8-cli8-deb-2-8-cliui -deb-2-8-cli-deb-2-8-cli>

<!-deb-2-8-cli-deb-2-8-cli snap-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-clicli
 snap-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-clicli -deb-2-8-cli-deb-2-8-cli>

<!-deb-2-8-cli-deb-2-8-cli snap-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-cliui
 snap-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-cliui -deb-2-8-cli-deb-2-8-cli>

<p>MAAS VM hosts allow for the dynamic composition of nodes from a pool of available hardware resources (e.g. disk space, memory, cores).  You can create virtual machines (VMs) as needed within the limits of your resources, without concern for physical hardware.  MAAS currently supports VM hosts and VMs created via <a href="https://ubuntu.com/server/docs/virtualization-deb-2-8-clilibvirt">libvirt^</a>.  As part of MAAS 2.8, we also support LXD VMs and VM hosts as a Beta feature.</p>
<p>VM hosts are particularly useful for Juju integration, allowing for dynamic allocation of VMs with custom interface constraints. Alternatively, if you would like to use MAAS to manage a collection of VMs, the robust web UI allows you to easily create and manage VMs, logically grouped by VM host.  Six conspicuous features include:</p>
<ol>
<li>Juju integration</li>
<li>At-deb-2-8-clia-deb-2-8-cliglance visual tools for easy resource management</li>
<li>Set overcommit ratios for physical resources such as CPU and RAM</li>
<li>Assign VMs to resource pools to segregate your VMs into logical groupings</li>
<li>Track VM host storage pool usage and assign default storage pools</li>
<li>Create VMs on multiple networks, specified by space, subnet, VLAN, or IP address</li>
</ol>
<p>This section will lead you through the creation, usage, and management of VM hosts.  Note that, as LXD VM hosts are still in Beta, some screen terminology has not yet been changed to reflect &ldquo;VM host&rdquo; instead of &ldquo;KVM.&rdquo;  You will still use the &ldquo;KVM&rdquo; tab on the top of the MAAS dashboard to reach the VM host functionality, and you may see buttons which refer to &ldquo;Add KVM,&rdquo; for example, instead of &ldquo;Add VM host.&rdquo;  Rest assured that the Beta LXD VM host functionality is fully available through these channels.</p>
<!-deb-2-8-cli-deb-2-8-cli deb-deb-2-8-cli2-deb-2-8-cli7-deb-2-8-clicli
#### Four questions you may have:

1. [What is a VM host?](#heading-deb-2-8-cli-deb-2-8-cliwhat-deb-2-8-cliis-deb-2-8-clia-deb-2-8-clivm-deb-2-8-clihost)
2. [Which VM host should I use: LXD or KVM?](#heading-deb-2-8-cli-deb-2-8-clichoosing-deb-2-8-clivm-deb-2-8-clihost-deb-2-8-clitype)
3. [How do I set up SSH for use by libvirt?](vm-deb-2-8-clihost-deb-2-8-clinetworking.html#heading-deb-2-8-cli-deb-2-8-cliset-deb-2-8-cliup-deb-2-8-clissh)
4. [How do I add a VM host?](adding-deb-2-8-clia-deb-2-8-clivm-deb-2-8-clihost.html)
 deb-deb-2-8-cli2-deb-2-8-cli7-deb-2-8-clicli -deb-2-8-cli-deb-2-8-cli>

<!-deb-2-8-cli-deb-2-8-cli deb-deb-2-8-cli2-deb-2-8-cli7-deb-2-8-cliui
#### Four questions you may have:

1. [What is a VM host?](#heading-deb-2-8-cli-deb-2-8-cliwhat-deb-2-8-cliis-deb-2-8-clia-deb-2-8-clivm-deb-2-8-clihost)
2. [Which VM host should I use: LXD or KVM?](#heading-deb-2-8-cli-deb-2-8-clichoosing-deb-2-8-clivm-deb-2-8-clihost-deb-2-8-clitype)
3. [How do I set up SSH for use by libvirt?](vm-deb-2-8-clihost-deb-2-8-clinetworking.html#heading-deb-2-8-cli-deb-2-8-cliset-deb-2-8-cliup-deb-2-8-clissh)
4. [How do I add a VM host?](adding-deb-2-8-clia-deb-2-8-clivm-deb-2-8-clihost.html)
 deb-deb-2-8-cli2-deb-2-8-cli7-deb-2-8-cliui -deb-2-8-cli-deb-2-8-cli>

<h4>Four questions you may have:</h4>
<ol>
<li><a href="#heading-deb-2-8-cli-deb-2-8-cliwhat-deb-2-8-cliis-deb-2-8-clia-deb-2-8-clivm-deb-2-8-clihost">What is a VM host?</a></li>
<li><a href="#heading-deb-2-8-cli-deb-2-8-clichoosing-deb-2-8-clivm-deb-2-8-clihost-deb-2-8-clitype">Which VM host should I use: LXD or KVM?</a></li>
<li><a href="vm-deb-2-8-clihost-deb-2-8-clinetworking.html#heading-deb-2-8-cli-deb-2-8-cliset-deb-2-8-cliup-deb-2-8-clissh">How do I set up SSH for use by libvirt?</a></li>
<li><a href="adding-deb-2-8-clia-deb-2-8-clivm-deb-2-8-clihost.html">How do I add a VM host?</a></li>
</ol>
<!-deb-2-8-cli-deb-2-8-cli deb-deb-2-8-cli2-deb-2-8-cli8-deb-2-8-cliui
#### Four questions you may have:

1. [What is a VM host?](#heading-deb-2-8-cli-deb-2-8-cliwhat-deb-2-8-cliis-deb-2-8-clia-deb-2-8-clivm-deb-2-8-clihost)
2. [Which VM host should I use: LXD or KVM?](#heading-deb-2-8-cli-deb-2-8-clichoosing-deb-2-8-clivm-deb-2-8-clihost-deb-2-8-clitype)
3. [How do I set up SSH for use by libvirt?](vm-deb-2-8-clihost-deb-2-8-clinetworking.html#heading-deb-2-8-cli-deb-2-8-cliset-deb-2-8-cliup-deb-2-8-clissh)
4. [How do I add a VM host?](adding-deb-2-8-clia-deb-2-8-clivm-deb-2-8-clihost.html)
 deb-deb-2-8-cli2-deb-2-8-cli8-deb-2-8-cliui -deb-2-8-cli-deb-2-8-cli>

<!-deb-2-8-cli-deb-2-8-cli deb-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-clicli
#### Nine questions you may have:

1. [What is a VM host?](#heading-deb-2-8-cli-deb-2-8-cliwhat-deb-2-8-cliis-deb-2-8-clia-deb-2-8-clivm-deb-2-8-clihost)
2. [Which VM host should I use: LXD or KVM?](#heading-deb-2-8-cli-deb-2-8-clichoosing-deb-2-8-clivm-deb-2-8-clihost-deb-2-8-clitype)
3. [How do I set up SSH for use by libvirt?](vm-deb-2-8-clihost-deb-2-8-clinetworking.html#heading-deb-2-8-cli-deb-2-8-cliset-deb-2-8-cliup-deb-2-8-clissh)
4. [How do I add a VM host?](adding-deb-2-8-clia-deb-2-8-clivm-deb-2-8-clihost.html)
5. [How do I see resources for a specific NUMA node?](#heading-deb-2-8-cli-deb-2-8-clinuma-deb-2-8-clinode-deb-2-8-cliresources)
6. [How do I pin NUMA nodes to specific cores?](#heading-deb-2-8-cli-deb-2-8-clipin-deb-2-8-clinuma-deb-2-8-clinodes)
7. [How do I see resources for NUMA-deb-2-8-clinode-deb-2-8-clibearing VM hosts?](#heading-deb-2-8-cli-deb-2-8-clinuma-deb-2-8-clivm-deb-2-8-clihost-deb-2-8-cliresources)
8. [How do I see the alignment between VM host interfaces and NUMA nodes?](#heading-deb-2-8-cli-deb-2-8-clinuma-deb-2-8-clialignment)
9. [How do I configure and use hugepages on my VMs?](#heading-deb-2-8-cli-deb-2-8-cliconfigure-deb-2-8-clihugepages)
 deb-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-clicli -deb-2-8-cli-deb-2-8-cli>

<!-deb-2-8-cli-deb-2-8-cli deb-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-cliui
#### Seven questions you may have:

1. [What is a VM host?](#heading-deb-2-8-cli-deb-2-8-cliwhat-deb-2-8-cliis-deb-2-8-clia-deb-2-8-clivm-deb-2-8-clihost)
2. [Which VM host should I use: LXD or KVM?](#heading-deb-2-8-cli-deb-2-8-clichoosing-deb-2-8-clivm-deb-2-8-clihost-deb-2-8-clitype)
3. [How do I set up SSH for use by libvirt?](vm-deb-2-8-clihost-deb-2-8-clinetworking.html#heading-deb-2-8-cli-deb-2-8-cliset-deb-2-8-cliup-deb-2-8-clissh)
4. [How do I add a VM host?](adding-deb-2-8-clia-deb-2-8-clivm-deb-2-8-clihost.html)
5. [How do I see resources for a specific NUMA node?](#heading-deb-2-8-cli-deb-2-8-clinuma-deb-2-8-clinode-deb-2-8-cliresources)
6. [How do I see resources for NUMA-deb-2-8-clinode-deb-2-8-clibearing VM hosts?](#heading-deb-2-8-cli-deb-2-8-clinuma-deb-2-8-clivm-deb-2-8-clihost-deb-2-8-cliresources)
7. [How do I see the alignment between VM host interfaces and NUMA nodes?](#heading-deb-2-8-cli-deb-2-8-clinuma-deb-2-8-clialignment)
 deb-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-cliui -deb-2-8-cli-deb-2-8-cli>

<!-deb-2-8-cli-deb-2-8-cli snap-deb-2-8-cli2-deb-2-8-cli7-deb-2-8-clicli
#### Four questions you may have:

1. [What is a VM host?](#heading-deb-2-8-cli-deb-2-8-cliwhat-deb-2-8-cliis-deb-2-8-clia-deb-2-8-clivm-deb-2-8-clihost)
2. [Which VM host should I use: LXD or KVM?](#heading-deb-2-8-cli-deb-2-8-clichoosing-deb-2-8-clivm-deb-2-8-clihost-deb-2-8-clitype)
3. [How do I set up SSH for use by libvirt?](vm-deb-2-8-clihost-deb-2-8-clinetworking.html#heading-deb-2-8-cli-deb-2-8-cliset-deb-2-8-cliup-deb-2-8-clissh)
4. [How do I add a VM host?](adding-deb-2-8-clia-deb-2-8-clivm-deb-2-8-clihost.html)
 snap-deb-2-8-cli2-deb-2-8-cli7-deb-2-8-clicli -deb-2-8-cli-deb-2-8-cli>

<!-deb-2-8-cli-deb-2-8-cli snap-deb-2-8-cli2-deb-2-8-cli7-deb-2-8-cliui
#### Four questions you may have:

1. [What is a VM host?](#heading-deb-2-8-cli-deb-2-8-cliwhat-deb-2-8-cliis-deb-2-8-clia-deb-2-8-clivm-deb-2-8-clihost)
2. [Which VM host should I use: LXD or KVM?](#heading-deb-2-8-cli-deb-2-8-clichoosing-deb-2-8-clivm-deb-2-8-clihost-deb-2-8-clitype)
3. [How do I set up SSH for use by libvirt?](vm-deb-2-8-clihost-deb-2-8-clinetworking.html#heading-deb-2-8-cli-deb-2-8-cliset-deb-2-8-cliup-deb-2-8-clissh)
4. [How do I add a VM host?](adding-deb-2-8-clia-deb-2-8-clivm-deb-2-8-clihost.html)
 snap-deb-2-8-cli2-deb-2-8-cli7-deb-2-8-cliui -deb-2-8-cli-deb-2-8-cli>

<!-deb-2-8-cli-deb-2-8-cli snap-deb-2-8-cli2-deb-2-8-cli8-deb-2-8-clicli
#### Four questions you may have:

1. [What is a VM host?](#heading-deb-2-8-cli-deb-2-8-cliwhat-deb-2-8-cliis-deb-2-8-clia-deb-2-8-clivm-deb-2-8-clihost)
2. [Which VM host should I use: LXD or KVM?](#heading-deb-2-8-cli-deb-2-8-clichoosing-deb-2-8-clivm-deb-2-8-clihost-deb-2-8-clitype)
3. [How do I set up SSH for use by libvirt?](vm-deb-2-8-clihost-deb-2-8-clinetworking.html#heading-deb-2-8-cli-deb-2-8-cliset-deb-2-8-cliup-deb-2-8-clissh)
4. [How do I add a VM host?](adding-deb-2-8-clia-deb-2-8-clivm-deb-2-8-clihost.html)
 snap-deb-2-8-cli2-deb-2-8-cli8-deb-2-8-clicli -deb-2-8-cli-deb-2-8-cli>

<!-deb-2-8-cli-deb-2-8-cli snap-deb-2-8-cli2-deb-2-8-cli8-deb-2-8-cliui
#### Four questions you may have:

1. [What is a VM host?](#heading-deb-2-8-cli-deb-2-8-cliwhat-deb-2-8-cliis-deb-2-8-clia-deb-2-8-clivm-deb-2-8-clihost)
2. [Which VM host should I use: LXD or KVM?](#heading-deb-2-8-cli-deb-2-8-clichoosing-deb-2-8-clivm-deb-2-8-clihost-deb-2-8-clitype)
3. [How do I set up SSH for use by libvirt?](vm-deb-2-8-clihost-deb-2-8-clinetworking.html#heading-deb-2-8-cli-deb-2-8-cliset-deb-2-8-cliup-deb-2-8-clissh)
4. [How do I add a VM host?](adding-deb-2-8-clia-deb-2-8-clivm-deb-2-8-clihost.html)
 snap-deb-2-8-cli2-deb-2-8-cli8-deb-2-8-cliui -deb-2-8-cli-deb-2-8-cli>

<!-deb-2-8-cli-deb-2-8-cli snap-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-clicli
#### Nine questions you may have:

1. [What is a VM host?](#heading-deb-2-8-cli-deb-2-8-cliwhat-deb-2-8-cliis-deb-2-8-clia-deb-2-8-clivm-deb-2-8-clihost)
2. [Which VM host should I use: LXD or KVM?](#heading-deb-2-8-cli-deb-2-8-clichoosing-deb-2-8-clivm-deb-2-8-clihost-deb-2-8-clitype)
3. [How do I set up SSH for use by libvirt?](vm-deb-2-8-clihost-deb-2-8-clinetworking.html#heading-deb-2-8-cli-deb-2-8-cliset-deb-2-8-cliup-deb-2-8-clissh)
4. [How do I add a VM host?](adding-deb-2-8-clia-deb-2-8-clivm-deb-2-8-clihost.html)
5. [How do I see resources for a specific NUMA node?](#heading-deb-2-8-cli-deb-2-8-clinuma-deb-2-8-clinode-deb-2-8-cliresources)
6. [How do I pin NUMA nodes to specific cores?](#heading-deb-2-8-cli-deb-2-8-clipin-deb-2-8-clinuma-deb-2-8-clinodes)
7. [How do I see resources for NUMA-deb-2-8-clinode-deb-2-8-clibearing VM hosts?](#heading-deb-2-8-cli-deb-2-8-clinuma-deb-2-8-clivm-deb-2-8-clihost-deb-2-8-cliresources)
8. [How do I see the alignment between VM host interfaces and NUMA nodes?](#heading-deb-2-8-cli-deb-2-8-clinuma-deb-2-8-clialignment)
9. [How do I configure and use hugepages on my VMs?](#heading-deb-2-8-cli-deb-2-8-cliconfigure-deb-2-8-clihugepages)
 snap-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-clicli -deb-2-8-cli-deb-2-8-cli>

<!-deb-2-8-cli-deb-2-8-cli snap-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-cliui
#### Seven questions you may have:

1. [What is a VM host?](#heading-deb-2-8-cli-deb-2-8-cliwhat-deb-2-8-cliis-deb-2-8-clia-deb-2-8-clivm-deb-2-8-clihost)
2. [Which VM host should I use: LXD or KVM?](#heading-deb-2-8-cli-deb-2-8-clichoosing-deb-2-8-clivm-deb-2-8-clihost-deb-2-8-clitype)
3. [How do I set up SSH for use by libvirt?](vm-deb-2-8-clihost-deb-2-8-clinetworking.html#heading-deb-2-8-cli-deb-2-8-cliset-deb-2-8-cliup-deb-2-8-clissh)
4. [How do I add a VM host?](adding-deb-2-8-clia-deb-2-8-clivm-deb-2-8-clihost.html)
5. [How do I see resources for a specific NUMA node?](#heading-deb-2-8-cli-deb-2-8-clinuma-deb-2-8-clinode-deb-2-8-cliresources)
6. [How do I see the alignment between VM host interfaces and NUMA nodes?](#heading-deb-2-8-cli-deb-2-8-clinuma-deb-2-8-clialignment)
 snap-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-cliui -deb-2-8-cli-deb-2-8-cli>

<p><a href="#heading-deb-2-8-cli-deb-2-8-cliwhat-deb-2-8-cliis-deb-2-8-clia-deb-2-8-clivm-deb-2-8-clihost"><h2 id="heading-deb-2-8-cli-deb-2-8-cliwhat-deb-2-8-cliis-deb-2-8-clia-deb-2-8-clivm-deb-2-8-clihost">What is a VM host?</h2></a></p>
<p>Simply put, a VM host is a machine which is designated to run virtual machines (VMs).  A VM host divides its resources (CPU cores, RAM, storage) among the number of VMs you want to create, based on choices that you make when creating each VM.  It is also possible to overcommit resources &ndash; that is, use more resources than the VM host actually has available &ndash; as long as you use the VMs carefully. Once MAAS has enlisted, commissioned, and acquired a newly-deb-2-8-cliadded machine, you can deploy it as a VM host.</p>
<p><a href="#heading-deb-2-8-cli-deb-2-8-clichoosing-deb-2-8-clivm-deb-2-8-clihost-deb-2-8-clitype"><h2 id="heading-deb-2-8-cli-deb-2-8-clichoosing-deb-2-8-clivm-deb-2-8-clihost-deb-2-8-clitype">LXD VM host  (Beta) vs. libvirt</h2></a></p>
<p>Libvirt KVMs and LXD VMs are both based on the same underlying virtualisation technology, QEMU.  Unlike libvirt KVMs, though, LXD VMs can be managed without requiring SSH access to the VM host. LXD are remotely accessed via secure HTTP transport, which provides better security for LXD-deb-2-8-clibased VMs.  In addition, LXD has a better API, and is part of a much larger constellation of enterprise software, offering a wider range of future features and use cases.</p>
<!-deb-2-8-cli-deb-2-8-cli snap-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-cliui snap-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-clicli deb-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-cliui deb-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-clicli

<a href="#heading-deb-2-8-cli-deb-2-8-clivnuma"><h2 id="heading-deb-2-8-cli-deb-2-8-clivnuma">VMs and NUMA</h2></a>

MAAS provides extensive optimisation tools for using NUMA with virtual machines. Earlier versions of MAAS guarantee that machines are assigned to a single NUMA node that contains all the machine's resources.  As of 2.9, MAAS now allows you to see how many VMs are allocated to each NUMA node, along with the allocations of cores, storage, and memory.  You can quickly spot a VM running in multiple NUMA nodes, and optimise accordingly, with instant updates on pinning and allocations.  You can also tell which VMs are currently running.

In addition, you can get a bird's-deb-2-8-clieye view of network configuration:

1. You can see which VM NIC/bond is connected to which NUMA node.
2. You can tell when a NIC is connected to a different NUMA node.
3. You can tell if one of multiple NICs is not in the correct node.
4. You can confirm the subnet and space connecting to a VM.
5. You can confirm that a VM has the desired network properties, such as latency and throughput.
6. You can identify NICs that support SR-deb-2-8-cliIOV and tell how many VFs are available.

MAAS also shows hugepages information (if they are in use) and prevents overcommit when using them.  Hugepages essentially allow a much larger memory cache associated with the core.  This obviously reduces the number of times a core has to access memory, but because the core must swap entire hugepages, optimising usage of them can be complex. MAAS helps you create these optimisations by giving you a discrete view of hugepages associated with your VM, helping you decide whether you need to use them or not.
snap-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-cliui snap-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-clicli deb-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-cliui deb-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-clicli -deb-2-8-cli-deb-2-8-cli>

<!-deb-2-8-cli-deb-2-8-cli snap-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-clicli deb-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-clicli
<a href="#heading-deb-2-8-cli-deb-2-8-clinuma-deb-2-8-clinodes"><h2 id="heading-deb-2-8-cli-deb-2-8-clinuma-deb-2-8-clinodes">Support for NUMA, SR-deb-2-8-cliIOV, and hugepages</h2></a>

VM host management has been redesigned to support NUMA/SR-deb-2-8-cliIOV configurations and hugepages from the API/CLI.  Users can:

1. See resources per NUMA node.
2. Pin nodes to specific cores.
3. See resources for VM hosts bearing NUMA nodes.
4. See the alignment between VM host interfaces and NUMA nodes.
5. Configure and use hugepages.

This section explains how to access this new functionality.
 snap-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-clicli deb-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-clicli -deb-2-8-cli-deb-2-8-cli>

<!-deb-2-8-cli-deb-2-8-cli snap-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-cliui deb-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-cliui
<a href="#heading-deb-2-8-cli-deb-2-8-clinuma-deb-2-8-clinodes"><h3 id="heading-deb-2-8-cli-deb-2-8-clinuma-deb-2-8-clinodes">Support for NUMA, SR-deb-2-8-cliIOV, and hugepages</h3></a>

VM host management has been redesigned to support NUMA/SR-deb-2-8-cliIOV configurations and hugepages from the API/CLI.  Users can:

1. See resources per NUMA node.
2. See resources for VM hosts bearing NUMA nodes.
3. See the alignment between VM host interfaces and NUMA nodes.

Via the CLI, users can also pin nodes to specific cores, see more details about NUMA-deb-2-8-clibearing VM host resources, and configure hugepages; select the relevant "CLI" link in the top menu to access this information.

This section explains how to access this new functionality.
 snap-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-cliui deb-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-cliui -deb-2-8-cli-deb-2-8-cli>

<!-deb-2-8-cli-deb-2-8-cli snap-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-clicli deb-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-clicli
<a href="#heading-deb-2-8-cli-deb-2-8-clinuma-deb-2-8-clinode-deb-2-8-cliresources"><h3 id="heading-deb-2-8-cli-deb-2-8-clinuma-deb-2-8-clinode-deb-2-8-cliresources">Examine NUMA node resources</h3></a>

You can examine the resources of a NUMA node with the MAAS CLI.  A very basic way to do so is to enter the following command for a configured VM:


<pre><code>maas $PROFILE machine read $SYSTEM_ID
</code></pre>


In the resulting JSON output, look for the array entry ```numanode_set```, which will show the NUMA details for that specific VM:


<pre><code>&quot;numanode_set&quot;: [
     {
          &quot;index&quot;: 0,
      &quot;memory&quot;: 16384,
      &quot;cores&quot;: [
          0,
          2,
          1,
          3,
      ],
      &quot;hugepages_set&quot;: [
          {
              &quot;page_size&quot;: 2097152,
          &quot;total&quot;: 0
              }
      ]
     }
]
</code></pre>


<a href="#heading-deb-2-8-cli-deb-2-8-clipin-deb-2-8-clinuma-deb-2-8-clinodes"><h3 id="heading-deb-2-8-cli-deb-2-8-clipin-deb-2-8-clinuma-deb-2-8-clinodes">Pin NUMA nodes to specific cores</h3></a>

With the MAAS CLI, you can pin NUMA nodes to specific cores when composing a virtual machine.  For example, you can enter a command like this for a VM host you've already created:


<pre><code>maas $PROFILE vm-deb-2-8-clihost compose $VM_HOST_ID pinned_cores=1 pinned_cores=2
</code></pre>


<a href="#heading-deb-2-8-cli-deb-2-8-clinuma-deb-2-8-clivm-deb-2-8-clihost-deb-2-8-cliresources"><h3 id="heading-deb-2-8-cli-deb-2-8-clinuma-deb-2-8-clivm-deb-2-8-clihost-deb-2-8-cliresources">Examine resources for NUMA-deb-2-8-clinode-deb-2-8-clibearing VM hosts</h3></a>

With the MAAS CLI, you can get an overview of resource usage for an LXD host that's running NUMA VMs with the following command:


<pre><code>maas $PROFILE virtual-deb-2-8-climachines read
</code></pre>


Currently, the API does not give you an aggregated usage, as provided in the UI; hence you'll have to look at the VMs and sum up the usage data yourself.  You can see a list of pinned cores via this method, and we do show alignment of machines and NUMA nodes.

<a href="#heading-deb-2-8-cli-deb-2-8-clinuma-deb-2-8-clialignment"><h3 id="heading-deb-2-8-cli-deb-2-8-clinuma-deb-2-8-clialignment">Examine the alignment between VM host interfaces and NUMA nodes</h3></a>

To see an alignment of VM host interfaces and NUMA nodes via the CLI, you can use the command mentioned above:


<pre><code>maas $PROFILE machine read $SYSTEM_ID
</code></pre>


and focus on the `interface_block` section in the resulting JSON.  This will give you the alignment information you're seeking.

<a href="#heading-deb-2-8-cli-deb-2-8-cliconfigure-deb-2-8-clihugepages"><h3 id="heading-deb-2-8-cli-deb-2-8-cliconfigure-deb-2-8-clihugepages">Configure and use hugepages on my VMs</h3></a>

Configuring hugepages for VM use consists of two steps:

1. Creating a tag which includes a kernel option to use hugepages.
2. Composing a VM backed with hugepages, tagged with the newly-deb-2-8-clicreated tag.

Here are the specific commands:


<pre><code>maas $PROFILE tags create name=use-deb-2-8-clihugepages kernel_opts=default_hugepagesz=1G hugepages=20&quot;

maas $PROFILE vm-deb-2-8-clihost compose $VM_HOST_ID pinned_cores=$CORE_NUMBER hugepages_backed=true
</code></pre>

 snap-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-clicli deb-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-clicli -deb-2-8-cli-deb-2-8-cli>

<!-deb-2-8-cli-deb-2-8-cli snap-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-cliui deb-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-cliui
<a href="#heading-deb-2-8-cli-deb-2-8-clinuma-deb-2-8-clinode-deb-2-8-cliresources"><h3 id="heading-deb-2-8-cli-deb-2-8-clinuma-deb-2-8-clinode-deb-2-8-cliresources">Examine NUMA node resources</h3></a>

Within the MAAS UI, it is possible to view NUMA node resources for VM-deb-2-8-clihost-deb-2-8-clicomposed machines:

<a href="images/57245bbbfe6d28e83c9b7fb30e52caf05714eb00_2_485x500.png" target = "_blank"><img src="images/57245bbbfe6d28e83c9b7fb30e52caf05714eb00_2_485x500.png"></a></a> 

To reach this view, simply select the "KVM" item at the menu along the top, select a specific VM host, and select the "View by NUMA node" switch near the top right.

<a href="#heading-deb-2-8-cli-deb-2-8-clinuma-deb-2-8-clialignment"><h3 id="heading-deb-2-8-cli-deb-2-8-clinuma-deb-2-8-clialignment">Examine the alignment between VM host interfaces and NUMA nodes</h3></a>

To examine the alignment between VM host interfaces and NUMA nodes -deb-2-8-cli-deb-2-8-cli that is, the SR-deb-2-8-cliIOV configuration -deb-2-8-cli-deb-2-8-cli simply consult the "Virtual Functions" section of the NUMA resources diagram shown above, noting which network interfaces are mentioned.

 snap-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-cliui deb-deb-2-8-cli2-deb-2-8-cli9-deb-2-8-cliui -deb-2-8-cli-deb-2-8-cli>
    </div>
  </body>
</html>