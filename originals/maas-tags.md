<!-- deb-2-7-cli
 deb-2-7-cli -->

<!-- deb-2-7-ui
 deb-2-7-ui -->

<!-- deb-2-8-cli
 deb-2-8-cli -->

<!-- deb-2-8-ui
 deb-2-8-ui -->

<!-- deb-2-9-cli
 deb-2-9-cli -->

<!-- deb-2-9-ui
 deb-2-9-ui -->

<!-- snap-2-7-cli
 snap-2-7-cli -->

<!-- snap-2-7-ui
 snap-2-7-ui -->

<!-- snap-2-8-cli
 snap-2-8-cli -->

<!-- snap-2-8-ui
 snap-2-8-ui -->

<!-- snap-2-9-cli
 snap-2-9-cli -->

<!-- snap-2-9-ui
 snap-2-9-ui -->

Tags are a convenient way to assign descriptive words to machines, interfaces, and storage devices. Using MAAS tags, you can easily select machines that meet certain criteria, helping you to remember that you've defined or reserved certain machines for certain functions. 

<strong>NOTE:</strong> 
 Tag names can include any combination of letters, numbers, dashes (-) and underscores (_), and be a maximum of 256 characters in length.


<!-- snap-2-7-ui snap-2-8-ui snap-2-9-ui deb-2-7-ui deb-2-8-ui deb-2-9-ui
#### Quick questions you may have:

* [How are tags defined?](#heading--tag-definitions)
* [How can I see and filter the tag list?](#heading--tag-listing-and-tags-as-search-filters)
* [How do I see and change which tags are assigned?](#heading--tag-assignment)
* [How do I manage tags?](#heading--tag-management)

MAAS supports binding an XPath expressions to a tag using *tag definitions* (see below). This makes auto-assigning tags to matching hardware possible. For instance, you could tag machines that possess fast GPUs and then deploy software that used GPU-accelerated CUDA or OpenCL libraries.

Because [Juju](https://jujucharms.com/docs/stable/about-juju.html) is the recommended way to deploy services on machines managed by MAAS (see [below](#heading--tag-management)), it supports MAAS tags for application deployments. By specifying MAAS tags as Juju "constraints", services can be deployed to machines that have particular user-defined characteristics.

<h2 id="heading--tag-definitions">Tag definitions</h2>

A *tag definition* is the criteria by which machines are auto-labelled by the corresponding tag. During machine enlistment, MAAS collects hardware information (using the [lshw](http://ezix.org/project/wiki/HardwareLiSter) utility). The definition used in creating a tag is then constructed using an *XPath expression* based on that information. See [w3schools documentation](https://www.w3schools.com/xml/xpath_intro.asp) for details on XPath.

The collected data for each machine, viewable (in both XML and YAML) in the web UI, is inspected by you for the desired property. Building on the example alluded to above, a property can be a GPU with a clock speed greater than 1GHz. In this case, the following excerpt from a machine's data (in XML format) is pertinent:

``` nohighlight
      <lshw:node id="display" class="display" handle="PCI:0000:00:02.0">
       <lshw:description>VGA compatible controller</lshw:description>
       <lshw:product>GD 5446</lshw:product>
       <lshw:vendor>Cirrus Logic</lshw:vendor>
       <lshw:physid>2</lshw:physid>
       <lshw:businfo>pci@0000:00:02.0</lshw:businfo>
       <lshw:version>00</lshw:version>
       <lshw:width units="bits">32</lshw:width>
       <lshw:clock units="Hz">33000000</lshw:clock>
       <lshw:configuration>
        <lshw:setting id="latency" value="0"/>
       </lshw:configuration>
       <lshw:capabilities>
        <lshw:capability id="vga_controller"/>
       </lshw:capabilities>
       <lshw:resources>
        <lshw:resource type="memory" value="fc000000-fdffffff"/>
        <lshw:resource type="memory" value="febd0000-febd0fff"/>
        <lshw:resource type="memory" value="febc0000-febcffff"/>
       </lshw:resources>
      </lshw:node>
```

MAAS machines will be selected based on these XPath *predicates*:

-   *element* of 'node'
-   with an *attribute* of 'id'
-   whose *value* is 'display'
-   and has a *child element* of 'clock units="Hz"'

After adding the speed criteria via an XPath *operator* we end up with this as our tag definition:

``` nohighlight
//node[@id="display"]/'clock units="Hz"' > 1000000000
```

<h2 id="heading--tag-listing-and-tags-as-search-filters">Tag listing and tags as search filters</h2>

To list all tags, visit the 'Machines' tab and expand the 'Tags' subsection in the left pane.

In this view, you can use tags as machine search filters. Select one or several tags. The machines that satisfy all selected tags will display on the right pane. Notice there is a search field at the top of the right pane. You can type a search expression into this field.

Below, tag 'virtual' has been selected (with the mouse), and the search field automatically reflects this. Five machines satisfy this search filter.

<a href="https://assets.ubuntu.com/v1/69aa9997-nodes-tags__2.6-tags-filter.png" target = "_blank"><img src="https://assets.ubuntu.com/v1/69aa9997-nodes-tags__2.6-tags-filter.png"></a>

Remove a tag from the search filter by either hitting the 'x' character alongside a tag or editing the search expression.

<h2 id="heading--tag-assignment">Tag assignment</h2>

To view a machine's currently assigned tags, stay on the 'Machines' page and click on the machine in question. MAAS will display currently-assigned tags in the *Tags* pane of the 'Machine summary'.

Select the 'Configuration' tab and then the 'Edit' button alongside 'Machine configuration' to edit tags:

-   To unassign a tag hit the 'x' character alongside a tag.
-   To create a basic tag, type the name of the new tag in the 'Add a tag' field and hit Enter. The tag will be created and automatically assigned to the machine. Repeat if desired.
-   To assign an existing tag, type at least three characters to trigger a real-time search. Any resulting tags will show up in a drop-down menu. Select as desired.

<a href="https://assets.ubuntu.com/v1/250050ee-nodes-tags__2.6-tags-add-remove.png" target = "_blank"><img src="https://assets.ubuntu.com/v1/250050ee-nodes-tags__2.6-tags-add-remove.png"></a>

You can apply changes by pressing the 'Save changes' button.

<strong>NOTE:</strong> 
New tags become available as a filter in the 'Machines' page in the web UI immediately after you add them.


<h3 id="heading--tags-for-network-interfaces">Tags for network interfaces</h3>

It's also possible to assign tags to specific network interfaces. You can use these tags when searching for machines within the web UI and when allocating machines from the API.

Network interface tags can only be assigned when a machine is in either a 'Ready' or a 'Broken' state.

With the machine selected from the 'Machines' page, on the 'Interfaces' tab use the 'Edit Physical' button from the 'Actions' menu icon to the right of an interface:

<a href="https://assets.ubuntu.com/v1/dd9cf996-nodes-tags__2.6-tag-net-interfaces.png" target = "_blank"><img src="https://assets.ubuntu.com/v1/dd9cf996-nodes-tags__2.6-tag-net-interfaces.png"></a>

To add a tag, type its name into the 'Tags' field and press Enter. Repeat as desired. Use the small 'x' next to a tag to unassign the tag.

You can apply changes by pressing the 'Save' button.

<h3 id="heading--tags-for-storage-configuration">Tags for storage configuration</h3>

Alongside tags for an entire machine and network interfaces, you can also define tags for storage devices. You can use these tags like any other, when searching for machines within the web UI, where they appear beneath the 'Storage tag' filter, and when allocating machines from the API.

To add a tag to a storage device, click on the machine with the storage you wish to tag on the 'Machines' page of the web UI and open the 'Storage' tab. Use the menu in the 'Actions' column beneath 'Available disks and partitions' to select 'Edit disk' for your chosen device:

<a href="https://assets.ubuntu.com/v1/43dd9f9d-nodes-tags__2.6-tag-storage.png" target = "_blank"><img src="https://assets.ubuntu.com/v1/43dd9f9d-nodes-tags__2.6-tag-storage.png"></a>

To add a tag, type its name into the 'Tags' field and press Enter. Repeat as desired. Use the small 'x' next to a tag to unassign the tag.

You can apply changes by pressing the 'Save' button.
snap-2-7-ui snap-2-8-ui snap-2-9-ui deb-2-7-ui deb-2-8-ui deb-2-9-ui -->

<!-- snap-2-7-cli snap-2-8-cli snap-2-9-cli deb-2-7-cli deb-2-8-cli deb-2-9-cli
#### Quick questions you may have:

* [How do I get started with the MAAS CLI?](/t/maas-cli/802)
* [How do I create tags?](#heading--rudimentary-tag-creation)
* [How do I do tag creation and auto-assignment?](#heading--tag-creation-and-auto-assignment)
* [How do I delete a tag?](#heading--delete-a-tag)
* [How do I list all tags?](#heading--list-all-tags)
* [How do I list nodes/machines labelled with a tag?](#heading--list-nodesmachines-labelled-with-a-tag)
* [How do I handle Juju integration?](#heading--juju-integration)
* [How do I effect manual tag assignment?](#heading--manual-tag-assignment)
* [How do I effect hybrid tag assignment?](#heading--hybrid-tag-assignment)

<h2 id="heading--rudimentary-tag-creation">Tag creation</h2>

``` bash
maas $PROFILE tags create name=$TAG_NAME
```

<h2 id="heading--tag-creation-and-auto-assignment">Tag creation and auto-assignment</h2>

When you supply a [definition](/t/maas-tags/834#heading--tag-definitions) during a tag's creation, MAAS automatically applies the tag o all the nodes that satisfy the definition:

``` bash
maas $PROFILE tags create name=$TAG_NAME \
    comment='$TAG_COMMENT' definition='$TAG_DEFINITION'
```

For example,

``` bash
maas $PROFILE tags create name='gpu' \
    comment='GPU with clock speed >1GHz for running CUDA type operations.' \
    definition='//node[@id="display"]/'clock units="Hz"' > 1000000000'
```

We recommend that each tag have a short name and a comment that adequately describes it. You should make sure to create both of these because they will help you identify and use the tag later.

<h2 id="heading--tags-for-network-interfaces</h2>

It's also possible to assign tags to specific network interfaces. You can use these tags when searching for machines within the web UI and when allocating machines from the API.

Network interface tags can only be assigned when a machine is in either a 'Ready' or a 'Broken' state.

To add a tag to a network interface, use the following command:

```
maas $PROFILE interface add-tag $SYSTEM_ID $INTERFACE_ID tag=$TAG_STRING
```

To delete a tag from a network interface:

```
maas $PROFILE interface remove-tag $SYSTEM_ID $INTERFACE_ID tag=$TAG_STRING
```

<h2 id="heading--delete-a-tag">Delete a tag</h2>

``` bash
maas $PROFILE tag delete $TAG_NAME
```

<h2 id="heading--list-all-tags">List all tags</h2>

To list all tags present on the region controller:

``` bash
maas $PROFILE tags read
```

<h2 id="heading--list-nodesmachines-labelled-with-a-tag">List nodes/machines labelled with a tag</h2>

To list what nodes (or machines) a tag applies to:

``` bash
maas $PROFILE tag nodes $TAG_NAME
maas $PROFILE tag machines $TAG_NAME
```

<h2 id="heading--juju-integration">Juju integration</h2>

Although you can use a tag in the web UI (as a node search filter), you realise most of the benefit when you're deploying applications with Juju.

For example, to use the 'gpu' tag to deploy a (hypothetical) service called 'cuda':

``` bash
juju deploy --constraints tags=gpu cuda
```

You can also use multiple tags in addition to the normal Juju constraints:

``` bash
juju deploy --constraints "mem=1024 tags=gpu,intel" cuda
```

<h2 id="heading--manual-tag-assignment">Manual tag assignment</h2>

It is possible to assign tags to nodes manually by simply omitting the definition and applying the tag to a node by referencing its system id:

``` bash
maas $PROFILE tags create name=$TAG_NAME comment='$TAG_COMMENT'
maas $PROFILE tag update-nodes $TAG_NAME add=$SYSTEM_ID
```

To remove a tag:

``` bash
maas $PROFILE tag update-nodes $TAG_NAME remove=$SYSTEM_ID
```

In the same operation, a tag can be added to some nodes and removed from others:

``` bash
maas $PROFILE tag update-nodes $TAG_NAME \
    add=$SYSTEM_ID_1 add=$SYSTEM_ID_2 remove=$SYSTEM_ID_3
```

<h2 id="heading--hybrid-tag-assignment">Hybrid tag assignment</h2>

You can also create a tag with a definition (thereby map to certain nodes), remove the definition (but retain the mapping), and then add the tag manually to specific nodes. This action is useful for hardware which is conceptually similar but does not all satisfy a single tag definition. Here are the commands you would use to do this:

``` bash
maas $PROFILE tags create name=$TAG_NAME \
    comment='$TAG_COMMENT' definition='$TAG_DEFINITION'
maas $PROFILE tag update $TAG_NAME definition=''
maas $PROFILE tag update-nodes $TAG_NAME add=$SYSTEM_ID
```
snap-2-7-cli snap-2-8-cli snap-2-9-cli deb-2-7-cli deb-2-8-cli deb-2-9-cli -->

