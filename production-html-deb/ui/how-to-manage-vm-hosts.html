<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" type="text/css" href="css/stylesheet.css" />
    <style>
      #selector a:link{color:black;}
      #selector a:visited{color:black;}
      #selector a:active{color:black;}
      #selector a:hover{color:blue;}
      #sidebar a:link{color:black;}
      #sidebar a:visited{color:black;}
      #sidebar a:active{color:black;}
      #sidebar a:hover{color:blue;}
      ul {margin-left:0;margin-top:0;margin-bottom:0;list-style-type:none;padding-left:20px;}
      li {margin: 4px 0;}
      details {margin-top:0;margin-bottom:0;}
      details > summary {
	  padding: 0px;
	  margin-top: 0px;
	  margin-bottom: 0px;
	  width: 200px;
	  background-color: #ffffff;
	  border: none;
	  cursor: pointer;
    	  list-style-type: "< ";
	  direction: rtl;
      }
      details[open] > summary {
	  list-style-type: "v ";
      }
    </style>
  </head>
  <body>
    <div id="selector" style="top:0; position:fixed; float:right; background-color:#d9d9d9; width:100%;border-bottom:1px solid black;">
      &nbsp;&nbsp;
      <strong>Offline docs
      </strong>
      <a href="https://maas.io/docs">(switch to live docs)
      </a>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      <span style="background-color:white;border-top:1px solid black; border-left:1px solid black; border-right:1px solid black; border-bottom:5px solid white;">
        &nbsp;UI-only&nbsp;
      </span>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      <a href="../cli/how-to-manage-vm-hosts.html">
        CLI-only
      </a>
    </div>
    <div id="sidebar" style="float:left; width:25%;margin-top:40px; margin-left:20px">
      <ul>
	<li>
          <a href="maas-documentation.html"><b>MAAS Documentation</b></a>
	</li>
	<hr style="margin-top:15px;">
	<li>
          <details>
            <summary><a href="tutorials.html">Tutorials</a></summary>
            <ul>
              <li>
		<details>
                  <summary>Try out MAAS</summary>
		  <ul>
		    <li>
		      <a href="bootstrap-maas.html">Bootstrap MAAS</a>
		    </li>
		    <li>
		      <a href="get-to-know-your-machines.html">Get to know your machines</a>
		    </li>
		  </ul>
		</details>
              </li>
	      <li>
		<a href="try-out-the-maas-cli.html">Try out the MAAS CLI</a>
	      </li>
	      <li>
		<a href="create-custom-images.html">Create custom images</a>
	      </li>
	      <li>
		<a href="get-fancy-cli-output.html">Get fancy CLI output</a>
	      </li>
              <li>
		<details>
                  <summary>Primer tutorials</summary>
		  <ul>
		    <li>
		      <a href="primer-tutorial-the-osi-model.html">OSI model tutorial</a>
		    </li>
		  </ul>
		</details>
              </li>
            </ul>
          </details>
	</li>
	<hr style="margin-top:15px;">
	<li>
          <details>
            <summary><a href="how-to-guides.html">How-to guides</a></summary>
            <ul>
              <li>
		<details>
                  <summary><a href="how-to-get-started-with-maas.html">Get started with MAAS</a></summary>
		  <ul>
                    <li>
                      <a href="how-to-do-a-fresh-install-of-maas.html">Do a fresh install of MAAS</a>
		    </li>
		    <li>
                      <a href="how-to-upgrade-maas.html">Upgrade MAAS</a>
		    </li>
		    <li>
                      <a href="how-to-spin-up-maas-with-ansible.html">Spin up MAAS with Ansible</a>
		    </li>
		  </ul>
		</details>
              </li>
              <li>
		<details>
                  <summary><a href="how-to-manage-networks.html">Manage networks</a></summary>
		  <ul>
                    <li>
                      <a href="how-to-connect-maas-networks.html">Connect MAAS networks</a>
                    </li>
                    <li>
                      <a href="how-to-enable-dhcp.html">Enable DHCP</a>
                    </li>
                    <li>
                      <a href="how-to-use-availability-zones.html">Use availability zones</a>
                    </li>
		  </ul>
		</details>
              </li>
              <li>
		<details>
                  <summary><a href="how-to-use-images.html">Use images</a></summary>
		  <ul>
                    <li>
                      <a href="how-to-use-standard-images.html">Use standard images</a>
                    </li>
                    <li>
                      <a href="how-to-mirror-images-locally.html">Mirror images locally</a>
                    </li>
                    <li>
                      <a href="how-to-customise-images.html">Customise images</a>
                    </li>
                    <li>
                      <a href="how-to-employ-vmware-images.html">Employ VMware images</a>
                    </li>
                    <li>
                      <a href="how-to-deploy-a-real-time-kernel.html">Deploy a RT kernel</a>
                    </li>
		  </ul>
		</details>
              </li>
              <li>
		<details>
                  <summary><a href="how-to-manage-controllers.html">Manage controllers</a></summary>
		  <ul>
		    <li>
		      <a href="how-to-configure-controllers.html">Configure controllers</a>
		    </li>
		    <li>
		      <a href="how-to-enable-high-availability.html">Enable high availability</a>
		    </li>
		  </ul>
		</details>
              </li>
              <li>
		<details>
                  <summary><a href="how-to-manage-machines.html">Manage machines</a></summary>
		  <ul>
		    <li>
		      <a href="how-to-make-machines-available.html">Make machines available</a>
		    </li>
		    <li>
		      <a href="how-to-customise-machines.html">Customise machines</a>
		    </li>
		    <li>
		      <a href="how-to-put-machines-to-work.html">Put machines to work</a>
		    </li>
		  </ul>
		</details>
              </li>
              <li>
		<details>
                  <summary><a href="how-to-use-virtual-machines.html">Use virtual machines</a></summary>
		  <ul>
		    <li>
		      <a href="how-to-set-up-lxd.html">Set up LXD</a>
		    </li>
		    <li>
		      <a href="how-to-manage-vm-hosts.html">Manage VM hosts</a>
		    </li>
		    <li>
		      <a href="how-to-manage-virtual-machines.html">Manage virtual machines</a>
		    </li>
		  </ul>
		</details>
              </li>
              <li>
		<details>
                  <summary><a href="how-to-label-devices.html">Label devices</a></summary>
		  <ul>
		    <li>
		      <a href="how-to-tag-machines.html">Tag machines</a>
		    </li>
		    <li>
		      <a href="how-to-annotate-machines.html">Annotate machines</a>
		    </li>
		    <li>
		      <a href="how-to-use-machine-tags.html">Use machine tags</a>
		    </li>
		    <li>
		      <a href="how-to-use-controller-tags.html">Use controller tags</a>
		    </li>
		    <li>
		      <a href="how-to-use-storage-tags.html">Use storage tags</a>
		    </li>
		    <li>
		      <a href="how-to-use-network-tags.html">Use network tags</a>
		    </li>
		  </ul>
		</details>
              </li>
	      <li>
		<details>
                  <summary><a href="how-to-secure-maas.html">Secure MAAS</a></summary>
		  <ul>
		    <li>
		      <a href=.html"how-to-improve-maas-security.html">Improve MAAS security</a>
		    </li>
		    <li>
		      <a href="how-to-manage-user-accounts.html">Manage user accounts</a>
		    </li>
		    <li>
		      <a href="how-to-enable-maas-native-tls.html">Enable MAAS native TLS</a>
		    </li>
		    <li>
		      <a href="how-to-use-hashicorp-vault-with-maas.html">Use Vault with MAAS</a>
		    </li>
		    <li>
		      <a href="how-to-set-up-an-air-gapped-maas.html">Set up an air-gapped MAAS</a>
		    </li>
		  </ul>
		</details>
              </li>
	      <li>
		<details>
                  <summary><a href="how-to-operate-maas.html">Operate MAAS</a></summary>
		  <ul>
		    <li>
		      <a href=.html"how-to-find-machines.html">Find machines</a>
		    </li>
		    <li>
		      <a href="how-to-back-up-maas.html">Back up MAAS</a>
		    </li>
		    <li>
		      <a href="how-to-monitor-maas.html">Monitor MAAS</a>
		    </li>
		    <li>
		      <a href="how-to-audit-maas.html">Audit MAAS</a>
		    </li>
		    <li>
		      <a href="how-to-troubleshoot-maas">Troubleshoot MAAS</a>
		    </li>
		  </ul>
		</details>
              </li>
	      <li>
		<details>
                  <summary><a href="how-to-give-and-receive-help.html">Give and receive help</a></summary>
		  <ul>
		    <li>
		      <a href=.html"how-to-use-the-maas-discourse-forum.html">Use our discourse forum</a>
		    </li>
		    <li>
		      <a href="https://ubuntu.com/pro">Get support</a>
		    </li>
		    <li>
		      <a href="how-to-request-new-features.html">Request new features</a>
		    </li>
		    <li>
		      <a href="how-to-review-and-report-bugs.html">Review and report bugs</a>
		    </li>
		    <li>
		      <a href="how-to-contribute-documentation.html">Contribute documentation</a>
		    </li>
		  </ul>
		</details>
              </li>
            </ul>
          </details>
	</li>
	<hr style="margin-top:15px;">
	<li>
          <details>
            <summary><a href="reference.html">Reference</a></summary>
            <ul>
	      <details>
		<summary><a href="maas-release-notes.html">Release notes</a></summary>
		<ul>
		  <li>
		    <a href="what-is-new-with-maas-3-4.html">MAAS 3.4 release notes</a>
              	  </li>
		  <li>
              	    <a href="what-is-new-with-maas-3-3.html">MAAS 3.3 release notes</a>
              	  </li>
		  <li>
              	    <a href="what-is-new-with-maas-3-2.html">MAAS 3.2 release notes</a>
              	  </li>
		  <li>
              	    <a href="what-is-new-with-maas-3-1.html">MAAS 3.1 release notes</a>
              	  </li>
		  <li>
              	    <a href="what-is-new-with-maas-3-0.html">MAAS 3.0 release notes</a>
              	  </li>
		  <li>
              	    <a href="what-is-new-with-maas-2-9.html">MAAS 2.9 release notes</a>
              	  </li>
		  <li>
              	    <a href="what-is-new-with-maas-2-8.html">MAAS 2.8 release notes</a>
              	  </li>
		  <li>
              	    <a href="what-is-new-with-maas-2-7.html">MAAS 2.7 release notes</a>
              	  </li>
		</ul>
	      </details>
              <li>
		<details>
                  <summary><a href="general-reference.html">General</a></summary>
		  <ul>
		    <li>
		      <a href="installation-requirements.html">Installation requirements</a>
		    </li>
		    <li>
		      <a href="maas-settings-reference.html">MAAS settings</a>
		    </li>
		    <li>
		      <a href="https://launchpad.net/maas">Source code</a>
		    </li>
		    <li>
		      <a href="maas-documentation-style-guide.html">Doc style guide</a>
		    </li>
		    <li>
		      <a href="maas-glossary.html">Glossary</a>
		    </li>
		    <li>
		      <a href="https://ubuntu.com/community/code-of-conduct">Code of conduct</a>
		    </li>
		  </ul>
		</details>
	      </li>
              <li>
		<details>
		  <summary><a href="api.html">API</a></summary>
		  <ul>
		    <li>
                      <a href="api-authentication-reference.html">API authentication</a>
                    </li>
		    <li>
                      <a href="python-api-client-reference.html">Python API client</a>
                    </li>
		    <li>
                      <a href="/docs/api">API documentation</a>
                    </li>
		  </ul>
		</details>
              </li>
              <li>
		<details>
		  <summary><a href="scripts-reference.html">Scripts</a></summary>
		  <ul>
		    <li>
                      <a href="commissioning-scripts-reference.html">Commissioning scripts</a>
                    </li>
		    <li>
                      <a href="hardware-test-scripts-reference.html">Hardware test scripts</a>
                    </li>
		    <li>
                      <a href="maas-terraform-reference.html">Terraform</a>
                    </li>
		  </ul>
		</details>
              </li>
              <li>
		<details>
		  <summary><a href="log-reference.html">Logging</a></summary>
		  <ul>
		    <li>
                      <a href="event-logs-reference.html">Event logs</a>
                    </li>
		    <li>
                      <a href="audit-event-logs-reference.html">Audit event logs</a>
                    </li>
		    <li>
                      <a href="commissioning-logs-reference.html">Commissioning logs</a>
                    </li>
		    <li>
                      <a href="testing-logs-reference.html">Testing logs</a>
                    </li>
		  </ul>
		</details>
              </li>
              <li>
		<details>
		  <summary><a href="machine-parameters-reference.html">machine-parameters</a></summary>
		  <ul>
		    <li>
                      <a href=.html"power-drivers-reference.html">Power drivers</a>
                    </li>
		    <li>
                      <a href="storage-layouts-reference.html">Storage layouts</a>
                    </li>
		    <li>
                      <a href="device-labelling-reference.html">Device labelling</a>
                    </li>
		  </ul>
		</details>
              </li>
	    </ul>
	  </details>
	</li>
	<hr style="margin-top:15px;">
	<li>
	  <details>
	    <summary><a href="explanation.html">Explanation</a></summary>
	    <ul>
	      <li>
		<a href="about-maas.html">About MAAS</a>
	      </li>
	      <li>
		<details>
		  <summary>Networking</summary>
		  <ul>
		    <li>
		      <a href="about-maas-networks.html">MAAS networks</a>
		    </li>
		    <li>
		      <a href="about-tcp-ip-networks.html">TCP/IP primer</a>
		    </li>
		    <li>
		      <a href="about-dhcp.html">DHCP primer</a>
		    </li>
		    <li>
		      <a href="about-cloud-networking.html">Cloud networking primer</a>
		    </li>
		  </ul>
		</details>
	      </li>
	      <li>
		<a href="about-images.html">Images</a>
              </li>
	      <li>
		<details>
		  <summary>Controllers</summary>
		  <ul>
		    <li>
		      <a href="about-region-and-rack-controllers.html">Region and rack controllers</a>
		    </li>
		    <li>
		      <a href="about-high-availability.html">High availability</a>
		    </li>
		  </ul>
		</details>
	      </li>
	      <li>
		<details>
		  <summary>Machines and devices</summary>
		  <ul>
		    <li>
		      <a href="about-machines.html">Machines</a>
		    </li>
		    <li>
		      <a href="about-virtual-machines.html">Virtual machines</a>
		    </li>
		    <li>
		      <a href="device-labels.html">Device labels</a>
		    </li>
		  </ul>
		</details>
	      </li>
	      <li>
		<details>
		  <summary>Events and logging</summary>
		  <ul>
		    <li>
		      <a href="about-maas-events.html">MAAS events</a>
		    </li>
		    <li>
		      <a href="about-audit-events.html">Audit events</a>
		    </li>
		    <li>
		      <a href="about-log-files.html">MAAS logging</a>
		    </li>
		    <li>
		      <a href="about-maas-security.html">MAAS security</a>
		    </li>
		    <li>
		      <a href="about-maas-performance.html">MAAS performance</a>
		    </li>
		    <li>
		      <a href="about-ansible.html">Ansible</a>
		    </li>
		  </ul>
		</details>
	      </li>
	    </ul>
	  </details>
	</li>
      </ul>
    </div>
    <div class="container" style="float:right; width:65%; margin-top:40px; margin-right:30px">
      <h1>How to manage VM hosts</h1><!-- "How to manage VM hosts" -->
<p>In order to  deploy a VM host in your MAAS network, you first need to set up a bridge to connect between your VM host and MAAS itself. Once that&rsquo;s done, you can add and manage VM hosts &ndash; and subsequently, create VMs to act as MAAS machines.  This article explains:</p>
<ul style="margin-left:4px; list-style-type:disc;">
<li><a href="#heading--maas-bridge-web-ui">How to set up a VM host bridge with the web UI</a></li>
<li><a href="#heading--maas-bridge-netplan">How to set up a VM host bridge with netplan</a></li>
<li><a href="#heading--maas-bridge-libvirt">How to set up a VM host bridge with libvirt</a></li>
<li><a href="#heading--set-up-ssh">How to set up SSH for use by libvirt</a></li>
<li><a href="#heading--adding-a-vm-host">How to add a VM host</a></li>
<li><a href="#heading--deleting-a-vm-host">How to delete a VM host</a></li>
<li><a href="#heading--configuration">How to configure a VM host</a></li>
<li><a href="#heading--lxd-clusters">How to use LXD clusters</a></li>
</ul>
<p>To enable VM host networking features, MAAS must match the VM host IP address of a potential VM host with a known device (a machine or controller). For example, if a machine not known to MAAS is set up as a VM host, enhanced interface selection features will not be available.</p>
<p><strong>NOTE:</strong> 
It&rsquo;s essential to enforce usage of IP addresses to avoid domain name conflicts, should different controllers resolve the same domain name with different IP addresses. You should also avoid using 127.0.0.1 when running multiple controllers, as it would confuse MAAS.</p>
<p>If you need some background on VM hosting, we have a <a href="how-to-deploy-virtual-machines.html#heading--MAAS-VM-hosting">refresher</a> available.</p>
<p><a href="#heading--maas-bridge-web-ui"><h2 id="heading--maas-bridge-web-ui">How to set up a VM host bridge with the web UI</h2></a></p>
<p>To set up a VM host bridge with the Web UI:</p>
<ol>
<li>
<p>Select <em>Machines</em>.</p>
</li>
<li>
<p>Select the machine you want to use as a VM host.</p>
</li>
<li>
<p>Select <em>Network</em>.</p>
</li>
<li>
<p>Select the network where you want to create the bridge.</p>
</li>
<li>
<p>Select <em>Create bridge</em>.</p>
</li>
<li>
<p>Configure the bridge on a subnet MAAS controls.  You may use any IP mode for the bridge.</p>
</li>
<li>
<p>Register your changes with <em>Create bridge</em>.</p>
</li>
</ol>
<p>Then you can deploy Ubuntu.</p>
<p><a href="#heading--maas-bridge-netplan"><h2 id="heading--maas-bridge-netplan">How to set up a VM host bridge with netplan</h2></a></p>
<p>You can also use netplan to configure a VM host bridge:</p>
<p>Open your netplan configuration file.  This should be in <code>/etc/netplan</code>.  It could be called <code>50-cloud-init.yaml</code>, <code>netplan.yaml</code>, or something else.  Modify the file to add a bridge, using the example below to guide you:</p>
<pre><code class="language-nohighlight">network:
    bridges:
        br0:
            addresses:
            - 10.0.0.101/24
            gateway4: 10.0.0.1
            interfaces:
            - enp1s0
            macaddress: 52:54:00:39:9d:f9
            mtu: 1500
            nameservers:
                addresses:
                - 10.0.0.2
                search:
                - maas
            parameters:
                forward-delay: 15
                stp: false
    ethernets:
        enp1s0:
            match:
                macaddress: 52:54:00:39:9d:f9
            mtu: 1500
            set-name: enp1s0
        enp2s0:
            match:
                macaddress: 52:54:00:df:87:ac
            mtu: 1500
            set-name: enp2s0
        enp3s0:
            match:
                macaddress: 52:54:00:a7:ac:46
            mtu: 1500
            set-name: enp3s0
    version: 2
</code></pre>
<p>Apply the new configuration with <code>netplan apply</code>.</p>
<p><a href="#heading--maas-bridge-libvirt"><h2 id="heading--maas-bridge-libvirt">How to set up a VM host bridge with libvirt</h2></a></p>
<p>It is also possible to use <a href="https://ubuntu.com/server/docs/virtualization-libvirt">libvirt</a><code>↗</code> to configure a virtual bridge.  This method will also work for LXD VM hosts running on Ubuntu.  Be aware that other methods may be required if you are configuring LXD on an OS other than Ubuntu.</p>
<p>By default, libvirt creates a virtual bridge, <code>virbr0</code>, through which VMs communicate with each other and the Internet. DHCP, supplied by libvirt, automatically assigns an IP address to each VM.  However, to enable network booting in MAAS, you’ll need to provide DHCP in MAAS and either:</p>
<ul style="margin-left:4px; list-style-type:disc;">
<li>Disable DHCP on libvirt’s <code>default</code> network, or</li>
<li>Create a new libvirt network <code>maas</code> with DHCP disabled.</li>
</ul>
<p>You can set up such a <code>maas</code> network like this:</p>
<pre><code class="language-nohighlight">cat &lt;&lt; EOF &gt; maas.xml
&lt;network&gt;
 &lt;name&gt;maas&lt;/name&gt;
 &lt;forward mode='nat'&gt;
   &lt;nat&gt;
     &lt;port start='1024' end='65535'/&gt;
   &lt;/nat&gt;
 &lt;/forward&gt;
 &lt;dns enable=&quot;no&quot; /&gt;
 &lt;bridge name='virbr1' stp='off' delay='0'/&gt;
 &lt;domain name='testnet'/&gt;
 &lt;ip address='172.16.99.1' netmask='255.255.255.0'&gt;
 &lt;/ip&gt;
&lt;/network&gt;
EOF
virsh net-define maas.xml
</code></pre>
<p>Note that this network also has NAT port forwarding enabled to allow VMs to communicate with the Internet at large. Port forwarding is very useful in test environments.</p>
<p><a href="#heading--set-up-ssh"><h2 id="heading--set-up-ssh">How to set up SSH for use by libvirt</h2></a></p>
<p>For MAAS to successfully communicate with libvirt on your VM host machine &ndash; whether you&rsquo;re running from snap or package, or running rack controllers in LXD containers or on localhost &ndash; this example command must succeed from every rack controller:</p>
<pre><code class="language-nohighlight">virsh -c qemu+ssh://$USER@$VM_HOST_IP/system list --all
</code></pre>
<p>Here, <code>$USER</code> is a user on your VM host who is a member of the <code>libvirtd</code> Unix group on the VM host, and <code>$VM_HOST_IP</code> is the IP of your VM host.  <strong>Note</strong> that insufficient permissions for <code>$USER</code> may cause the <code>virsh</code> command to fail with an error such as <code>failed to connect to the hypervisor</code>. Check the <code>$USER</code> group membership to make sure <code>$USER</code> is a member of the <code>libvirtd</code> group.</p>
<p><a href="#heading--libvirt-ssh"><h3 id="heading--libvirt-ssh">How to set up SSH (libvirt only)</h3></a></p>
<p>The <code>maas</code> user on your rack controllers will issue all libvirt commands. Therefore, you&rsquo;ll need to set up SSH public keys on every rack controller for user <code>maas</code>.  First create SSH keys on all rack controllers:</p>
<pre><code class="language-nohighlight">$ sudo -i
root@maas:~$ mkdir -p /var/snap/maas/current/root/.ssh
root@maas:~$ cd /var/snap/maas/current/root/.ssh
root@maas:~$ ssh-keygen -f id_rsa
</code></pre>
<p>Next, add the contents of <code>~maas/.ssh/id_rsa.pub</code> to the VM host user&rsquo;s <code>~$USER/.ssh/authorized_keys</code>. To accomplish this, log into your VM host node, via SSH, from a host for which MAAS has a matching public SSH key.</p>
<p><a href="#heading--adding-a-vm-host"><h2 id="heading--adding-a-vm-host">How to add a LXD VM host with a MAAS-generated certificate</h2></a></p>
<p>To add a LXD VM host with a MAAS-generated certificate:</p>
<ol>
<li>
<p>Select <em>KVM &gt; LXD</em>.</p>
</li>
<li>
<p>Select <em>Add KVM</em>.</p>
</li>
<li>
<p>Enter a <em>Name</em> for the KVM host.</p>
</li>
<li>
<p>Optionally, select a non-default <em>Zone</em>.</p>
</li>
<li>
<p>Optionally, select a non-default <em>Resource pool</em>.</p>
</li>
<li>
<p>Enter the <em>LXD address</em> as the gateway address of the bridge for that LXD instance.  For example, if <code>lxdbr0</code> has address <code>10.4.241.0</code>, the default gateway address is <code>10.4.241.1</code>.</p>
</li>
<li>
<p>Select <em>Generate new certificate</em>.</p>
</li>
<li>
<p>Select <em>Next</em>.</p>
</li>
<li>
<p>Select <em>Add trust to LXD via command line</em>.</p>
</li>
<li>
<p>Copy the bash command and certificate from the text box.</p>
</li>
<li>
<p>In a terminal, paste the copied command and make sure that it runs.</p>
</li>
<li>
<p>Select <em>Check authentication</em>.  You&rsquo;ll switch screens; if all goes well, you&rsquo;ll see <em>Connected</em> with a green checkmark.</p>
</li>
<li>
<p>Select <em>Add new project</em> or <em>Select existing project</em>.  Be aware that if you select an existing project, any VMs already in that project will begin to commission.</p>
</li>
<li>
<p>Select <em>Next</em>.  You will drop out to a dashboard for the VM host.</p>
</li>
</ol>
<p>You can then add virtual machines to this new VM host as desired.</p>
<p><a href="#heading--How-to-use-your-own-existing-certificate"><h4 id="heading--How-to-use-your-own-existing-certificate">How to add a LXD VM host using an existing certificate</h4></a></p>
<p>To use your own existing certificate with a LXD VM host:</p>
<ol>
<li>
<p>Select <em>KVM</em>.</p>
</li>
<li>
<p>Select <em>Add KVM</em>.</p>
</li>
<li>
<p>Enter a <em>Name</em> for the KVM host.</p>
</li>
<li>
<p>Optionally, select a non-default <em>Zone</em>.</p>
</li>
<li>
<p>Optionally, select a non-default <em>Resource pool</em>.</p>
</li>
<li>
<p>Enter the <em>LXD address</em> as the gateway address of the bridge for that LXD instance.  For example, if <code>lxdbr0</code> has address <code>10.4.241.0</code>, the default gateway address is <code>10.4.241.1</code>.</p>
</li>
<li>
<p>Select <em>Provide certificate and private key</em>.  The screen will extend.</p>
</li>
<li>
<p><em>Upload a certificate</em> or paste one in the certificate text box.</p>
</li>
<li>
<p><em>Upload a private key</em> or paste on in the private key text box.</p>
</li>
<li>
<p>Select <em>Next</em>.</p>
</li>
<li>
<p>Select <em>Add trust to LXD via command line</em>.</p>
</li>
<li>
<p>Copy the bash command and certificate from the text box.</p>
</li>
<li>
<p>In a terminal, paste the copied command and make sure that it runs.</p>
</li>
<li>
<p>Select <em>Check authentication</em>.  You&rsquo;ll switch screens; if all goes well, you&rsquo;ll see <em>Connected</em> with a green checkmark.</p>
</li>
<li>
<p>Select <em>Add new project</em> or <em>Select existing project</em>.  Be aware that if you select an existing project, any VMs already in that project will begin to commission.</p>
</li>
<li>
<p>Select <em>Next</em>.  You will drop out to a dashboard for the VM host.</p>
</li>
</ol>
<p>You can then add virtual machines to this new VM host as desired.</p>
<p><a href="#heading--deleting-a-vm-host"><h2 id="heading--deleting-a-vm-host">How to delete a VM host</h2></a></p>
<p>To delete a VM host:</p>
<ol>
<li>
<p>Select <em>KVM</em>.</p>
</li>
<li>
<p>Select the VM host you wish to configure.</p>
</li>
<li>
<p>Select <em>KVM host settings</em>.</p>
</li>
<li>
<p>Select <em>Danger zone &gt;&gt; Remove KVM host</em>.  You will need to confirm this choice.</p>
</li>
</ol>
<p>There is no way to recover the VM host after confirming.</p>
<p><strong>NOTE:</strong> 
MAAS will automatically discover and store the resources your VM host contains. Any existing machines will also appear on the &lsquo;Machines&rsquo; page, and MAAS will automatically attempt to commission them.</p>
<p><a href="#heading--configuration"><h2 id="heading--configuration">How to configure a VM host</h2></a></p>
<p>To configure a VM host:</p>
<ol>
<li>
<p>Select <em>KVM &gt; LXD</em>.</p>
</li>
<li>
<p>Select the VM host you wish to configure.</p>
</li>
<li>
<p>Select <em>KVM host settings</em>.</p>
</li>
<li>
<p>Optionally set <em>KVM configuration &gt;&gt; Zone</em> by selecting from the dropdown.</p>
</li>
<li>
<p>Optionally set the <em>KVM configuration &gt;&gt; Resource pool</em> by selecting from the dropdown.</p>
</li>
<li>
<p>Optionally add or change <em>KVM configuration &gt;&gt; Tags</em>.</p>
</li>
<li>
<p>Optionally change the <em>KVM configuration &gt;&gt; CPU overcommit</em> ratio by moving the slider.</p>
</li>
<li>
<p>Optionally change the <em>KVM configuration &gt;&gt; Memory overcommit</em> ratio by moving the slider.</p>
</li>
<li>
<p>If you&rsquo;ve made changes to this point, select <em>KVM configuration &gt;&gt; Save changes</em>.  MAAS will save the <em>KVM configuration</em> changes, but will not switch screens.</p>
</li>
<li>
<p>If you need to change the <em>Authentication &gt;&gt; Certificate</em>, you may do so.  Make sure to choose <em>Update certificate</em> to register your changes.</p>
</li>
<li>
<p>If you want to remove this KVM host, choose <em>Danger zone &gt;&gt; Remove KVM host</em>.  You will need to confirm this choice.</p>
</li>
</ol>
<p><a href="#heading--lxd-clusters"><h3 id="heading--lxd-clusters">LXD clusters</h3></a></p>
<p>MAAS takes advantage of the existing LXD clustering capability.</p>
<p><a href="#heading--about-lxd-clusters"><h4 id="heading--about-lxd-clusters">About LXD clusters</h4></a></p>
<p>LXD clusters within the context of MAAS are a way of viewing and managing existing VM host clusters and composing VMs within said cluster.  MAAS will not create a new cluster, but will discover an existing cluster when you provide the info for adding a single clustered host.</p>
<p><a href="#heading--how-to-add-lxd-clusters"><h4 id="heading--how-to-add-lxd-clusters">How to add LXD clusters</h4></a></p>
<p>MAAS assumes you have already configured a cluster within the context of LXD. You then need to configure this cluster with a single trust MAAS will use to communicate with said cluster. </p>
<p>The process of adding a LXD cluster is <a href="#heading--adding-a-vm-host">identical to the procedure for adding a LXD VM host</a>.  The only difference is that the name you provide will be used for the cluster instead of the individual host. </p>
<p>MAAS will then connect to the provided host and discover the other hosts within the cluster, and rename the initially defined host with the cluster member name configured in LXD. The VM host will show up as a <em>Cluster</em> on the dashboard. </p>
<p><a href="#heading--how-to-compose-vms-in-lxd-clusters"><h4 id="heading--how-to-compose-vms-in-lxd-clusters">How to compose VMs in LXD clusters</h4></a></p>
<p>To compose VMs in a LXD cluster, follow the procedure for <a href="how-to-create-and-manage-vms.html">adding a VM to a VM host</a>. </p>
<p><a href="#heading--how-to-delete-lxd-clusters"><h3 id="heading--how-to-delete-lxd-clusters">How to delete LXD clusters</h3></a></p>
<p>To delete a LXD cluster, <a href="#heading--deleting-a-vm-host">delete any VM host within the cluster</a>.  </p>
<p><strong>NOTE:</strong> 
This will delete the cluster and <strong>all</strong> members within the cluster.  Make sure that&rsquo;s what you want to do.</p>
    </div>
  </body>
</html>