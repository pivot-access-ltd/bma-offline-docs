<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" type="text/css" href="css/stylesheet.css" />
    <style>
      #selector a:link{color:black;}
      #selector a:visited{color:black;}
      #selector a:active{color:black;}
      #selector a:hover{color:blue;}
      #sidebar a:link{color:black;}
      #sidebar a:visited{color:black;}
      #sidebar a:active{color:black;}
      #sidebar a:hover{color:blue;}
      ul {margin-left:0;margin-top:0;margin-bottom:0;list-style-type:none;padding-left:20px;}
      li {margin: 4px 0;}
      details {margin-top:0;margin-bottom:0;}
      details > summary {
	  padding: 0px;
	  margin-top: 0px;
	  margin-bottom: 0px;
	  width: 200px;
	  background-color: #ffffff;
	  border: none;
	  cursor: pointer;
    	  list-style-type: "< ";
	  direction: rtl;
      }
      details[open] > summary {
	  list-style-type: "v ";
      }
    </style>
  </head>
  <body>
    <div id="selector" style="top:0; position:fixed; float:right; background-color:#d9d9d9; width:100%;border-bottom:1px solid black;">
      &nbsp;&nbsp;
      <strong>Offline docs
      </strong>
      <a href="https://maas.io/docs">(switch to live docs)
      </a>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      <span style="background-color:white;border-top:1px solid black; border-left:1px solid black; border-right:1px solid black; border-bottom:5px solid white;">
        &nbsp;UI-only&nbsp;
      </span>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      <a href="../cli/about-cloud-networking.html">
        CLI-only
      </a>
    </div>
    <div id="sidebar" style="float:left; width:25%;margin-top:40px; margin-left:20px">
      <ul>
	<li>
          <a href="maas-documentation.html"><b>MAAS Documentation</b></a>
	</li>
	<hr style="margin-top:15px;">
	<li>
          <details>
            <summary><a href="tutorials.html">Tutorials</a></summary>
            <ul>
              <li>
		<details>
                  <summary>Try out MAAS</summary>
		  <ul>
		    <li>
		      <a href="bootstrap-maas.html">Bootstrap MAAS</a>
		    </li>
		    <li>
		      <a href="get-to-know-your-machines.html">Get to know your machines</a>
		    </li>
		  </ul>
		</details>
              </li>
	      <li>
		<a href="try-out-the-maas-cli.html">Try out the MAAS CLI</a>
	      </li>
	      <li>
		<a href="create-custom-images.html">Create custom images</a>
	      </li>
	      <li>
		<a href="get-fancy-cli-output.html">Get fancy CLI output</a>
	      </li>
              <li>
		<details>
                  <summary>Primer tutorials</summary>
		  <ul>
		    <li>
		      <a href="primer-tutorial-the-osi-model.html">OSI model tutorial</a>
		    </li>
		  </ul>
		</details>
              </li>
            </ul>
          </details>
	</li>
	<hr style="margin-top:15px;">
	<li>
          <details>
            <summary><a href="how-to-guides.html">How-to guides</a></summary>
            <ul>
              <li>
		<details>
                  <summary><a href="get-started-with-maas.thml">Get started with MAAS</a></summary>
		  <ul>
                    <li>
                      <a href="do-a-fresh-install-of-maas.html">Do a fresh install of MAAS</a>
		    </li>
		    <li>
                      <a href="upgrade-maas.html">Upgrade MAAS</a>
		    </li>
		    <li>
                      <a href="spin-up-maas-with-ansible.html">Spin up MAAS with Ansible</a>
		    </li>
		  </ul>
		</details>
              </li>
              <li>
		<details>
                  <summary><a href="set-up-networks.html">Set up networks</a></summary>
		  <ul>
                    <li>
                      <a href="connect-maas-networks.html">Connect MAAS networks</a>
                    </li>
                    <li>
                      <a href="enable-dhcp.html">Enable DHCP</a>
                    </li>
                    <li>
                      <a href="use-availability-zones.html">Use availability zones</a>
                    </li>
		  </ul>
		</details>
              </li>
              <li>
		<details>
                  <summary><a href="use-images.html">Use images</a></summary>
		  <ul>
                    <li>
                      <a href="use-standard-images.html">Use standard images</a>
                    </li>
                    <li>
                      <a href="mirror-images-locally.html">Mirror images locally</a>
                    </li>
                    <li>
                      <a href="customise-images.html">Customise images</a>
                    </li>
                    <li>
                      <a href="employ-vmware-images.html">Employ VMWare images</a>
                    </li>
                    <li>
                      <a href="deply-a-rt-kernel.html">Deploy a RT kernel</a>
                    </li>
		  </ul>
		</details>
              </li>
              <li>
		<details>
                  <summary><a href="manage-controllers.html">Manage controllers</a></summary>
		  <ul>
		    <li>
		      <a href="configure-controllers.html">Configure controllers</a>
		    </li>
		    <li>
		      <a href="enable-high-availability.html">Enable high availability</a>
		    </li>
		  </ul>
		</details>
              </li>
              <li>
		<details>
                  <summary><a href="manage-machines.html">Manage machines</a></summary>
		  <ul>
		    <li>
		      <a href="make-machines-available.html">Make machines available</a>
		    </li>
		    <li>
		      <a href="customise-machines.html">Customise machines</a>
		    </li>
		    <li>
		      <a href="put-machines-to-work.html">Put machines to work</a>
		    </li>
		  </ul>
		</details>
              </li>
              <li>
		<details>
                  <summary><a href="use-virtual-machines.html">Use virtual machines</a></summary>
		  <ul>
		    <li>
		      <a href="set-up-lxd.html">Set up LXD</a>
		    </li>
		    <li>
		      <a href="manage-vm-hosts.html">Manage VM hosts</a>
		    </li>
		    <li>
		      <a href="manage-virtual-machines.html">Manage virtual machines</a>
		    </li>
		  </ul>
		</details>
              </li>
              <li>
		<details>
                  <summary><a href="label-devices.html">Label devices</a></summary>
		  <ul>
		    <li>
		      <a href="tag-machines.html">Tag machines</a>
		    </li>
		    <li>
		      <a href="annotate-machines.html">Annotate machines</a>
		    </li>
		    <li>
		      <a href="use-machine-tags.html">Use machine tags</a>
		    </li>
		    <li>
		      <a href="use-controller-tags.html">Use controller tags</a>
		    </li>
		    <li>
		      <a href="use-storage-tags.html">Use storage tags</a>
		    </li>
		    <li>
		      <a href="use-network-tags.html">Use network tags</a>
		    </li>
		  </ul>
		</details>
              </li>
	      <li>
		<details>
                  <summary><a href="secure-maas.html">Secure MAAS</a></summary>
		  <ul>
		    <li>
		      <a href=.html"improve-MAAS-security.html">Improve MAAS security</a>
		    </li>
		    <li>
		      <a href="manage-user-accounts.html">Manage user accounts</a>
		    </li>
		    <li>
		      <a href="enable-MAAS-native TLS.html">Enable MAAS native TLS</a>
		    </li>
		    <li>
		      <a href="use-Vault-with-MAAS.html">Use Vault with MAAS</a>
		    </li>
		    <li>
		      <a href="set-up-an-air-gapped MAAS.html">Set up an air-gapped MAAS</a>
		    </li>
		  </ul>
		</details>
              </li>
            </ul>
          </details>
	</li>
	<hr style="margin-top:15px;">
	<li>
          <details>
            <summary><a href="reference.html">Reference</a></summary>
            <ul>
	      <details>
		<summary><a href="release-notes.html">Release notes</a></summary>
		<ul>
		  <li>
		    <a href="maas-3-4-release notes.html">MAAS 3.4 release notes</a>
              	  </li>
		  <li>
              	    <a href="maas-3-3-release notes.html">MAAS 3.3 release notes</a>
              	  </li>
		  <li>
              	    <a href="maas-3-2-release notes.html">MAAS 3.2 release notes</a>
              	  </li>
		  <li>
              	    <a href="maas-3-1-release notes.html">MAAS 3.1 release notes</a>
              	  </li>
		  <li>
              	    <a href="maas-3-0-release notes.html">MAAS 3.0 release notes</a>
              	  </li>
		  <li>
              	    <a href="maas-2-9-release notes.html">MAAS 2.9 release notes</a>
              	  </li>
		  <li>
              	    <a href="maas-2-8-release notes.html">MAAS 2.8 release notes</a>
              	  </li>
		  <li>
              	    <a href="maas-2-7-release notes.html">MAAS 2.7 release notes</a>
              	  </li>
		</ul>
	      </details>
              <li>
		<details>
                  <summary><a href="general-reference.html">General</a></summary>
		  <ul>
		    <li>
		      <a href="maas-settings.html">Settings</a>
		    </li>
		    <li>
		      <a href="https://launchpad.net/maas">Source code</a>
		    </li>
		    <li>
		      <a href="doc-style-guide.html">Doc style guide</a>
		    </li>
		    <li>
		      <a href="glossary.html">Glossary</a>
		    </li>
		    <li>
		      <a href="https://ubuntu.com/community/code-of-conduct">Code of conduct</a>
		    </li>
		  </ul>
		</details>
	      </li>
              <li>
		<details>
		  <summary><a href="api.html">API</a></summary>
		  <ul>
		    <li>
                      <a href="api-authentication.html">API authentication</a>
                    </li>
		    <li>
                      <a href="python-api-client.html">Python API client</a>
                    </li>
		    <li>
                      <a href="/docs/api">API documentation</a>
                    </li>
		  </ul>
		</details>
              </li>
              <li>
		<details>
		  <summary><a href="scripts.html">Scripts</a></summary>
		  <ul>
		    <li>
                      <a href="commissioning-scripts.html">Commissioning scripts</a>
                    </li>
		    <li>
                      <a href="hardware-test-scripts.html">Hardware test scripts</a>
                    </li>
		    <li>
                      <a href="terraform.html">Terraform</a>
                    </li>
		  </ul>
		</details>
              </li>
              <li>
		<details>
		  <summary><a href="logging.html">Logging</a></summary>
		  <ul>
		    <li>
                      <a href="event-logs.html">Event logs</a>
                    </li>
		    <li>
                      <a href="audit-event-logs.html">Audit event logs</a>
                    </li>
		    <li>
                      <a href="commissioning-logs.html">Commissioning logs</a>
                    </li>
		    <li>
                      <a href="testing-logs.html">Testing logs</a>
                    </li>
		  </ul>
		</details>
              </li>
              <li>
		<details>
		  <summary><a href="machine-parameters.html">machine-parameters</a></summary>
		  <ul>
		    <li>
                      <a href=.html"power-drivers.html">Power drivers</a>
                    </li>
		    <li>
                      <a href="storage-layouts.html">Storage layouts</a>
                    </li>
		    <li>
                      <a href="device-labelling.html">Device labelling</a>
                    </li>
		  </ul>
		</details>
              </li>
	    </ul>
	  </details>
	</li>
	<hr style="margin-top:15px;">
	<li>
	  <details>
	    <summary><a href="explanation.html">Explanation</a></summary>
	    <ul>
	      <li>
		<a href="maas.html">About MAAS</a>
		-           </li>
	      <li>
		<a href=.html"high-availability.html">High availability</a>
              </li>
	      <li>
		<details>
		  <summary>Networking</summary>
		  <ul>
		    <li>
		      <a href="maas-networks.html">MAAS networks</a>
		    </li>
		    <li>
		      <a href="tcp/IP-primer.html">TCP/IP primer</a>
		    </li>
		    <li>
		      <a href="dhcp-primer.html">DHCP primer</a>
		    </li>
		    <li>
		      <a href="cloud-networking-primer.html">Cloud networking primer</a>
		    </li>
		  </ul>
		</details>
	      </li>
	      <li>
		<a href="images.html">Images</a>
              </li>
	      <li>
		<a href="controllers.html">Controllers</a>
              </li>
	      <li>
		<a href="machines.html">Machines</a>
              </li>
	      <li>
		<a href="virtual-machines.html">Virtual machines</a>
              </li>
	      <li>
		<a href="device-labels.html">Device labels</a>
              </li>
	      <li>
		<a href="maas-events.html">Events</a>
              </li>
	      <li>
		<a href="audit-events.html">Audit events</a>
              </li>
	      <li>
		<a href="maas-logging.html">Logging</a>
              </li>
	      <li>
		<a href="maas-security.html">Security</a>
              </li>
	      <li>
		<a href="maas-performance.html">Performance</a>
              </li>
	      <li>
		<a href="ansible.html">Ansible</a>
              </li>
	    </ul>
	  </details>
	</li>
      </ul>
    </div>
    <div class="container" style="float:right; width:65%; margin-top:40px; margin-right:30px">
      <h1>About cloud networking</h1><!-- "About cloud networking" -->

<p>Cloud network architectures deviate significantly from the architecture of the Internet infrastructure.  These deviations are driven mostly by economics, simplicity, and scalability.  This article will help you learn:</p>
<ul style="margin-left:4px; list-style-type:disc;">
<li><a href="#heading--clos-architecture">About old and new network architectures</a></li>
<li><a href="#heading--aag-problems">Problems with the AAG architecture</a></li>
<li><a href="#heading--disaggregating-the-cloud">Disaggregating the cloud</a></li>
<li><a href="#heading--routing-still-rules">Routing still rules</a></li>
</ul>
<p><a href="#heading--clos-architecture"><h2 id="heading--clos-architecture">About old and new network architectures</h2></a></p>
<p>Before there were networks, monolithic applications ran on a mainframe with hardwired I/O devices.  As CPUs proliferated in separate enclosures, LANs like <a href="https://en.wikipedia.org/wiki/Banyan_VINES">Banyan Vines</a><code>↗</code> grew up.  Proprietary mismatch led to the <a href="https://maas.io/docs/about-tcp-ip-networks#heading--about-the-osi-model">OSI model</a><code>↗</code>.  Next came the Web, which distributed processing to client devices.  Now, we have the idea of generic switches and servers in cloud and bare-metal clusters.  Servers have shifted from dedicated applications to being completely <a href="https://en.wikipedia.org/wiki/Virtualization">virtualised</a><code>↗</code>.</p>
<p>A traditional AAC architecture looks like this:</p>
<p><a href="https://discourse.maas.io/uploads/default/original/2X/e/e15a35da43b2788883ec014efb1832b8f641e872.jpeg" target="_blank"><img src="https://discourse.maas.io/uploads/default/original/2X/e/e15a35da43b2788883ec014efb1832b8f641e872.jpeg"></a></p>
<p>It’s heavy on network hardware; that is, the radio of switches to servers is (too) high.  Switch-driven networks used hardware packet switching (<a href="https://etherealmind.com/analysis-merchant-custom-silicon">merchant silicon</a><code>↗</code>) to serve proprietary network configurations.  In theory, bridges needed no configuration, although <a href="https://en.wikipedia.org/wiki/Network_congestion">congestion</a><code>↗</code> and <a href="https://en.wikipedia.org/wiki/IP_address#Addressing_conflicts">mistaken identity</a><code>↗</code> led to the need for <a href="https://en.wikipedia.org/wiki/Spanning_Tree_Protocol">STP</a><code>↗</code>, <a href="https://networklessons.com/spanning-tree/per-vlan-spanning-tree-pvst">per-VLAN trees</a><code>↗</code>, and IP address redundancy management techniques.</p>
<p>A cloud architecture simplifies these networks:</p>
<p><a href="https://discourse.maas.io/uploads/default/original/2X/f/fd86954e48538ce9ba8fc6e02df23b0a2337ef12.jpeg" target="_blank"><img src="https://discourse.maas.io/uploads/default/original/2X/f/fd86954e48538ce9ba8fc6e02df23b0a2337ef12.jpeg"></a></p>
<p>Cloud architecture is a simple <a href="https://networklessons.com/cisco/ccna-200-301/spine-and-leaf-architecture">spine-and-leaf network</a><code>↗</code>, built from cheap, identical switches connecting cheap, identical servers.  Every switch has a path to every other switch, mitigating congestion.  Any switch can route any traffic anywhere, and any server can do any job (at any time)<code>↗</code>.  This architecture moves the developer’s focus from metal to actual computing problems.</p>
<p><a href="#heading--aag-problems"><h2 id="heading--aag-problems">Problems with the AAG architecture</h2></a></p>
<p>Modern applications generate much more server-to-server traffic than the original Access-Aggregation-Core networks envisioned.  As a result, the AAG architecture presents several problems under load:</p>
<ul style="margin-left:4px; list-style-type:disc;">
<li><strong>VLAN shorting</strong>: At cloud scale, 12 bits of VLAN ID don&rsquo;t provide nearly enough VLAN instances.  Even with Multi-instance/STP, there simply aren&rsquo;t enough virtual LAN networks to accommodate the build-out of even a modest cloud configuration.  Tenant machines come and go rapidly, and STP hello messages simply can&rsquo;t keep up.</li>
<li><strong>STP switch-count</strong>: STP is only designed for two aggregation switches, which throttles bandwidth and causes massive, constant congestion in an extended cloud network.</li>
<li><strong>Million-plus-packet floods</strong>: Broadcast-and-learn bridges can&rsquo;t keep up with a million-plus MAC addresses, and even if they do, when those cached addresses start to time out, the periodic re-learning floods edge hosts, incapacitating them on a regular basis.</li>
<li><strong>Unintentional VLAN partitioning</strong>: Large VLANs plus many devices creates a high-probability of a configuration mistake or an ID refresh miss; these issues cause the network to be invisibly partitioned, making troubleshooting all but impossible.</li>
<li><strong>ARP storms</strong>: Hundreds of virtual machines bound to a couple of aggregation switches translates to a network-saturating flurry of ARP refreshes.  There&rsquo;s no easy fix for this without changing the network topology, or setting the refresh timer so high that DHCP hosts will fall off the DNS periodically.</li>
</ul>
<p>There are other issues usually cited, but these are most concrete.</p>
<p><a href="#heading--disaggregating-the-cloud"><h2 id="heading--disaggregating-the-cloud">Disaggregating the cloud</h2></a></p>
<p>An effective cloud architecture breaks routers and bridges into separate hardware and software, sometimes called &ldquo;switch disaggregation&rdquo;.  A merchant-silicon chassis (the hardware) can be combined with someone else&rsquo;s NOS (network operating system, the software) to produce more standard and cost-effective network switch-gear.  In practice, few cloud providers actually create their own NOS, choosing instead to either integrate merchant silicon with a separately purchased NOS, or, more likely, to buy bundled units from switch providers that have broader integration experience.</p>
<p>Either way, the effect is to have switch-gear which is (1) less likely to be proprietary, and (2) easier to upgrade as the hardware advances.  Switch disaggregation effectively commoditizes the switching elements, effectively eliminating them from network throughput calculations.  In other words, the bridges and routers in a modern cloud network are essentially invisible, uninteresting, and inexpensive, which facilitates the cloud-network build-out model.</p>
<p><a href="#heading--routing-still-rules"><h2 id="heading--routing-still-rules">Routing still rules</h2></a></p>
<p>Regardless of your network vintage, packet routing is still the fundamental algorithm that gates throughput.  If you&rsquo;re familiar with routing, this section can be skipped. If you&rsquo;re trying to level up your cloud networking knowledge, this section should help quite a bit.</p>
<p>Routing is fundamentally simple: you&rsquo;re trying to get a packet from a source to a destination, using the destination IP address embedded in that packet.  In practice, routing is more complicated.  Most of the routers in a network path are not forwarding directly to the destination.  Instead, they&rsquo;re sending the packet to the next hop, that is, another, reachable router that is closer to the intended destination.</p>
<p>In <a href="tcp-ip.html#heading--borrowed-from-ma-bell">the TCP/IP tutorial</a>, we talked about telephone-line repeaters that refreshed the signal to keep it crystal clear over long runs of wire.  The signals didn&rsquo;t have to make it to the intended recipient, they just had to make it to the next repeater, which boosted the signal, cleaned up the noise, and sent the call on down the line to another repeater.  Eventually the call would make it to the subscriber.</p>
<p>Routing works very much the same way: most of the routers in the loop understand how to find another router which is close to the intended destination.  That &ldquo;next hop&rdquo; will take care of repackaging the packets and sending them further down the line.  What matters in high-traffic cloud networks is not routing, per se, but how the packets are routed.  The choice of routing protocols can make all the difference in whether or not your network lags.  For this reason, we&rsquo;re going to take a more extended look at routing.</p>
<p><a href="#heading--multicast-routing"><h3 id="heading--multicast-routing">Multicast routing</h3></a></p>
<p>One helpful tool for modern cloud networks is the concept of multicast routing.  Stated simply, multicast routing allows one packet to be received by many servers, but only if those servers are interested in receiving it.  Multicast receivers &ndash; which have to subscribe in order to receive the packets &ndash; support a much larger (and more flat) network.  This layout more easily scales to the cloud architecture shown above. Multicasting is generally faster and more efficient for certain payloads; unlike broadcast packets, multicast packets are not examined by every NIC in the packet&rsquo;s path.</p>
<p>For example, all IPv6 communications are multicast, so there&rsquo;s no ARP.  Instead, a process called <a href="https://en.wikipedia.org/wiki/Neighbor_Discovery_Protocol">neighbour discovery</a><code>↗</code> (NDP) is used.  But IPv4 networks can also handle multicast transactions.  Both IPv4 and IPv6 protocols support <a href="https://en.wikipedia.org/wiki/Multicast_address">multicast address blocks</a><code>↗</code>, which enable multicasting.</p>
<p>A multicasting server sends one packet, and the network handles replication and addressing (multiplexing) of the packets to the subscribed servers.  Multicast is a one-way protocol: any responses have to be sent by other protocols.  For larger server farms, multicast is a good way to handle things like a software update or a database refresh.  Two special protocols handle subscriptions: <a href="https://en.wikipedia.org/wiki/Internet_Group_Management_Protocol">IGMP</a><code>↗</code>, used by individual IPv4 receivers, and <a href="https://en.wikipedia.org/wiki/Protocol_Independent_Multicast">PIM</a><code>↗</code>, which is used by L3 devices (like routers) to manage multicast &ldquo;trees&rdquo; across a network or subnet.</p>
    </div>
  </body>
</html>