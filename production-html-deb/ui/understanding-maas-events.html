<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" type="text/css" href="css/stylesheet.css" />
    <style>
      #selector a:link{color:black;}
      #selector a:visited{color:black;}
      #selector a:active{color:black;}
      #selector a:hover{color:blue;}
      #sidebar a:link{color:black;}
      #sidebar a:visited{color:black;}
      #sidebar a:active{color:black;}
      #sidebar a:hover{color:blue;}
      ul {margin-left:0;list-style-type:none;}
      li {margin: 4px 0;}
    </style>
  </head>
  <body>
    <div id="selector" style="top:0; position:fixed; float:right; background-color:#d9d9d9; width:100%;border-bottom:1px solid black;">
      &nbsp;&nbsp;<strong>Offline docs</strong>
      <a href="https://maas.io/docs">(switch to live docs)</a>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      <span style="background-color:white;border-top:1px solid black; border-left:1px solid black; border-right:1px solid black; border-bottom:5px solid white;">
	  &nbsp;UI-only&nbsp;
      </span>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
	<a href="../cli/understanding-maas-events.html">
	  CLI-only
	</a>
    </div>
    <div id="sidebar" style="float:left; width:25%;margin-top:40px; margin-left:20px">
      <strong>
	<a href="maas-documentation.html">
	  Home
	</a>
      </strong>
      <ul>
	<li>
	  <a href="what-is-new-with-maas.html">
	    Release notes
	  </a>
	</li>
      </ul>
      <p/>
      <strong>
	  Tutorials
      </strong>
      <ul>
	<li>
	  <a href="get-started-with-maas.html">
	    Get started with MAAS
	  </a>
	</li>
	<li>
	  <a href="maas-cli-tutorial.html">
	    Try out the MAAS CLI
	  </a>
	</li>
	<li>
	  <a href="create-a-custom-image.html">
	    Create a custom image
	  </a>
	</li>
	<li>
	  <a href="using-jq-with-the-maas-cli.html">
	    Using jq with the MAAS CLI
	  </a>
	</li>
      </ul>
      <strong>
	  How to get MAAS running
      </strong>
      <ul>
	<li>
	  <a href="how-to-install-maas.html">
	    Installation
	  </a>
	</li>
		<li>
	  <a href="how-to-upgrade-maas.html">
	    Upgrade older versions
	  </a>
	</li>
	<li>
	  <a href="how-to-troubleshoot-maas.html">
	    Troubleshooting
	  </a>
	</li>
      </ul>
      <strong>
	  How to configure networking
      </strong>
      <ul>
	<li>
	  <a href="how-to-manage-networks.html">
	    Manage networks
	  </a>
	</li>
	<li>
	  <a href="how-to-manage-ip-addresses.html">
	    Manage IP addresses
	  </a>
	</li>
	<li>
	  <a href="how-to-enable-tls-encryption.html">
	    Enable TLS
	  </a>
	</li>
	<li>
	  <a href="how-to-manage-availability-zones.html">
	    Manage zones
	  </a>
	</li>
      </ul>
      <strong>
	  How to choose images
      </strong>
      <ul>
	<li>
	  <a href="how-to-import-images.html">
	    Import images
	  </a>
	</li>
	<li>
	  <a href="how-to-create-custom-images.html">
	    Create custom images
	  </a>
	</li>
	<li>
	  <a href="how-to-mirror-images-locally.html">
	    Mirror images locally
	  </a>
	</li>
	<li>
	  <a href="how-to-manage-vmware-images.html">
	    Manage VMWare images
	  </a>
	</li>
      </ul>
      <strong>
	  How to deploy MAAS
      </strong>
      <ul>
	<li>
	  <a href="how-to-manage-controllers.html">
	    Manage controllers
	  </a>
	</li>
	<li>
	  <a href="how-to-manage-machines.html">
	    Manage machines
	  </a>
	</li>
	<li>
	  <a href="how-to-deploy-machines.html">
	    Deploy machines
	  </a>
	</li>
	<li>
	  <a href="how-to-customise-machines.html">
	    Customise machines
	  </a>
	</li>
	<li>
	  <a href="how-to-manage-vm-hosts.html">
	    Manage VM hosts
	  </a>
	</li>
	<li>
	  <a href="how-to-manage-vms.html">
	    Manage VMs
	  </a>
	</li>
	<li>
	  <a href="how-to-use-lxd.html">
	    Use LXD
	  </a>
	</li>
      </ul>
      <strong>
	  How to use tags
      </strong>
      <ul>
	<li>
	  <a href="how-to-work-with-tags.html">
	    Work with tags
	  </a>
	</li>
	<li>
	  <a href="how-to-work-with-annotations.html">
	    Work with annotations
	  </a>
	</li>
	<li>
	  <a href="how-to-use-machine-tags.html">
	    Use machine tags
	  </a>
	</li>
	<li>
	  <a href="how-to-use-controller-tags.html">
	    Use controller tags
	  </a>
	</li>
	<li>
	  <a href="how-to-use-storage-tags.html">
	    Use storage tags
	  </a>
	</li>
	<li>
	  <a href="how-to-use-network-tags.html">
	    Use network tags
	  </a>
	</li>
      </ul>
      <strong>
	  How to operate MAAS
      </strong>
	<ul>
	  <li>
	    <a href="how-to-enable-high-availability.html">
	      Enable HA
	    </a>
	  </li>
	  <li>
	    <a href="how-to-set-up-maas-metrics.html">
	      Set up MAAS metrics
	    </a>
	  </li>
	  <li>
	    <a href="how-to-work-with-audit-event-logs.html">
	      Work with audit event logs
	    </a>
	  </li>
	<li>
	  <a href="how-to-use-maas-in-an-air-gapped-environment.html">
	    Use air-gapped MAAS
	  </a>
	</li>
	  <li>
	  <a href="how-to-back-up-maas.html">
	    Back up MAAS
	  </a>
	</li>
	<li>
	  <a href="how-to-secure-maas.html">
	    Secure MAAS
	  </a>
	</li>
	<li>
	  <a href="how-to-manage-user-accounts.html">
	    Manage users
	  </a>
	</li>
	<li>
	  <a href="how-to-search-maas.html">
	    Search MAAS
	  </a>
	</li>
	</ul>
      <p/>
      <strong>
	  API Reference
      </strong>
      <ul>
	<li>
	  <a href="api-authentication-reference.html">
	    API authentication
	  </a>
	</li>
	<li>
	  <a href="api.html">
	    API documentation
	  </a>
	</li>
	<li>
	  <a href="python-api-client-reference.html">
	    API client
	  </a>
	</li>
      </ul>
      <p/>
      <strong>
	Technical Reference
      </strong>
      <ul>
	<li>
	  <a href="audit-event-log-reference.html">
	    Audit event log reference
	  </a>
	</li>
	<li>
	  <a href="commissioning-scripts-reference.html">
	    Commissioning scripts
	  </a>
	</li>
	<li>
	  <a href="hardware-test-scripts-reference.html">
	    Hardware test scripts
	  </a>
	</li>
	<li>
	  <a href="maas-logging-reference.html">
	    Log files
	  </a>
	</li>
	<li>
	  <a href="maas-performance.html">
	    MAAS performance
	  </a>
	</li>
	<li>
	  <a href="power-management-reference.html">
	    Power management
	  </a>
	</li>
	<li>
	  <a href="storage-layouts-reference.html">
	    Storage reference
	  </a>
	</li>
	<p/>
	<strong>
	  General Reference
	</strong>
	<li>
	  <a href="what-is-new-with-maas.html">
	    Release notes
	  </a>
	</li>
	<li>
	  <a href="installation-requirements.html">
	    Installation requirements
	  </a>
	</li>

	<li>
	  <a href="maas-concepts-and-terms-reference.html">
	    Concepts & terms
	  </a>
	</li>
	<li>
	  <a href="how-to-get-help.html">
	    Getting help
	  </a>
	</li>
      </ul>
      <p/>
      <strong>
	  Explanations
      </strong>
      <ul>
	<li>
	  <a href="about-maas.html">
	    MAAS
	  </a>
	</li>
	<li>
	  <a href="about-tcp-ip-networks.html">
	    TCP/IP networks
	  </a>
	</li>
	<li>
	  <a href="about-cloud-networks.html">
	    Cloud networks
	  </a>
	</li>
	<li>
	  <a href="about-dhcp.html">
	    DHCP
	  </a>
	</li>
	<li>
	  <a href="about-networking.html">
	    MAAS networking
	  </a>
	</li>
	<li>
	  <a href="about-images.html">
	    Images
	  </a>
	</li>
	<li>
	  <a href="about-creating-custom-images.html">
	    Custom images
	  </a>
	</li>
	<li>
	  <a href="about-controllers.html">
	    Controllers
	  </a>
	</li>
	<li>
	  <a href="about-machines.html">
	    Machines
	  </a>
	</li>
	<li>
	  <a href="about-customising-machines.html">
	    Customising machines
	  </a>
	</li>
	<li>
	  <a href="about-vm-hosting.html">
	    VM hosting
	  </a>
	</li>
      </ul>
    </div>
    <div class="container" style="float:right; width:65%; margin-top:40px; margin-right:30px">
  <h1>Understanding MAAS events</h1><!-- "Understanding MAAS events" -->

<p>Events are state changes that happen to MAAS elements, such as controllers, networks, or machines.  These state changes can be caused by MAAS itself, some external agent (such as an external DHCP server), or by users (such as when commissioning a machine).  Being able to review events is often essential to debugging or verifying your MAAS system.</p>
<p>Events can be seen in the MAAS logs, in the UI event log, and in output from the CLI <code>events query</code> command.  These three sources provide analagous (but somewhat different information). For example, consider the following log listing, obtained by doing a <code>grep "fun-zebra" *.log | grep "transition from"</code> in the MAAS log directory:</p>
<pre><code class="language-nohighlight">maas.log:2022-09-29T15:04:07.795515-05:00 neuromancer maas.node: [info] fun-zebra: Status transition from COMMISSIONING to TESTING
maas.log:2022-09-29T15:04:17.288763-05:00 neuromancer maas.node: [info] fun-zebra: Status transition from TESTING to READY
</code></pre>
<p>This information appears this way when events are queried from the CLI:</p>
<pre><code class="language-nohighlight">        {
            &quot;username&quot;: &quot;unknown&quot;,
            &quot;node&quot;: &quot;bk7mg8&quot;,
            &quot;hostname&quot;: &quot;fun-zebra&quot;,
            &quot;id&quot;: 170,
            &quot;level&quot;: &quot;INFO&quot;,
            &quot;created&quot;: &quot;Thu, 29 Sep. 2022 20:04:17&quot;,
            &quot;type&quot;: &quot;Ready&quot;,
            &quot;description&quot;: &quot;&quot;
        },
        {
            &quot;username&quot;: &quot;unknown&quot;,
            &quot;node&quot;: &quot;bk7mg8&quot;,
            &quot;hostname&quot;: &quot;fun-zebra&quot;,
            &quot;id&quot;: 167,
            &quot;level&quot;: &quot;INFO&quot;,
            &quot;created&quot;: &quot;Thu, 29 Sep. 2022 20:04:07&quot;,
            &quot;type&quot;: &quot;Running test&quot;,
            &quot;description&quot;: &quot;smartctl-validate on sda&quot;
        },
</code></pre>
<p>And it appears like this in the UI events log:</p>
<table>
<thead>
<tr>
<th>Time</th>
<th>Event</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Thu, 29 Sep. 2022 20:04:17</strong></td>
<td><strong>Node changed status - From &lsquo;Testing&rsquo; to &lsquo;Ready&rsquo;</strong></td>
</tr>
<tr>
<td>Thu, 29 Sep. 2022 20:04:17</td>
<td>Ready</td>
</tr>
<tr>
<td>Thu, 29 Sep. 2022 20:04:17</td>
<td>Script result - smartctl-validate on sda changed status from &lsquo;Running&rsquo; to &lsquo;Skipped&rsquo;</td>
</tr>
<tr>
<td>Thu, 29 Sep. 2022 20:04:16</td>
<td>Script result - smartctl-validate on sda changed status from &lsquo;Installing dependencies&rsquo; to &lsquo;Running&rsquo;</td>
</tr>
<tr>
<td>Thu, 29 Sep. 2022 20:04:07</td>
<td>Running test - smartctl-validate on sda</td>
</tr>
<tr>
<td><strong>Thu, 29 Sep. 2022 20:04:07</strong></td>
<td><strong>Node changed status - From &lsquo;Commissioning&rsquo; to &lsquo;Testing&rsquo;</strong></td>
</tr>
</tbody>
</table>
<p>You can see that all three outputs are sources of truth, but the messages are somewhat different, include different information, and contain different levels of detail.</p>
<p><a href="#heading--Using-the-logs-directly"><h2 id="heading--Using-the-logs-directly">Using the logs directly</h2></a></p>
<p>By the way, if you&rsquo;re interested in reading the logs, and you&rsquo;re using snaps, you&rsquo;ll find what you need here:</p>
<ul style="margin-left:4px; list-style-type:disc;">
<li>/var/snap/maas/common/log/maas.log</li>
<li>/var/snap/maas/common/log/regiond.log</li>
<li>/var/snap/maas/common/log/rackd.log</li>
<li>/var/snap/maas/common/log/rsyslog/$MACHINE_NAME/$RELEVANT_DATE/messages</li>
</ul>
<p>If you’re using packages, you’ll find the log files in these locations:</p>
<ul style="margin-left:4px; list-style-type:disc;">
<li>/var/log/maas/maas.log</li>
<li>/var/log/maas/regiond.log</li>
<li>/var/log/maas/rackd.log</li>
<li>/var/log/maas/rsyslog/$MACHINE_NAME/$RELEVANT_DATE/messages</li>
</ul>
<p>These logs can be very large and hard to search, and the web UI does not separate events by type. For instance, commissioning a simple VM produces logging information like this:</p>
<pre><code class="language-nohighlight">maas.log:2022-09-29T15:00:16.461402-05:00 neuromancer maas.interface: [info] eth0 (physical) on fun-zebra: IP address automatically unlinked: None:type=AUTO
maas.log:2022-09-29T15:00:16.553396-05:00 neuromancer maas.node: [info] fun-zebra: Status transition from NEW to COMMISSIONING
maas.log:2022-09-29T15:00:16.754265-05:00 neuromancer maas.power: [info] Changing power state (on) of node: fun-zebra (bk7mg8)
maas.log:2022-09-29T15:00:16.759676-05:00 neuromancer maas.node: [info] fun-zebra: Commissioning started
maas.log:2022-09-29T15:00:18.039441-05:00 neuromancer maas.power: [info] Changed power state (on) of node: fun-zebra (bk7mg8)
maas.log:2022-09-29T15:03:26.946507-05:00 neuromancer maas.node: [info] fun-zebra: Storage layout was set to flat.
maas.log:2022-09-29T15:04:07.795515-05:00 neuromancer maas.node: [info] fun-zebra: Status transition from COMMISSIONING to TESTING
maas.log:2022-09-29T15:04:17.288763-05:00 neuromancer maas.node: [info] fun-zebra: Status transition from TESTING to READY
regiond.log:2022-09-29 20:00:16 maasserver.models.signals.interfaces: [info] eth0 (physical) on fun-zebra: deleted IP addresses due to VLAN update (5001 -&gt; 5002).
regiond.log:2022-09-29 20:00:32 maasserver.region_controller: [info] Reloaded DNS configuration; ip 10.103.114.192 connected to fun-zebra on eth0
regiond.log:2022-09-29 20:01:09 maasserver.rpc.leases: [info] Lease update: commit for 10.103.114.192 on 0:16:3e:a2:73:5c at 2022-09-29 20:01:09 (lease time: 600s) (hostname: fun-zebra)
regiond.log:2022-09-29 20:01:14 maasserver.region_controller: [info] Reloaded DNS configuration; ip 10.103.114.192 connected to fun-zebra on eth0
regiond.log:     * node fun-zebra renamed interface eth0 to enp5s0
regiond.log:     * ip 10.103.114.192 connected to fun-zebra on eth0
regiond.log:     * ip 10.103.114.192 disconnected from fun-zebra on eth0
</code></pre>
<p>Not all of this output is relevant, nor does it all trigger a recorded MAAS event.  Interpreting MAAS logs is a matter of practice with known events in a controlled environment.</p>
<p><a href="#heading--maas-events-query"><h2 id="heading--mass-events-query">MAAS CLI events query command</h2></a></p>
<p>To simplify the review of significant events, MAAS provides a CLI tool, <code>events query</code>, which can help you filter and summarise events.  Let&rsquo;s take a look at how this tool works.</p>
<p>MAAS events can be queried with the simple CLI command:</p>
<pre><code class="language-nohighlight">maas $PROFILE events query
</code></pre>
<p>where <code>$PROFILE</code> is your login name for your MAAS CLI.  This command produces a very long JSON listing, something like this:</p>
<pre><code class="language-nohighlight">Success.
Machine-readable output follows:
{
    &quot;count&quot;: 100,
    &quot;events&quot;: [
        {
            &quot;username&quot;: &quot;unknown&quot;,
            &quot;node&quot;: &quot;ebd7dc&quot;,
            &quot;hostname&quot;: &quot;new-name&quot;,
            &quot;id&quot;: 588448,
            &quot;level&quot;: &quot;WARNING&quot;,
            &quot;created&quot;: &quot;Tue, 27 Sep. 2022 20:49:37&quot;,
            &quot;type&quot;: &quot;Failed to query node's BMC&quot;,
            &quot;description&quot;: &quot;Failed to login to virsh console.&quot;
        },
        {
            &quot;username&quot;: &quot;unknown&quot;,
            &quot;node&quot;: &quot;mm3tc8&quot;,
            &quot;hostname&quot;: &quot;fair-marten&quot;,
            &quot;id&quot;: 588447,
            &quot;level&quot;: &quot;WARNING&quot;,
            &quot;created&quot;: &quot;Tue, 27 Sep. 2022 20:49:37&quot;,
            &quot;type&quot;: &quot;Failed to query node's BMC&quot;,
            &quot;description&quot;: &quot;Failed to login to virsh console.&quot;
        },
        [... goes on for 100 events, by default ...]
        {
            &quot;username&quot;: &quot;unknown&quot;,
            &quot;node&quot;: &quot;ebd7dc&quot;,
            &quot;hostname&quot;: &quot;new-name&quot;,
            &quot;id&quot;: 588442,
            &quot;level&quot;: &quot;WARNING&quot;,
            &quot;created&quot;: &quot;Tue, 27 Sep. 2022 20:39:22&quot;,
            &quot;type&quot;: &quot;Failed to query node's BMC&quot;,
            &quot;description&quot;: &quot;Failed to login to virsh console.&quot;
        }
    ],
    &quot;next_uri&quot;: &quot;/MAAS/api/2.0/events/?op=query&amp;limit=5&amp;after=588448&quot;,
    &quot;prev_uri&quot;: &quot;/MAAS/api/2.0/events/?op=query&amp;limit=5&amp;before=588442&quot;
}
</code></pre>
<p>These listings can be very long and very hard to read.  You&rsquo;ll also notice that this particular MAAS has over 500,000 events, so parsing these logs by hand is certainly not practical.  There are two things you should do to make events easier to interpret:</p>
<ul style="margin-left:4px; list-style-type:disc;">
<li>
<p>use the <code>jq</code> command, with some invocations we&rsquo;ll give you, to make neat tables out of your event lists.</p>
</li>
<li>
<p>use the various filters &ndash; supplied as part of the <code>events query</code> command &ndash; to limit your output.</p>
</li>
</ul>
<p>Let&rsquo;s explore both of these things in turn.</p>
<p><a href="#heading--using-jq-with-events"><h2 id="heading--using-jq-with-events">Using jq with events</h2></a></p>
<p>We offer a <a href="using-jq-with-the-maas-cli.html">more complete tutorial on jq</a> in this documentation set, but for now, we can give you some invocations that will make events much easier to read.  Let&rsquo;s take our example command above and add some <code>jq</code> to it to make the output more readable:</p>
<pre><code class="language-nohighlight">maas $PROFILE events query limit=20 \
| jq -r '([&quot;USERNAME&quot;,&quot;NODE&quot;,&quot;HOSTNAME&quot;,&quot;LEVEL&quot;,&quot;DATE&quot;,&quot;TYPE&quot;,&quot;EVENT&quot;] | 
(., map(length*&quot;-&quot;))),
(.events[] | [.username,.node,.hostname,.level,.created,.type,.description]) 
| @tsv' | column -t -s$'\t'
</code></pre>
<p>This might give us output something like this:</p>
<pre><code class="language-nohighlight">USERNAME  NODE    HOSTNAME       LEVEL    DATE                        TYPE                        EVENT
--------  ----    --------       -----    ----                        ----                        -----
unknown   ebd7dc  new-name       WARNING  Thu, 10 Mar. 2022 21:59:52  Failed to query node's BMC  Failed to login to virsh console.
unknown   mm3tc8  fair-marten    WARNING  Thu, 10 Mar. 2022 21:59:52  Failed to query node's BMC  Failed to login to virsh console.
unknown   pbpncx  ruling-bobcat  WARNING  Thu, 10 Mar. 2022 21:59:22  Failed to query node's BMC  Pod pbpncx: Failed to connect to the LXD REST API.
unknown   ebd7dc  new-name       WARNING  Thu, 10 Mar. 2022 21:54:34  Failed to query node's BMC  Failed to login to virsh console.
unknown   mm3tc8  fair-marten    WARNING  Thu, 10 Mar. 2022 21:54:34  Failed to query node's BMC  Failed to login to virsh console.
unknown   pbpncx  ruling-bobcat  WARNING  Thu, 10 Mar. 2022 21:54:05  Failed to query node's BMC  Pod pbpncx: Failed to connect to the LXD REST API.
unknown   ebd7dc  new-name       WARNING  Thu, 10 Mar. 2022 21:49:21  Failed to query node's BMC  Failed to login to virsh console.
unknown   mm3tc8  fair-marten    WARNING  Thu, 10 Mar. 2022 21:49:19  Failed to query node's BMC  Failed to login to virsh console.
unknown   pbpncx  ruling-bobcat  WARNING  Thu, 10 Mar. 2022 21:48:49  Failed to query node's BMC  Pod pbpncx: Failed to connect to the LXD REST API.
unknown   mm3tc8  fair-marten    WARNING  Thu, 10 Mar. 2022 21:44:08  Failed to query node's BMC  Failed to login to virsh console.
admin     ebd7dc  new-name       AUDIT    Thu, 09 Jun. 2022 21:39:54  Node                        Tagging 'new-name'.
unknown   pbpncx  contr-105      ERROR    Rack import error           Unable to import boot images: ('Connection broken: IncompleteRead(4096 bytes read)', IncompleteRead(4096 bytes read))
unknown   mm3tc8  fair-marten    WARNING  Thu, 10 Mar. 2022 21:38:50  Failed to query node's BMC  Failed to login to virsh console.
unknown   ebd7dc  contr-105      DEBUG    Thu, 12 May. 2022 21:38:26  Rack import info            Starting rack boot image import
unknown   pbpncx  ruling-bobcat  WARNING  Thu, 10 Mar. 2022 21:38:21  Failed to query node's BMC  Pod pbpncx: Failed to connect to the LXD REST API.
admin     pbpncx  ruling-bobcat  AUDIT    Thu, 16 Jun. 2022 21:35:16  Node                        Started commissioning on 'ruling-bobcat'.
unknown   mm3tc8  fair-marten    WARNING  Thu, 10 Mar. 2022 21:33:44  Failed to query node's BMC  Failed to login to virsh console.
unknown   pbpncx  ruling-bobcat  WARNING  Thu, 10 Mar. 2022 21:33:16  Failed to query node's BMC  Pod pbpncx: Failed to connect to the LXD REST API.
unknown   knpge8  bolla          INFO     Thu, 10 Mar. 2022 20:21:41  Ready                         
unknown   pbpncx  ruling-bobcat  WARNING  Thu, 10 Mar. 2022 18:01:47  Failed to query node's BMC  &lt;LXDAPIException instance at 0x7f0b53e21dc0 with str error:\n Traceback (most recent call last):\n  File &quot;/snap/maas/19076/usr/lib/python3/dist-packages/twisted/python/reflect.py&quot;, line 448, in safe_str\n    return str(o)\n  File &quot;/snap/maas/19076/usr/lib/python3/dist-packages/pylxd/exceptions.py&quot;, line 18, in __str__\n    if self.response.status_code == 200:  # Operation failure\nAttributeError: 'LXDAPIException' object has no attribute 'status_code'\n&gt;
</code></pre>
<p>You&rsquo;ll notice, in this listing, we have a mix of event types and responses.  In one case, the log even recorded a code exception.  You can probably see from this listing that events can be very helpful in tracking behaviours and resolving issues with your MAAS instance.  Even limited to 20 records, though, this output is still hard to parse, so let&rsquo;s explore ways to filter this table.</p>
<p><a href="#heading--filter-parameters"><h2 id="heading--filter-parameters">Filter parameters</h2></a></p>
<p>The <code>events query</code> command accepts several different filters, all of them optional:</p>
<ul style="margin-left:4px; list-style-type:disc;">
<li>
<p><em>hostname</em>: Only events relating to the node with the matching hostname will be returned. This can be specified multiple times to get events relating to more than one node.</p>
</li>
<li>
<p><em>mac_address</em>: Only nodes with matching MAC addresses will be returned. Note that MAC address is not part of the standard output, so you&rsquo;d need to look it up elsewhere.</p>
</li>
<li>
<p><em>id</em>: Only nodes with matching system IDs will be returned.  This corresponds to the <code>node</code> parameter in the JSON listing, not the <code>id</code> parameter there, which is a serial event number.</p>
</li>
<li>
<p><em>zone</em>: Only nodes in the zone will be returned.  Note that zones are not part of the standard output, so you&rsquo;d need to look these up elsewhere.</p>
</li>
<li>
<p><em>level</em>: The event level to capture.  You can choose from AUDIT, CRITICAL, DEBUG, ERROR, INFO, or WARNING.  The default is INFO.</p>
</li>
<li>
<p><em>limit</em>: Number of events to return. The default is 100, the maximum in one command is 1000.</p>
</li>
<li>
<p><em>before</em>: Defines an event id to start returning older events.  This is the &ldquo;id&rdquo; part of the JSON, not the system ID or &ldquo;node&rdquo;.  Note that <code>before</code> and <code>after</code> cannot be used together, as the results are unpredictable.</p>
</li>
<li>
<p><em>after</em>: Defines an event id to start returning newer events.  This is the &ldquo;id&rdquo; part of the JSON, not the system ID or &ldquo;node&rdquo;.  Note that <code>before</code> and <code>after</code> cannot be used together, as the results are unpredictable.</p>
</li>
</ul>
<p>This list of filters gives us a few different ways to simplify the output.  Let&rsquo;s try some of these combinations on the sample data, above.</p>
<p><a href="#heading--hostname-filter"><h3 id="heading--hostname-filter">Hostname, system ID, and MAC address filters</h3></a></p>
<p>We can limit the hostname to, say, &ldquo;new-name&rdquo; by entering the following:</p>
<pre><code class="language-nohighlight">maas $PROFILE events query limit=5 hostname=new-name\
| jq -r '([&quot;USERNAME&quot;,&quot;NODE&quot;,&quot;HOSTNAME&quot;,&quot;LEVEL&quot;,&quot;DATE&quot;,&quot;TYPE&quot;,&quot;EVENT&quot;] | 
(., map(length*&quot;-&quot;))),
(.events[] | [.username,.node,.hostname,.level,.created,.type,.description]) 
| @tsv' | column -t -s$'\t'
</code></pre>
<p>This might give us the following output:</p>
<pre><code class="language-nohighlight">USERNAME  NODE    HOSTNAME  LEVEL    DATE                        TYPE                        EVENT
--------  ----    --------  -----    ----                        ----                        -----
unknown   ebd7dc  new-name  WARNING  Tue, 27 Sep. 2022 21:41:37  Failed to query node's BMC  Failed to login to virsh console.
unknown   ebd7dc  new-name  WARNING  Tue, 27 Sep. 2022 21:36:22  Failed to query node's BMC  Failed to login to virsh console.
unknown   ebd7dc  new-name  WARNING  Tue, 27 Sep. 2022 21:31:22  Failed to query node's BMC  Failed to login to virsh console.
unknown   ebd7dc  new-name  WARNING  Tue, 27 Sep. 2022 21:26:07  Failed to query node's BMC  Failed to login to virsh console.
unknown   ebd7dc  new-name  WARNING  Tue, 27 Sep. 2022 21:21:07  Failed to query node's BMC  Failed to login to virsh console.
</code></pre>
<p>We would get similar results with this command, using the &ldquo;id&rdquo; filter:</p>
<pre><code class="language-nohighlight">maas $PROFILE events query limit=5 id=ebd7dc\
| jq -r '([&quot;USERNAME&quot;,&quot;NODE&quot;,&quot;HOSTNAME&quot;,&quot;LEVEL&quot;,&quot;DATE&quot;,&quot;TYPE&quot;,&quot;EVENT&quot;] | 
(., map(length*&quot;-&quot;))),
(.events[] | [.username,.node,.hostname,.level,.created,.type,.description]) 
| @tsv' | column -t -s$'\t'
</code></pre>
<p>We can also get similar results by looking up this machine&rsquo;s MAC address (52:54:00:32:8b:ea) and filtering by that parameter instead:</p>
<pre><code class="language-nohighlight">maas $PROFILE events query limit=5 mac_address=52:54:00:32:8b:ea\
| jq -r '([&quot;USERNAME&quot;,&quot;NODE&quot;,&quot;HOSTNAME&quot;,&quot;LEVEL&quot;,&quot;DATE&quot;,&quot;TYPE&quot;,&quot;EVENT&quot;] | 
(., map(length*&quot;-&quot;))),
(.events[] | [.username,.node,.hostname,.level,.created,.type,.description]) 
| @tsv' | column -t -s$'\t'
</code></pre>
<p>In this particular case, all three would yield identical outputs.</p>
<p><a href="#heading--zone-filter"><h3 id="heading--zone-filter">Zone filter</h3></a></p>
<p>We can look up one of the zones (using the Web UI or other CLI commands), and formulate a filter like this:</p>
<pre><code class="language-nohighlight">maas $PROFILE events query limit=5 zone=twilight\
| jq -r '([&quot;USERNAME&quot;,&quot;NODE&quot;,&quot;HOSTNAME&quot;,&quot;LEVEL&quot;,&quot;DATE&quot;,&quot;TYPE&quot;,&quot;EVENT&quot;] | 
(., map(length*&quot;-&quot;))),
(.events[] | [.username,.node,.hostname,.level,.created,.type,.description]) 
| @tsv' | column -t -s$'\t'
</code></pre>
<p>Note that this query yields slightly different records:</p>
<pre><code class="language-nohighlight">USERNAME  NODE    HOSTNAME     LEVEL    DATE                        TYPE                        EVENT
--------  ----    --------     -----    ----                        ----                        -----
unknown   mm3tc8  fair-marten  WARNING  Tue, 27 Sep. 2022 21:52:07  Failed to query node's BMC  Failed to login to virsh console.
unknown   mm3tc8  fair-marten  WARNING  Tue, 27 Sep. 2022 21:46:52  Failed to query node's BMC  Failed to login to virsh console.
unknown   mm3tc8  fair-marten  WARNING  Tue, 27 Sep. 2022 21:41:37  Failed to query node's BMC  Failed to login to virsh console.
unknown   mm3tc8  fair-marten  WARNING  Tue, 27 Sep. 2022 21:36:22  Failed to query node's BMC  Failed to login to virsh console.
unknown   mm3tc8  fair-marten  WARNING  Tue, 27 Sep. 2022 21:31:22  Failed to query node's BMC  Failed to login to virsh console.
</code></pre>
<p><a href="#heading--level-filter"><h3 id="heading--level-filter">Level filter</h3></a></p>
<p>We can choose to look at specific events that match a logging level.  For example, we can repeat this command with <code>level=AUDIT</code>:</p>
<pre><code class="language-nohighlight">maas $PROFILE events query limit=5 level=AUDIT\
| jq -r '([&quot;USERNAME&quot;,&quot;NODE&quot;,&quot;HOSTNAME&quot;,&quot;LEVEL&quot;,&quot;DATE&quot;,&quot;TYPE&quot;,&quot;EVENT&quot;] | 
(., map(length*&quot;-&quot;))),
(.events[] | [.username,.node,.hostname,.level,.created,.type,.description]) 
| @tsv' | column -t -s$'\t'
</code></pre>
<p>This will yield dramatically different results:</p>
<pre><code class="language-nohighlight">USERNAME  NODE    HOSTNAME       LEVEL  DATE                        TYPE  EVENT
--------  ----    --------       -----  ----                        ----  -----
admin     ebd7dc  new-name       AUDIT  Thu, 22 Sep. 2022 15:25:55  Node  Overrode failed testing on 'new-name'.
admin     87pnsc  solid-tick     AUDIT  Thu, 22 Sep. 2022 15:22:33  Node  Aborted 'commissioning' on 'solid-tick'.
admin     pbpncx  ruling-bobcat  AUDIT  Thu, 22 Sep. 2022 15:19:00  Node  Started commissioning on 'ruling-bobcat'.
admin     87pnsc  solid-tick     AUDIT  Thu, 22 Sep. 2022 15:18:59  Node  Started commissioning on 'solid-tick'.
understanding-maas-events.htmlobob  mm3tc8  fair-marten    AUDIT  Wed, 21 Sep. 2022 14:21:25  Node  Tagging 'fair-marten'.
understanding-maas-events.htmlobob  mm3tc8  fair-marten    AUDIT  Wed, 21 Sep. 2022 14:10:38  Node  Untagging 'fair-marten'.
</code></pre>
<p>In fact, there are several different levels associated with MAAS events:</p>
<ul style="margin-left:4px; list-style-type:disc;">
<li>INFO: the default, used if no <code>level=</code> is specified; shows <code>INFO</code> and <code>ERROR</code> events.  A typical <code>INFO</code> event is &ldquo;Ready&rdquo;, indicating that a machine has reached the &ldquo;Ready&rdquo; state.</li>
<li>CRITICAL: critical MAAS failures; shows only <code>CRITICAL</code> events.  These events usually represent severe error conditions that should be immediately remedied.</li>
<li>ERROR: MAAS errors; shows only <code>ERROR</code> events. Typical <code>ERROR</code> events include such things as power on/off failures, commissioning timeouts, and image import failures.</li>
<li>WARNING: failures which may or may not affect MAAS performance; shows <code>WARNING</code> and <code>ERROR</code> events.  A typical warning event, for example, might include the inability to find and boot a machine.</li>
<li>DEBUG: information which would help debug MAAS behavior; shows <code>DEBUG</code> and <code>INFO</code> events.  Typical <code>DEBUG</code> events involve routine image import activites, for example.</li>
<li>AUDIT: information which helps determine settings and user actions in MAAS; shows only <code>AUDIT</code> events.  They are <a href="understanding-maas-audit-events.html">covered in more detail elsewhere</a>.</li>
</ul>
<p><a href="#heading--combining-filters"><h3 id="heading--combining-filters">Combining filters</h3></a></p>
<p>We can combine the <code>level</code> parameter with the <code>zone</code> parameter:</p>
<pre><code class="language-nohighlight">maas $PROFILE events query limit=5 level=AUDIT zone=twilight\
| jq -r '([&quot;USERNAME&quot;,&quot;NODE&quot;,&quot;HOSTNAME&quot;,&quot;LEVEL&quot;,&quot;DATE&quot;,&quot;TYPE&quot;,&quot;EVENT&quot;] | 
(., map(length*&quot;-&quot;))),
(.events[] | [.username,.node,.hostname,.level,.created,.type,.description]) 
| @tsv' | column -t -s$'\t'
</code></pre>
<p>This combination gives us a very different output:</p>
<pre><code class="language-nohighlight">USERNAME     NODE    HOSTNAME     LEVEL  DATE                        TYPE  EVENT
--------     ----    --------     -----  ----                        ----  -----
bobslidell   7h3cw7  polong       AUDIT  Tue, 27 Sep. 2022 21:53:38  Node  Set the zone to 'twilight' on 'polong'.
theotherbob  8r6pw7  karura       AUDIT  Tue, 27 Sep. 2022 21:53:34  Node  Set the zone to 'twilight' on 'karura'.
miltwaddams  mm3tc8  fair-marten  AUDIT  Wed, 21 Sep. 2022 14:21:25  Node  Tagging 'fair-marten'.
mikebolton   mm3tc8  fair-marten  AUDIT  Wed, 21 Sep. 2022 14:10:38  Node  Untagging 'fair-marten'.
admin        8r6pw7  karura       AUDIT  Wed, 21 Sep. 2022 14:00:47  Node  Untagging 'karura'.
</code></pre>
<p>These various filters can be combined, and even repeated as necessary:</p>
<pre><code class="language-nohighlight">$ maas $PROFILE events query level=AUDIT hostname=karura hostname=polong limit=5 \
| jq -r '([&quot;USERNAME&quot;,&quot;NODE&quot;,&quot;HOSTNAME&quot;,&quot;LEVEL&quot;,&quot;DATE&quot;,&quot;TYPE&quot;,&quot;EVENT&quot;] | 
(., map(length*&quot;-&quot;))),
(.events[] | [.username,.node,.hostname,.level,.created,.type,.description]) 
| @tsv' | column -t -s$'\t'
</code></pre>
<p>Again, this combination gives us a different view of the event data:</p>
<pre><code class="language-nohighlight">USERNAME    NODE    HOSTNAME  LEVEL  DATE                        TYPE  EVENT
--------    ----    --------  -----  ----                        ----  -----
stormrider  7h3cw7  polong    AUDIT  Tue, 27 Sep. 2022 21:53:38  Node  Set the zone to 'twilight' on 'polong'.
stormrider  8r6pw7  karura    AUDIT  Tue, 27 Sep. 2022 21:53:34  Node  Set the zone to 'twilight' on 'karura'.
admin       8r6pw7  karura    AUDIT  Wed, 21 Sep. 2022 14:00:47  Node  Untagging 'karura'.
admin       8r6pw7  karura    AUDIT  Wed, 21 Sep. 2022 14:00:01  Node  Tagging 'karura'.
admin       8r6pw7  karura    AUDIT  Wed, 21 Sep. 2022 13:58:11  Node  Untagging 'karura'.
</code></pre>
<p><a href="#heading--limit-filter"><h3 id="heading--limit-filter">The limit filter</h3></a></p>
<p>You can use the <code>limit</code> filter to restrict the number of records listed, as we have been doing in many of the examples above.  We can expand the last example to <code>limit=7</code>, for instance:</p>
<pre><code class="language-nohighlight">$ maas $PROFILE events query level=AUDIT hostname=karura hostname=polong limit=7 \
| jq -r '([&quot;USERNAME&quot;,&quot;NODE&quot;,&quot;HOSTNAME&quot;,&quot;LEVEL&quot;,&quot;DATE&quot;,&quot;TYPE&quot;,&quot;EVENT&quot;] | 
(., map(length*&quot;-&quot;))),
(.events[] | [.username,.node,.hostname,.level,.created,.type,.description]) 
| @tsv' | column -t -s$'\t'
</code></pre>
<p>This gives us a slightly longer list:</p>
<pre><code class="language-nohighlight">USERNAME    NODE    HOSTNAME  LEVEL  DATE                        TYPE  EVENT
--------    ----    --------  -----  ----                        ----  -----
stormrider  7h3cw7  polong    AUDIT  Tue, 27 Sep. 2022 21:53:38  Node  Set the zone to 'twilight' on 'polong'.
stormrider  8r6pw7  karura    AUDIT  Tue, 27 Sep. 2022 21:53:34  Node  Set the zone to 'twilight' on 'karura'.
admin       8r6pw7  karura    AUDIT  Wed, 21 Sep. 2022 14:00:47  Node  Untagging 'karura'.
admin       8r6pw7  karura    AUDIT  Wed, 21 Sep. 2022 14:00:01  Node  Tagging 'karura'.
admin       8r6pw7  karura    AUDIT  Wed, 21 Sep. 2022 13:58:11  Node  Untagging 'karura'.
admin       8r6pw7  karura    AUDIT  Wed, 21 Sep. 2022 13:57:48  Node  Tagging 'karura'.
admin       7h3cw7  polong    AUDIT  Tue, 13 Sep. 2022 14:14:24  Node  Powered on 'polong'.
</code></pre>
<p><a href="#heading--before-and-after-filters"><h3 id="heading--before-and-after-filters">The before and after filters</h3></a></p>
<p>Let&rsquo;s suppose that we want to repeat the query in the last example, but we want to start from the beginning of the event log (whenever that might have been).  We could modify the above command to something like this:</p>
<pre><code class="language-nohighlight">$ maas $PROFILE events query level=AUDIT hostname=karura hostname=polong after=0 limit=7 \
| jq -r '([&quot;USERNAME&quot;,&quot;NODE&quot;,&quot;HOSTNAME&quot;,&quot;LEVEL&quot;,&quot;DATE&quot;,&quot;TYPE&quot;,&quot;EVENT&quot;] | 
(., map(length*&quot;-&quot;))),
(.events[] | [.username,.node,.hostname,.level,.created,.type,.description]) 
| @tsv' | column -t -s$'\t'
</code></pre>
<p>This would give us a different view:</p>
<pre><code class="language-nohighlight">USERNAME  NODE    HOSTNAME  LEVEL  DATE                        TYPE  EVENT
--------  ----    --------  -----  ----                        ----  -----
ed        8r6pw7  karura    AUDIT  Tue, 12 Jul. 2022 15:08:27  Node  Powered on 'karura'.
ed        8r6pw7  karura    AUDIT  Tue, 12 Jul. 2022 15:08:23  Node  Powered on 'karura'.
ed        8r6pw7  karura    AUDIT  Tue, 12 Jul. 2022 15:08:08  Node  Powered off 'karura'.
admin     8r6pw7  karura    AUDIT  Thu, 23 Jun. 2022 23:26:53  Node  Set the zone to 'asd' on 'karura'.
peter     8r6pw7  karura    AUDIT  Fri, 22 Apr. 2022 08:06:59  Node  Powered off 'karura'.
peter     8r6pw7  karura    AUDIT  Fri, 22 Apr. 2022 07:09:55  Node  Powered on 'karura'.
ed        7h3cw7  polong    AUDIT  Thu, 27 Jan. 2022 14:34:34  Node  Powered on 'polong'.
</code></pre>
<p>We could also retrieve very recent records using &ldquo;before&rdquo;:</p>
<pre><code class="language-nohighlight">$ maas $PROFILE events query level=AUDIT before=500000 limit=7 \
| jq -r '([&quot;USERNAME&quot;,&quot;NODE&quot;,&quot;HOSTNAME&quot;,&quot;LEVEL&quot;,&quot;DATE&quot;,&quot;TYPE&quot;,&quot;EVENT&quot;] | 
(., map(length*&quot;-&quot;))),
(.events[] | [.username,.node,.hostname,.level,.created,.type,.description]) 
| @tsv' | column -t -s$'\t'
</code></pre>
<p>This would return:</p>
<pre><code class="language-nohighlight">USERNAME  NODE    HOSTNAME     LEVEL  DATE                        TYPE  EVENT
--------  ----    --------     -----  ----                        ----  -----
peter     8r6pw7  karura       AUDIT  Fri, 22 Apr. 2022 08:06:59  Node  Powered off 'karura'.
peter     8r6pw7  karura       AUDIT  Fri, 22 Apr. 2022 07:09:55  Node  Powered on 'karura'.
admin     ebd7dc  new-name     AUDIT  Thu, 14 Apr. 2022 02:24:02  Node  Aborted 'commissioning' on 'new-name'.
admin     ebd7dc  new-name     AUDIT  Thu, 14 Apr. 2022 02:23:44  Node  Started commissioning on 'new-name'.
ed        mm3tc8  fair-marten  AUDIT  Fri, 08 Apr. 2022 11:02:15  Node  Untagging 'fair-marten'.
ed        mm3tc8  fair-marten  AUDIT  Fri, 08 Apr. 2022 11:02:14  Node  Tagging 'fair-marten'.
admin     mm3tc8  fair-marten  AUDIT  Fri, 11 Feb. 2022 11:00:00  Node  Set the zone to 'twilight' on 'fair-marten'.
</code></pre>
    </div>
  </body>
</html>