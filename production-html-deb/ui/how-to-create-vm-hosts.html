<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" type="text/css" href="css/stylesheet.css" />
    <style>
      #selector a:link{color:black;}
      #selector a:visited{color:black;}
      #selector a:active{color:black;}
      #selector a:hover{color:blue;}
      #sidebar a:link{color:black;}
      #sidebar a:visited{color:black;}
      #sidebar a:active{color:black;}
      #sidebar a:hover{color:blue;}
      ul {margin-left:0;list-style-type:none;}
      li {margin: 4px 0;}
    </style>
  </head>
  <body>
    <div id="selector" style="top:0; position:fixed; float:right; background-color:#d9d9d9; width:100%;border-bottom:1px solid black;">
      &nbsp;&nbsp;
      <strong>Offline docs
      </strong>
      <a href="https://maas.io/docs">(switch to live docs)
      </a>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      <span style="background-color:white;border-top:1px solid black; border-left:1px solid black; border-right:1px solid black; border-bottom:5px solid white;">
	  UI-only
      </span>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
	<a href="../cli/how-to-create-vm-hosts.html">
	  CLI-only
	</a>
    </div>
    <div id="sidebar" style="float:left; width:25%;margin-top:40px; margin-left:20px">
      <strong>
	<a href="maas-documentation.html">
	  Home
	</a>
      </strong>
      <ul>
	<li>
	  <a href="what-is-new-with-maas.html">
	    Release notes
	  </a>
	</li>
	<li>
	  <a href="maas-installation-requirements.html">
	    Installation requirements
	  </a>
	</li>
	<li>
	  <a href="maas-glossary.html">
	    Glossary
	  </a>
	</li>
      </ul>
      <strong>
	<a href="basic-tutorials.html">
	  Basic tutorials
	</a>
      </strong>
      <ul>
	<li>
	  <a href="maas-bootstrap-tutorial.html">
	    MAAS bootstrap tutorial
	  </a>
	</li>
	<li>
	  <a href="try-out-the-maas-cli.html">
	    Try out the MAAS CLI
	  </a>
	</li>
	<li>
	  <a href="custom-image-tutorial.html">
	    Custom image tutorial
	  </a>
	</li>
	<li>
	  <a href="using-jq-with-the-maas-cli.html">
	    Using jq with the MAAS CLI
	  </a>
	</li>
      </ul>
      <strong>
	<a href="how-to-get-started-with-maas.html">
	  How to get started with MAAS
	</a>
      </strong>
      <ul>
	<li>
	  <a href="how-to-spin-up-maas-with-ansible.html">
	    Spin up MAAS with Ansible
	  </a>
	</li>
	<li>
	  <a href="how-to-install-maas.html">
	    Install MAAS
	  </a>
	</li>
	<li>
	  <a href="how-to-upgrade-maas.html">
	    Upgrade MAAS
	  </a>
	</li>
	<li>
	  <a href="how-to-change-maas-settings.html">
	    Change MAAS settings
	  </a>
	</li>
	<li>
	  <a href="how-to-get-help.html">
	    Ask for help
	  </a>
	</li>
	<li>
	  <a href="how-to-request-a-feature.html">
	    Request a feature
	  </a>
	</li>
	<li>
	  <a href="how-to-report-a-bug.html">
	    Report a bug
	  </a>
	</li>
	<li>
	  <a href="how-to-troubleshoot-maas.html">
	    Troubleshooting
	  </a>
	</li>
      </ul>
      <strong>
	<a href="how-to-set-up-networks.html">
	  How to set up networks
	</a>
      </strong>
      <ul>
	<li>
	  <a href="how-to-connect-maas-networks.html">
	    Connect MAAS networks
	  </a>
	</li>
	<li>
	  <a href="how-to-enable-dhcp.html">
	    Enable DHCP
	  </a>
	</li>
	<li>
	  <a href="how-to-manage-availability-zones.html">
	    Manage zones (AZs)
	  </a>
	</li>
      </ul>
      <strong>
	<a href="how-to-acquire-images.html">
	  How to acquire images
	</a>
      </strong>
      <ul>
	<li>
	  <a href="how-to-use-standard-images.html">
	    Use standard images
	  </a>
	</li>
	<li>
	  <a href="how-to-mirror-images-locally.html">
	    Mirror images locally
	  </a>
	</li>
	<li>
	  <a href="how-to-build-custom-images.html">
	    Build custom images
	  </a>
	</li>
	<li>
	  <a href="how-to-employ-vmware-images.html">
	    Employ VMWare images
	  </a>
	</li>
      </ul>
      <strong>
	<a href="how-to-tune-controllers.html">
	  How to tune controllers
	</a>
      </strong>
      <ul>
	<li>
	  <a href="how-to-adjust-your-controllers.html">
	    Adjust your controllers
	  </a>
	</li>
	<li>
	  <a href="how-to-enable-high-availability.html">
	    Enable HA
	  </a>
	</li>
      </ul>
      <strong>
	<a href="how-to-deploy-physical-machines.html">
	  How to deploy physical machines
	</a>
      </strong>
      <ul>
	<li>
	  <a href="how-to-make-machines-available.html">
	    Make machines available
	  </a>
	</li>
	<li>
	  <a href="how-to-customise-machines.html">
	    Customise machines
	  </a>
	</li>
	<li>
	  <a href="how-to-put-machines-to-work.html">
	    Put machines to work
	  </a>
	</li>
      </ul>
      <strong>
	<a href="how-to-deploy-virtual-machines.html">
	  How to deploy virtual machines
	</a>
      </strong>
      <ul>
	<li>
	  <a href="how-to-set-up-lxd.html">
	    Set up LXD
	  </a>
	</li>
	<li>
	  <a href="how-to-create-vm-hosts.html">
	    Create VM hosts
	  </a>
	</li>
	<li>
	  <a href="how-to-create-and-manage-vms.html">
	    Create and manage VMs
	  </a>
	</li>
      </ul>
      <strong>
	<a href="how-to-label-and-find-machines.html">
	  How to label and find machines
	</a>
      </strong>
      <ul>
	<li>
	  <a href="how-to-tag-machines.html">
	    Tag machines
	  </a>
	</li>
	<li>
	  <a href="how-to-annotate-machines.html">
	    Annotate machines
	  </a>
	</li>
	<li>
	  <a href="how-to-use-machine-tags.html">
	    Use machine tags
	  </a>
	</li>
	<li>
	  <a href="how-to-use-controller-tags.html">
	    Use controller tags
	  </a>
	</li>
	<li>
	  <a href="how-to-use-storage-tags.html">
	    Use storage tags
	  </a>
	</li>
	<li>
	  <a href="how-to-use-network-tags.html">
	    Use network tags
	  </a>
	</li>
	<li>
	  <a href="how-to-find-machines.html">
	    Find machines
	  </a>
	</li>
      </ul>
      <strong>
	How to diagnose issues
      </strong>
      <ul>
	<li>
	  <a href="how-to-work-with-log-files.html">
	    Work with log files
	  </a>
	</li>
	<li>
	  <a href="how-to-work-with-audit-event-logs.html">
	    Work with audit event logs
	  </a>
	</li>
      </ul>
      <strong>
	How to work securely
      </strong>
      <ul>
	<li>
	  <a href="how-to-improve-maas-security.html">
	    Improve MAAS security
	  </a>
	</li>
	<li>
	  <a href="how-to-enable-maas-native-tls.html">
	    Enable MAAS native TLS
	  </a>
	</li>
	<li>
	  <a href="how-to-set-up-an-air-gapped-maas.html">
	    Set up an air-gapped MAAS
	  </a>
	</li>
	<li>
	  <a href="how-to-manage-user-accounts.html">
	    Manage user accounts
	  </a>
	</li>
      </ul>
      <strong>
	How to operate reliably
      </strong>
      <ul>
	<li>
	  <a href="how-to-keep-maas-backed-up.html">
	    Keep MAAS backed up
	  </a>
	</li>
	<li>
	  <a href="how-to-observe-a-live-maas.html">
	    Observe a live MAAS
	  </a>
	</li>
      </ul>
      <strong>
	<a href="explanation.html">
	Explanations
	</a>
      </strong>
      <ul>
	<li>
	  <a href="about-vm-hosting.html">
	    VM hosting
	  </a>
	</li>
	<li>
	  <a href="understanding-maas-events.html">
	    MAAS events
	  </a>
	</li>
	<li>
	  <a href="undersdtanding-maas-audit-events.html">
	    MAAS audit events
	  </a>
	</li>
	<li>
	  <a href="about-rbac.html">
	    RBAC
	  </a>
	</li>
      </ul>
      <strong>
	API reference
      </strong>
      <ul>
	<li>
	  <a href="api-authentication-reference.html">
	    API authentication
	  </a>
	</li>
	<li>
	  <a href="python-api-client-reference.html">
	    API client
	  </a>
	</li>
	<li>
	  <a href="api.html">
	    API documentation
	  </a>
	</li>
      </ul>
      <strong>
	<a href="maas-technical-reference.html">
	  MAAS technical reference
	</a>
      </strong>
      <ul>
	<li>
	  <a href="commissioning-scripts-reference.html">
	    Commissioning scripts
	  </a>
	</li>
	<li>
	  <a href="hardware-test-scripts-reference.html">
	    Hardware test scripts
	  </a>
	</li>
	<li>
	  <a href="audit-event-log-reference.html">
	    Audit event logs
	  </a>
	</li>
	<li>
	  <a href="maas-performance.html">
	    MAAS performance
	  </a>
	</li>
	<li>
	  <a href="power-management-reference.html">
	    Power management
	  </a>
	</li>
	<li>
	  <a href="storage-layouts-reference.html">
	    Storage layouts
	  </a>
	</li>
	<li>
	  <a href="maas-terraform-provider-reference.html">
	    Terraform provider
	  </a>
	</li>
      </ul>
    </div>
    <div class="container" style="float:right; width:65%; margin-top:40px; margin-right:30px">
      <h1>How to create VM hosts</h1><!-- "How to create VM hosts" -->
<p>In order to  deploy a VM host in your MAAS network, you first need to set up a bridge to connect between your VM host and MAAS itself. Once that&rsquo;s done, you can add and manage VM hosts &ndash; and subsequently, create VMs to act as MAAS machines.  This article explains:</p>
<ul style="margin-left:4px; list-style-type:disc;">
<li><a href="#heading--maas-bridge-web-ui">How to set up a VM host bridge with the web UI</a></li>
<li><a href="#heading--maas-bridge-netplan">How to set up a VM host bridge with netplan</a></li>
<li><a href="#heading--maas-bridge-libvirt">How to set up a VM host bridge with libvirt</a></li>
<li><a href="#heading--set-up-ssh">How to set up SSH for use by libvirt</a></li>
<li><a href="#heading--adding-a-vm-host">How to add a VM host</a></li>
<li><a href="#heading--configuration">How to configure a VM host</a></li>
<li><a href="#heading--lxd-clusters">How to use LXD clusters</a></li>
</ul>
<p>To enable VM host networking features, MAAS must match the VM host IP address of a potential VM host with a known device (a machine or controller). For example, if a machine not known to MAAS is set up as a VM host, enhanced interface selection features will not be available.</p>
<p><strong>NOTE:</strong> 
It&rsquo;s essential to enforce usage of IP addresses to avoid domain name conflicts, should different controllers resolve the same domain name with different IP addresses. You should also avoid using 127.0.0.1 when running multiple controllers, as it would confuse MAAS.</p>
<p><a href="#heading--maas-bridge-web-ui"><h2 id="heading--maas-bridge-web-ui">How to set up a VM host bridge with the web UI</h2></a></p>
<p>You can use the MAAS UI to configure a bridge to connect a VM host to MAAS:</p>
<p>Select the machine you want to use as a VM host, switch to the &ldquo;Network&rdquo; tab. Select the network where you want to create the bridge and click &ldquo;Create bridge:&rdquo;</p>
<p><a href="../images/29624d737106c5bad777aee9d2c8cad9c3de7151.jpeg" target = "_blank"><img alt="unlabeled image" width="690" src="../images/29624d737106c5bad777aee9d2c8cad9c3de7151.jpeg"></a> </p>
<p>Configure the bridge on a subnet MAAS controls.  You may use any IP mode for the bridge:</p>
<p><a href="../images/dd8567ff1cd76606c5ce1751e606fcfab2bc7ce2.jpeg" target = "_blank"><img alt="unlabeled image" width="690" src="../images/dd8567ff1cd76606c5ce1751e606fcfab2bc7ce2.jpeg"></a> </p>
<p>When you&rsquo;re done, it should look something like this:</p>
<p><a href="../images/e392d638f0acecb9d54c81bbca4ee17cbcd05445.jpeg" target = "_blank"><img alt="unlabeled image" width="690" src="../images/e392d638f0acecb9d54c81bbca4ee17cbcd05445.jpeg"></a> </p>
<p>Then you can deploy Ubuntu.</p>
<p><a href="#heading--maas-bridge-netplan"><h2 id="heading--maas-bridge-netplan">How to set up a VM host bridge with netplan</h2></a></p>
<p>You can also use netplan to configure a VM host bridge:</p>
<p>Open your netplan configuration file.  This should be in <code>/etc/netplan</code>.  It could be called <code>50-cloud-init.yaml</code>, <code>netplan.yaml</code>, or something else.  Modify the file to add a bridge, using the example below to guide you:</p>
<pre><code class="language-nohighlight">network:
    bridges:
        br0:
            addresses:
            - 10.0.0.101/24
            gateway4: 10.0.0.1
            interfaces:
            - enp1s0
            macaddress: 52:54:00:39:9d:f9
            mtu: 1500
            nameservers:
                addresses:
                - 10.0.0.2
                search:
                - maas
            parameters:
                forward-delay: 15
                stp: false
    ethernets:
        enp1s0:
            match:
                macaddress: 52:54:00:39:9d:f9
            mtu: 1500
            set-name: enp1s0
        enp2s0:
            match:
                macaddress: 52:54:00:df:87:ac
            mtu: 1500
            set-name: enp2s0
        enp3s0:
            match:
                macaddress: 52:54:00:a7:ac:46
            mtu: 1500
            set-name: enp3s0
    version: 2
</code></pre>
<p>Apply the new configuration with <code>netplan apply</code>.</p>
<p><a href="#heading--maas-bridge-libvirt"><h2 id="heading--maas-bridge-libvirt">How to set up a VM host bridge with libvirt</h2></a></p>
<p>It is also possible to use <a href="https://ubuntu.com/server/docs/virtualization-libvirt">libvirt</a><code>↗</code> to configure a virtual bridge.  This method will also work for LXD VM hosts running on Ubuntu.  Be aware that other methods may be required if you are configuring LXD on an OS other than Ubuntu.</p>
<p>By default, libvirt creates a virtual bridge, <code>virbr0</code>, through which VMs communicate with each other and the Internet. DHCP, supplied by libvirt, automatically assigns an IP address to each VM.  However, to enable network booting in MAAS, you’ll need to provide DHCP in MAAS and either:</p>
<ul style="margin-left:4px; list-style-type:disc;">
<li>Disable DHCP on libvirt’s <code>default</code> network, or</li>
<li>Create a new libvirt network <code>maas</code> with DHCP disabled.</li>
</ul>
<p>You can set up such a <code>maas</code> network like this:</p>
<pre><code class="language-nohighlight">cat &lt;&lt; EOF &gt; maas.xml
&lt;network&gt;
 &lt;name&gt;maas&lt;/name&gt;
 &lt;forward mode='nat'&gt;
   &lt;nat&gt;
     &lt;port start='1024' end='65535'/&gt;
   &lt;/nat&gt;
 &lt;/forward&gt;
 &lt;dns enable=&quot;no&quot; /&gt;
 &lt;bridge name='virbr1' stp='off' delay='0'/&gt;
 &lt;domain name='testnet'/&gt;
 &lt;ip address='172.16.99.1' netmask='255.255.255.0'&gt;
 &lt;/ip&gt;
&lt;/network&gt;
EOF
virsh net-define maas.xml
</code></pre>
<p>Note that this network also has NAT port forwarding enabled to allow VMs to communicate with the Internet at large. Port forwarding is very useful in test environments.</p>
<p><a href="#heading--set-up-ssh"><h2 id="heading--set-up-ssh">How to set up SSH for use by libvirt</h2></a></p>
<p>For MAAS to successfully communicate with libvirt on your VM host machine &ndash; whether you&rsquo;re running from snap or package, or running rack controllers in LXD containers or on localhost &ndash; this example command must succeed from every rack controller:</p>
<pre><code class="language-nohighlight">virsh -c qemu+ssh://$USER@$VM_HOST_IP/system list --all
</code></pre>
<p>Here, <code>$USER</code> is a user on your VM host who is a member of the <code>libvirtd</code> Unix group on the VM host, and <code>$VM_HOST_IP</code> is the IP of your VM host.  <strong>Note</strong> that insufficient permissions for <code>$USER</code> may cause the <code>virsh</code> command to fail with an error such as <code>failed to connect to the hypervisor</code>. Check the <code>$USER</code> group membership to make sure <code>$USER</code> is a member of the <code>libvirtd</code> group.</p>
<p><a href="#heading--adding-a-vm-host"><h2 id="heading--adding-a-vm-host">How to add a VM host</h2></a></p>
<p>After installing MAAS, the &lsquo;KVM&rsquo; page is typically empty:</p>
<p><a href="../images/883a61d38dea2c04010bf9286f0c68700b14975c.png" target = "_blank"><img alt="unlabeled image" width="690" src="../images/883a61d38dea2c04010bf9286f0c68700b14975c.png"></a></p>
<p>If you want to add a LXD (or <a href="https://ubuntu.com/server/docs/virtualization-libvirt">libvirt</a>)<code>↗</code> KVM host to a machine which is already installed, you can do so with the &lsquo;Add KVM&rsquo; button:</p>
<p><a href="../images/93fcb7aecee3eeea31f3939a884c12fe89f790ba.jpeg" target = "_blank"><img alt="unlabeled image" width="690" src="../images/93fcb7aecee3eeea31f3939a884c12fe89f790ba.jpeg"></a></p>
<p><a href="#heading--How-to-authenticate-LXD-VM-hosts-via-certificates"><h3 id="heading--How-to-authenticate-LXD-VM-hosts-via-certificates">How to authenticate LXD VM hosts via certificates</h3></a></p>
<p>Suppose that you&rsquo;re creating a new LXD KVM, beginning from the top tab in MAAS:</p>
<p><a href="../images/b7048c83a7d6e4dbca69a060a7b4bf8bc07e1953_2_690x165.png" target = "_blank"><img alt="unlabeled image" width="690" src="../images/b7048c83a7d6e4dbca69a060a7b4bf8bc07e1953_2_690x165.png"></a></p>
<p>Select &ldquo;Add KVM&rdquo;, which brings you to the definition screen:</p>
<p><a href="../images/806d3577b11ed415574fd06de5f643f26ffb7928_2_690x257.png" target = "_blank"><img alt="unlabeled image" width="690" src="../images/806d3577b11ed415574fd06de5f643f26ffb7928_2_690x257.png"></a></p>
<p>From here, you&rsquo;ll continue by choosing your authentication method.</p>
<p><a href="#heading--How-to-let-MAAS-create-a-certificate-for-you"><h3 id="heading--How-to-let-MAAS-create-a-certificate-for-you">How to let MAAS create a certificate for you</h3></a></p>
<p>If you choose &ldquo;Generate new certificate&rdquo;, as shown above, you&rsquo;ll come to a screen like this one:</p>
<p><a href="../images/08a32d9221a73f0d6f84580ab9ebeeaaf84aeb65_2_690x325.png" target = "_blank"><img alt="unlabeled image" width="690" src="../images/08a32d9221a73f0d6f84580ab9ebeeaaf84aeb65_2_690x325.png"></a></p>
<p>You can still choose to use the LXD trust password (entered when you ran <code>lxd init</code> during LXD installation).  You can also, though, choose to use the certificate MAAS has just generated for you.  To do that, select the entire contents of the text box, copy it, and paste it into a terminal window &ndash; then hit &ldquo;Enter&rdquo;:</p>
<pre><code>$ lxc config trust add - &lt;&lt;EOF
&gt; -----BEGIN CERTIFICATE-----
&gt; MIIErTCCApUCEQCGa86XdjYUGm8h8YOh4HAEMA0GCSqGSIb3DQEBDQUAMAAwHhcN
&gt; MjEwOTI0MjE1NDQ4WhcNMzEwOTIyMjE1NDQ4WjApMScwJQYDVQQDDB5teTBuZXh0
&gt; LTMuMS4wLWJldGExLWt2bUB3YWxkZW4wggIiMA0GCSqGSIb3DQEBAQUAA4ICDwAw
&gt; ggIKAoICAQC1tmJbSYx3Jb5JcuqLvyO6P0RtYWCbjVYOSAIM1PKHZJRvako6QhjR
&gt; 6wWNcVLAjDJIMuEBysrI8mcAv9D/AfT2qLQ/5mg7anbxfrd3YXG2nc70QJazpFaw
&gt; INDc85wrdJD5NEd50iaka+PztIAWzoZWQr/pLb7hUDnArzSHp5J+w0dRCUh54SyW
&gt; Du4mLpDks5UqMeONO1o7lbaQuBdzGtR4btdmvOkJfg/Pu3i/rzFZ1vvn1JhZTX96
&gt; +xH7tJQiqOk0SXG7F2RmbYiYDhAkiysbMoyOHBCf/qFWq4Vtd/VMxOAT1WERrgWn
&gt; 8nL5kRBozV94QocJaOe+GUSWLHsRpsVa8jiAj3LS2CFQfpaEsrzLSlQOeN2rNB9z
&gt; DO9yGXGql4tUpgtyEvxB/zVrIGd04iTC3D4S9b1KyzTbSsyjTc/XJhUStnn49ySW
&gt; Iwv1eHa2jMvIjRVm5sRfpf0EOZW27HLI1AqDOXR0DmlM2mWvndjvfacX+41I8vuG
&gt; +RPq0ZjDhwfRmUaLiebzcExwPmSHAxqiaV+t0n6ivDWTNk6cNc38rZBh3x6I7JMR
&gt; /85Rc1blLSF7QBMA1HxheCUYzBPTKsdE2btygq9vShRXCdSekV0jGoL1g0n6T59r
&gt; +9nHShgc/Bzk42kcddQySlrqWWHrXX6Z2N1R3eYpuvSEaKsnsjqjwwIDAQABMA0G
&gt; CSqGSIb3DQEBDQUAA4ICAQA4d1Xqi941ssyJoiovTzBgMDSp9kqjpB83BRqbF9oZ
&gt; fQGkezn2jF7SnaXbTyR/K+nir5Rms8OZfUxyZJwYh/YCdnIF8hzC32mLJbP6jcJV
&gt; LS0OD+EipwyRLSe9g2it68TtAhhVXKPx3tGQWWiXtJOF631sJRcRUZATc9nco5H2
&gt; 91GKog4LdFeKD3ArOq1GkE9r95WauTV37x0c474XBt2mVcEvFW50oZbIBPaWLt8E
&gt; q8NG0KYkfIHkhXDGqPDkUtdPJlkiGwqXdaqghuG31a4Or9IKcNmDlli47apaWWJW
&gt; /gqZfFALbOrSJHg10PCqNsfoKmQr2YZzPlTjG39RA7sA1XR6y+lQZqwcXnXk2iAE
&gt; n62OkRUrYVXzBo99zk5jQJVEg6zhfPH9zl6Jmn/vBu0p6RqmqNLTTlMOio8VOp9e
&gt; 9Gyb9uRwzwZ9zgydgI4bHMvcIAq+46wTruOfXBNATWLC2YqXbc+9QqemJebcXULW
&gt; Wf7Sc+SHHx2cVb4OUvUD8keZN37No/2vfZ9NI2SJOI4SxlV2yf6ZRyb7MYIwpm1h
&gt; YTzyS+ywUN4C8p1PsU5iT8DGdcg7Kcso4/DDZeZkLKNeCKizkdMreF7qV0qHTW8z
&gt; PyfZHcR/xWMkjxYZoFu4rVyxpsUJYItJNUNk6vZvSnSDfC2e2JJFfMws+fntNy14
&gt; /w==
&gt; -----END CERTIFICATE-----
&gt; EOF
$ 
</code></pre>
<p>The certificate will be created for you.  When you click the &ldquo;Check authentication&rdquo; button, you will be brought to this screen:</p>
<p><a href="../images/ad3f6fd06fdef3ce5be467816b2fc3667550f397_2_690x204.png" target = "_blank"><img alt="unlabeled image" width="690" src="../images/ad3f6fd06fdef3ce5be467816b2fc3667550f397_2_690x204.png"></a></p>
<p>from which you can continue with normal LXD KVM setup.</p>
<p><a href="#heading--How-to-use-your-own,-existing-certificate"><h4 id="heading--How-to-use-your-own,-existing-certificate">How to use your own, existing certificate</h4></a></p>
<p>Suppose that, after identifying your LXD KVM, you choose &ldquo;Provide certificate and private key&rdquo;.  When you do so, the screen will extend to allow you to upload these items:</p>
<p><a href="../images/fa0bf04654e495ff1233defba4fc8768c06dd25f_2_690x443.png" target = "_blank"><img alt="unlabeled image" width="690" src="../images/fa0bf04654e495ff1233defba4fc8768c06dd25f_2_690x443.png"></a></p>
<p>Paste or upload your certificate and private key, then click &ldquo;Next&rdquo; to validate your authentication criteria, before continuing through the normal LXD KVM creation process.  If your certificate and/or key aren&rsquo;t usable for some reason, MAAS will return an error (in this case, the private key was entered as gibberish, to produce an error output):</p>
<p><a href="../images/286e648de20c9db3bb6c56c5855647c23a5d9e2e.png" target = "_blank"><img alt="unlabeled image" width="690" src="../images/286e648de20c9db3bb6c56c5855647c23a5d9e2e.png"></a></p>
<p>Upon selecting &ldquo;Authenticate&rdquo; (assuming successful authentication), you will receive a project selection screen similar to this:</p>
<p><a href="../images/346c8e29fc8d4b74507843a956865ebd254aad57.jpeg" target = "_blank"><img alt="unlabeled image" width="690" src="../images/346c8e29fc8d4b74507843a956865ebd254aad57.jpeg"></a></p>
<p>You must either enter a new project name (which cannot contain spaces or special characters), or you must select an existing project.  If you&rsquo;re not really planning on using projects, selecting the &ldquo;default&rdquo; project will allow you to continue working as you have in the past.</p>
<p><strong>NOTE:</strong> 
MAAS will automatically discover and store the resources your VM host contains. Any existing machines will also appear on the &lsquo;Machines&rsquo; page, and MAAS will automatically attempt to commission them.</p>
<p><a href="#heading--configuration"><h2 id="heading--configuration">How to configure a VM host</h2></a></p>
<p>VM hosts have several configuration options. Modify these by selecting the &lsquo;Configuration&rsquo; tab and editing options directly.  These options include a VM host&rsquo;s location, password, network zone, resource pool, and memory and CPU overcommit sliders.</p>
<p><a href="../images/8b3fc96a8f1a1e4b25413a9f60388dc04dd886c9.png" target = "_blank"><img alt="unlabeled image" width="690" src="../images/8b3fc96a8f1a1e4b25413a9f60388dc04dd886c9.png"></a></p>
<p><a href="#heading--lxd-clusters"><h3 id="heading--lxd-clusters">LXD clusters</h3></a></p>
<p>MAAS 3.1 allows MAAS to take advantage of the existing LXD clustering capability.</p>
<p><a href="#heading--about-lxd-clusters"><h4 id="heading--about-lxd-clusters">About LXD clusters</h4></a></p>
<p>LXD clusters within the context of MAAS are a way of viewing and managing existing VM host clusters and composing VMs within said cluster.  MAAS will not create a new cluster, but will discover an existing cluster when you provide the info for adding a single clustered host.</p>
<p><a href="#heading--how-to-add-lxd-clusters"><h4 id="heading--how-to-add-lxd-clusters">How to add LXD clusters</h4></a></p>
<p>MAAS assumes you have already configured a cluster within the context of LXD. You then need to configure said cluster with a single trust MAAS will use to communicate with said cluster. Adding a LXD cluster is similar to adding a single LXD host, in that you provide authentication the same way for a single host within the cluster, and then select a project. The only difference is the name you provide will be used for the cluster instead of the individual host. MAAS will then connect to the provided host and discover the other hosts within the cluster, and rename the initially defined host with the cluster member name configured in LXD.</p>
<p><a href="../images/3aba7d6e30eda61623f66cb162ca85814128864a.png" target = "_blank"><img alt="unlabeled image" width="690" src="../images/3aba7d6e30eda61623f66cb162ca85814128864a.png"></a></p>
<p>First, add an LXD KVM:</p>
<p><a href="../images/c7d35ad0d8e1d9038dd39a8965307a49f57d453a.png" target = "_blank"><img alt="unlabeled image" width="690" src="../images/c7d35ad0d8e1d9038dd39a8965307a49f57d453a.png"></a></p>
<p>Next, set up credentials and get your MAAS certificate trusted by LXD:</p>
<p><a href="../images/b3ea7559edc066e899e41f41846a268b2459b1a5.png" target = "_blank"><img alt="unlabeled image" width="690" src="../images/b3ea7559edc066e899e41f41846a268b2459b1a5.png"></a></p>
<p>Once it is connected, you can select the project in that cluster:</p>
<p><a href="../images/ba798351c1c2b37d0aa79bca8c44def38d4ab839.png" target = "_blank"><img alt="unlabeled image" width="690" src="../images/ba798351c1c2b37d0aa79bca8c44def38d4ab839.png"></a></p>
<p>If the KVM host address is part of a cluster, it will show as a Cluster on the listing page. </p>
<p><a href="../images/069bae193cbb09ead3c811fd1a1d28582b946ff4.png" target = "_blank"><img alt="unlabeled image" width="690" src="../images/069bae193cbb09ead3c811fd1a1d28582b946ff4.png"></a></p>
<p><a href="#heading--how-to-compose-vms-in-lxd-clusters"><h4 id="heading--how-to-compose-vms-in-lxd-clusters">How to compose VMs in LXD clusters</h4></a></p>
<p>Composing a VM in a LXD cluster via MAAS is similar to composing a VM for a single VM host. MAAS does not provide any sort of scheduling of said VM, and will instead target the host you select for composing the VM.</p>
<p>From the KVM host listing page, click on the <code>+</code> icon to add a VM to a specific host:</p>
<p><a href="../images/219a302c245992a390cd44ada341cfe5a93a7b5a.png" target = "_blank"><img alt="unlabeled image" width="690" src="../images/219a302c245992a390cd44ada341cfe5a93a7b5a.png"></a></p>
<p>If you are in a specific KVM host page, you can click <code>+ add virtual machine</code>:</p>
<p><a href="../images/219a302c245992a390cd44ada341cfe5a93a7b5a.png" target = "_blank"><img alt="unlabeled image" width="690" src="../images/219a302c245992a390cd44ada341cfe5a93a7b5a.png"></a></p>
<p><a href="#heading--how-to-delete-lxd-clusters"><h3 id="heading--how-to-delete-lxd-clusters">How to delete LXD clusters</h3></a></p>
<p>To delete a LXD cluster, delete any one VM host within the cluster, this will delete the cluster and all members within the cluster:</p>
<p><a href="../images/ea7cd2476ae8cafe6d8e78f2b029d0cd41afa592.png" target = "_blank"><img alt="unlabeled image" width="690" src="../images/ea7cd2476ae8cafe6d8e78f2b029d0cd41afa592.png"></a></p>
    </div>
  </body>
</html>