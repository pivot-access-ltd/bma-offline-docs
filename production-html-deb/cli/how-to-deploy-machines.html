<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" type="text/css" href="css/stylesheet.css" />
    <style>
      #selector a:link{color:black;}
      #selector a:visited{color:black;}
      #selector a:active{color:black;}
      #selector a:hover{color:blue;}
      #sidebar a:link{color:black;}
      #sidebar a:visited{color:black;}
      #sidebar a:active{color:black;}
      #sidebar a:hover{color:blue;}
      ul {margin-left:0;list-style-type:none;}
      li {margin: 4px 0;}
    </style>
  </head>
  <body>
    <div id="selector" style="top:0; position:fixed; float:right; background-color:#d9d9d9; width:100%;border-bottom:1px solid black;">
      &nbsp;&nbsp;<strong>Offline docs</strong>
      <a href="https://maas.io/docs">(switch to live docs)</a>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
	<a href="../ui/how-to-deploy-machines.html">
	  UI-only
	</a>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      <span style="background-color:white;border-top:1px solid black; border-left:1px solid black; border-right:1px solid black; border-bottom:5px solid white;">
	  &nbsp;CLI-only&nbsp;
      </span>
    </div>
    <div id="sidebar" style="float:left; width:25%;margin-top:40px; margin-left:20px">
      <strong>
	<a href="maas-documentation.html">
	  Home
	</a>
      </strong>
      <ul>
	<li>
	  <a href="what-is-new-with-maas.html">
	    Release notes
	  </a>
	</li>
      </ul>
      <p/>
      <strong>
	  Tutorials
      </strong>
      <ul>
	<li>
	  <a href="get-started-with-maas.html">
	    Get started with MAAS
	  </a>
	</li>
	<li>
	  <a href="maas-cli-tutorial.html">
	    Try out the MAAS CLI
	  </a>
	</li>
	<li>
	  <a href="create-a-custom-image.html">
	    Create a custom image
	  </a>
	</li>
	<li>
	  <a href="using-jq-with-the-maas-cli.html">
	    Using jq with the MAAS CLI
	  </a>
	</li>
      </ul>
      <strong>
	  How to get MAAS running
      </strong>
      <ul>
	<li>
	  <a href="how-to-install-maas.html">
	    Installation
	  </a>
	</li>
		<li>
	  <a href="how-to-upgrade-maas.html">
	    Upgrade older versions
	  </a>
	</li>
	<li>
	  <a href="how-to-troubleshoot-maas.html">
	    Troubleshooting
	  </a>
	</li>
      </ul>
      <strong>
	  How to configure networking
      </strong>
      <ul>
	<li>
	  <a href="how-to-manage-networks.html">
	    Manage networks
	  </a>
	</li>
	<li>
	  <a href="how-to-manage-ip-addresses.html">
	    Manage IP addresses
	  </a>
	</li>
	<li>
	  <a href="how-to-enable-tls-encryption.html">
	    Enable TLS
	  </a>
	</li>
	<li>
	  <a href="how-to-manage-availability-zones.html">
	    Manage zones
	  </a>
	</li>
      </ul>
      <strong>
	  How to choose images
      </strong>
      <ul>
	<li>
	  <a href="how-to-import-images.html">
	    Import images
	  </a>
	</li>
	<li>
	  <a href="how-to-create-custom-images.html">
	    Create custom images
	  </a>
	</li>
	<li>
	  <a href="how-to-mirror-images-locally.html">
	    Mirror images locally
	  </a>
	</li>
	<li>
	  <a href="how-to-manage-vmware-images.html">
	    Manage VMWare images
	  </a>
	</li>
      </ul>
      <strong>
	  How to deploy MAAS
      </strong>
      <ul>
	<li>
	  <a href="how-to-manage-controllers.html">
	    Manage controllers
	  </a>
	</li>
	<li>
	  <a href="how-to-manage-machines.html">
	    Manage machines
	  </a>
	</li>
	<li>
	  <a href="how-to-deploy-machines.html">
	    Deploy machines
	  </a>
	</li>
	<li>
	  <a href="how-to-customise-machines.html">
	    Customise machines
	  </a>
	</li>
	<li>
	  <a href="how-to-manage-vm-hosts.html">
	    Manage VM hosts
	  </a>
	</li>
	<li>
	  <a href="how-to-manage-vms.html">
	    Manage VMs
	  </a>
	</li>
	<li>
	  <a href="how-to-use-lxd.html">
	    Use LXD
	  </a>
	</li>
      </ul>
      <strong>
	  How to use tags
      </strong>
      <ul>
	<li>
	  <a href="how-to-work-with-tags.html">
	    Work with tags
	  </a>
	</li>
	<li>
	  <a href="how-to-work-with-annotations.html">
	    Work with annotations
	  </a>
	</li>
	<li>
	  <a href="how-to-use-machine-tags.html">
	    Use machine tags
	  </a>
	</li>
	<li>
	  <a href="how-to-use-controller-tags.html">
	    Use controller tags
	  </a>
	</li>
	<li>
	  <a href="how-to-use-storage-tags.html">
	    Use storage tags
	  </a>
	</li>
	<li>
	  <a href="how-to-use-network-tags.html">
	    Use network tags
	  </a>
	</li>
      </ul>
      <strong>
	  How to operate MAAS
      </strong>
	<ul>
	  <li>
	    <a href="how-to-enable-high-availability.html">
	      Enable HA
	    </a>
	  </li>
	  <li>
	    <a href="how-to-set-up-maas-metrics.html">
	      Set up MAAS metrics
	    </a>
	  </li>
	  <li>
	    <a href="how-to-work-with-audit-event-logs.html">
	      Work with audit event logs
	    </a>
	  </li>
	<li>
	  <a href="how-to-use-maas-in-an-air-gapped-environment.html">
	    Use air-gapped MAAS
	  </a>
	</li>
	  <li>
	  <a href="how-to-back-up-maas.html">
	    Back up MAAS
	  </a>
	</li>
	<li>
	  <a href="how-to-secure-maas.html">
	    Secure MAAS
	  </a>
	</li>
	<li>
	  <a href="how-to-manage-user-accounts.html">
	    Manage users
	  </a>
	</li>
	<li>
	  <a href="how-to-search-maas.html">
	    Search MAAS
	  </a>
	</li>
	</ul>
      <p/>
      <strong>
	  API Reference
      </strong>
      <ul>
	<li>
	  <a href="api-authentication-reference.html">
	    API authentication
	  </a>
	</li>
	<li>
	  <a href="api.html">
	    API documentation
	  </a>
	</li>
	<li>
	  <a href="python-api-client-reference.html">
	    API client
	  </a>
	</li>
      </ul>
      <p/>
      <strong>
	Technical Reference
      </strong>
      <ul>
	<li>
	  <a href="audit-event-log-reference.html">
	    Audit event log reference
	  </a>
	</li>
	<li>
	  <a href="commissioning-scripts-reference.html">
	    Commissioning scripts
	  </a>
	</li>
	<li>
	  <a href="hardware-test-scripts-reference.html">
	    Hardware test scripts
	  </a>
	</li>
	<li>
	  <a href="maas-logging-reference.html">
	    Log files
	  </a>
	</li>
	<li>
	  <a href="maas-performance.html">
	    MAAS performance
	  </a>
	</li>
	<li>
	  <a href="power-management-reference.html">
	    Power management
	  </a>
	</li>
	<li>
	  <a href="storage-layouts-reference.html">
	    Storage reference
	  </a>
	</li>
	<p/>
	<strong>
	  General Reference
	</strong>
	<li>
	  <a href="what-is-new-with-maas.html">
	    Release notes
	  </a>
	</li>
	<li>
	  <a href="installation-requirements.html">
	    Installation requirements
	  </a>
	</li>

	<li>
	  <a href="maas-concepts-and-terms-reference.html">
	    Concepts & terms
	  </a>
	</li>
	<li>
	  <a href="how-to-get-help.html">
	    Getting help
	  </a>
	</li>
      </ul>
      <p/>
      <strong>
	  Explanations
      </strong>
      <ul>
	<li>
	  <a href="about-maas.html">
	    MAAS
	  </a>
	</li>
	<li>
	  <a href="about-tcp-ip-networks.html">
	    TCP/IP networks
	  </a>
	</li>
	<li>
	  <a href="about-cloud-networks.html">
	    Cloud networks
	  </a>
	</li>
	<li>
	  <a href="about-dhcp.html">
	    DHCP
	  </a>
	</li>
	<li>
	  <a href="about-networking.html">
	    MAAS networking
	  </a>
	</li>
	<li>
	  <a href="about-images.html">
	    Images
	  </a>
	</li>
	<li>
	  <a href="about-creating-custom-images.html">
	    Custom images
	  </a>
	</li>
	<li>
	  <a href="about-controllers.html">
	    Controllers
	  </a>
	</li>
	<li>
	  <a href="about-machines.html">
	    Machines
	  </a>
	</li>
	<li>
	  <a href="about-customising-machines.html">
	    Customising machines
	  </a>
	</li>
	<li>
	  <a href="about-vm-hosting.html">
	    VM hosting
	  </a>
	</li>
      </ul>
    </div>
    <div class="container" style="float:right; width:65%; margin-top:40px; margin-right:30px">
  <h1>How to deploy machines</h1><!-- "How to deploy machines" -->
<p>The ultimate purpose of MAAS is to deploy and manage machines.  It&rsquo;s important to understand <a href="about-images.html#heading--how-images-deploy">how images get deployed</a> &ndash; as explained in <a href="about-machines.html#heading--about-the-machine-life-cycle">About the machine life-cycle</a>, machines must first be enlisted or commissioned, then allocated, then deployed.  This article will help you build on that understanding by explaining:</p>
<ul style="margin-left:4px; list-style-type:disc;">
<li><a href="#heading--how-to-commission-a-machine">How to commission a machine</a></li>
<li><a href="#heading--how-to-test-machines">How to test machines</a></li>
<li><a href="#heading--allocate-machines">How to allocate machines</a></li>
<li><a href="#heading--deploy">How to deploy machines</a></li>
</ul>
<p><a href="#heading--how-to-commission-a-machine"><h2 id="heading--how-to-commission-a-machine">How to commission a machine</h2></a></p>
<p>Note that if you are using your own commissioning scripts, and you do not want them to automatically run every time, you must specify <code>noauto</code>, as in this script snippet:</p>
<pre><code>#!/bin/bash
#
# --- Start MAAS 1.0 script metadata ---
# name: 50-script-example
# title: Example
# description: Just an example
# script_type: commissioning
# tags: noauto
</code></pre>
<p>If you do not specify <code>noauto</code>, your custom commissioning scripts will run every time commissioning is attempted.</p>
<p>Once commissioned, you may consider adding a tag to this machine.  The next step is testing and deployment.</p>
<p><a href="#heading--how-to-test-machines"><h2 id="heading--how-to-test-machines">How to test machines</h2></a></p>
<p>This section explains:</p>
<p>You can also refer to technical details and examples for <a href="commissioning-scripts-reference.html">commissioning scripts</a> and <a href="hardware-test-scripts-reference.html">testing scripts</a> as needed.</p>
<p><a href="#heading--how-to-download-built-in-scripts"><h3 id="heading--how-to-download-built-in-scripts">How to download built-in scripts</h3></a></p>
<p>You can download the source for all commissioning and test scripts via the API with the following command:</p>
<pre><code class="language-nohighlight">maas $PROFILE node-script download $SCRIPT_NAME
</code></pre>
<p>The source code to all built-in scripts is available on <a href="https://git.launchpad.net/maas/tree/src/metadataserver/builtin_scripts">launchpad</a>.</p>
<p><a href="#heading--how-to-locate-script-files"><h3 id="heading--how-to-locate-script-files">How to locate script files</h3></a></p>
<p>Commissioning and testing script files may be found in the following directories:</p>
<ul style="margin-left:4px; list-style-type:disc;">
<li><code>/tmp/user_data.sh.*/scripts/commissioning/</code>: Commissioning scripts</li>
<li><code>/tmp/user_data.sh.*/scripts/testing/</code>: Hardware testing scripts</li>
</ul>
<p><a href="#heading--how-to-locate-log-files"><h3 id="heading--how-to-locate-log-files">How to locate log files</h3></a></p>
<p>Commissioning and testing log files may be found in the following directories:</p>
<ul style="margin-left:4px; list-style-type:disc;">
<li><code>/tmp/user_data.sh*/out/</code></li>
<li><code>/var/log/cloud-init-output.log</code></li>
<li><code>/var/log/cloud-init.log</code></li>
</ul>
<p><a href="#heading--how-to-run-all-scripts-manually"><h3 id="heading--how-to-run-all-scripts-manually">How to run all scripts manually</h3></a></p>
<p>You can also run all commissioning and hardware-testing scripts on a machine for debugging.</p>
<pre><code class="language-nohighlight">/tmp/user_data.sh.*/bin/maas-run-remote-scripts \
    [--no-download] \
    [--no-send] \
    /tmp/user_data.sh.*
</code></pre>
<p>Where:</p>
<ul style="margin-left:4px; list-style-type:disc;">
<li><code>--no-download</code>: Optional. Do not download the scripts from MAAS again.</li>
<li><code>--no-send</code>: Optional. Do not send the results to MAAS.</li>
</ul>
<p>For example, to run all the scripts again without downloading again from MAAS:</p>
<pre><code class="language-nohighlight">/tmp/user_data.sh.*/bin/maas-run-remote-scripts --no-download /tmp/user_data.sh.*
</code></pre>
<p>Here, all the scripts are run again after downloading from MAAS, but no output data is sent to MAAS:</p>
<pre><code class="language-nohighlight">/tmp/user_data.sh.*/bin/maas-run-remote-scripts --no-send /tmp/user_data.sh.*
</code></pre>
<p><a href="#heading--network-link-testing"><h3 id="heading--network-link-testing">How to test network links</h3></a></p>
<p>MAAS can check whether links are connected or disconnected, so that you can detect unplugged cables.  If you are not running MAAS 2.7 or higher, you must first upgrade and then recommission your machines to find disconnected links.  MAAS not only reports unplugged cables, but also gives a warning when trying to configure a disconnected interface.  In addition, administrators can change the cable connection status after manually resolving the issue.</p>
<p>Once you have manually repaired the broken connection, an administrator can change cable connection status:</p>
<p><a href="#heading--slow-link-detection"><h2 id="heading--slow-link-detection">How to detect slow network links</h2></a></p>
<p>Administrators can change or update the link and interface speeds after manual changes to the connection:</p>
<pre><code>maas $PROFILE interface update $SYSTEM_ID $INTERFACE_ID link_speed=$NEW_LINK_SPEED \
interface_speed=$NEW_INTERFACE_SPEED
</code></pre>
<p>This functionality is only available through the MAAS CLI.</p>
<p><a href="#heading--network-validation-scripts-and-testing"><h3 id="heading--network-validation-scripts-and-testing">How to configure network validation and testing scripts</h3></a></p>
<p>MAAS allows you to configure network connectivity testing in a number of ways. If MAAS can’t connect to the rack controller, deployment can’t complete.  MAAS can check connectivity to the rack controller and warn you if there’s no link, long before you have to try and debug it. For example, if you can’t connect to your gateway controller, traffic can’t leave your network. </p>
<p>Via the Web UI only, MAAS can check this link and recognise that there’s no connectivity, which alleviates hard-to-detect network issues:</p>
<p><a href="https://discourse.maas.io/uploads/default/original/1X/c4f81cb3ef1a90f0a46fb62c893a4cc9f7e5f45a.jpeg" target = "_blank"><img src="https://discourse.maas.io/uploads/default/original/1X/c4f81cb3ef1a90f0a46fb62c893a4cc9f7e5f45a.jpeg"></a> </p>
<p>Users can now test their network configuration to check for:</p>
<ul style="margin-left:4px; list-style-type:disc;">
<li>Interfaces which have a broken network configuration</li>
<li>Bonds that are not fully operational</li>
<li>Broken gateways, rack controllers, and Internet links</li>
</ul>
<p>In the ephemeral environment, standard DHCP is still applied, but when network testing runs, MAAS can apply your specific configuration for the duration of the test.  While all URLs / IPs are tested with all interfaces, MAAS can test each of your interfaces individually, including breaking apart bonded NICS and testing each side of your redundant interfaces. You can also run different tests on each pass, e.g., a different set of URLs, although each run would be a different testing cycle.</p>
<p>To test individual interfaces, for example, you could issue the following CLI command:</p>
<p><a href="https://discourse.maas.io/uploads/default/original/1X/7fadb56a2939f7a781510a55813141de03521e0d.jpeg" target = "_blank"><img src="https://discourse.maas.io/uploads/default/original/1X/7fadb56a2939f7a781510a55813141de03521e0d.jpeg"></a> </p>
<p>Note that in this command, we are testing internet connectivity to the single interface &ldquo;br0.&rdquo;</p>
<p><a href="#heading--customisable-network-testing"><h3 id="heading--customisable-network-testing">How to customise network testing</h3></a></p>
<p>MAAS allow you to customise network testing according to your needs.  You can create your own commissioning scripts and tests related to networking, and you can run them during the network testing portion of the MAAS workflow.</p>
<p><a href="https://discourse.maas.io/uploads/default/original/1X/0dcf089dbd8efc2fc9d0782d3b15f47647e950b8.jpeg" target = "_blank"><img src="https://discourse.maas.io/uploads/default/original/1X/0dcf089dbd8efc2fc9d0782d3b15f47647e950b8.jpeg"></a> </p>
<p>There are no particular restrictions on these scripts, so you can test a wide variety of possible conditions and situations.  Administrators can upload network tests and test scripts.  Administrators can also create tests which accept an interface parameter, or scripts which apply custom network configurations.  </p>
<p>Users can specify unique parameters using the API, override machines which fail network testing (allowing their use), and suppress individual failed network tests.  Users can also review the health status from all interface tests, even sorting them by interface name and MAC.  In addition, MAAS can report the overall status of all interfaces.</p>
<p><a href="#heading--allocate-machines"><h2 id="heading--allocate-machines">How to allocate machines</h2></a></p>
<p><strong>NOTE:</strong> 
To allocate a node, it must have a status of &lsquo;Ready&rsquo;.</p>
<p><a href="#heading--deploy"><h2 id="heading--deploy">How to deploy machines</h2></a></p>
    </div>
  </body>
</html>