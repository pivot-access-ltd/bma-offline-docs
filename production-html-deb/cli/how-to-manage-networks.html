<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" type="text/css" href="css/stylesheet.css" />
    <style>
      #selector a:link{color:black;}
      #selector a:visited{color:black;}
      #selector a:active{color:black;}
      #selector a:hover{color:blue;}
      #sidebar a:link{color:black;}
      #sidebar a:visited{color:black;}
      #sidebar a:active{color:black;}
      #sidebar a:hover{color:blue;}
      ul {margin-left:0;list-style-type:none;}
      li {margin: 4px 0;}
    </style>
  </head>
  <body>
    <div id="selector" style="top:0; position:fixed; float:right; background-color:#d9d9d9; width:100%;border-bottom:1px solid black;">
      &nbsp;&nbsp;<strong>Offline docs</strong>
      <a href="https://maas.io/docs">(switch to live docs)</a>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
	<a href="../ui/how-to-manage-networks.html">
	  UI-only
	</a>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      <span style="background-color:white;border-top:1px solid black; border-left:1px solid black; border-right:1px solid black; border-bottom:5px solid white;">
	  &nbsp;CLI-only&nbsp;
      </span>
    </div>
    <div id="sidebar" style="float:left; width:25%;margin-top:40px; margin-left:20px">
      <strong>
	<a href="maas-documentation.html">
	  Introduction
	</a>
      </strong>
      <ul>
	<li>
	  <a href="about-maas.html">
	    About MAAS
	  </a>
	</li>
	<li>
	  <a href="get-started-with-maas.html">
	    Get started with MAAS
	  </a>
	</li>
	<li>
	  <a href="how-to-install-maas.html">
	    Install MAAS
	  </a>
	</li>
	<li>
	  <a href="how-to-use-the-maas-cli.html">
	    Use the MAAS CLI
	  </a>
	</li>
      </ul>
      <strong>
	Controllers
      </strong>
      <ul>
	<li>
	  <a href="about-controllers.html">
	    About controllers
	  </a>
	</li>
	<li>
	  <a href="how-to-manage-racks.html">
	    Manage racks
	  </a>
	</li>
	<li>
	  <a href="how-to-manage-regions.html">
	    Region controllers
	  </a>
	</li>
	<li>
	  <a href="how-to-enable-high-availability.html">
	    Enable HA
	  </a>
	</li>
      </ul>
      <strong>
	Machines
      </strong>
      <ul>
	<li>
	  <a href="about-machines.html">
	    About machines
	  </a>
	</li>
	<li>
	  <a href="how-to-manage-machines.html">
	    Manage machines
	  </a>
	</li>
	<li>
	  <a href="how-to-deploy-machines.html">
	    Deploy machines
	  </a>
	</li>
	<li>
	  <a href="how-to-customise-machines.html">
	    Customise machines
	  </a>
	</li>
      </ul>
      <strong>
	VM hosting
      </strong>
      <ul>
	<li>
	  <a href="about-vm-hosting.html">
	    About VM hosting
	  </a>
	</li>
	<li>
	  <a href="how-to-manage-vm-hosts.html">
	    Manage VM hosts
	  </a>
	</li>
	<li>
	  <a href="how-to-manage-vms.html">
	    Manage VMs
	  </a>
	</li>
	<li>
	  <a href="how-to-use-lxd.html">
	    Use LXD
	  </a>
	</li>
      </ul>
      <strong>
	Networking fundamentals
      </strong>
      <ul>
	<li>
	  <a href="about-tcp-ip-networks.html">
	    About TCP/IP networks
	  </a>
	</li>
	<li>
	  <a href="about-cloud-networks.html">
	    About cloud networks
	  </a>
	</li>
	<li>
	  <a href="about-dhcp.html">
	    About DHCP
	  </a>
	</li>
      </ul>
      <strong>
	MAAS Networking
      </strong>
      <ul>
	<li>
	  <a href="about-networking.html">
	    About MAAS networks
	  </a>
	</li>
	<li>
	  <a href="how-to-manage-networks.html">
	    Manage networks
	  </a>
	</li>
	<li>
	  <a href="how-to-manage-machine-interfaces.html">
	    Manage interfaces
	  </a>
	</li>
	<li>
	  <a href="how-to-manage-dhcp.html">
	    Manage DHCP
	  </a>
	</li>
	<li>
	  <a href="how-to-manage-ip-ranges.html">
	    Manage IP ranges
	  </a>
	</li>
	<li>
	  <a href="how-to-manage-proxies.html">
	    Manage proxies
	  </a>
	</li>
	<li>
	  <a href="how-to-enable-tls-encryption.html">
	    Enable TLS
	  </a>
	</li>
	<li>
	  <a href="how-to-manage-availability-zones.html">
	    Manage zones
	  </a>
	</li>
	<li>
	  <a href="how-to-set-up-ntp.html">
	    Set up NTP
	  </a>
	</li>
	<li>
	  <a href="how-to-use-maas-in-an-air-gapped-environment.html">
	    Use air-gapped MAAS
	  </a>
	</li>
      </ul>
      <strong>
	Images
      </strong>
      <ul>
	<li>
	  <a href="about-images.html">
	    About images
	  </a>
	</li>
	<li>
	  <a href="how-to-import-images.html">
	    Select and import images
	  </a>
	</li>
	<li>
	  <a href="how-to-build-maas-images.html">
	    Build MAAS images
	  </a>
	</li>
	<li>
	  <a href="how-to-create-a-custom-ubuntu-image.html">
	    Create custom images
	  </a>
	</li>
	<li>
	  <a href="how-to-use-image-streams.html">
	    Use image streams
	  </a>
	</li>
	<li>
	  <a href="how-to-mirror-images-locally.html">
	    Mirror images locally
	  </a>
	</li>
	<li>
	  <a href="how-to-manage-vmware-images.html">
	    Manage VMWare images
	  </a>
	</li>
      </ul>
      <strong>
	Tags
      </strong>
      <ul>
	<li>
	  <a href="how-to-work-with-tags.html">
	    Work with tags
	  </a>
	</li>
	<li>
	  <a href="how-to-work-with-annotations.html">
	    Work with annotations
	  </a>
	</li>
	<li>
	  <a href="how-to-use-machine-tags.html">
	    Use machine tags
	  </a>
	</li>
	<li>
	  <a href="how-to-use-controller-tags.html">
	    Use controller tags
	  </a>
	</li>
	<li>
	  <a href="how-to-use-storage-tags.html">
	    Use storage tags
	  </a>
	</li>
	<li>
	  <a href="how-to-use-network-tags.html">
	    Use network tags
	  </a>
	</li>
      </ul>
	<p/>
	<strong>
	  Operations
	</strong>
	<ul>
	  <li>
	    <a href="how-to-set-up-maas-metrics.html">
	      Set up MAAS metrics
	    </a>
	  </li>
	  <li>
	  <a href="how-to-back-up-maas.html">
	    Back up MAAS
	  </a>
	</li>
	<li>
	  <a href="how-to-secure-maas.html">
	    Secure MAAS
	  </a>
	</li>
	<li>
	  <a href="how-to-manage-user-accounts.html">
	    Manage users
	  </a>
	</li>
	<li>
	  <a href="how-to-search-maas.html">
	    Search MAAS
	  </a>
	</li>
      </ul>
      <strong>
	Reference
      </strong>
      <ul>
	<li>
	  <a href="power-management-reference.html">
	    Power management
	  </a>
	</li>
	<li>
	  <a href="commissioning-scripts-reference.html">
	    Commissioning scripts
	  </a>
	</li>
	<li>
	  <a href="hardware-test-scripts-reference.html">
	    Hardware test scripts
	  </a>
	</li>
	<li>
	  <a href="maas-logging-reference.html">
	    Log files
	  </a>
	</li>
	<li>
	  <a href="api.html">
	    API documentation
	  </a>
	</li>
	<li>
	  <a href="python-api-client-reference.html">
	    API client
	  </a>
	</li>
	<li>
	  <a href="api-authentication-reference.html">
	    API authentication
	  </a>
	</li>
	<li>
	  <a href="maas-concepts-and-terms-reference.html">
	    Concepts & terms
	  </a>
	</li>
      </ul>
      <strong>
	<a href="how-to-troubleshoot-maas.html">
	  Troubleshooting
	</a>
      </strong>
      <ul>
	<li>
	  <a href="how-to-get-help.html">
	    Get help
	  </a>
	</li>
	<li>
	  <a href="tips-and-tricks.html">
	    Tips, tricks, and traps
	  </a>
	</li>
	<li>
	  <a href="how-to-upgrade-maas.html">
	    Upgrade MAAS
	  </a>
	</li>
      </ul>
      <strong>
	<a href="what-is-new-with-maas.html">
	  Release notes
	</a>
      </strong>
      <p/>
      <strong>
	<a href="how-to-contact-us.html">
	  Contact us
	</a>
      </strong>
    </div>
    <div class="container" style="float:right; width:65%; margin-top:40px; margin-right:30px">
  <h1>How to manage networks</h1><!-- "How to manage networks" -->
<p>You can easily manage the basic networking elements of MAAS, including subnets, fabrics, VLANs, spaces, and IP ranges.  This section shows how to access and edit these elements. See <a href="maas-concepts-and-terms-reference.html">Concepts and terms</a> for the definitions of these networking components.</p>
<p>This section will show you:</p>
<ul>
<li><a href="#heading--how-to-enable-network-discovery">How to enable network discovery</a></li>
<li><a href="#heading--how-to-toggle-subnet-management">How to toggle subnet management</a></li>
<li><a href="#heading--how-to-determine-fabric-id">How to determine fabric ID</a></li>
<li><a href="#heading--how-to-set-a-default-gateway">How to set a default gateway</a></li>
<li><a href="#heading--how-to-set-a-dns-server">How to set a DNS server</a></li>
<li><a href="#heading--cli-list-available-subnets">How to list available subnets</a></li>
<li><a href="#heading--cli-how-to-view-subnet-details">How to view subnet details</a></li>
<li><a href="#heading--how-to-manage-static-routes">How to manage static routes between subnets</a></li>
<li><a href="#heading--how-to-set-up-a-bridge-with-maas">How to set up a bridge with MAAS</a></li>
<li><a href="#heading--how-to-set-up-a-bridge-with-netplan">How to set up a bridge with netplan</a></li>
</ul>
<p><a href="#heading--how-to-enable-network-discovery"><h3 id="heading--how-to-enable-network-discovery">How to enable network discovery</h3></a></p>
<p>To enable network discovery, enter the following at the command line:</p>
<pre><code class="language-nohighlight">maas $PROFILE maas set-config name=network_discovery value=&quot;enabled&quot;
</code></pre>
<p>If successful, you should receive output similar to:</p>
<pre><code class="language-nohighlight">Success.
Machine-readable output follows:
OK
</code></pre>
<p>Network discovery can be disabled or re-enabled at any time with this CLI command.</p>
<p><a href="#heading--how-to-toggle-subnet-management"><h3 id="heading--how-to-toggle-subnet-management">How to toggle subnet management</h3></a></p>
<p>To enable or disable subnet management:</p>
<pre><code class="language-nohighlight">maas $PROFILE subnet update $SUBNET_CIDR managed=false|true
</code></pre>
<p>For example, to disable subnet management:</p>
<pre><code class="language-nohighlight">maas $PROFILE subnet update 192.168.1.0/24 managed=false
</code></pre>
<p>You can use the subnets ID in place of the CIDR address.</p>
<p><a href="#heading--how-to-determine-fabric-id"><h3 id="heading--how-to-determine-fabric-id">How to determine fabric ID</h3></a></p>
<p>To determine a fabric ID based on a subnet address:</p>
<pre><code class="language-nohighlight">FABRIC_ID=$(maas $PROFILE subnet read $SUBNET_CIDR \
    | grep fabric | cut -d ' ' -f 10 | cut -d '&quot;' -f 2)
</code></pre>
<p>This may come in handy when you need a fabric ID for other CLI calls.</p>
<p><a href="#heading--how-to-set-a-default-gateway"><h3 id="heading--how-to-set-a-default-gateway">How to set a default gateway</h3></a></p>
<p>To set the default gateway for a subnet:</p>
<pre><code class="language-nohighlight">maas $PROFILE subnet update $SUBNET_CIDR gateway_ip=$MY_GATEWAY
</code></pre>
<p><a href="#heading--how-to-set-a-dns-server"><h3 id="heading--how-to-set-a-dns-server">How to set a DNS server</h3></a></p>
<p>To set the DNS server for a subnet:</p>
<pre><code class="language-nohighlight">maas $PROFILE subnet update $SUBNET_CIDR dns_servers=$MY_NAME SERVER
</code></pre>
<p><a href="#heading--cli-list-available-subnets"><h3 id="heading--cli-list-available-subnets">How to list available subnets</h3></a></p>
<p>To view the list of available subnets, enter the following command:</p>
<pre><code class="language-nohighlight">maas admin subnets read | \
jq -r '([&quot;FABRIC&quot;, &quot;VLAN&quot;, &quot;DHCP&quot;, &quot;SUBNET&quot;]
| (., map(length*&quot;-&quot;))),
(.[] | [.vlan.fabric, .vlan.name, .vlan.dhcp_on, .cidr])
| @tsv' \
| column -t
</code></pre>
<p>which produces output something like this:</p>
<pre><code class="language-nohighlight">FABRIC        VLAN      DHCP       SUBNET
------        ----      ---------  ------
Patient-Care  untagged  true       192.168.123.0/24
fabric-0      untagged  false      0.0.0.0/0
fabric-0      untagged  false      10.0.0.0/24
fabric-1      untagged  false      10.70.132.0/24
fabric-1      untagged  false      fd42:8b52:7114:9ef8::/64
fabric-3      untagged  true       192.168.43.0/24
fabric-3      untagged  true       2600:100d:b125:d5e9::/64
fabric-3      untagged  true       2600:100d:b120:3933::/64
fabric-3      untagged  true       2600:100d:b109:dee0::/64
fabric-3      untagged  true       2600:100d:b104:94c0::/64
</code></pre>
<p><a href="#heading--cli-how-to-view-subnet-details"><h3 id="heading--cli-how-to-view-subnet-details">How to view subnet details</h3></a></p>
<p>You can view the details of an individual subnet with the command:</p>
<pre><code class="language-nohighlight">maas $PROFILE subnet read $SUBNET_ID \
| jq -r '([&quot;NAME&quot;,&quot;CIDR&quot;,&quot;GATEWAY&quot;,&quot;DNS&quot;,&quot;DISCOVERY&quot;,&quot;FABRIC&quot;,&quot;VLAN&quot;]
| (., map(length*&quot;-&quot;))), ([.name,.cidr,.gateway_ip // &quot;-&quot;, .allow_dns,.active_discovery,.vlan.name,.vlan.fabric]) | @tsv' | column -t
</code></pre>
<p>This command retrieves output similar to this:</p>
<pre><code class="language-nohighlight">NAME              CIDR              GATEWAY  DNS   DISCOVERY  FABRIC    VLAN
----              ----              -------  ---   ---------  ------    ----
192.168.123.0/24  192.168.123.0/24  -        true  false      untagged  default
</code></pre>
<p>If you don&rsquo;t know the subnet ID, you can look it up like this:</p>
<pre><code class="language-nohighlight">maas $PROFILE subnets read \
| jq -r '([&quot;NAME&quot;, &quot;SUBNET_ID&quot;]
| (., map(length*&quot;-&quot;))), (.[] | [.name, .id]) | @tsv' \
| column -t | grep $SUBNET_NAME
</code></pre>
<p>For example, if you&rsquo;re using the &ldquo;admin&rdquo; profile, and your subnet name contains &ldquo;192.168.123,&rdquo; you could find the subnet ID with this command:</p>
<pre><code class="language-nohighlight">maas admin subnets read \
| jq -r '([&quot;NAME&quot;, &quot;SUBNET_ID&quot;]
| (., map(length*&quot;-&quot;))), (.[] | [.name, .id]) | @tsv' \
| column -t | grep 192.168.123
</code></pre>
<p><a href="#heading--how-to-manage-static-routes"><h3 id="heading--how-to-manage-static-routes">How to manage static routes between subnets</h3></a></p>
<p>To create a static route between two subnets, use the following command:</p>
<pre><code class="language-nohighlight">maas admin static-routes create source=$SOURCE_SUBNET destination=$DEST_SUBNET \
gateway_ip=$GATEWAY_IP
</code></pre>
<p><a href="#heading--how-to-set-up-a-bridge-with-maas"><h3 id="heading--how-to-set-up-a-bridge-with-maas">How to set up a bridge with MAAS</h3></a></p>
<p>At various times in your MAAS network, you may need to set up a bridge to connect between your machines and MAAS, as shown in this section.</p>
<p><strong>NOTE:</strong> 
It&rsquo;s essential to enforce usage of IP addresses to avoid domain name conflicts, should different controllers resolve the same domain name with different IP addresses. You should also avoid using 127.0.0.1 when running multiple controllers, as it would confuse MAAS.</p>
<p>You can use the MAAS CLI/API to configure a bridge via the following procedure:</p>
<ol>
<li>
<p>Select the interface on which you wish to configure the bridge. This example uses the boot interface, since the boot interface must be connected to a MAAS controlled network &ndash; but any interface is allowed:</p>
<pre><code>INTERFACE_ID=$(maas $PROFILE machine read $SYSTEM_ID | jq .boot_interface.id)
</code></pre>
</li>
<li>
<p>Create the bridge:</p>
<pre><code> BRIDGE_ID=$(maas $PROFILE interfaces create-bridge $SYSTEM_ID name=br0 parent=$INTERFACE_ID | jq .id)
</code></pre>
</li>
<li>
<p>Select the subnet where you want the bridge (this should be a MAAS controlled subnet):</p>
<pre><code>SUBNET_ID=$(maas $PROFILE subnets read | jq -r '.[] | select(.cidr == "10.0.0.0/24" and .managed == true).id')
</code></pre>
</li>
<li>
<p>Connect the bridge to the subnet:</p>
<pre><code>  maas $PROFILE interface link-subnet $SYSTEM_ID $BRIDGE_ID subnet=$SUBNET_ID mode="STATIC" ip_address="10.0.0.101"
</code></pre>
</li>
</ol>
<p><a href="#heading--how-to-set-up-a-bridge-with-netplan"><h3 id="heading--how-to-set-up-a-bridge-with-netplan">How to set up a bridge with netplan</h3></a></p>
<p>You can also use netplan to configure a bridge:</p>
<ol>
<li>
<p>Open your netplan configuration file.  This should be in <code>/etc/netplan</code>.  It could be called <code>50-cloud-init.yaml</code>, <code>netplan.yaml</code>, or something else.  </p>
</li>
<li>
<p>Modify the file to add a bridge, using the following example as a guide:</p>
</li>
</ol>
<pre><code class="language-nohighlight">network:
    bridges:
        br0:
            addresses:
            - 10.0.0.101/24
            gateway4: 10.0.0.1
            interfaces:
            - enp1s0
            mac address: 52:54:00:39:9d:f9
            mtu: 1500
            name servers:
                addresses:
                - 10.0.0.2
                search:
                - maas
            parameters:
                forward-delay: 15
                stp: false
    Ethernet's:
        enp1s0:
            match:
                mac address: 52:54:00:39:9d:f9
            mtu: 1500
            set-name: enp1s0
        enp2s0:
            match:
                mac address: 52:54:00:df:87:ac
            mtu: 1500
            set-name: enp2s0
        enp3s0:
            match:
                mac address: 52:54:00:a7:ac:46
            mtu: 1500
            set-name: enp3s0
    version: 2
</code></pre>
<ol>
<li>Apply the new configuration with <code>netplan apply</code>.</li>
</ol>
    </div>
  </body>
</html>