<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" type="text/css" href="css/stylesheet.css" />
    <style>
      #selector a:link{color:black;}
      #selector a:visited{color:black;}
      #selector a:active{color:black;}
      #selector a:hover{color:blue;}
      #sidebar a:link{color:black;}
      #sidebar a:visited{color:black;}
      #sidebar a:active{color:black;}
      #sidebar a:hover{color:blue;}
      ul {margin-left:0;list-style-type:none;}
      li {margin: 4px 0;}
    </style>
  </head>
  <body>
    <div id="selector" style="top:0; position:fixed; float:right; background-color:#d9d9d9; width:100%;border-bottom:1px solid black;">
      &nbsp;&nbsp;<strong>Offline docs</strong>
      <a href="https://maas.io/docs">(switch to live docs)</a>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
	<a href="../ui/how-to-customise-machines.html">
	  UI-only
	</a>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      <span style="background-color:white;border-top:1px solid black; border-left:1px solid black; border-right:1px solid black; border-bottom:5px solid white;">
	  &nbsp;CLI-only&nbsp;
      </span>
    </div>
    <div id="sidebar" style="float:left; width:25%;margin-top:40px; margin-left:20px">
      <strong>
	<a href="maas-documentation.html">
	  Home
	</a>
      </strong>
      <ul>
	<li>
	  <a href="what-is-new-with-maas.html">
	    Release notes
	  </a>
	</li>
	<li>
	  <a href="maas-installation-requirements.html">
	    Installation requirements
	  </a>
	</li>
	<li>
	  <a href="maas-glossary.html">
	    Glossary
	  </a>
	</li>
      </ul>
      <strong>
	<a href="basic-tutorials.html">
	  Basic tutorials
	</a>
      </strong>
      <ul>
	<li>
	  <a href="maas-bootstrap-tutorial.html">
	    MAAS bootstrap tutorial
	  </a>
	</li>
	<li>
	  <a href="try-out-the-maas-cli.html">
	    Try out the MAAS CLI
	  </a>
	</li>
	<li>
	  <a href="custom-image-tutorial.html">
	    Custom image tutorial
	  </a>
	</li>
	<li>
	  <a href="using-jq-with-the-maas-cli.html">
	    Using jq with the MAAS CLI
	  </a>
	</li>
      </ul>
      <strong>
	<a href="how-to-get-started-with-maas.html">
	  How to get started with MAAS
	</a>
      </strong>
      <ul>
	<li>
	  <a href="how-to-spin-up-maas-with-ansible.html">
	    Spin up MAAS with Ansible
	  </a>
	</li>
	<li>
	  <a href="how-to-install-maas.html">
	    Install MAAS
	  </a>
	</li>
	<li>
	  <a href="how-to-upgrade-maas.html">
	    Upgrade MAAS
	  </a>
	</li>
	<li>
	  <a href="how-to-change-maas-settings.html">
	    Change MAAS settings
	  </a>
	</li>
	<li>
	  <a href="how-to-get-help.html">
	    Ask for help
	  </a>
	</li>
	<li>
	  <a href="how-to-request-a-feature.html">
	    Request a feature
	  </a>
	</li>
	<li>
	  <a href="how-to-report-a-bug.html">
	    Report a bug
	  </a>
	</li>
	<li>
	  <a href="how-to-troubleshoot-maas.html">
	    Troubleshooting
	  </a>
	</li>
      </ul>
      <strong>
	<a href="how-to-set-up-networks.html">
	  How to set up networks
	</a>
      </strong>
      <ul>
	<li>
	  <a href="how-to-connect-maas-networks.html">
	    Connect MAAS networks
	  </a>
	</li>
	<li>
	  <a href="how-to-enable-dhcp.html">
	    Enable DHCP
	  </a>
	</li>
	<li>
	  <a href="how-to-manage-availability-zones.html">
	    Manage zones (AZs)
	  </a>
	</li>
      </ul>
      <strong>
	<a href="how-to-acquire-images.html">
	  How to acquire images
	</a>
      </strong>
      <ul>
	<li>
	  <a href="how-to-use-standard-images.html">
	    Use standard images
	  </a>
	</li>
	<li>
	  <a href="how-to-mirror-images-locally.html">
	    Mirror images locally
	  </a>
	</li>
	<li>
	  <a href="how-to-build-custom-images.html">
	    Build custom images
	  </a>
	</li>
	<li>
	  <a href="how-to-employ-vmware-images.html">
	    Employ VMWare images
	  </a>
	</li>
      </ul>
      <strong>
	<a href="how-to-tune-controllers.html">
	  How to tune controllers
	</a>
      </strong>
      <ul>
	<li>
	  <a href="how-to-adjust-your-controllers.html">
	    Adjust your controllers
	  </a>
	</li>
	<li>
	  <a href="how-to-enable-high-availability.html">
	    Enable HA
	  </a>
	</li>
      </ul>
      <strong>
	<a href="how-to-deploy-physical-machines.html">
	  How to deploy physical machines
	</a>
      </strong>
      <ul>
	<li>
	  <a href="how-to-make-machines-available.html">
	    Make machines available
	  </a>
	</li>
	<li>
	  <a href="how-to-cusdomise-machines.html">
	    Customise machines
	  </a>
	</li>
	<li>
	  <a href="how-to-put-machines-to-work.html">
	    Put machines to work
	  </a>
	</li>
      </ul>
      <strong>
	<a href="how-to-deploy-virtual-machines.html">
	  How to deploy virtual machines
	</a>
      </strong>
      <ul>
	<li>
	  <a href="how-to-set-up-lxd.html">
	    Set up LXD
	  </a>
	</li>
	<li>
	  <a href="how-to-create-vm-hosts.html">
	    Create VM hosts
	  </a>
	</li>
	<li>
	  <a href="how-to-create-and-manage-vms.html">
	    Create and manage VMs
	  </a>
	</li>
      </ul>
      <strong>
	<a href="how-to-label-and-find-machines.html">
	  How to label and find machines
	</a>
      </strong>
      <ul>
	<li>
	  <a href="how-to-tag-machines.html">
	    Tag machines
	  </a>
	</li>
	<li>
	  <a href="how-to-annotate-machines.html">
	    Annotate machines
	  </a>
	</li>
	<li>
	  <a href="how-to-use-machine-tags.html">
	    Use machine tags
	  </a>
	</li>
	<li>
	  <a href="how-to-use-controller-tags.html">
	    Use controller tags
	  </a>
	</li>
	<li>
	  <a href="how-to-use-storage-tags.html">
	    Use storage tags
	  </a>
	</li>
	<li>
	  <a href="how-to-use-network-tags.html">
	    Use network tags
	  </a>
	</li>
	<li>
	  <a href="how-to-find-machines.html">
	    Find machines
	  </a>
	</li>
      </ul>
      <strong>
	How to diagnose issues
      </strong>
      <ul>
	<li>
	  <a href="how-to-work-with-log-files.html">
	    Work with log files
	  </a>
	</li>
	<li>
	  <a href="how-to-work-with-audit-event-logs.html">
	    Work with audit event logs
	  </a>
	</li>
      </ul>
      <strong>
	How to work securely
      </strong>
      <ul>
	<li>
	  <a href="how-to-improve-maas-security.html">
	    Improve MAAS security
	  </a>
	</li>
	<li>
	  <a href="how-to-enable-maas-native-tls-encryption.html">
	    Enable MAAS native TLS
	  </a>
	</li>
	<li>
	  <a href="how-to-set-up-an-air-gapped-maas.html">
	    Set up an air-gapped MAAS
	  </a>
	</li>
	<li>
	  <a href="how-to-manage-user-accounts.html">
	    Manage user accounts
	  </a>
	</li>
      </ul>
      <strong>
	How to operate reliably
      </strong>
      <ul>
	<li>
	  <a href="how-to-keep-maas-backed-up.html">
	    Keep MAAS backed up
	  </a>
	</li>
	<li>
	  <a href="how-to-observe-a-live-maas.html">
	    Observe a live MAAS
	  </a>
	</li>
      </ul>
      <strong>
	<a href="explanation.html">
	Explanations
	</a>
      </strong>
      <ul>
	<li>
	  <a href="about-vm-hosting.html">
	    VM hosting
	  </a>
	</li>
	<li>
	  <a href="understanding-maas-events.html">
	    MAAS events
	  </a>
	</li>
	<li>
	  <a href="undersdtanding-maas-audit-events.html">
	    MAAS audit events
	  </a>
	</li>
	<li>
	  <a href="about-rbac.html">
	    RBAC
	  </a>
	</li>
      </ul>
      <strong>
	API reference
      </strong>
      <ul>
	<li>
	  <a href="api-authentication-reference.html">
	    API authentication
	  </a>
	</li>
	<li>
	  <a href="python-api-client-reference.html">
	    API client
	  </a>
	</li>
	<li>
	  <a href="api.html">
	    API documentation
	  </a>
	</li>
      </ul>
      <strong>
	<a href=".html">
	  Technical reference
	</a>
      </strong>
      <ul>
	<li>
	  <a href="commissioning-scripts-reference.html">
	    Commissioning scripts
	  </a>
	</li>
	<li>
	  <a href="hardware-test-scripts-reference.html">
	    Hardware test scripts
	  </a>
	</li>
	<li>
	  <a href="audit-event-log-reference.html">
	    Audit event logs
	  </a>
	</li>
	<li>
	  <a href="maas-performance.html">
	    MAAS performance
	  </a>
	</li>
	<li>
	  <a href="power-management-reference.html">
	    Power management
	  </a>
	</li>
	<li>
	  <a href="storage-layouts-reference.html">
	    Storage layouts
	  </a>
	</li>
	<li>
	  <a href="maas-terraform-provider-reference.html">
	    Terraform provider
	  </a>
	</li>
      </ul>
    </div>
    <div class="container" style="float:right; width:65%; margin-top:40px; margin-right:30px">
  <h1>How to customise machines</h1><!-- "How to customise machines" -->
<p>MAAS provides the capability to customise machines.  This article will help you learn:</p>
<p><a href="#heading--how-to-customise-machine-storage"><h2 id="heading--how-to-customise-machine-storage">How to customise machine storage</h2></a></p>
<p>This section will show you:</p>
<ul style="margin-left:4px; list-style-type:disc;">
<li><a href="#heading--how-to-set-global-storage-layouts">How to set global storage layouts</a></li>
<li><a href="#heading--how-to-set-per-machine-storage-layouts">How to set per-machine storage layouts</a></li>
<li><a href="#heading--how-to-erase-disks">How to erase disks</a></li>
<li><a href="#heading--how-to-specify-conditional-erasure-types">How to specify conditional erasure types</a></li>
<li><a href="#heading--how-to-list-block-devices">How to list block devices</a></li>
<li><a href="#heading--how-to-read-a-block-device">How to read a block device</a></li>
<li><a href="#heading--how-to-create-a-block-device">How to create a block device</a></li>
<li><a href="#heading--how-to-update-a-block-device">How to update a block device</a></li>
<li><a href="#heading--how-to-delete-a-block-device">How to delete a block device</a></li>
<li><a href="#heading--format-block-device">How to format a block device</a></li>
<li><a href="#heading--how-to-unformat-a-block-device">How to unformat a block device</a></li>
<li><a href="#heading--how-to-mount-a-block-device">How to mount a block device</a></li>
<li><a href="#heading--how-to-unmount-a-block-device">How to unmount a block device</a></li>
<li><a href="#heading--how-to-set-a-block-device-as-a-boot-disk">How to set a block device as a boot disk</a></li>
<li><a href="#heading--how-to-list-partitions">How to list partitions</a></li>
<li><a href="#heading--how-to-create-a-partition">How to create a partition</a></li>
<li><a href="#heading--how-to-delete-a-partition">How to delete a partition</a></li>
<li><a href="#heading--how-to-format-a-partition">How to format a partition</a></li>
<li><a href="#heading--how-to-unformat-a-partition">How to unformat a partition</a></li>
<li><a href="#heading--how-to-mount-a-partition">How to mount a partition</a></li>
<li><a href="#heading--how-to-unmount-a-partition">How to unmount a partition</a></li>
<li><a href="#heading--how-to-list-vmfs-datastores">How to list VMFS datastores</a></li>
<li><a href="#heading--how-to-view-a-vmfs-datastore">How to view a VMFS datastore</a></li>
<li><a href="#heading--how-to-create-a-vmfs-datastore">How to create a VMFS datastore</a></li>
<li><a href="#heading--how-to-edit-a-vmfs-datastore">How to edit a VMFS datastore</a></li>
<li><a href="#heading--how-to-delete-a-vmfs-datastore">How to delete a VMFS datastore</a></li>
</ul>
<p>Note that layouts can be set globally and on a per-machine basis.  For additional information on storage layouts, see the <a href="storage-layouts-reference.html">Storage layouts reference</a> article.</p>
<p><a href="#heading--how-to-set-global-storage-layouts"><h3 id="heading--how-to-set-global-storage-layouts">How to set global storage layouts</h3></a></p>
<p>All machines will have a default layout applied when commissioned. To set the default storage layout for all machines:</p>
<pre><code>maas $PROFILE maas set-config name=default_storage_layout value=$LAYOUT_TYPE
</code></pre>
<p>For example, to set the default layout to Flat:</p>
<pre><code>maas $PROFILE maas set-config name=default_storage_layout value=flat
</code></pre>
<p>Important: The new default will only apply to newly-commissioned machines.</p>
<p><strong>NOTE:</strong> 
The new default will only apply to newly-commissioned machines.</p>
<p><a href="#heading--how-to-set-per-machine-storage-layouts"><h3 id="heading--how-to-set-per-machine-storage-layouts">How to set per-machine storage layouts</h3></a></p>
<p>An administrator can set a storage layout for a machine with a status of ‘Ready’ like this:</p>
<pre><code>maas $PROFILE machine set-storage-layout $SYSTEM_ID storage_layout=$LAYOUT_TYPE [$OPTIONS]
</code></pre>
<p>For example, to set an LVM layout where the logical volume has a size of 5 GB:</p>
<pre><code>maas $PROFILE machine set-storage-layout $SYSTEM_ID storage_layout=lvm lv_size=5368709120

</code></pre>
<p>You must specify all storage sizes in bytes.</p>
<p>This action will remove the configuration that may exist on any block device.</p>
<p><strong>NOTE:</strong> 
Only an administrator can modify storage at the block device level (providing the machine has a status of &lsquo;Ready&rsquo;).</p>
<p><a href="#heading--how-to-erase-disks"><h3 id="heading--how-to-erase-disks">How to erase disks</h3></a></p>
<p>When using the MAAS CLI, you can erase a disk when releasing an individual machine.  Note that this option is not available when releasing multiple machines, so you&rsquo;ll want to make sure you&rsquo;re using:</p>
<pre><code>maas $PROFILE machine release...
</code></pre>
<p>and not:</p>
<pre><code>maas $PROFILE machines release...
</code></pre>
<p>Note the difference in singular and plural &ldquo;machine/machines&rdquo; in the commands.  Releasing a machine requires that you have the <code>system_id</code> of the machine to be released, which you can obtain with a command like this one:</p>
<pre><code>maas admin machines read | jq -r '([&quot;HOSTNAME&quot;,&quot;SYSID&quot;,&quot;POWER&quot;,&quot;STATUS&quot;,
&quot;OWNER&quot;, &quot;TAGS&quot;, &quot;POOL&quot;, &quot;VLAN&quot;,&quot;FABRIC&quot;,&quot;SUBNET&quot;] | (., map(length*&quot;-&quot;))),
(.[] | [.hostname, .system_id, .power_state, .status_name, .owner // &quot;-&quot;, 
.tag_names[0] // &quot;-&quot;, .pool.name,
.boot_interface.vlan.name, .boot_interface.vlan.fabric,
.boot_interface.links[0].subnet.name]) | @tsv' | column -t
</code></pre>
<p><a href="https://discourse.maas.io/uploads/default/original/1X/a496ac76977909f3403160ca96a1bb7224e785f5.jpeg" target = "_blank"><img src="https://discourse.maas.io/uploads/default/original/1X/a496ac76977909f3403160ca96a1bb7224e785f5.jpeg">
</a></p>
<p>The basic form of the release command, when erasing disks on releasing, is:</p>
<pre><code>maas $PROFILE machine release $SYSTEM_ID comment=&quot;some comment&quot; erase=true [secure_erase=true ||/&amp;&amp; quick_erase=true]
</code></pre>
<p>Parameters <code>secure_erase</code> and <code>quick_erase</code> are both optional, although if you don&rsquo;t specify either of them, the entire disk will be overwritten with null bytes.  Note that this overwrite process is very slow.</p>
<p>Secure erasure uses the drive&rsquo;s secure erase feature, if it has one.  In some cases, this can be much faster than overwriting the entire drive.  Be aware, though, that some drives implement secure erasure as a complete drive overwrite, so this method may still be very slow.  Additionally, if you specify secure erasure and the drive doesn&rsquo;t have this feature, you&rsquo;ll get a complete overwrite anyway &ndash; again, possibly very slow.</p>
<p>Quick erasure wipes 2MB at the start and end of the drive to make recovery both inconvenient and unlikely to happen by accident.  Note, though, that quick erasure is not secure.</p>
<p><a href="#heading--how-to-specify-conditional-erasure-types"><h3 id="heading--how-to-specify-conditional-erasure-types">How to specify conditional erasure types</h3></a></p>
<p>If you specify both erasure types, like this:</p>
<pre><code>maas $PROFILE machine release $SYSTEM_ID comment=&quot;some comment&quot; erase=true secure_erase=true quick_erase=true
</code></pre>
<p>then MAAS will perform a secure erasure if the drive has that feature; if not, it will perform a quick erasure.  Of course, if you&rsquo;re concerned about completely erasing the drive, and you&rsquo;re not sure whether the disk has secure erase features, the best way to handle that is to specify nothing, and allow the full disk to be overwritten by null bytes:</p>
<pre><code>maas $PROFILE machine release $SYSTEM_ID comment=&quot;some comment&quot; erase=true
</code></pre>
<p><a href="#heading--how-to-list-block-devices"><h3 id="heading--how-to-list-block-devices">How to list block devices</h3></a></p>
<p>To view all block devices on a machine use the read operation. This list both physical and virtual block devices, as you can see in the output from the following command:</p>
<pre><code class="language-bash">maas admin block-devices read &lt;node-id&gt;
</code></pre>
<p>Output:</p>
<pre><code class="language-nohighlight">Success.
Machine-readable output follows:
[
    {
        &quot;id&quot;: 10,
        &quot;path&quot;: &quot;/dev/disk/by-dname/vda&quot;,
        &quot;serial&quot;: &quot;&quot;,
        &quot;block_size&quot;: 4096,
        &quot;available_size&quot;: 0,
        &quot;resource_uri&quot;: &quot;/MAAS/api/2.0/nodes/4y3h8a/blockdevices/10/&quot;,
        &quot;filesystem&quot;: null,
        &quot;id_path&quot;: &quot;/dev/vda&quot;,
        &quot;size&quot;: 5368709120,
        &quot;partition_table_type&quot;: &quot;MBR&quot;,
        &quot;model&quot;: &quot;&quot;,
        &quot;type&quot;: &quot;physical&quot;,
        &quot;uuid&quot;: null,
        &quot;used_size&quot;: 5365563392,
        &quot;used_for&quot;: &quot;MBR partitioned with 1 partition&quot;,
        &quot;partitions&quot;: [
            {
                &quot;bootable&quot;: false,
                &quot;id&quot;: 9,
                &quot;resource_uri&quot;:&quot;/MAAS/api/2.0/nodes/4y3h8a/blockdevices/10/partition/9&quot;,
                &quot;path&quot;: &quot;/dev/disk/by-dname/vda-part1&quot;,
                &quot;uuid&quot;: &quot;aae082cd-8be0-4a64-ab49-e998abd6ea43&quot;,
                &quot;used_for&quot;: &quot;LVM volume for vgroot&quot;,
                &quot;size&quot;: 5360320512,
                &quot;type&quot;: &quot;partition&quot;,
                &quot;filesystem&quot;: {
                    &quot;uuid&quot;: &quot;a56ebfa6-8ef4-48b5-b6bc-9f9d27065d24&quot;,
                    &quot;mount_options&quot;: null,
                    &quot;label&quot;: null,
                    &quot;fstype&quot;: &quot;lvm-pv&quot;,
                    &quot;mount_point&quot;: null
                }
            }
        ],
        &quot;tags&quot;: [
            &quot;rotary&quot;
        ],
        &quot;name&quot;: &quot;vda&quot;
    },
    {
        &quot;id&quot;: 11,
        &quot;path&quot;: &quot;/dev/disk/by-dname/lvroot&quot;,
        &quot;serial&quot;: null,
        &quot;block_size&quot;: 4096,
        &quot;available_size&quot;: 0,
        &quot;resource_uri&quot;: &quot;/MAAS/api/2.0/nodes/4y3h8a/blockdevices/11/&quot;,
        &quot;filesystem&quot;: {
            &quot;uuid&quot;: &quot;7181a0c0-9e16-4276-8a55-c77364d137ca&quot;,
            &quot;mount_options&quot;: null,
            &quot;label&quot;: &quot;root&quot;,
            &quot;fstype&quot;: &quot;ext4&quot;,
            &quot;mount_point&quot;: &quot;/&quot;
        },
        &quot;id_path&quot;: null,
        &quot;size&quot;: 3221225472,
        &quot;partition_table_type&quot;: null,
        &quot;model&quot;: null,
        &quot;type&quot;: &quot;virtual&quot;,
        &quot;uuid&quot;: &quot;fc8ba89e-9149-412c-bcea-e596eb7c0d14&quot;,
        &quot;used_size&quot;: 3221225472,
        &quot;used_for&quot;: &quot;ext4 formatted filesystem mounted at /&quot;,
        &quot;partitions&quot;: [],
        &quot;tags&quot;: [],
        &quot;name&quot;: &quot;vgroot-lvroot&quot;
    }
]
</code></pre>
<p><a href="#heading--how-to-read-a-block-device"><h3 id="heading--how-to-read-a-block-device">How to read a block device</h3></a></p>
<p>If you want to read just one block device instead of listing all block devices the read operation on the block device endpoint provides that information. To display the details on device &lsquo;11&rsquo; from the previous output, for example, we could enter:</p>
<pre><code class="language-bash">maas admin block-device read &lt;node-id&gt; 11
</code></pre>
<p>The above command generates the following output:</p>
<pre><code class="language-nohighlight">Success.
Machine-readable output follows:
{
    &quot;available_size&quot;: 0,
    &quot;path&quot;: &quot;/dev/disk/by-dname/vgroot-lvroot&quot;,
    &quot;name&quot;: &quot;vgroot-lvroot&quot;,
    &quot;used_for&quot;: &quot;ext4 formatted filesystem mounted at /&quot;,
    &quot;type&quot;: &quot;virtual&quot;,
    &quot;used_size&quot;: 3221225472,
    &quot;filesystem&quot;: {
        &quot;uuid&quot;: &quot;7181a0c0-9e16-4276-8a55-c77364d137ca&quot;,
        &quot;mount_point&quot;: &quot;/&quot;,
        &quot;mount_options&quot;: null,
        &quot;fstype&quot;: &quot;ext4&quot;,
        &quot;label&quot;: &quot;root&quot;
    },
    &quot;id_path&quot;: null,
    &quot;id&quot;: 11,
    &quot;partition_table_type&quot;: null,
    &quot;block_size&quot;: 4096,
    &quot;tags&quot;: [],
    &quot;resource_uri&quot;: &quot;/MAAS/api/2.0/nodes/4y3h8a/blockdevices/11/&quot;,
    &quot;uuid&quot;: &quot;fc8ba89e-9149-412c-bcea-e596eb7c0d14&quot;,
    &quot;serial&quot;: null,
    &quot;partitions&quot;: [],
    &quot;size&quot;: 3221225472,
    &quot;model&quot;: null
}
</code></pre>
<p>It is also possible to use the name of the block device, such as &lsquo;sda&rsquo; or &lsquo;vda&rsquo;, instead of its &lsquo;id&rsquo;:</p>
<pre><code class="language-bash">s admin block-device read &lt;node-id&gt; vda
</code></pre>
<p><strong>NOTE:</strong> 
MAAS allows the name of a block device to be changed. If the block device name has changed then the API call needs to use the new name.</p>
<pre><code>Using the ID is safer as it never changes.
</code></pre>
<p><a href="#heading--how-to-create-a-block-device"><h3 id="heading--how-to-create-a-block-device">How to create a block device</h3></a></p>
<p>MAAS gathers the required information itself on block devices when re- commissioning a machine. If this doesn&rsquo;t provide the required information, it is also possible - though not recommended - for an administrator to use the API to manually add a physical block device to a machine.</p>
<pre><code class="language-bash">maas admin block-devices create &lt;node-id&gt; name=vdb model=&quot;QEMU&quot; serial=&quot;QM00001&quot; size=21474836480 block_size=4096
</code></pre>
<p>Depending on your configuration, output should be similar to the following:</p>
<pre><code class="language-nohighlight">Success.
Machine-readable output follows:
{
    &quot;available_size&quot;: 21474836480,
    &quot;path&quot;: &quot;/dev/disk/by-dname/vdb&quot;,
    &quot;name&quot;: &quot;vdb&quot;,
    &quot;used_for&quot;: &quot;Unused&quot;,
    &quot;type&quot;: &quot;physical&quot;,
    &quot;used_size&quot;: 0,
    &quot;filesystem&quot;: null,
    &quot;id_path&quot;: &quot;&quot;,
    &quot;id&quot;: 12,
    &quot;partition_table_type&quot;: null,
    &quot;block_size&quot;: 4096,
    &quot;tags&quot;: [],
    &quot;resource_uri&quot;: &quot;/MAAS/api/2.0/nodes/4y3h8a/blockdevices/12/&quot;,
    &quot;uuid&quot;: null,
    &quot;serial&quot;: &quot;QM00001&quot;,
    &quot;partitions&quot;: [],
    &quot;size&quot;: 21474836480,
    &quot;model&quot;: &quot;QEMU&quot;
}
</code></pre>
<p><strong>NOTE:</strong> 
The serial number is what MAAS will use when a machine is deployed to find the specific block device. It&rsquo;s important that this be correct. In a rare chance that your block device does not provide a model or serial number you can provide an id_path. The id_path should be a path that is always the same, no matter the kernel version.</p>
<p><a href="#heading--how-to-update-a-block-device"><h3 id="heading--how-to-update-a-block-device">How to update a block device</h3></a></p>
<p>An administrator can also update the details held on a physical block device, such as its name, from the API:</p>
<pre><code class="language-bash">maas admin block-device update &lt;node-id&gt; 12 name=newroot
</code></pre>
<p>Output from this command will show that the &lsquo;name&rsquo; has changed:</p>
<pre><code class="language-nohighlight">Success.
Machine-readable output follows:
{
    &quot;block_size&quot;: 4096,
    &quot;size&quot;: 21474836480,
    &quot;filesystem&quot;: null,
    &quot;model&quot;: &quot;QEMU&quot;,
    &quot;name&quot;: &quot;newroot&quot;,
    &quot;partitions&quot;: [],
    &quot;tags&quot;: [],
    &quot;used_size&quot;: 0,
    &quot;path&quot;: &quot;/dev/disk/by-dname/newroot&quot;,
    &quot;id_path&quot;: &quot;&quot;,
    &quot;uuid&quot;: null,
    &quot;available_size&quot;: 21474836480,
    &quot;id&quot;: 12,
    &quot;used_for&quot;: &quot;Unused&quot;,
    &quot;type&quot;: &quot;physical&quot;,
    &quot;resource_uri&quot;: &quot;/MAAS/api/2.0/nodes/4y3h8a/blockdevices/12/&quot;,
    &quot;partition_table_type&quot;: null,
    &quot;serial&quot;: &quot;QM00001&quot;
}
</code></pre>
<p><a href="#heading--how-to-delete-a-block-device"><h3 id="heading--how-to-delete-a-block-device">How to delete a block device</h3></a></p>
<p>Physical and virtual block devices can be deleted by an administrator, while ordinary users can only delete virtual block devices:</p>
<pre><code class="language-bash">maas admin block-device delete &lt;node-id&gt; 12
</code></pre>
<p><a href="#heading--format-block-device"><h3 id="heading--format-block-device">How to format a block device</h3></a></p>
<p>An entire block device can be formatted by defining a filesystem with the &lsquo;format&rsquo; API call:</p>
<pre><code class="language-bash">maas admin block-device format &lt;node-id&gt; 11 fstype=ext4
</code></pre>
<p>Successful output from this command will look similar to this:</p>
<pre><code class="language-nohighlight">Success.
Machine-readable output follows:
{
    &quot;block_size&quot;: 4096,
    &quot;size&quot;: 3221225472,
    &quot;filesystem&quot;: {
        &quot;label&quot;: &quot;&quot;,
        &quot;fstype&quot;: &quot;ext4&quot;,
        &quot;mount_options&quot;: null,
        &quot;uuid&quot;: &quot;75e42f49-9a45-466c-8425-87a40e4f4148&quot;,
        &quot;mount_point&quot;: null
    },
    &quot;model&quot;: null,
    &quot;name&quot;: &quot;vgroot-lvroot&quot;,
    &quot;partitions&quot;: [],
    &quot;tags&quot;: [],
    &quot;used_size&quot;: 3221225472,
    &quot;path&quot;: &quot;/dev/disk/by-dname/vgroot-lvroot&quot;,
    &quot;id_path&quot;: null,
    &quot;uuid&quot;: &quot;fc8ba89e-9149-412c-bcea-e596eb7c0d14&quot;,
    &quot;available_size&quot;: 0,
    &quot;id&quot;: 11,
    &quot;used_for&quot;: &quot;Unmounted ext4 formatted filesystem&quot;,
    &quot;type&quot;: &quot;virtual&quot;,
    &quot;resource_uri&quot;: &quot;/MAAS/api/2.0/nodes/4y3h8a/blockdevices/11/&quot;,
    &quot;partition_table_type&quot;: null,
    &quot;serial&quot;: null
}
</code></pre>
<p><strong>NOTE:</strong> 
You cannot format a block device that contains partitions or is used to make another virtual block device.</p>
<p><a href="#heading--how-to-unformat-a-block-device"><h3 id="heading--how-to-unformat-a-block-device">How to unformat a block device</h3></a></p>
<p>You can remove the filesystem from a block device with the &lsquo;unformat&rsquo; API call:</p>
<pre><code class="language-bash">maas admin block-device unformat &lt;node-id&gt; 11
</code></pre>
<p>The output from this command should show the filesystem is now &lsquo;null&rsquo;:</p>
<pre><code class="language-nohighlight">Success.
Machine-readable output follows:
{
    &quot;available_size&quot;: 3221225472,
    &quot;path&quot;: &quot;/dev/disk/by-dname/vgroot-lvroot&quot;,
    &quot;name&quot;: &quot;vgroot-lvroot&quot;,
    &quot;used_for&quot;: &quot;Unused&quot;,
    &quot;type&quot;: &quot;virtual&quot;,
    &quot;used_size&quot;: 0,
    &quot;filesystem&quot;: null,
    &quot;id_path&quot;: null,
    &quot;id&quot;: 11,
    &quot;partition_table_type&quot;: null,
    &quot;block_size&quot;: 4096,
    &quot;tags&quot;: [],
    &quot;resource_uri&quot;: &quot;/MAAS/api/2.0/nodes/4y3h8a/blockdevices/11/&quot;,
    &quot;uuid&quot;: &quot;fc8ba89e-9149-412c-bcea-e596eb7c0d14&quot;,
    &quot;serial&quot;: null,
    &quot;partitions&quot;: [],
    &quot;size&quot;: 3221225472,
    &quot;model&quot;: null
}
</code></pre>
<p><a href="#heading--how-to-mount-a-block-device"><h3 id="heading--how-to-mount-a-block-device">How to mount a block device</h3></a></p>
<p>If a block device has a filesystem, you can use the &lsquo;maas&rsquo; command to mount a block devices at a given mount point:</p>
<pre><code class="language-bash">maas admin block-device mount &lt;node-id&gt; 11 mount_point=/srv
</code></pre>
<p>The mount point is included in the successful output from the command:</p>
<pre><code class="language-nohighlight">Success.
Machine-readable output follows:
{
    &quot;available_size&quot;: 0,
    &quot;path&quot;: &quot;/dev/disk/by-dname/vgroot-lvroot&quot;,
    &quot;name&quot;: &quot;vgroot-lvroot&quot;,
    &quot;used_for&quot;: &quot;ext4 formatted filesystem mounted at /srv&quot;,
    &quot;type&quot;: &quot;virtual&quot;,
    &quot;used_size&quot;: 3221225472,
    &quot;filesystem&quot;: {
        &quot;uuid&quot;: &quot;6f5965ad-49f7-42da-95ff-8000b739c39f&quot;,
        &quot;mount_point&quot;: &quot;/srv&quot;,
        &quot;mount_options&quot;: &quot;&quot;,
        &quot;fstype&quot;: &quot;ext4&quot;,
        &quot;label&quot;: &quot;&quot;
    },
    &quot;id_path&quot;: null,
    &quot;id&quot;: 11,
    &quot;partition_table_type&quot;: null,
    &quot;block_size&quot;: 4096,
    &quot;tags&quot;: [],
    &quot;resource_uri&quot;: &quot;/MAAS/api/2.0/nodes/4y3h8a/blockdevices/11/&quot;,
    &quot;uuid&quot;: &quot;fc8ba89e-9149-412c-bcea-e596eb7c0d14&quot;,
    &quot;serial&quot;: null,
    &quot;partitions&quot;: [],
    &quot;size&quot;: 3221225472,
    &quot;model&quot;: null
}
</code></pre>
<p><a href="#heading--how-to-unmount-a-block-device"><h3 id="heading--how-to-unmount-a-block-device">How to unmount a block device</h3></a></p>
<p>To remove the mount point from the block device, use the &lsquo;unmount&rsquo; call:</p>
<pre><code class="language-bash">maas admin block-device unmount &lt;node-id&gt; 11 mount_point=/srv
</code></pre>
<p>The previous command will include a nullified &lsquo;mount_point&rsquo; in its output:</p>
<pre><code class="language-nohighlight">Success.
Machine-readable output follows:
{
    &quot;available_size&quot;: 0,
    &quot;path&quot;: &quot;/dev/disk/by-dname/vgroot-lvroot&quot;,
    &quot;name&quot;: &quot;vgroot-lvroot&quot;,
    &quot;used_for&quot;: &quot;Unmounted ext4 formatted filesystem&quot;,
    &quot;type&quot;: &quot;virtual&quot;,
    &quot;used_size&quot;: 3221225472,
    &quot;filesystem&quot;: {
        &quot;uuid&quot;: &quot;6f5965ad-49f7-42da-95ff-8000b739c39f&quot;,
        &quot;mount_point&quot;: null,
        &quot;mount_options&quot;: null,
        &quot;fstype&quot;: &quot;ext4&quot;,
        &quot;label&quot;: &quot;&quot;
    },
    &quot;id_path&quot;: null,
    &quot;id&quot;: 11,
    &quot;partition_table_type&quot;: null,
    &quot;block_size&quot;: 4096,
    &quot;tags&quot;: [],
    &quot;resource_uri&quot;: &quot;/MAAS/api/2.0/nodes/4y3h8a/blockdevices/11/&quot;,
    &quot;uuid&quot;: &quot;fc8ba89e-9149-412c-bcea-e596eb7c0d14&quot;,
    &quot;serial&quot;: null,
    &quot;partitions&quot;: [],
    &quot;size&quot;: 3221225472,
    &quot;model&quot;: null
}
</code></pre>
<p><a href="#heading--how-to-set-a-block-device-as-a-boot-disk"><h3 id="heading--how-to-set-a-block-device-as-a-boot-disk">How to set a block device as a boot disk</h3></a></p>
<p>By default, MAAS picks the first added block device to the machine as the boot disk. In most cases this works as expected as the BIOS usually enumerates the boot disk as the first block device. There are cases where this fails and the boot disk needs to be set to another disk. This API allow setting which block device on a machine MAAS should use as the boot disk.:</p>
<pre><code class="language-bash">maas admin block-device set-boot-disk &lt;node-id&gt; 10
</code></pre>
<p><strong>NOTE:</strong> 
Only an administrator can set which block device should be used as the boot disk and only a physical block device can be set as as the boot disk. This operation should be done before a machine is allocated or the storage layout will be applied to the previous boot disk.</p>
<p><a href="#heading--how-to-list-partitions"><h3 id="heading--how-to-list-partitions">How to list partitions</h3></a></p>
<p>To view all the partitions on a block device, use the &lsquo;partitions read&rsquo; API call:</p>
<pre><code class="language-bash">maas admin partitions read &lt;node-id&gt; 10
</code></pre>
<pre><code class="language-nohighlight">Success.
Machine-readable output follows:
[
    {
        &quot;bootable&quot;: false,
        &quot;id&quot;: 9,
        &quot;resource_uri&quot;:
&quot;/MAAS/api/2.0/nodes/4y3h8a/blockdevices/10/partition/9&quot;,
        &quot;path&quot;: &quot;/dev/disk/by-dname/vda-part1&quot;,
        &quot;uuid&quot;: &quot;aae082cd-8be0-4a64-ab49-e998abd6ea43&quot;,
        &quot;used_for&quot;: &quot;LVM volume for vgroot&quot;,
        &quot;size&quot;: 5360320512,
        &quot;type&quot;: &quot;partition&quot;,
        &quot;filesystem&quot;: {
            &quot;uuid&quot;: &quot;a56ebfa6-8ef4-48b5-b6bc-9f9d27065d24&quot;,
            &quot;mount_options&quot;: null,
            &quot;label&quot;: null,
            &quot;fstype&quot;: &quot;lvm-pv&quot;,
            &quot;mount_point&quot;: null
        }
    }
]
</code></pre>
<p>To view the metadata for a specific partition on a block device, rather than all partitions, use the singular &lsquo;partition&rsquo; API call with an endpoint:</p>
<pre><code class="language-bash">maas admin partition read &lt;node-id&gt; 10 9
</code></pre>
<p><a href="#heading--how-to-create-a-partition"><h3 id="heading--how-to-create-a-partition">How to create a partition</h3></a></p>
<p>To create a new partition on a block device, use the &lsquo;create&rsquo; API call:</p>
<pre><code class="language-bash">maas admin partitions create &lt;node-id&gt; 10 size=5360320512
</code></pre>
<p>In addition to bytes, as shown above, the &lsquo;size&rsquo; of a partition can also be defined with a &lsquo;G&rsquo; for gigabytes or &lsquo;M&rsquo; for megabytes. The output from the previous command will look like this:</p>
<pre><code class="language-nohighlight">Success.
Machine-readable output follows:
{
    &quot;bootable&quot;: false,
    &quot;path&quot;: &quot;/dev/disk/by-dname/vda-part1&quot;,
    &quot;filesystem&quot;: null,
    &quot;used_for&quot;: &quot;Unused&quot;,
    &quot;type&quot;: &quot;partition&quot;,
    &quot;id&quot;: 10,
    &quot;size&quot;: 5360320512,
    &quot;resource_uri&quot;: &quot;/MAAS/api/2.0/nodes/4y3h8a/blockdevices/10/partition/10&quot;,
    &quot;uuid&quot;: &quot;3d32adbf-9943-4785-ab38-963758338c6c&quot;
}
</code></pre>
<p><a href="#heading--how-to-delete-a-partition"><h3 id="heading--how-to-delete-a-partition">How to delete a partition</h3></a></p>
<p>Partitions can be deleted from a block device with the &lsquo;delete&rsquo; API call. Make sure you double check the partition details as the partition is deleted immediately, with no further confirmation:</p>
<pre><code class="language-bash">maas admin partition delete &lt;node-id&gt; 10 9
</code></pre>
<p>Successful output from the &lsquo;delete&rsquo; command will look like this:</p>
<pre><code class="language-bash">Success.
Machine-readable output follows:
</code></pre>
<p><a href="#heading--how-to-format-a-partition"><h3 id="heading--how-to-format-a-partition">How to format a partition</h3></a></p>
<p>Partitions can be formatted in a similar way to block devices:</p>
<pre><code class="language-bash">maas admin partition format &lt;node-id&gt; 10 9 fstype=ext4
</code></pre>
<p>The output from the &lsquo;format&rsquo; command will be similar to the following:</p>
<pre><code class="language-nohighlight">Success.
Machine-readable output follows:
{
    &quot;id&quot;: 9,
    &quot;used_for&quot;: &quot;Unmounted ext4 formatted filesystem&quot;,
    &quot;resource_uri&quot;: &quot;/MAAS/api/2.0/nodes/4y3h8a/blockdevices/10/partition/9&quot;,
    &quot;path&quot;: &quot;/dev/disk/by-dname/vda-part1&quot;,
    &quot;uuid&quot;: &quot;aae082cd-8be0-4a64-ab49-e998abd6ea43&quot;,
    &quot;size&quot;: 5360320512,
    &quot;bootable&quot;: false,
    &quot;type&quot;: &quot;partition&quot;,
    &quot;filesystem&quot;: {
        &quot;uuid&quot;: &quot;ea593366-be43-4ea3-b2d5-0adf82085a62&quot;,
        &quot;mount_point&quot;: null,
        &quot;mount_options&quot;: null,
        &quot;fstype&quot;: &quot;ext4&quot;,
        &quot;label&quot;: &quot;&quot;
    }
}
</code></pre>
<p><strong>NOTE:</strong> 
You cannot format partitions that are used to make another virtual block device.</p>
<p><a href="#heading--how-to-unformat-a-partition"><h3 id="heading--how-to-unformat-a-partition">How to unformat a partition</h3></a></p>
<p>You can also remove the filesystem from a partition with the &lsquo;unformat&rsquo; API call:</p>
<pre><code class="language-bash">maas admin partition unformat &lt;node-id&gt; 10 10 fstype=ext4
</code></pre>
<pre><code class="language-nohighlight">Success.
Machine-readable output follows:
{
    &quot;bootable&quot;: false,
    &quot;path&quot;: &quot;/dev/disk/by-dname/vda-part1&quot;,
    &quot;filesystem&quot;: null,
    &quot;used_for&quot;: &quot;Unused&quot;,
    &quot;type&quot;: &quot;partition&quot;,
    &quot;id&quot;: 10,
    &quot;size&quot;: 5360320512,
    &quot;resource_uri&quot;: &quot;/MAAS/api/2.0/nodes/4y3h8a/blockdevices/10/partition/10&quot;,
    &quot;uuid&quot;: &quot;3d32adbf-9943-4785-ab38-963758338c6c&quot;
}
</code></pre>
<p><a href="#heading--how-to-mount-a-partition"><h3 id="heading--how-to-mount-a-partition">How to mount a partition</h3></a></p>
<p>A formatted partition can be mounted at a given mount point with the &lsquo;mount&rsquo; command.</p>
<pre><code class="language-bash">maas admin partition mount &lt;node-id&gt; 10 10 mount_point=/srv
</code></pre>
<p>The mount point and the filesystem is visible in the output from the command:</p>
<pre><code class="language-nohighlight">Success.
Machine-readable output follows:
{
    &quot;bootable&quot;: false,
    &quot;id&quot;: 10,
    &quot;resource_uri&quot;: &quot;/MAAS/api/2.0/nodes/4y3h8a/blockdevices/10/partition/10&quot;,
    &quot;path&quot;: &quot;/dev/disk/by-dname/vda-part1&quot;,
    &quot;uuid&quot;: &quot;3d32adbf-9943-4785-ab38-963758338c6c&quot;,
    &quot;used_for&quot;: &quot;ext4 formatted filesystem mounted at /srv&quot;,
    &quot;size&quot;: 5360320512,
    &quot;type&quot;: &quot;partition&quot;,
    &quot;filesystem&quot;: {
        &quot;uuid&quot;: &quot;1949a5fb-f7bd-4ada-8ba5-d06d3f5857a8&quot;,
        &quot;mount_options&quot;: &quot;&quot;,
        &quot;label&quot;: &quot;&quot;,
        &quot;fstype&quot;: &quot;ext4&quot;,
        &quot;mount_point&quot;: &quot;/srv&quot;
    }
}
</code></pre>
<p><a href="#heading--how-to-unmount-a-partition"><h3 id="heading--how-to-unmount-a-partition">How to unmount a partition</h3></a></p>
<p>A previous mounted partition can be unmounted with the &lsquo;unmount&rsquo; command:</p>
<pre><code class="language-bash">maas admin partition unmount 4y3h8a 10 10
</code></pre>
<p>After successfully running this command, the mount point will show as &lsquo;null&rsquo; in the output:</p>
<pre><code class="language-nohighlight">Success.
Machine-readable output follows:
{
    &quot;bootable&quot;: false,
    &quot;id&quot;: 10,
    &quot;resource_uri&quot;: &quot;/MAAS/api/2.0/nodes/4y3h8a/blockdevices/10/partition/10&quot;,
    &quot;path&quot;: &quot;/dev/disk/by-dname/vda-part1&quot;,
    &quot;uuid&quot;: &quot;3d32adbf-9943-4785-ab38-963758338c6c&quot;,
    &quot;used_for&quot;: &quot;Unmounted ext4 formatted filesystem&quot;,
    &quot;size&quot;: 5360320512,
    &quot;type&quot;: &quot;partition&quot;,
    &quot;filesystem&quot;: {
        &quot;uuid&quot;: &quot;1949a5fb-f7bd-4ada-8ba5-d06d3f5857a8&quot;,
        &quot;mount_options&quot;: null,
        &quot;label&quot;: &quot;&quot;,
        &quot;fstype&quot;: &quot;ext4&quot;,
        &quot;mount_point&quot;: null
    }
    &quot;type&quot;: &quot;partition&quot;,
    &quot;id&quot;: 3,
    &quot;size&quot;: 2000003072
}
</code></pre>
<p><a href="#heading--how-to-list-vmfs-datastores"><h3 id="heading--how-to-list-vmfs-datastores">How to list VMFS datastores</h3></a></p>
<p>To view all VMFS Datastores on a machine, use the &lsquo;vmfs-datastores read&rsquo; API call:</p>
<pre><code class="language-bash">maas $PROFILE vmfs-datastores read $SYSTEM_ID
</code></pre>
<pre><code class="language-nohighlight">[
    {
        &quot;human_size&quot;: &quot;45.8 GB&quot;,
        &quot;filesystem&quot;: {
            &quot;fstype&quot;: &quot;vmfs6&quot;,
            &quot;mount_point&quot;: &quot;/vmfs/volumes/datastore1&quot;
        },
        &quot;uuid&quot;: &quot;2779a745-1db3-4fd7-b06e-455b728fffd4&quot;,
        &quot;name&quot;: &quot;datastore1&quot;,
        &quot;system_id&quot;: &quot;4qxaga&quot;,
        &quot;devices&quot;: [
            {
                &quot;uuid&quot;: &quot;c55fe657-689d-4570-8492-683dd5fa1c40&quot;,
                &quot;size&quot;: 35026632704,
                &quot;bootable&quot;: false,
                &quot;tags&quot;: [],
                &quot;used_for&quot;: &quot;VMFS extent for datastore1&quot;,
                &quot;filesystem&quot;: {
                    &quot;fstype&quot;: &quot;vmfs6&quot;,
                    &quot;label&quot;: null,
                    &quot;uuid&quot;: &quot;55ac6422-68b5-440e-ba65-153032605b51&quot;,
                    &quot;mount_point&quot;: null,
                    &quot;mount_options&quot;: null
                },
                &quot;type&quot;: &quot;partition&quot;,
                &quot;device_id&quot;: 5,
                &quot;path&quot;: &quot;/dev/disk/by-dname/sda-part3&quot;,
                &quot;system_id&quot;: &quot;4qxaga&quot;,
                &quot;id&quot;: 71,
                &quot;resource_uri&quot;: &quot;/MAAS/api/2.0/nodes/4qxaga/blockdevices/5/partition/71&quot;
            },
            {
                &quot;uuid&quot;: &quot;5182e503-4ad4-446e-9660-fd5052b41cc5&quot;,
                &quot;size&quot;: 10729029632,
                &quot;bootable&quot;: false,
                &quot;tags&quot;: [],
                &quot;used_for&quot;: &quot;VMFS extent for datastore1&quot;,
                &quot;filesystem&quot;: {
                    &quot;fstype&quot;: &quot;vmfs6&quot;,
                    &quot;label&quot;: null,
                    &quot;uuid&quot;: &quot;a5949b18-d591-4627-be94-346d0fdaf816&quot;,
                    &quot;mount_point&quot;: null,
                    &quot;mount_options&quot;: null
                },
                &quot;type&quot;: &quot;partition&quot;,
                &quot;device_id&quot;: 6,
                &quot;path&quot;: &quot;/dev/disk/by-dname/sdb-part1&quot;,
                &quot;system_id&quot;: &quot;4qxaga&quot;,
                &quot;id&quot;: 77,
                &quot;resource_uri&quot;: &quot;/MAAS/api/2.0/nodes/4qxaga/blockdevices/6/partition/77&quot;
            }
        ],
        &quot;id&quot;: 17,
        &quot;size&quot;: 45755662336,
        &quot;resource_uri&quot;: &quot;/MAAS/api/2.0/nodes/4qxaga/vmfs-datastore/17/&quot;
    }
]
</code></pre>
<p><a href="#heading--how-to-view-a-vmfs-datastore"><h3 id="heading--how-to-view-a-vmfs-datastore">How to view a VMFS datastore</h3></a></p>
<p>To view a specific VMFS Datastores on a machine, use the &lsquo;vmfs-datastore read&rsquo; API call:</p>
<pre><code class="language-bash">maas $PROFILE vmfs-datastore read $SYSTEM_ID $VMFS_DATASTORE_ID
</code></pre>
<pre><code class="language-nohighlight">{
    &quot;uuid&quot;: &quot;fb6fedc2-f711-40de-ab83-77eddc3e19ac&quot;,
    &quot;name&quot;: &quot;datastore1&quot;,
    &quot;system_id&quot;: &quot;b66fn6&quot;,
    &quot;id&quot;: 18,
    &quot;filesystem&quot;: {
        &quot;fstype&quot;: &quot;vmfs6&quot;,
        &quot;mount_point&quot;: &quot;/vmfs/volumes/datastore1&quot;
    },
    &quot;human_size&quot;: &quot;2.8 GB&quot;,
    &quot;devices&quot;: [
        {
            &quot;uuid&quot;: &quot;b91df576-ba02-4acb-914f-03ba9a2865b7&quot;,
            &quot;size&quot;: 2814377984,
            &quot;bootable&quot;: false,
            &quot;tags&quot;: [],
            &quot;system_id&quot;: &quot;b66fn6&quot;,
            &quot;used_for&quot;: &quot;VMFS extent for datastore1&quot;,
            &quot;type&quot;: &quot;partition&quot;,
            &quot;id&quot;: 80,
            &quot;filesystem&quot;: {
                &quot;fstype&quot;: &quot;vmfs6&quot;,
                &quot;label&quot;: null,
                &quot;uuid&quot;: &quot;4a098d71-1e59-4b5f-932d-fc30a1c0dc96&quot;,
                &quot;mount_point&quot;: null,
                &quot;mount_options&quot;: null
            },
            &quot;device_id&quot;: 1,
            &quot;path&quot;: &quot;/dev/disk/by-dname/vda-part3&quot;,
            &quot;resource_uri&quot;: &quot;/MAAS/api/2.0/nodes/b66fn6/blockdevices/1/partition/80&quot;
        }
    ],
    &quot;size&quot;: 2814377984,
    &quot;resource_uri&quot;: &quot;/MAAS/api/2.0/nodes/b66fn6/vmfs-datastore/18/&quot;
}
</code></pre>
<p><a href="#heading--how-to-create-a-vmfs-datastore"><h3 id="heading--how-to-create-a-vmfs-datastore">How to create a VMFS datastore</h3></a></p>
<p>A VMware VMFS datastore is created on one or more <a href="#heading--about-block-devices">block devices</a> or <a href="#heading--about-partitions">partitions</a>.</p>
<p>To create a VMFS Datastores on a machine use the &lsquo;vmfs-datastores create&rsquo; API call:</p>
<pre><code class="language-bash">maas $PROFILE vmfs-datastores create $SYSTEM_ID name=$VMFS_NAME block_devices=$BLOCK_ID_1,$BLOCK_ID_2 partitions=$PARTITION_ID_1,$PARTITION_ID_2
</code></pre>
<pre><code class="language-nohighlight">{
    &quot;system_id&quot;: &quot;b66fn6&quot;,
    &quot;devices&quot;: [
        {
            &quot;uuid&quot;: &quot;b91df576-ba02-4acb-914f-03ba9a2865b7&quot;,
            &quot;size&quot;: 2814377984,
            &quot;bootable&quot;: false,
            &quot;tags&quot;: [],
            &quot;device_id&quot;: 1,
            &quot;system_id&quot;: &quot;b66fn6&quot;,
            &quot;type&quot;: &quot;partition&quot;,
            &quot;used_for&quot;: &quot;VMFS extent for datastore42&quot;,
            &quot;filesystem&quot;: {
                &quot;fstype&quot;: &quot;vmfs6&quot;,
                &quot;label&quot;: null,
                &quot;uuid&quot;: &quot;fc374367-a2fb-4e50-9377-768bfe9705b6&quot;,
                &quot;mount_point&quot;: null,
                &quot;mount_options&quot;: null
            },
            &quot;path&quot;: &quot;/dev/disk/by-dname/vda-part3&quot;,
            &quot;id&quot;: 80,
            &quot;resource_uri&quot;: &quot;/MAAS/api/2.0/nodes/b66fn6/blockdevices/1/partition/80&quot;
        }
    ],
    &quot;name&quot;: &quot;datastore42&quot;,
    &quot;filesystem&quot;: {
        &quot;fstype&quot;: &quot;vmfs6&quot;,
        &quot;mount_point&quot;: &quot;/vmfs/volumes/datastore42&quot;
    },
    &quot;id&quot;: 19,
    &quot;size&quot;: 2814377984,
    &quot;uuid&quot;: &quot;2711566c-2df4-4cc4-8c06-7392bb1f9532&quot;,
    &quot;human_size&quot;: &quot;2.8 GB&quot;,
    &quot;resource_uri&quot;: &quot;/MAAS/api/2.0/nodes/b66fn6/vmfs-datastore/19/&quot;
}
</code></pre>
<p><a href="#heading--how-to-edit-a-vmfs-datastore"><h2 id="heading--how-to-edit-a-vmfs-datastore">How to edit a VMFS datastore</h2></a></p>
<p>To edit an existing VMFS Datastores on a machine use the &lsquo;vmfs-datastore update&rsquo; API call:</p>
<pre><code class="language-bash">maas $PROFILE vmfs-datastore update $SYSTEM_ID $VMFS_ID name=$NEW_VMFS_NAME add_block_devices=$NEW_BLOCK_ID_1,$NEW_BLOCK_ID_2 add_partitions=$NEW_PARTITION_ID_1,$NEW_PARTITION_ID_2 remove_partitions=$EXISTING_PARTITION_ID1,$EXISTING_PARTITION_ID2
</code></pre>
<pre><code class="language-nohighlight">{
    &quot;uuid&quot;: &quot;2711566c-2df4-4cc4-8c06-7392bb1f9532&quot;,
    &quot;name&quot;: &quot;datastore42&quot;,
    &quot;system_id&quot;: &quot;b66fn6&quot;,
    &quot;id&quot;: 19,
    &quot;filesystem&quot;: {
        &quot;fstype&quot;: &quot;vmfs6&quot;,
        &quot;mount_point&quot;: &quot;/vmfs/volumes/datastore42&quot;
    },
    &quot;human_size&quot;: &quot;13.5 GB&quot;,
    &quot;devices&quot;: [
        {
            &quot;uuid&quot;: &quot;b91df576-ba02-4acb-914f-03ba9a2865b7&quot;,
            &quot;size&quot;: 2814377984,
            &quot;bootable&quot;: false,
            &quot;tags&quot;: [],
            &quot;system_id&quot;: &quot;b66fn6&quot;,
            &quot;used_for&quot;: &quot;VMFS extent for datastore42&quot;,
            &quot;type&quot;: &quot;partition&quot;,
            &quot;id&quot;: 80,
            &quot;filesystem&quot;: {
                &quot;fstype&quot;: &quot;vmfs6&quot;,
                &quot;label&quot;: null,
                &quot;uuid&quot;: &quot;fc374367-a2fb-4e50-9377-768bfe9705b6&quot;,
                &quot;mount_point&quot;: null,
                &quot;mount_options&quot;: null
            },
            &quot;device_id&quot;: 1,
            &quot;path&quot;: &quot;/dev/disk/by-dname/vda-part3&quot;,
            &quot;resource_uri&quot;: &quot;/MAAS/api/2.0/nodes/b66fn6/blockdevices/1/partition/80&quot;
        },
        {
            &quot;uuid&quot;: &quot;f21fe54e-b5b1-4562-ab6b-e699e99f002f&quot;,
            &quot;size&quot;: 10729029632,
            &quot;bootable&quot;: false,
            &quot;tags&quot;: [],
            &quot;system_id&quot;: &quot;b66fn6&quot;,
            &quot;used_for&quot;: &quot;VMFS extent for datastore42&quot;,
            &quot;type&quot;: &quot;partition&quot;,
            &quot;id&quot;: 86,
            &quot;filesystem&quot;: {
                &quot;fstype&quot;: &quot;vmfs6&quot;,
                &quot;label&quot;: null,
                &quot;uuid&quot;: &quot;f3d9b6a3-bab3-4677-becb-bf5a421bfcc2&quot;,
                &quot;mount_point&quot;: null,
                &quot;mount_options&quot;: null
            },
            &quot;device_id&quot;: 2,
            &quot;path&quot;: &quot;/dev/disk/by-dname/vdb-part1&quot;,
            &quot;resource_uri&quot;: &quot;/MAAS/api/2.0/nodes/b66fn6/blockdevices/2/partition/86&quot;
        }
    ],
    &quot;size&quot;: 13543407616,
    &quot;resource_uri&quot;: &quot;/MAAS/api/2.0/nodes/b66fn6/vmfs-datastore/19/&quot;
}
</code></pre>
<p><a href="#heading--how-to-delete-a-vmfs-datastore"><h3 id="heading--how-to-delete-a-vmfs-datastore">How to delete a VMFS datastore</h3  ></a></p>
<p>To delete a VMFS Datastores on a machine use the &lsquo;vmfs-datastore delete&rsquo; API call:</p>
<pre><code class="language-bash">maas $PROFILE vmfs-datastore delete $SYSTEM_ID $VMFS_ID
</code></pre>
<p><a href="#heading--how-to-pre-seed-with-curtin"><h2 id="heading--how-to-pre-seed-with-curtin">How to pre-seed with curtin</h2></a></p>
<p>You can customise the Curtin installation by either editing the existing <code>curtin_userdata</code> template or by adding a custom file as described above.  For a flowchart, showing where Curtin and pre-seeding fits into the deployment picture, see <a href="about-images.html#heading--how-images-deploy">How images get deployed</a>.</p>
<p>Curtin provides hooks to execute custom code before and after installation takes place. These hooks are named <code>early</code> and <code>late</code> respectively, and they can both be overridden to execute the Curtin configuration in the ephemeral environment. Additionally, the <code>late</code> hook can be used to execute a configuration for a machine being installed, a state known as in-target.</p>
<p>Curtin commands look like this:</p>
<pre><code>foo: ["command", "--command-arg", "command-arg-value"]
</code></pre>
<p>Each component of the given command makes up an item in an array. Note, however, that the following won&rsquo;t work:</p>
<pre><code>foo: ["sh", "-c", "/bin/echo", "foobar"]
</code></pre>
<p>This syntax won&rsquo;t work because the value of <code>sh</code>&lsquo;s <code>-c</code> argument is itself an entire command. The correct way to express this is:</p>
<pre><code>foo: ["sh", "-c", "/bin/echo foobar"]
</code></pre>
<p>The following is an example of an early command that will run before the installation takes place in the ephemeral environment. The command pings an external machine to signal that the installation is about to start:</p>
<pre><code class="language-bash">early_commands:
  signal: [&quot;wget&quot;, &quot;--no-proxy&quot;, &quot;http://example.com/&quot;, &quot;--post-data&quot;, &quot;system_id=&amp;signal=starting_install&quot;, &quot;-O&quot;, &quot;/dev/null&quot;]
</code></pre>
<p>The following is an example of two late commands that run after installation is complete. Both run in-target, on the machine being installed.</p>
<p>The first command adds a PPA to the machine. The second command creates a file containing the machine’s system ID:</p>
<pre><code class="language-bash">late_commands:
  add_repo: [&quot;curtin&quot;, &quot;in-target&quot;, &quot;--&quot;, &quot;add-apt-repository&quot;, &quot;-y&quot;, &quot;ppa:my/ppa&quot;]
  custom: [&quot;curtin&quot;, &quot;in-target&quot;, &quot;--&quot;, &quot;sh&quot;, &quot;-c&quot;, &quot;/bin/echo -en 'Installed ' &gt; /tmp/maas_system_id&quot;]
</code></pre>
<p><a href="#heading--cloud-init"><h2 id="heading--cloud-init">How to pre-seed with cloud-init</h2></a></p>
<p>For a flowchart, showing where cloud-init fits into the deployment picture, see <a href="about-images.html#heading--how-images-deploy">How images get deployed</a>.</p>
<p>Using cloud-init to customise a machine after deployment is relatively easy. After you&rsquo;re logged in, use the following command to deploy a machine with a custom script you&rsquo;ve written:</p>
<pre><code>maas $PROFILE machine deploy $SYSTEM_ID user_data=&lt;base-64-encoded-script&gt;
</code></pre>
<p>The three replaceable parameters shown above decode to:</p>
<ol>
<li><code>$PROFILE</code>: Your MAAS login. E.g. <code>admin</code></li>
<li><code>$SYSTEM_ID</code>: The machine&rsquo;s system ID (see example below)</li>
<li><code>&lt;base-64-encoded-script&gt;</code>: A base-64 encoded copy of your customisation script. See below for an example.</li>
</ol>
<p>E.g.:</p>
<p>Suppose you would like to import an SSH key immediately after your machine deployment. First, you want to find the machine&rsquo;s <code>system_id</code>, which you can do with this short, command-line <code>jq</code> script:</p>
<pre><code>maas admin machines read | jq -r '([&quot;HOSTNAME&quot;,&quot;SYSID&quot;] | (., map(length*&quot;-&quot;))),
(.[] | [.hostname, .system_id]) | @tsv' | column -t
</code></pre>
<p>You might then use this script, called <code>import_key.sh</code>, to retrieve the needed key:</p>
<pre><code class="language-bash">#!/bin/bash
(
echo === $date ===
ssh-import-id foobar_user
) | tee /ssh-key-import.log
</code></pre>
<p>This script echos the date in addition to the output of the <code>ssh-import-key</code> command. It also adds that output to a file, <code>/ssh-key-import.log</code>.</p>
<p>Base-64 encoding is required because the MAAS command-line interacts with the MAAS API, and base-64 encoding allows MAAS to send the script inside a POST HTTP command.</p>
<p>Use the <code>base64</code> command to output a base-64 encoded version of your script:</p>
<pre><code>base64 -w0 ./import_key.sh
</code></pre>
<p>Putting it together:</p>
<pre><code>maas $PROFILE machine deploy $SYSTEM_ID user_data=$(base64 -w0 ./import_key.sh)
</code></pre>
<p>After MAAS deploys the machine, you&rsquo;ll find <code>/ssh-key-import.log</code> on the machine you deployed.</p>
<p><a href="#heading--how-to-choose-ubuntu-kernels"><h2 id="heading--how-to-choose-ubuntu-kernels">How to choose Ubuntu kernels</h2></a></p>
<p>This section will show you:</p>
<ul style="margin-left:4px; list-style-type:disc;">
<li><a href="#heading--set-a-default-minimum-kernel-for-enlistment-and-commissioning">How to set a default minimum kernel for enlistment and commissioning</a></li>
<li><a href="#heading--set-a-minimum-deploy-kernel-for-a-machine">How to set a minimum deployment kernel for a machine</a></li>
<li><a href="#heading--set-a-specific-kernel-during-machine-deployment">How to set a specific kernel during machine deployment</a></li>
</ul>
<p><a href="#heading--set-a-default-minimum-kernel-for-enlistment-and-commissioning"><h3 id="heading--set-a-default-minimum-kernel-for-enlistment-and-commissioning">How to set a default minimum kernel for enlistment and commissioning</h3></a></p>
<p>To set a default minimum kernel for all new and commissioned machines:</p>
<pre><code class="language-bash">maas $PROFILE maas set-config name=default_min_hwe_kernel value=$KERNEL
</code></pre>
<p>For example, to set it to the 16.04 GA kernel:</p>
<pre><code class="language-bash">maas $PROFILE maas set-config name=default_min_hwe_kernel value=ga-16.04
</code></pre>
<p><strong>NOTE:</strong> 
The command option <code>default_min_hwe_kernel</code> appears to apply to only HWE kernels but this is not the case.</p>
<p><a href="#heading--set-a-minimum-deploy-kernel-for-a-machine"><h3 id="heading--set-a-minimum-deploy-kernel-for-a-machine">How to set a minimum deployment kernel for a machine</h3></a></p>
<p>To set the minimum deploy kernel on a per-machine basis:</p>
<pre><code class="language-bash">maas $PROFILE machine update $SYSTEM_ID min_hwe_kernel=$HWE_KERNEL
</code></pre>
<p>For example, to set it to the HWE 16.04 kernel:</p>
<pre><code class="language-bash">maas $PROFILE machine update $SYSTEM_ID min_hwe_kernel=hwe-16.04
</code></pre>
<p><strong>NOTE:</strong> 
The command option <code>default_min_hwe_kernel</code> appears to apply to only HWE kernels but this is not the case.</p>
<p><a href="#heading--set-a-specific-kernel-during-machine-deployment"><h3 id="heading--set-a-specific-kernel-during-machine-deployment">How to set a specific kernel during machine deployment</h3></a></p>
<p>To set a specific kernel during the deployment of a machine:</p>
<pre><code class="language-bash">maas $PROFILE machine deploy $SYSTEM_ID distro_series=$SERIES hwe_kernel=$KERNEL
</code></pre>
<p>The operation will fail if the kernel specified by <code>hwe_kernel</code> is older than the kernel (possibly) given by <code>default_min_hwe_kernel</code>. Similarly, it will not work if the kernel is not available for the given distro series (such as &lsquo;hwe-16.10&rsquo; for &lsquo;xenial&rsquo;).</p>
<p>For example, to deploy a Xenial node with the HWE 16.04 edge kernel:</p>
<pre><code class="language-bash">maas $PROFILE machine deploy $SYSTEM_ID distro_series=xenial hwe_kernel=hwe-16.04-edge
</code></pre>
<p><strong>NOTE:</strong> 
The command option <code>hwe_kernel</code> appears to apply to only HWE kernels but this is not the case.</p>
<p><a href="#heading--how-to-set-global-kernel-boot-options"><h2 id="heading--how-to-set-global-kernel-boot-options">How to set global kernel boot options</h2></a></p>
<p>You can set kernel boot options and apply them to all machines with the CLI command:</p>
<pre><code class="language-bash">maas $PROFILE maas set-config name=kernel_opts value='$KERNEL_OPTIONS'
</code></pre>
<p><a href="#heading--create-tags-with-built-in-kernel-options"><h2 id="heading--create-tags-with-built-in-kernel-options">How to create tags with built-in kernel options</h2></a></p>
<p>You can create tags with embedded kernel boot options.  When you apply such tags to a machine, those kernel boot options will be applied to that machine on the next deployment.</p>
<p>To create a tag with embedded kernel boot options, use the following command:</p>
<pre><code class="language-nohighlight">maas $PROFILE tags create name='$TAG_NAME' \
    comment='$TAG_COMMENT' kernel_opts='$KERNEL_OPTIONS'
</code></pre>
<p>For example:</p>
<pre><code class="language-nohighlight">maas admin tags create name='nomodeset_tag' \
    comment='nomodeset_kernel_option' kernel_opts='nomodeset vga'
</code></pre>
<p>This command yields the following results:</p>
<pre><code class="language-nohighlight">Success.
Machine-readable output follows:
{
    &quot;name&quot;: &quot;nomodeset_tag&quot;,
    &quot;definition&quot;: &quot;&quot;,
    &quot;comment&quot;: &quot;nomodeset_kernel_option&quot;,
    &quot;kernel_opts&quot;: &quot;nomodeset vga&quot;,
    &quot;resource_uri&quot;: &quot;/MAAS/api/2.0/tags/nomodeset_tag/&quot;
}
</code></pre>
<p>You can check your work with a modified form of the listing command:</p>
<pre><code class="language-nohighlight">maas admin tags read | jq -r \
'([&quot;tag_name&quot;,&quot;tag_comment&quot;,&quot;kernel_options&quot;]
|(.,map(length*&quot;-&quot;))),(.[]|[.name,.comment,.kernel_opts]) 
| @tsv' | column -t
</code></pre>
<p>This should give you results something like this:</p>
<pre><code class="language-nohighlight">tag_name             tag_comment                  kernel_options                     
--------             -----------                  --------------                     
virtual                                                                              
new_tag              a-new-tag-for-test-purposes                                     
pod-console-logging  console=tty1                 console=ttyS0                      
nomodeset_tag        nomodeset_kernel_option      nomodeset       vga
</code></pre>
<p><a href="#heading--how-to-use-resource-pools"><h2 id="heading--how-to-use-resource-pools">How to use resource pools</h2></a></p>
<p>This section will explain:</p>
<ul style="margin-left:4px; list-style-type:disc;">
<li><a href="#heading--creating-a-resource-pool">How to create a resource pool</a></li>
<li><a href="#heading--list-available-resource-pools">How to list available resource pools</a></li>
<li><a href="#heading--list-a-single-resource-pool">How to list a single resource pool</a></li>
<li><a href="#heading--update-a-resource-pool">How to update a resource pool</a></li>
<li><a href="#heading--delete-a-resource-pool">How to delete a resource pool</a></li>
<li><a href="#heading--add-a-machine-to-a-resource-pool">How to add a machine to a resource pool</a></li>
</ul>
<p><a href="#heading--creating-a-resource-pool"><h3 id="heading--creating-a-resource-pool">How to create a resource pool</h3></a></p>
<p>Here&rsquo;s an example that demonstrates how to create a new resource pool named <code>myresource</code>.</p>
<pre><code class="language-bash">maas $PROFILE resource-pools create name=myresource description=&quot;A new resource pool.&quot;
</code></pre>
<p><strong>NOTE:</strong> 
The <code>description</code> field is optional.</p>
<p><a href="#heading--list-available-resource-pools"><h3 id="heading--list-available-resource-pools">How to list available resource pools</h3></a></p>
<pre><code class="language-bash">maas $PROFILE resource-pools read
</code></pre>
<p><a href="#heading--list-a-single-resource-pool"><h3 id="heading--list-a-single-resource-pool">How to list a single resource pool</h3></a></p>
<pre><code class="language-bash">maas $PROFILE resource-pool read $RESOURCE_POOL_ID
</code></pre>
<p><a href="#heading--update-a-resource-pool"><h3 id="heading--update-a-resource-pool">How to update a resource pool</h3></a></p>
<pre><code class="language-bash">maas $PROFILE resource-pool update $RESOURCE_POOL_ID name=newname description=&quot;A new description.&quot;
</code></pre>
<p><strong>NOTE:</strong> 
The <code>name</code> and <code>description</code> fields are optional.</p>
<p><a href="#heading--delete-a-resource-pool"><h3 id="heading--delete-a-resource-pool">How to delete a resource pool</h3></a></p>
<pre><code class="language-bash">maas $PROFILE resource-pool delete $RESOURCE_POOL_ID
</code></pre>
<p><a href="#heading--add-a-machine-to-a-resource-pool"><h3 id="heading--add-a-machine-to-a-resource-pool">How to add a machine to a resource pool</h3></a></p>
<pre><code class="language-bash">maas $PROFILE machine update $SYSTEM_ID pool=$POOL_NAME
</code></pre>
    </div>
  </body>
</html>