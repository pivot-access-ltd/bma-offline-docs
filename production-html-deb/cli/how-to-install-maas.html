<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" type="text/css" href="css/stylesheet.css" />
    <style>
      #selector a:link{color:black;}
      #selector a:visited{color:black;}
      #selector a:active{color:black;}
      #selector a:hover{color:blue;}
      #sidebar a:link{color:black;}
      #sidebar a:visited{color:black;}
      #sidebar a:active{color:black;}
      #sidebar a:hover{color:blue;}
      ul {margin-left:0;list-style-type:none;}
      li {margin: 4px 0;}
    </style>
  </head>
  <body>
    <div id="selector" style="top:0; position:fixed; float:right; background-color:#d9d9d9; width:100%;border-bottom:1px solid black;">
      &nbsp;&nbsp;<strong>Offline docs</strong>
      <a href="https://maas.io/docs">(switch to live docs)</a>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
	<a href="../ui/how-to-install-maas.html">
	  UI-only
	</a>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      <span style="background-color:white;border-top:1px solid black; border-left:1px solid black; border-right:1px solid black; border-bottom:5px solid white;">
	  &nbsp;CLI-only&nbsp;
      </span>
    </div>
    <div id="sidebar" style="float:left; width:25%;margin-top:40px; margin-left:20px">
      <strong>
	<a href="maas-documentation.html">
	  Home
	</a>
      </strong>
      <p/>
      <strong>
	  Tutorials
      </strong>
      <ul>
	<li>
	  <a href="get-started-with-maas.html">
	    Get started with MAAS
	  </a>
	</li>
	<li>
	  <a href="maas-cli-tutorial.html">
	    Try out the MAAS CLI
	  </a>
	</li>
	<li>
	  <a href="create-a-custom-image.html">
	    Create a custom image
	  </a>
	</li>
	<li>
	  <a href="using-jq-with-the-maas-cli.html">
	    Using jq with the MAAS CLI
	  </a>
	</li>
      </ul>
      <strong>
	  How to get MAAS running
      </strong>
      <ul>
	<li>
	  <a href="how-to-install-maas.html">
	    Install MAAS
	  </a>
	</li>
	<li>
	  <a href="how-to-troubleshoot-maas.html">
	    Troubleshooting
	  </a>
	</li>
      </ul>
      <strong>
	  How to configure networking
      </strong>
      <ul>
	<li>
	  <a href="how-to-manage-networks.html">
	    Manage networks
	  </a>
	</li>
	<li>
	  <a href="how-to-manage-ip-addresses.html">
	    Manage IP addresses
	  </a>
	</li>
	<li>
	  <a href="how-to-enable-tls-encryption.html">
	    Enable TLS
	  </a>
	</li>
	<li>
	  <a href="how-to-manage-availability-zones.html">
	    Manage zones
	  </a>
	</li>
      </ul>
      <strong>
	  How to choose images
      </strong>
      <ul>
	<li>
	  <a href="how-to-import-images.html">
	    Import images
	  </a>
	</li>
	<li>
	  <a href="how-to-custom-images.html">
	    Create custom images
	  </a>
	</li>
	<li>
	  <a href="how-to-mirror-images-locally.html">
	    Mirror images locally
	  </a>
	</li>
	<li>
	  <a href="how-to-manage-vmware-images.html">
	    Manage VMWare images
	  </a>
	</li>
      </ul>
      <strong>
	  How to deploy MAAS
      </strong>
      <ul>
	<li>
	  <a href="how-to-manage-controllers.html">
	    Manage controllers
	  </a>
	</li>
	<li>
	  <a href="how-to-manage-machines.html">
	    Manage machines
	  </a>
	</li>
	<li>
	  <a href="how-to-deploy-machines.html">
	    Commission and deploy machines
	  </a>
	</li>
	<li>
	  <a href="how-to-customise-machines.html">
	    Customise machines
	  </a>
	</li>
	<li>
	  <a href="how-to-manage-vm-hosts.html">
	    Manage VM hosts
	  </a>
	</li>
	<li>
	  <a href="how-to-manage-vms.html">
	    Manage VMs
	  </a>
	</li>
	<li>
	  <a href="how-to-use-lxd.html">
	    Use LXD
	  </a>
	</li>
      </ul>
      <strong>
	  How to use tags
      </strong>
      <ul>
	<li>
	  <a href="how-to-work-with-tags.html">
	    Work with tags
	  </a>
	</li>
	<li>
	  <a href="how-to-work-with-annotations.html">
	    Work with annotations
	  </a>
	</li>
	<li>
	  <a href="how-to-use-machine-tags.html">
	    Use machine tags
	  </a>
	</li>
	<li>
	  <a href="how-to-use-controller-tags.html">
	    Use controller tags
	  </a>
	</li>
	<li>
	  <a href="how-to-use-storage-tags.html">
	    Use storage tags
	  </a>
	</li>
	<li>
	  <a href="how-to-use-network-tags.html">
	    Use network tags
	  </a>
	</li>
      </ul>
      <strong>
	  How to operate MAAS
      </strong>
	<ul>
	<li>
	  <a href="how-to-enable-high-availability.html">
	    Enable HA
	  </a>
	</li>
	  <li>
	    <a href="how-to-set-up-maas-metrics.html">
	      Set up MAAS metrics
	    </a>
	  </li>
	  <li>
	    <a href="how-to-work-with-audit-event-logs.html">
	      Work with audit event logs
	    </a>
	  </li>
	<li>
	  <a href="how-to-use-maas-in-an-air-gapped-environment.html">
	    Use air-gapped MAAS
	  </a>
	</li>
	  <li>
	  <a href="how-to-back-up-maas.html">
	    Back up MAAS
	  </a>
	</li>
	<li>
	  <a href="how-to-secure-maas.html">
	    Secure MAAS
	  </a>
	</li>
	<li>
	  <a href="how-to-manage-user-accounts.html">
	    Manage users
	  </a>
	</li>
	<li>
	  <a href="how-to-search-maas.html">
	    Search MAAS
	  </a>
	</li>
	<li>
	  <a href="how-to-upgrade-maas.html">
	    Upgrade older versions
	  </a>
	</li>
      </ul>
      <strong>
	  Reference
      </strong>
      <ul>
	<li>
	  <a href="what-is-new-with-maas.html">
	    Release notes
	  </a>
	</li>
	<li>
	  <a href="power-management-reference.html">
	    Power management
	  </a>
	</li>
	<li>
	  <a href="commissioning-scripts-reference.html">
	    Commissioning scripts
	  </a>
	</li>
	<li>
	  <a href="hardware-test-scripts-reference.html">
	    Hardware test scripts
	  </a>
	</li>
	<li>
	  <a href="maas-logging-reference.html">
	    Log files
	  </a>
	</li>
	<li>
	  <a href="audit-event-log-reference.html">
	    Audit event log reference
	  </a>
	</li>
	<li>
	  <a href="api.html">
	    API documentation
	  </a>
	</li>
	<li>
	  <a href="python-api-client-reference.html">
	    API client
	  </a>
	</li>
	<li>
	  <a href="api-authentication-reference.html">
	    API authentication
	  </a>
	</li>
	<li>
	  <a href="maas-concepts-and-terms-reference.html">
	    Concepts & terms
	  </a>
	</li>
	<li>
	  <a href="how-to-get-help.html">
	    Getting help
	  </a>
	</li>
      </ul>
      <strong>
	  Explanations
      </strong>
      <ul>
	<li>
	  <a href="about-maas.html">
	    MAAS
	  </a>
	</li>
	<li>
	  <a href="about-tcp-ip-networks.html">
	    TCP/IP networks
	  </a>
	</li>
	<li>
	  <a href="about-cloud-networks.html">
	    Cloud networks
	  </a>
	</li>
	<li>
	  <a href="about-dhcp.html">
	    DHCP
	  </a>
	</li>
	<li>
	  <a href="about-networking.html">
	    MAAS networking
	  </a>
	</li>
	<li>
	  <a href="about-images.html">
	    Images
	  </a>
	</li>
	<li>
	  <a href="about-creating-custom-images.html">
	    Custom images
	  </a>
	</li>
	<li>
	  <a href="about-controllers.html">
	    Controllers
	  </a>
	</li>
	<li>
	  <a href="about-machines.html">
	    Machines
	  </a>
	</li>
	<li>
	  <a href="about-customising-machines.html">
	    Customising machines
	  </a>
	</li>
	<li>
	  <a href="about-vm-hosting.html">
	    VM hosting
	  </a>
	</li>
      </ul>
    </div>
    <div class="container" style="float:right; width:65%; margin-top:40px; margin-right:30px">
  <h1>How to install MAAS</h1><blockquote>
<!-- "How to install MAAS" -->
</blockquote>
<p>MAAS is relatively easy to install and configure using Debian packages.</p>
<p><a href="#heading--maas-init-modes"><h3 id="heading--maas-init-modes">MAAS initialisation modes reference</h3></a></p>
<p>MAAS supports the following modes, which dictate what services will run on the local system:</p>
<table>
<thead>
<tr>
<th align="left">Mode</th>
<th align="center">Region</th>
<th align="center">Rack</th>
<th align="center">Database</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>region</code></td>
<td align="center">X</td>
<td align="center"></td>
<td align="center"></td>
<td align="left">Region API server only</td>
</tr>
<tr>
<td align="left"><code>rack</code></td>
<td align="center"></td>
<td align="center">X</td>
<td align="center"></td>
<td align="left">Rack controller only</td>
</tr>
<tr>
<td align="left"><code>region+rack</code></td>
<td align="center">X</td>
<td align="center">X</td>
<td align="center"></td>
<td align="left">Region API server and rack controller</td>
</tr>
<tr>
<td align="left"><code>none</code></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="left">Reinitialises MAAS and stops services</td>
</tr>
</tbody>
</table>
<p><a href="#heading--ssh-keys"><h3 id="heading--ssh-keys">About SSH keys</h3></a></p>
<p>MAAS uses your Launchpad or Github SSH keys to access machines that have been deployed.  Normally, you enter this key during the initialisation of MAAS.  If you don&rsquo;t have a key associated with either of these services, you will have an opportunity to paste your public key into the MAAS SSH key list, after you&rsquo;ve started MAAS for the first time as part of the welcome screens.</p>
<p><a href="#heading--maas-url"><h3 id="heading--maas-url">About the MAAS URL</h3></a></p>
<p>All run modes (except <code>none</code>) prompt for a MAAS URL, interpreted differently depending on the mode:</p>
<ul style="margin-left:4px; list-style-type:disc;">
<li><code>region</code>: Used to create a new region controller.</li>
<li><code>rack</code>: Used to locate the region controller.</li>
</ul>
<p><a href="#heading--shared-secret"><h3 id="heading--shared-secret">About the shared secret</h3></a></p>
<p>The &lsquo;rack&rsquo; and &lsquo;region+rack&rsquo; modes will additionally ask for a shared secret that will allow the new rack controller to register with the region controller.</p>
<p><a href="#heading--how-to-install-maas-main"><h2 id="heading--how-to-install-maas-main">How to install MAAS</h2></a></p>
<p>This article will show you:</p>
<ul style="margin-left:4px; list-style-type:disc;">
<li><a href="#heading--check-system-requirements-for-maas">How to check system requirements for MAAS</a></li>
<li><a href="#heading--upgrade-from-3-1-to-3-2">How to ugprade from MAAS 3.1 to MAAS 3.2</a></li>
<li><a href="#heading--upgrade-from-2-8-to-3-2">How to upgrade from MAAS 2.8 or lower to MAAS 3.2</a></li>
<li><a href="#heading--fresh-install-3-2-packages">How to do a fresh install of MAAS 3.2 from packages</a></li>
<li><a href="#heading--create-a-maas-user">How to create a MAAS user</a></li>
<li><a href="#heading--service-status">How to check the status of MAAS services</a></li>
<li><a href="#heading--reinitialising-maas">How to re-initialise MAAS</a></li>
<li><a href="#heading--additional-init-options">How to list additional MAAS initialisation options</a></li>
<li><a href="#heading--configure-maas">How to configure MAAS</a></li>
</ul>
<p><a href="#heading--check-system-requirements-for-maas"><h2 id="heading--check-system-requirements-for-maas">How to check system requirements for MAAS</h2></a></p>
<p>Before installing MAAS for the first time, you should make sure that the target system meets the minimum requirements for the machines that run MAAS, which vary widely depending on local implementation and usage.  Below, you will find resource estimates based on MAAS components and operating system (Ubuntu Server). We consider both a test configuration (for proof of concept) and a production environment.</p>
<p><a href="#heading--test-environment"><h2 id="heading--test-environment">Requirements for a test environment</h2></a></p>
<p>Here is a proof-of-concept scenario, with all MAAS components installed on a single host. This scenario assumes two complete sets of images (latest two Ubuntu LTS releases) for a single architecture (amd64).</p>
<table>
<thead>
<tr>
<th align="left"></th>
<th align="right">Memory (MB)</th>
<th align="right">CPU (GHz)</th>
<th align="right">Disk (GB)</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><a href="maas-concepts-and-terms-reference.html#heading--controllers">Region controller</a> (minus PostgreSQL)</td>
<td align="right">512</td>
<td align="right">0.5</td>
<td align="right">5</td>
</tr>
<tr>
<td align="left">PostgreSQL</td>
<td align="right">512</td>
<td align="right">0.5</td>
<td align="right">5</td>
</tr>
<tr>
<td align="left"><a href="maas-concepts-and-terms-reference.html#heading--controllers&quot;">Rack controller</a></td>
<td align="right">512</td>
<td align="right">0.5</td>
<td align="right">5</td>
</tr>
<tr>
<td align="left">Ubuntu Server (including logs)</td>
<td align="right">512</td>
<td align="right">0.5</td>
<td align="right">5</td>
</tr>
</tbody>
</table>
<p>Based on this table, the approximate requirements for this scenario are 2 GB memory, 2 GHz CPU, and 20 GB of disk space.</p>
<p><a href="#heading--production-environment"><h2 id="heading--production-environment">Requirements for a production environment</h2></a></p>
<p>Here is a production scenario designed to handle a high number of sustained client connections. This scenario implements both high availability (region and rack) and load balancing (region). MAAS reserves extra space for images (database and rack controller), while some images, such as those for Microsoft Windows, may require a lot more &ndash; so plan accordingly.</p>
<table>
<thead>
<tr>
<th align="left"></th>
<th align="right">Memory (MB)</th>
<th align="right">CPU (GHz)</th>
<th align="right">Disk (GB)</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><a href="maas-concepts-and-terms-reference.html#heading--controllers">Region controller</a> (minus PostgreSQL)</td>
<td align="right">2048</td>
<td align="right">2.0</td>
<td align="right">5</td>
</tr>
<tr>
<td align="left">PostgreSQL</td>
<td align="right">2048</td>
<td align="right">2.0</td>
<td align="right">20</td>
</tr>
<tr>
<td align="left"><a href="maas-concepts-and-terms-reference.html#heading--controllers&quot;">Rack controller</a></td>
<td align="right">2048</td>
<td align="right">2.0</td>
<td align="right">20</td>
</tr>
<tr>
<td align="left">Ubuntu Server (including logs)</td>
<td align="right">512</td>
<td align="right">0.5</td>
<td align="right">5</td>
</tr>
</tbody>
</table>
<p>So, based on the above, the approximate requirements for this scenario are:</p>
<ul style="margin-left:4px; list-style-type:disc;">
<li>A region controller (including PostgreSQL) installed on one host, with 4.5 GB memory, 4.5 GHz CPU, and 45 GB of disk space.</li>
<li>A duplicate region controller (including PostgreSQL) on a second host, also with 4.5 GB memory, 4.5 GHz CPU, and 45 GB of disk space.</li>
<li>A rack controller installed on a third host, with 2.5 GB memory, 2.5 GHz CPU, and 40 GB of disk space.</li>
<li>A duplicate rack controller on a fourth host, also with 2.5 GB memory, 2.5 GHz CPU, and 40 GB of disk space.</li>
</ul>
<p>The tables above refer to MAAS infrastructure only. They do not cover the resources needed by subsequently-added nodes. Note that machines should have IPMI-based BMC controllers for power cycling, see <a href="power-management-reference.html">Power management</a> for more details.</p>
<p>Some examples of factors that influence hardware specifications include:</p>
<ul style="margin-left:4px; list-style-type:disc;">
<li>the number of connecting clients (client activity)</li>
<li>how you decide to distribute services</li>
<li>whether or not you use <a href="how-to-enable-high-availability.html">high availability/load balancing</a>.</li>
<li>the number of images that you choose to store (disk space affecting PostgreSQL and the rack controller)</li>
</ul>
<p>Also, this discussion does not take into account a possible local image mirror, which would be a large consumer of disk space.</p>
<p>One rack controller should only service 1000 machines or less, regardless of how you distribute them across subnets. There is no load balancing at the rack level, so you will need additional, independent rack controllers. Each controller must service its own subnet(s).</p>
<p><a href="#heading--upgrade-from-3-1-to-3-2"><h2 id="heading--upgrade-from-3-1-to-3-2">How to ugprade from MAAS 3.1 to MAAS 3.2</h2></a></p>
<p>To upgrade from MAAS 3.1 to MAAS 3.2:</p>
<ol>
<li>
<p>Back up your MAAS server completely; the tools and media are left entirely to your discretion.  Just be sure that you can definitely restore your previous configuration, should this procedure fail to work correctly.</p>
</li>
<li>
<p>Add the MAAS 3.1 PPA to your repository list with the following command, ignoring any apparent error messages:</p>
</li>
</ol>
<pre><code>sudo apt-add-repository ppa:maas/3.2
</code></pre>
<ol>
<li>Run the MAAS upgrade like this:</li>
</ol>
<pre><code>sudo apt update
sudo apt upgrade maas
</code></pre>
<ol>
<li>
<p>Check your running MAAS install (by looking at the information on the bottom of the machine list) to make sure you&rsquo;re running the 3.2 release.</p>
</li>
<li>
<p>If this didn&rsquo;t work, you will need to restore from the backup you made in step 1, and consider obtaining separate hardware to install MAAS 3.2.</p>
</li>
</ol>
<p><a href="#heading--upgrade-from-2-8-to-3-2"><h2 id="heading--upgrade-from-2-8-to-3-2">How to upgrade from MAAS 2.8 or lower to MAAS 3.2</h2></a></p>
<p>If you are running MAAS 2.8 or lower, you can upgrade directly to MAAS 3.2. You must first make sure that the target system is running Ubuntu 20.04 LTS or higher, by executing the following command:</p>
<pre><code>lsb_release -a
</code></pre>
<p>The response should look something like this:</p>
<pre><code>Distributor ID: Ubuntu
Description:    Ubuntu xx.yy
Release:    xx.yy
Codename:   $RELEASE_NAME
</code></pre>
<p>The minimum &ldquo;xx.yy&rdquo; required for MAAS 3.2 is &ldquo;20.04,&rdquo; code-named &ldquo;focal.&rdquo;</p>
<p>If you are currently running Ubuntu bionic 18.04 LTS, you can upgrade to focal 20.04 LTS with the following procedure:</p>
<ol>
<li>Upgrade the release:</li>
</ol>
<pre><code>sudo do-release-upgrade --allow-third-party
</code></pre>
<ol>
<li>
<p>Accept the defaults for any questions asked by the upgrade script.</p>
</li>
<li>
<p>Reboot the machine when requested.</p>
</li>
<li>
<p>Check whether the upgrade was successful:</p>
</li>
</ol>
<pre><code>lsb_release -a
</code></pre>
<p>A successful upgrade should respond with output similar to the following:</p>
<pre><code>Distributor ID: Ubuntu
Description:    Ubuntu 20.04(.nn) LTS
Release:    20.04
Codename:   focal
</code></pre>
<p><strong>NOTE:</strong> 
If you&rsquo;re upgrading from MAAS version 2.8 or lower to version 3.2: While the following procedures should work, note that they are untested.  Use at your own risk.  Start by making a verifiable backup; see step 1, below.</p>
<ol>
<li>
<p>Back up your MAAS server completely; the tools and media are left entirely to your discretion.  Just be sure that you can definitely restore your previous configuration, should this procedure fail to work correctly.</p>
</li>
<li>
<p>Add the MAAS 3.2 PPA to your repository list with the following command, ignoring any apparent error messages:</p>
</li>
</ol>
<pre><code>sudo apt-add-repository ppa:maas/3.2
</code></pre>
<ol>
<li>Run the release upgrade like this, answering any questions with the given default values:</li>
</ol>
<pre><code>sudo do-release-upgrade --allow-third-party
</code></pre>
<ol>
<li>Check whether your upgrade has been successful by entering:</li>
</ol>
<pre><code>lsb_release -a
</code></pre>
<p>If the ugprade was successful, this command should yield output similar to the following:</p>
<pre><code>No LSB modules are available.
Distributor ID: Ubuntu
Description:    Ubuntu 20.04(.nn) LTS
Release:    20.04
Codename:   focal
</code></pre>
<ol>
<li>
<p>Check your running MAAS install (by looking at the information on the bottom of the machine list) to make sure you&rsquo;re running the 3.2 release.</p>
</li>
<li>
<p>If this didn&rsquo;t work, you will need to restore from the backup you made in step 1, and consider obtaining separate hardware to install MAAS 3.2.</p>
</li>
</ol>
<p><a href="#heading--fresh-install-3-2-packages"><h2 id="heading--fresh-install-3-2-packages">How to do a fresh install of MAAS 3.2 from packages</h2></a></p>
<p>MAAS 3.2 can be installed from packages by adding the <code>ppa:maas/3.2</code> PPA:</p>
<pre><code>sudo add-apt-repository ppa:maas/3.2
sudo apt update
sudo apt install maas
</code></pre>
<p>You can then install MAAS 3.2 fresh (recommended) with:</p>
<pre><code>sudo apt-get -y install maas
</code></pre>
<p><a href="#heading--create-a-maas-user"><h2 id="heading--create-a-maas-user">How to create a MAAS 3.2 RC1 user</h2></a></p>
<p>You will need to create a MAAS administrator user to access the web UI:</p>
<pre><code class="language-nohighlight">sudo maas createadmin --username=$PROFILE --email=$EMAIL_ADDRESS
</code></pre>
<p>$PROFILE is the administrative MAAS username you wish to create.  $EMAIL_ADDRESS is an email address you may type in at random (currently, MAAS does not use this email address).</p>
<p>The <code>createadmin</code> option will ask for an SSH key.  If you have an SSH key associated with your launchpad or github accounts, you can enter the username here to use the associated key. For launchpad, just enter <code>lp:username</code>, and for github, enter <code>gh:username</code> at the prompt. In both cases, the actual username has to be supplied after the <code>lp:</code> or <code>gh:</code> prefix.</p>
<p><a href="#heading--service-status"><h2 id="heading--service-status">How to check the status of MAAS services</h2></a></p>
<p>You can check the status of running services with:</p>
<pre><code>sudo maas status
</code></pre>
<p>Typically, the output looks something like this:</p>
<pre><code>bind9                            RUNNING   pid 7999, uptime 0:09:17
dhcpd                            STOPPED   Not started
dhcpd6                           STOPPED   Not started
ntp                              RUNNING   pid 8598, uptime 0:05:42
postgresql                       RUNNING   pid 8001, uptime 0:09:17
proxy                            STOPPED   Not started
rackd                            RUNNING   pid 8000, uptime 0:09:17
regiond:regiond-0                RUNNING   pid 8003, uptime 0:09:17
regiond:regiond-1                RUNNING   pid 8008, uptime 0:09:17
regiond:regiond-2                RUNNING   pid 8005, uptime 0:09:17
regiond:regiond-3                RUNNING   pid 8015, uptime 0:09:17
tgt                              RUNNING   pid 8040, uptime 0:09:15
</code></pre>
<p><a href="#heading--reinitialising-maas"><h3 id="heading--reinitialising-maas">How to re-initialise MAAS</h3></a></p>
<p>It is also possible to re-initialise MAAS to switch modes.  For example, to switch from <code>rack</code> to <code>region</code>:</p>
<pre><code>sudo maas init region
</code></pre>
<p><a href="#heading--additional-init-options"><h2 id="heading--additional-init-options">How to list additional MAAS initialisation options</h2></a></p>
<p>The <code>init</code> command can takes optional arguments. To list them, as well as read a brief description of each, you can enter:</p>
<pre><code>sudo maas init --help
</code></pre>
<p><a href="#heading--configure-maas"><h2 id="heading--configure-maas">How to configure MAAS</h2></a></p>
<p>Once you&rsquo;ve successfully installed MAAS (regardless of method), you can login to the MAAS CLI via the following process.  First, generate the API-key for the user you&rsquo;re going to employing:</p>
<pre><code>sudo maas apikey --username=$PROFILE &gt; api-key-file
</code></pre>
<p>Replace $PROFILE with whatever username you set during the <code>createadmin</code> part of the install process.  Next, login with the following command:</p>
<pre><code>maas login $PROFILE $MAAS_URL &lt; api-key-file
</code></pre>
<p>Substitute $MAAS_URL with the URL that was returned to you when you initialised MAAS, for example, <code>192.168.43.251:5240/MAAS</code>.  Remember that, once you&rsquo;ve logged in, you can get extensive CLI help with the command:</p>
<pre><code>maas admin --help
</code></pre>
<p>Sample output is shown in the detail section below.</p>
<p><details><summary>MAAS CLI help, sample output</summary>
usage: maas admin [-h] COMMAND &hellip;</p>
<p>Issue commands to the MAAS region controller at <code>http://192.168.43.251:5240/MAAS/api/2.0/.</code></p>
<p>optional arguments:
  -h, &ndash;help            show this help message and exit</p>
<p>drill down:
  COMMAND
    account             Manage the current logged-in user.
    bcache-cache-set    Manage bcache cache set on a machine.
    bcache-cache-sets   Manage bcache cache sets on a machine.
    bcache              Manage bcache device on a machine.
    bcaches             Manage bcache devices on a machine.
    block-device        Manage a block device on a machine.
    block-devices       Manage block devices on a machine.
    boot-resource       Manage a boot resource.
    boot-resources      Manage the boot resources.
    boot-source         Manage a boot source.
    boot-source-selection
                        Manage a boot source selection.
    boot-source-selections
                        Manage the collection of boot source selections.
    boot-sources        Manage the collection of boot sources.
    commissioning-script
                        Manage a custom commissioning script.
    commissioning-scripts
                        Manage custom commissioning scripts.
    dhcpsnippet         Manage an individual DHCP snippet.
    dhcpsnippets        Manage the collection of all DHCP snippets in MAAS.
    dnsresource         Manage dnsresource.
    dnsresource-record  Manage dnsresourcerecord.
    dnsresource-records
                        Manage DNS resource records (e.g. CNAME, MX, NS, SRV,
                        TXT)
    dnsresources        Manage dnsresources.
    device              Manage an individual device.
    devices             Manage the collection of all the devices in the MAAS.
    discoveries         Query observed discoveries.
    discovery           Read or delete an observed discovery.
    domain              Manage domain.
    domains             Manage domains.
    events              Retrieve filtered node events.
    fabric              Manage fabric.
    fabrics             Manage fabrics.
    fan-network         Manage Fan Network.
    fan-networks        Manage Fan Networks.
    file                Manage a FileStorage object.
    files               Manage the collection of all the files in this MAAS.
    ipaddresses         Manage IP addresses allocated by MAAS.
    iprange             Manage IP range.
    ipranges            Manage IP ranges.
    interface           Manage a node&rsquo;s or device&rsquo;s interface.
    interfaces          Manage interfaces on a node.
    license-key         Manage a license key.
    license-keys        Manage the license keys.
    maas                Manage the MAAS server.
    machine             Manage an individual machine.
    machines            Manage the collection of all the machines in the MAAS.
    network             Manage a network.
    networks            Manage the networks.
    node                Manage an individual Node.
    node-results        Read the collection of commissioning script results.
    node-script         Manage or view a custom script.
    node-script-result  Manage node script results.
    node-script-results
                        Manage node script results.
    node-scripts        Manage custom scripts.
    nodes               Manage the collection of all the nodes in the MAAS.
    notification        Manage an individual notification.
    notifications       Manage the collection of all the notifications in
                        MAAS.
    package-repositories
                        Manage the collection of all Package Repositories in
                        MAAS.
    package-repository  Manage an individual package repository.
    partition           Manage partition on a block device.
    partitions          Manage partitions on a block device.
    pod                 Manage an individual pod.
    pods                Manage the collection of all the pod in the MAAS.
    rack-controller     Manage an individual rack controller.
    rack-controllers    Manage the collection of all rack controllers in MAAS.
    raid                Manage a specific RAID (Redundant Array of Independent
                        Disks) on a machine.
    raids               Manage all RAIDs (Redundant Array of Independent
                        Disks) on a machine.
    region-controller   Manage an individual region controller.
    region-controllers  Manage the collection of all region controllers in
                        MAAS.
    resource-pool       Manage a resource pool.
    resource-pools      Manage resource pools.
    sshkey              Manage an SSH key.
    sshkeys             Manage the collection of all the SSH keys in this
                        MAAS.
    sslkey              Manage an SSL key.
    sslkeys             Operations on multiple keys.
    space               Manage space.
    spaces              Manage spaces.
    static-route        Manage static route.
    static-routes       Manage static routes.
    subnet              Manage subnet.
    subnets             Manage subnets.
    tag                 Tags are properties that can be associated with a Node
                        and serve as criteria for selecting and allocating
                        nodes.
    tags                Manage all tags known to MAAS.
    user                Manage a user account.
    users               Manage the user accounts of this MAAS.
    version             Information about this MAAS instance.
    vlan                Manage a VLAN on a fabric.
    vlans               Manage VLANs on a fabric.
    vm-host             Manage an individual vm-host.
    vm-hosts            Manage the collection of all the vm-hosts in the MAAS.
    vmfs-datastore      Manage VMFS datastore on a machine.
    vmfs-datastores     Manage VMFS datastores on a machine.
    volume-group        Manage volume group on a machine.
    volume-groups       Manage volume groups on a machine.
    zone                Manage a physical zone.
    zones               Manage physical zones.</p>
<p>This is a profile.  Any commands you issue on this profile will
operate on the MAAS region server.</p>
<p>The command information you see here comes from the region server&rsquo;s
API; it may differ for different profiles.  If you believe the API may
have changed, use the command&rsquo;s &lsquo;refresh&rsquo; sub-command to fetch the
latest version of this help information from the server.
</details></p>
<p><a href="#heading--configuration"><h3 id="heading--configuration">Configuration</h3></a></p>
<p>Configuring MAAS consists of four broad steps:</p>
<ol>
<li>Setting upstream DNS</li>
<li>Importing an SSH key for your admin user</li>
<li>Importing images</li>
<li>Configuring DNS</li>
</ol>
<p>This section will cover those four operations</p>
<p><a href="#heading--setting-dns"><h4 id="heading--setting-dns">How to set upstream DNS</h4></a></p>
<p>After logging in for the first time, you will need to set a number of system-wide configuration options.  First up, you should configure DNS.  You can check out the help for DNS settings, known in the CLI as a &ldquo;DNS forwarder&rdquo;:</p>
<pre><code>maas $PROFILE maas set-config name=upstream_dns value=&quot;8.8.8.8&quot;
</code></pre>
<p>Here, we&rsquo;ve set the DNS forwarder to &ldquo;8.8.8.8&rdquo; (Google), which is a reliable value.</p>
<p><a href="#heading--setting-ssh"><h4 id="heading--setting-ssh">How to set up SSH for the admin user</h4></a></p>
<p>To add a public SSH key to a MAAS user account, type the following command:</p>
<pre><code>maas $PROFILE sshkeys create &quot;key=$SSH_KEY&quot;
</code></pre>
<p><a href="#heading--importing-images"><h4 id="heading--importing-images">How to import images</h4></a></p>
<p>Before going any further, it&rsquo;s worthwhile to start the image import, as it can sometimes take a few minutes.  You can see what images you already have downloaded with this command:</p>
<pre><code>maas $PROFILE boot-resources read | jq -r '.[] | &quot;\(.name)\t\(.architecture)&quot;'
</code></pre>
<p>This command will return a list similar to the following:</p>
<pre><code>grub-efi-signed/uefi        amd64/generic
grub-efi/uefi           arm64/generic
grub-ieee1275/open-firmware ppc64el/generic
pxelinux/pxe            i386/generic
ubuntu/bionic           amd64/ga-18.04
ubuntu/bionic           amd64/ga-18.04-lowlatency
ubuntu/bionic           amd64/hwe-18.04
ubuntu/bionic           amd64/hwe-18.04-edge
ubuntu/bionic           amd64/hwe-18.04-lowlatency
ubuntu/bionic           amd64/hwe-18.04-lowlatency-edge
</code></pre>
<p>Suppose you also want a version called &ldquo;Trusty&rdquo; &ndash; you can import a new image by first selecting it for download, like this:</p>
<pre><code>maas $PROFILE boot-source-selections create 1 \ &gt; os=&quot;ubuntu&quot; release=&quot;trusty&quot; arches=&quot;amd64&quot; subarches=&quot;*&quot; \ &gt; labels=&quot;*&quot;
</code></pre>
<p>which returns some JSON confirming your action:</p>
<pre><code>Success.
Machine-readable output follows:
{
    &quot;os&quot;: &quot;ubuntu&quot;,
    &quot;release&quot;: &quot;trusty&quot;,
    &quot;arches&quot;: [
        &quot;amd64&quot;
    ],
    &quot;subarches&quot;: [
        &quot;*&quot;
    ],
    &quot;labels&quot;: [
        &quot;*&quot;
    ],
    &quot;boot_source_id&quot;: 1,
    &quot;id&quot;: 2,
    &quot;resource_uri&quot;: &quot;/MAAS/api/2.0/boot-sources/1/selections/2/&quot;
}
</code></pre>
<p>Once selected, you can start the image import with this command:</p>
<pre><code>maas admin boot-resources import
</code></pre>
<p>which offers a shorter confirmation message:</p>
<pre><code>Success.
Machine-readable output follows:
Import of boot resources started
</code></pre>
<p><a href="#heading--enabling-dhcp"><h4 id="heading--enabling-dhcp">How to enable DHCP</h4></a></p>
<p>Once your image has been imported, you&rsquo;ll want to get DHCP working, which means finding the untagged VLAN. In truth, it shouldn’t be too hard, because at this point, there still should only be one.</p>
<p>In order to turn on DHCP, you need to know two things besides the VLAN name (“untagged”): the fabric ID and the primary rack controller name. To start, all the fabrics will be on the same untagged VLAN, so any fabric will do. You can find a valid fabric ID by reading it from any subnet, so just pick one  (e.g., 192.168.123.0/24) and find a usable fabric ID like this:</p>
<pre><code>maas $PROFILE subnet read $SUBNET_CIDR | grep fabric_id
</code></pre>
<p>which returns (in this example):</p>
<pre><code>&quot;fabric_id&quot;: $FABRIC_ID,
</code></pre>
<p>Next, find the name of the primary rack controller. It&rsquo;s usually fairly obvious, but for purposes of argument, assume that it&rsquo;s not known. You can get it this way:</p>
<pre><code>maas $PROFILE rack-controllers read | grep hostname | cut -d '&quot;' -f 4
</code></pre>
<p>This returns a hostname, which we&rsquo;ll call:</p>
<pre><code>$RACK_CONTR_HOSTNAME
</code></pre>
<p>Finally, you need to create an IP range for DHCP, in this case, a dynamic range:</p>
<pre><code>maas $PROFILE ipranges create type=dynamic start_ip=$START_IP end_ip=$END_IP
</code></pre>
<p>This command returns something similar to this sample output:</p>
<pre><code>Success.
Machine-readable output follows:
{
    "subnet": {
        "name": "192.168.123.0/24",
        "description": "",
        "vlan": {
            "vid": 0,
            "mtu": 1500,
            "dhcp_on": false,
            "external_dhcp": null,
            "relay_vlan": null,
            "fabric": "fabric-2",
            "primary_rack": null,
            "name": "untagged",
            "id": 5003,
            "space": "undefined",
            "secondary_rack": null,
            "fabric_id": 2,
            "resource_uri": "/MAAS/api/2.0/vlans/5003/"
        },
        "cidr": "192.168.123.0/24",
        "rdns_mode": 2,
        "gateway_ip": null,
        "dns_servers": [],
        "allow_dns": true,
        "allow_proxy": true,
        "active_discovery": false,
        "managed": true,
        "id": 4,
        "space": "undefined",
        "resource_uri": "/MAAS/api/2.0/subnets/4/"
    },
    "type": "dynamic",
    "start_ip": "192.168.123.190",
    "end_ip": "192.168.123.253",
    "user": {
        "is_superuser": true,
        "username": "admin",
        "email": "admin@admin.com",
        "is_local": true,
        "resource_uri": "/MAAS/api/2.0/users/admin/"
    },
    "comment": "",
    "id": 1,
    "resource_uri": "/MAAS/api/2.0/ipranges/1/"
}
</code></pre>
<p>So you should now be able to turn on DHCP like this:</p>
<pre><code>maas $PROFILE vlan update $FABRIC_ID untagged dhcp_on=True primary_rack=$RACK_CONTR_HOSTNAME
</code></pre>
<p>If you&rsquo;ve done everything correctly, you should see JSON output similar to this sample:</p>
<pre><code>Success.
Machine-readable output follows:
{
    "vid": 0,
    "mtu": 1500,
    "dhcp_on": true,
    "external_dhcp": null,
    "relay_vlan": null,
    "fabric": "fabric-2",
    "space": "undefined",
    "primary_rack": "8dwnne",
    "secondary_rack": null,
    "name": "untagged",
    "fabric_id": 2,
    "id": 5003,
    "resource_uri": "/MAAS/api/2.0/vlans/5003/"
}
</code></pre>
    </div>
  </body>
</html>