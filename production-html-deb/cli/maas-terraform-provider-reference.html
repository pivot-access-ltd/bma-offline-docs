<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" type="text/css" href="css/stylesheet.css" />
    <style>
      #selector a:link{color:black;}
      #selector a:visited{color:black;}
      #selector a:active{color:black;}
      #selector a:hover{color:blue;}
      #sidebar a:link{color:black;}
      #sidebar a:visited{color:black;}
      #sidebar a:active{color:black;}
      #sidebar a:hover{color:blue;}
      ul {margin-left:0;list-style-type:none;}
      li {margin: 4px 0;}
    </style>
  </head>
  <body>
    <div id="selector" style="top:0; position:fixed; float:right; background-color:#d9d9d9; width:100%;border-bottom:1px solid black;">
      &nbsp;&nbsp;<strong>Offline docs</strong>
      <a href="https://maas.io/docs">(switch to live docs)</a>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
	<a href="../ui/maas-terraform-provider-reference.html">
	  UI-only
	</a>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      <span style="background-color:white;border-top:1px solid black; border-left:1px solid black; border-right:1px solid black; border-bottom:5px solid white;">
	  &nbsp;CLI-only&nbsp;
      </span>
    </div>
    <div id="sidebar" style="float:left; width:25%;margin-top:40px; margin-left:20px">
      <strong>
	<a href="maas-documentation.html">
	  Home
	</a>
      </strong>
      <ul>
	<li>
	  <a href="what-is-new-with-maas.html">
	    Release notes
	  </a>
	</li>
      </ul>
      <p/>
      <strong>
	  Tutorials
      </strong>
      <ul>
	<li>
	  <a href="get-started-with-maas.html">
	    Get started with MAAS
	  </a>
	</li>
	<li>
	  <a href="maas-cli-tutorial.html">
	    Try out the MAAS CLI
	  </a>
	</li>
	<li>
	  <a href="create-a-custom-image.html">
	    Create a custom image
	  </a>
	</li>
	<li>
	  <a href="using-jq-with-the-maas-cli.html">
	    Using jq with the MAAS CLI
	  </a>
	</li>
      </ul>
      <strong>
	  How to get MAAS running
      </strong>
      <ul>
	<li>
	  <a href="how-to-install-maas.html">
	    Installation
	  </a>
	</li>
		<li>
	  <a href="how-to-upgrade-maas.html">
	    Upgrade older versions
	  </a>
	</li>
	<li>
	  <a href="how-to-troubleshoot-maas.html">
	    Troubleshooting
	  </a>
	</li>
      </ul>
      <strong>
	  How to configure networking
      </strong>
      <ul>
	<li>
	  <a href="how-to-manage-networks.html">
	    Manage networks
	  </a>
	</li>
	<li>
	  <a href="how-to-manage-ip-addresses.html">
	    Manage IP addresses
	  </a>
	</li>
	<li>
	  <a href="how-to-enable-tls-encryption.html">
	    Enable TLS
	  </a>
	</li>
	<li>
	  <a href="how-to-manage-availability-zones.html">
	    Manage zones
	  </a>
	</li>
      </ul>
      <strong>
	  How to choose images
      </strong>
      <ul>
	<li>
	  <a href="how-to-import-images.html">
	    Import images
	  </a>
	</li>
	<li>
	  <a href="how-to-create-custom-images.html">
	    Create custom images
	  </a>
	</li>
	<li>
	  <a href="how-to-mirror-images-locally.html">
	    Mirror images locally
	  </a>
	</li>
	<li>
	  <a href="how-to-manage-vmware-images.html">
	    Manage VMWare images
	  </a>
	</li>
      </ul>
      <strong>
	  How to deploy MAAS
      </strong>
      <ul>
	<li>
	  <a href="how-to-manage-controllers.html">
	    Manage controllers
	  </a>
	</li>
	<li>
	  <a href="how-to-manage-machines.html">
	    Manage machines
	  </a>
	</li>
	<li>
	  <a href="how-to-deploy-machines.html">
	    Deploy machines
	  </a>
	</li>
	<li>
	  <a href="how-to-customise-machines.html">
	    Customise machines
	  </a>
	</li>
	<li>
	  <a href="how-to-manage-vm-hosts.html">
	    Manage VM hosts
	  </a>
	</li>
	<li>
	  <a href="how-to-manage-vms.html">
	    Manage VMs
	  </a>
	</li>
	<li>
	  <a href="how-to-use-lxd.html">
	    Use LXD
	  </a>
	</li>
      </ul>
      <strong>
	  How to use tags
      </strong>
      <ul>
	<li>
	  <a href="how-to-work-with-tags.html">
	    Work with tags
	  </a>
	</li>
	<li>
	  <a href="how-to-work-with-annotations.html">
	    Work with annotations
	  </a>
	</li>
	<li>
	  <a href="how-to-use-machine-tags.html">
	    Use machine tags
	  </a>
	</li>
	<li>
	  <a href="how-to-use-controller-tags.html">
	    Use controller tags
	  </a>
	</li>
	<li>
	  <a href="how-to-use-storage-tags.html">
	    Use storage tags
	  </a>
	</li>
	<li>
	  <a href="how-to-use-network-tags.html">
	    Use network tags
	  </a>
	</li>
      </ul>
      <strong>
	  How to operate MAAS
      </strong>
	<ul>
	  <li>
	    <a href="how-to-enable-high-availability.html">
	      Enable HA
	    </a>
	  </li>
	  <li>
	    <a href="how-to-set-up-maas-metrics.html">
	      Set up MAAS metrics
	    </a>
	  </li>
	  <li>
	    <a href="how-to-work-with-audit-event-logs.html">
	      Work with audit event logs
	    </a>
	  </li>
	<li>
	  <a href="how-to-use-maas-in-an-air-gapped-environment.html">
	    Use air-gapped MAAS
	  </a>
	</li>
	  <li>
	  <a href="how-to-back-up-maas.html">
	    Back up MAAS
	  </a>
	</li>
	<li>
	  <a href="how-to-secure-maas.html">
	    Secure MAAS
	  </a>
	</li>
	<li>
	  <a href="how-to-manage-user-accounts.html">
	    Manage users
	  </a>
	</li>
	<li>
	  <a href="how-to-search-maas.html">
	    Search MAAS
	  </a>
	</li>
	</ul>
      <p/>
      <strong>
	  API Reference
      </strong>
      <ul>
	<li>
	  <a href="api-authentication-reference.html">
	    API authentication
	  </a>
	</li>
	<li>
	  <a href="api.html">
	    API documentation
	  </a>
	</li>
	<li>
	  <a href="python-api-client-reference.html">
	    API client
	  </a>
	</li>
      </ul>
      <p/>
      <strong>
	Technical Reference
      </strong>
      <ul>
	<li>
	  <a href="audit-event-log-reference.html">
	    Audit event log reference
	  </a>
	</li>
	<li>
	  <a href="commissioning-scripts-reference.html">
	    Commissioning scripts
	  </a>
	</li>
	<li>
	  <a href="hardware-test-scripts-reference.html">
	    Hardware test scripts
	  </a>
	</li>
	<li>
	  <a href="maas-logging-reference.html">
	    Log files
	  </a>
	</li>
	<li>
	  <a href="maas-performance.html">
	    MAAS performance
	  </a>
	</li>
	<li>
	  <a href="power-management-reference.html">
	    Power management
	  </a>
	</li>
	<li>
	  <a href="storage-layouts-reference.html">
	    Storage reference
	  </a>
	</li>
	<p/>
	<strong>
	  General Reference
	</strong>
	<li>
	  <a href="what-is-new-with-maas.html">
	    Release notes
	  </a>
	</li>
	<li>
	  <a href="installation-requirements.html">
	    Installation requirements
	  </a>
	</li>

	<li>
	  <a href="maas-concepts-and-terms-reference.html">
	    Concepts & terms
	  </a>
	</li>
	<li>
	  <a href="how-to-get-help.html">
	    Getting help
	  </a>
	</li>
      </ul>
      <p/>
      <strong>
	  Explanations
      </strong>
      <ul>
	<li>
	  <a href="about-maas.html">
	    MAAS
	  </a>
	</li>
	<li>
	  <a href="about-tcp-ip-networks.html">
	    TCP/IP networks
	  </a>
	</li>
	<li>
	  <a href="about-cloud-networks.html">
	    Cloud networks
	  </a>
	</li>
	<li>
	  <a href="about-dhcp.html">
	    DHCP
	  </a>
	</li>
	<li>
	  <a href="about-networking.html">
	    MAAS networking
	  </a>
	</li>
	<li>
	  <a href="about-images.html">
	    Images
	  </a>
	</li>
	<li>
	  <a href="about-creating-custom-images.html">
	    Custom images
	  </a>
	</li>
	<li>
	  <a href="about-controllers.html">
	    Controllers
	  </a>
	</li>
	<li>
	  <a href="about-machines.html">
	    Machines
	  </a>
	</li>
	<li>
	  <a href="about-customising-machines.html">
	    Customising machines
	  </a>
	</li>
	<li>
	  <a href="about-vm-hosting.html">
	    VM hosting
	  </a>
	</li>
      </ul>
    </div>
    <div class="container" style="float:right; width:65%; margin-top:40px; margin-right:30px">
  <h1>MAAS Terraform provider reference</h1><!-- "MAAS Terraform provider reference" -->
<p>If you wish to use MAAS with <a href="https://www.terraform.io/">Terraform</a>, there is a <a href="https://github.com/maas/terraform-provider-maas">provider avaiable</a>, supplied by a third party.  This article provides reference information about the data sources and resources available through the provider.  It does not attempt to explain the mechanics or usage of Terraform or offer any tutorial information related to this MAAS Terraform provider.</p>
<p><a href="#heading--what-is-this"><h1 id="heading--what-is-this">The MAAS Terraform provider</h1></a></p>
<p>The MAAS provider is a Terraform provider that allows you to manage MAAS resources using the Terraform (CRUD) tool. This provider can be used to manage many aspects of a MAAS environment, including networking, users, machines, and VM hosts.</p>
<p>These aspects can be divided into three categories of Terraform-compliant HCL:</p>
<ul style="margin-left:4px; list-style-type:disc;">
<li><a href="#heading--terraform-api-linkage">API linkages</a></li>
<li><a href="#heading--data-sources">Data sources</a></li>
<li><a href="#heading--resources">Resources</a></li>
</ul>
<p>We will deal with each of these categories in turn.  For each data source and resource, we will offer a brief definition and description of how that item is employed in MAAS.  If you are new to <a href="https://www.terraform.io/">Terraform</a>, or want to explore what terraforming may provide for your MAAS instance, you may wish to consult the <a href="https://www.terraform.io/intro">Terraform documentation</a> or one of the many <a href="https://learn.hashicorp.com/collections/terraform/aws-get-started?utm_source=WEBSITE&amp;utm_medium=WEB_IO&amp;utm_offer=ARTICLE_PAGE&amp;utm_content=DOCS">tutorials available</a>.</p>
<p><a href="#heading--terraform-api-linkage"><h2 id="heading--terraform-api-linkage">API linkages</h2></a></p>
<p>The schema that provides an API linkage to MAAS from Terraform consists of a standard HCL provider block and a provider API block.  As with all Terraform providers, the provider block contains at least two items:</p>
<ul style="margin-left:4px; list-style-type:disc;">
<li>a source element, which in this case is &ldquo;maas/maas&rdquo;.</li>
<li>a version element, which can be sufficiently specified by &ldquo;~&gt;1.0&rdquo;.</li>
</ul>
<p>The provider block would look something like this:</p>
<pre><code class="language-nohighlight">terraform {
  required_providers {
    maas = {
      source  = &quot;maas/maas&quot;
      version = &quot;~&gt;1.0&quot;
    }
  }
}
</code></pre>
<p>The provider API block contains the necessary credentials to allow Terraform to access your MAAS instance, which include three things:</p>
<ul style="margin-left:4px; list-style-type:disc;">
<li>an API version.</li>
<li>an API key.</li>
<li>an API URL.</li>
</ul>
<p>A typical provider API block might look like this:</p>
<pre><code class="language-nohighlight">provider &quot;maas&quot; {
  api_version = &quot;2.0&quot;
  api_key = &quot;&lt;YOUR API KEY&gt;&quot;
  api_url = &quot;http://127.0.0.1:5240/MAAS&quot;
}
</code></pre>
<p>A completed definition would also include some data sources and resources, like this typical example:</p>
<pre><code class="language-nohighlight">terraform {
  required_providers {
    maas = {
      source  = &quot;maas/maas&quot;
      version = &quot;~&gt;1.0&quot;
    }
  }
}

provider &quot;maas&quot; {
  api_version = &quot;2.0&quot;
  api_key = &quot;&lt;YOUR API KEY&gt;&quot;
  api_url = &quot;&lt;YOUR API URL&gt;&quot;
}

resource &quot;maas_space&quot; &quot;tf_space&quot; {
  name = &quot;tf-space&quot;
}

resource &quot;maas_fabric&quot; &quot;tf_fabric&quot; {
  name = &quot;tf-fabric&quot;
}

resource &quot;maas_vlan&quot; &quot;tf_vlan&quot; {
  fabric = maas_fabric.tf_fabric.id
  vid = 14
  name = &quot;tf-vlan14&quot;
  space = maas_space.tf_space.name
}
resource &quot;maas_subnet&quot; &quot;tf_subnet&quot; {
  cidr = &quot;10.88.88.0/24&quot;
  fabric = maas_fabric.tf_fabric.id
  vlan = maas_vlan.tf_vlan.vid
  name = &quot;tf_subnet&quot;
  gateway_ip = &quot;10.88.88.1&quot;
  dns_servers = [
    &quot;1.1.1.1&quot;,
  ]
  ip_ranges {
    type = &quot;reserved&quot;
    start_ip = &quot;10.88.88.1&quot;
    end_ip = &quot;10.88.88.50&quot;
  }
  ip_ranges {
    type = &quot;dynamic&quot;
    start_ip = &quot;10.88.88.200&quot;
    end_ip = &quot;10.88.88.254&quot;
  }
}
</code></pre>
<p>See the <a href="https://www.terraform.io/language">Terraform HCL documentation</a> for more details about these blocks.</p>
<p><a href="#heading--data-sources"><h2 id="heading--data-sources">Data sources</h2></a></p>
<p>The MAAS Terraform provider offers three data sources, all representing network elements:</p>
<ul style="margin-left:4px; list-style-type:disc;">
<li>a <a href="maas-concepts-and-terms-reference.html#heading--fabrics">fabric</a>, which is essentially a VLAN namespace &ndash; that is, it connects two or more VLANs together.</li>
<li>a <a href="maas-concepts-and-terms-reference.html#heading--subnets">subnet</a>, which is the traditional way of dividing up IP addresses into smaller networks, e.g., 192.168.15.0/24.</li>
<li>a <a href="https://en.wikipedia.org/wiki/VLAN">VLAN</a>, a &ldquo;virtual LAN&rdquo;, which is a collection of specific addresses or ports that are connected together to form a restricted network.</li>
</ul>
<p>Each of these data sources has a specific HCL block with elements structured appropriately to manage that MAAS element.</p>
<p><a href="#heading--fabric"><h3 id="heading--fabric">Fabric</h3></a></p>
<p>The <a href="https://github.com/maas/terraform-provider-maas/blob/master/docs/data_sources/maas_fabric.md">fabric</a> data source provides minimal details, namely, the fabric ID, of an existing MAAS fabric.  It takes one argument (the fabric name) and exports one attribute (the fabric ID):</p>
<pre><code class="language-nohighlight">data &quot;maas_fabric&quot; &quot;default&quot; {
  name = &quot;maas&quot;
}
</code></pre>
<p>Fabrics within MAAS are not widely manipulated in and of themselves, but rather serve as containers for storing VLAN/subnet combinations.</p>
<p><a href="#heading--subnet"><h3 id="heading--subnet">Subnet</h3></a></p>
<p>The <a href="https://github.com/maas/terraform-provider-maas/blob/master/docs/data_sources/maas_subnet.md">subnet</a> data source provides a number of details about an existing MAAS network subnet.  The element takes one argument, the subnet CIDR, and exports a number of attributes:</p>
<ul style="margin-left:4px; list-style-type:disc;">
<li>id - The subnet ID.</li>
<li>fabric - The subnet fabric.</li>
<li>vid - The subnet VLAN traffic segregation ID.</li>
<li>name - The subnet name.</li>
<li>rdns_mode - How reverse DNS is handled for this subnet. It can have one of the following values:
&ndash; 0 - Disabled, no reverse zone is created.
&ndash; 1 - Enabled, generate reverse zone.
&ndash; 2 - RFC2317, extends 1 to create the necessary parent zone with the appropriate CNAME resource records for the network, if the network is small enough to require the support described in RFC2317.</li>
<li>allow_dns - Boolean value that indicates if the MAAS DNS resolution is enabled for this subnet.</li>
<li>allow_proxy - Boolean value that indicates if maas-proxy allows requests from this subnet.</li>
<li>gateway_ip - Gateway IP address for the subnet.</li>
<li>dns_servers - List of IP addresses set as DNS servers for the subnet.</li>
</ul>
<p>Declaring a subnet looks something like this example:</p>
<pre><code class="language-nohighlight">data &quot;maas_subnet&quot; &quot;vid10&quot; {
  cidr = &quot;10.10.0.0/16&quot;
}
</code></pre>
<p>Subnets are the network backbone of MAAS, and thus provide a number of attributes that can be manipulated to alter the behavior of MAAS.</p>
<p><a href="#heading--vlan"><h3 id="heading--vlan">VLAN</h3></a></p>
<p>The <a href="https://github.com/maas/terraform-provider-maas/blob/master/docs/data_sources/maas_vlan.md">VLAN</a> data source provides details about an existing MAAS VLAN.  A VLAN takes two arguments:</p>
<ul style="margin-left:4px; list-style-type:disc;">
<li>fabric - (Required) The fabric identifier (ID or name) for the VLAN.</li>
<li>vlan - (Required) The VLAN identifier (ID or traffic segregation ID).</li>
</ul>
<p>A VLAN data source exports a few useful attributes:</p>
<ul style="margin-left:4px; list-style-type:disc;">
<li>mtu - The MTU used on the VLAN.</li>
<li>dhcp_on - Boolean value indicating if DHCP is enabled on the VLAN.</li>
<li>name - The VLAN name.</li>
<li>space - The VLAN space.</li>
</ul>
<p>VLAN <a href="maas-concepts-and-terms-reference.html#heading--spaces">spaces</a> are used mostly by Juju, but can be employed by other tools, if desired.</p>
<p>The typical definition of a MAAS VLAN in HCL might look like this:</p>
<pre><code class="language-nohighlight">data &quot;maas_vlan&quot; &quot;vid10&quot; {
  fabric = data.maas_fabric.default.id
  vlan = 10
}
</code></pre>
<p>VLANs are available as data sources, but generally, subnets are the workhorses of most MAAS instances.</p>
<p><a href="#heading--resources"><h2 id="heading--resources">Resources</h2></a></p>
    </div>
  </body>
</html>